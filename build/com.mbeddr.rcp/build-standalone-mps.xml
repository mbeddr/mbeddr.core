<project name="jetbrains.mps.standalone" default="build">
  <!-- Generated by MPS -->
  <property name="build.dir" location="build" />
  <property name="build.tmp" location="${build.dir}/tmp/jetbrains.mps.standalone" />
  <property name="build.layout" location="${build.dir}/artifacts/jetbrains.mps.standalone" />
  <property name="mps.home" location="${basedir}/../../../../MPS 3.1 EAP.app" />
  <property name="buildnumber" value="130.001" />
  <property name="date" value="20130805" />
  <property name="artifacts.mpsStandalone" location="${mps.home}" />
  <property file="${artifacts.mpsStandalone}/build.properties" prefix="import.mpsStandalone" />
  <property name="mpsBootstrapCore.version" value="${import.mpsStandalone.mpsBootstrapCore.version}" />
  
  <target name="assemble" depends="classes, declare-mps-tasks, fetchDependencies">
    <mkdir dir="${build.layout}/bin" />
    <copy todir="${build.layout}/bin">
      <fileset dir="${artifacts.mpsStandalone}/bin">
        <include name="log.xml" />
        <include name="log4j.dtd" />
      </fileset>
    </copy>
    <copy todir="${build.layout}/bin">
      <fileset file="${mps.home}/bin/idea.properties" />
      <filterchain>
        <tokenfilter>
          <replaceregex pattern="\.MPS(\w+)" replace="\.${buildnumber}" flags="g" />
        </tokenfilter>
      </filterchain>
    </copy>
    <mkdir dir="${build.layout}/license" />
    <copy todir="${build.layout}/license">
      <fileset dir="${artifacts.mpsStandalone}/license" />
    </copy>
    <mkdir dir="${build.layout}/languages" />
    <copy todir="${build.layout}/languages">
      <fileset dir="${artifacts.mpsStandalone}/languages" />
    </copy>
    <mkdir dir="${build.layout}/plugins" />
    <copy todir="${build.layout}/plugins">
      <fileset dir="${artifacts.mpsStandalone}/plugins" />
    </copy>
    <mkdir dir="${build.layout}/lib" />
    <copy todir="${build.layout}/lib">
      <fileset dir="${artifacts.mpsStandalone}/lib">
        <exclude name="MPS-src.zip" />
        <exclude name="branding.jar" />
      </fileset>
    </copy>
    <echo file="${build.layout}/build.number">build.number=${buildnumber}${line.separator}date=${date}${line.separator}version=${mpsBootstrapCore.version}</echo>
    <echo file="${build.layout}/build.properties">mps.build.number=MPS-129.283${line.separator}mps.idea.platform.build.number=IC-111.277${line.separator}mps.date=20130802</echo>
    <echo file="${build.layout}/build.properties">jetbrains.mps.standalone.buildnumber=${buildnumber}${line.separator}jetbrains.mps.standalone.date=${date}${line.separator}mpsBootstrapCore.version=${mpsBootstrapCore.version}</echo>
  </target>
  
  <target name="buildDependents" />
  
  <target name="fetchDependencies" />
  
  <target name="build" depends="assemble" />
  
  <target name="clean">
    <delete dir="${build.tmp}" />
    <delete dir="${build.layout}" />
  </target>
  
  <target name="compileJava" />
  
  <target name="processResources" />
  
  <target name="classes" depends="compileJava, processResources" />
  
  <target name="test" depends="classes" />
  
  <target name="check" depends="test" />
  
  <target name="generate" depends="declare-mps-tasks" />
  
  <target name="declare-mps-tasks" />
  
  <target name="makeDependents" />
</project>
package com.mbeddr.doc.typesystem;

/*Generated by MPS */

import jetbrains.mps.lang.typesystem.runtime.AbstractNonTypesystemRule_Runtime;
import jetbrains.mps.lang.typesystem.runtime.NonTypesystemRule_Runtime;
import org.jetbrains.mps.openapi.model.SNode;
import jetbrains.mps.typesystem.inference.TypeCheckingContext;
import jetbrains.mps.lang.typesystem.runtime.IsApplicableStatus;
import jetbrains.mps.internal.collections.runtime.ListSequence;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SModelOperations;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SNodeOperations;
import jetbrains.mps.errors.messageTargets.MessageTarget;
import jetbrains.mps.errors.messageTargets.PropertyMessageTarget;
import jetbrains.mps.errors.IErrorReporter;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SLinkOperations;
import java.util.Set;
import jetbrains.mps.internal.collections.runtime.SetSequence;
import java.util.HashSet;
import com.mbeddr.doc.behavior.IDocumentLike__BehaviorDescriptor;
import com.mbeddr.doc.behavior.PathDefinition__BehaviorDescriptor;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SPropertyOperations;
import org.jetbrains.mps.openapi.language.SAbstractConcept;
import org.jetbrains.mps.openapi.language.SProperty;
import jetbrains.mps.smodel.adapter.structure.MetaAdapterFactory;
import org.jetbrains.mps.openapi.language.SConcept;
import org.jetbrains.mps.openapi.language.SContainmentLink;
import org.jetbrains.mps.openapi.language.SReferenceLink;

public class check_AbstractExport_NonTypesystemRule extends AbstractNonTypesystemRule_Runtime implements NonTypesystemRule_Runtime {
  public check_AbstractExport_NonTypesystemRule() {
  }
  public void applyRule(final SNode ae, final TypeCheckingContext typeCheckingContext, IsApplicableStatus status) {
    if (ListSequence.fromList(SModelOperations.roots(SNodeOperations.getModel(ae), CONCEPTS.DocumentExport$bq)).count() > 1) {
      {
        final MessageTarget errorTarget = new PropertyMessageTarget(PROPS.name$MnvL);
        IErrorReporter _reporter_2309309498 = typeCheckingContext.reportTypeError(ae, "you can only have one document export per model", "r:4678d28a-4cfe-45ce-be25-7ac92fa82f13(com.mbeddr.doc.typesystem)", "6386504476136566200", null, errorTarget);
      }
    }

    if (SLinkOperations.getTarget(ae, LINKS.root$175E) != null) {
      Set<SNode> allTransitivePaths = SetSequence.fromSet(new HashSet<SNode>());
      IDocumentLike__BehaviorDescriptor.collectTransitivelyUsedPaths_id3UlEobTHAVZ.invoke(SLinkOperations.getTarget(SLinkOperations.getTarget(ae, LINKS.root$175E), LINKS.doc$bvgi), allTransitivePaths);
      for (final SNode p : SetSequence.fromSet(allTransitivePaths).where((it) -> (boolean) PathDefinition__BehaviorDescriptor.needsMapping_id2i$odZBB7La.invoke(it))) {
        if (!(ListSequence.fromList(SLinkOperations.getChildren(ae, LINKS.mappings$1cg0)).any((it) -> SLinkOperations.getTarget(it, LINKS.pathDef$k8pi) == p))) {
          {
            final MessageTarget errorTarget = new PropertyMessageTarget(PROPS.name$MnvL);
            IErrorReporter _reporter_2309309498 = typeCheckingContext.reportTypeError(ae, "no path mapping specified for path '" + SPropertyOperations.getString(p, PROPS.name$MnvL) + "'", "r:4678d28a-4cfe-45ce-be25-7ac92fa82f13(com.mbeddr.doc.typesystem)", "4509696981881781969", null, errorTarget);
          }
        }
      }
    }



  }
  public SAbstractConcept getApplicableConcept() {
    return CONCEPTS.AbstractExport$TZ;
  }
  public IsApplicableStatus isApplicableAndPattern(SNode argument) {
    return new IsApplicableStatus(argument.getConcept().isSubConceptOf(getApplicableConcept()), null);
  }
  public boolean overrides() {
    return false;
  }

  private static final class PROPS {
    /*package*/ static final SProperty name$MnvL = MetaAdapterFactory.getProperty(0xceab519525ea4f22L, 0x9b92103b95ca8c0cL, 0x110396eaaa4L, 0x110396ec041L, "name");
  }

  private static final class CONCEPTS {
    /*package*/ static final SConcept DocumentExport$bq = MetaAdapterFactory.getConcept(0x2374bc907e3741f1L, 0xa9c4c2e35194c36aL, 0x2e7fd03a4b7f5a6eL, "com.mbeddr.doc.structure.DocumentExport");
    /*package*/ static final SConcept AbstractExport$TZ = MetaAdapterFactory.getConcept(0x2374bc907e3741f1L, 0xa9c4c2e35194c36aL, 0x5439559294885429L, "com.mbeddr.doc.structure.AbstractExport");
  }

  private static final class LINKS {
    /*package*/ static final SContainmentLink root$175E = MetaAdapterFactory.getContainmentLink(0x2374bc907e3741f1L, 0xa9c4c2e35194c36aL, 0x5439559294885429L, 0x5439559294886741L, "root");
    /*package*/ static final SReferenceLink doc$bvgi = MetaAdapterFactory.getReferenceLink(0x2374bc907e3741f1L, 0xa9c4c2e35194c36aL, 0x2e7fd03a4b7ee169L, 0x2e7fd03a4b7ee16aL, "doc");
    /*package*/ static final SContainmentLink mappings$1cg0 = MetaAdapterFactory.getContainmentLink(0x2374bc907e3741f1L, 0xa9c4c2e35194c36aL, 0x5439559294885429L, 0x5439559294886742L, "mappings");
    /*package*/ static final SReferenceLink pathDef$k8pi = MetaAdapterFactory.getReferenceLink(0x2374bc907e3741f1L, 0xa9c4c2e35194c36aL, 0x58a16bfbe08fc074L, 0x58a16bfbe08fc075L, "pathDef");
  }
}

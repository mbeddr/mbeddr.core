package com.mbeddr.mpsutil.preferenceform.runtime;

/*Generated by MPS */

import com.intellij.openapi.options.ConfigurableEP;
import com.intellij.openapi.options.Configurable;
import com.intellij.openapi.options.SearchableConfigurable;
import javax.swing.Icon;
import javax.swing.JPanel;
import org.jetbrains.annotations.Nullable;
import org.jetbrains.annotations.NonNls;
import javax.swing.JComponent;
import java.awt.BorderLayout;
import java.awt.GridLayout;
import java.awt.Component;

public abstract class AbstractPreferenceFormConfigurable extends ConfigurableEP<Configurable> implements Configurable, SearchableConfigurable {
  public static final String OWN_CLIENT_PROPERTY_KEY = AbstractPreferenceFormConfigurable.class.getName() + "_OWN_CLIENT_PROPERTY_KEY";
  public static final String CONTROL_CLIENT_PROPERTY_KEY = AbstractPreferenceFormConfigurable.class.getName() + "_CONTROL_CLIENT_PROPERTY_KEY";

  private final AbstractPreferenceFormComponent preferenceFormComponent;
  protected Icon icon = null;

  protected JPanel jComponent;
  protected JPanel outerJComponent;

  protected AbstractPreferenceFormConfigurable(AbstractPreferenceFormComponent preferenceFormComponent) {
    this.preferenceFormComponent = preferenceFormComponent;
    // Intellij doesn't find class with own classloader
    this.instanceClass = this.getClass().getName();
  }

  @Override
  public Configurable createConfigurable() {
    return this;
  }
  @Override
  public boolean canCreateConfigurable() {
    return true;
  }

  public AbstractPreferenceFormComponent getPreferenceFormComponent() {
    return this.preferenceFormComponent;
  }

  public AbstractPreferenceFormComponent.AbstractMyState getStateObject() {
    return getPreferenceFormComponent().getStateObject();
  }

  @Nullable
  @NonNls
  public String getHelpTopic() {
    return null;
  }

  @Nullable
  public JComponent createComponent() {
    this.outerJComponent = new JPanel(new BorderLayout());
    this.outerJComponent.putClientProperty(OWN_CLIENT_PROPERTY_KEY, this);
    this.jComponent = new JPanel(new GridLayout(0, 2));
    init();

    this.outerJComponent.add(this.jComponent, BorderLayout.NORTH);

    return this.outerJComponent;
  }

  public void disposeUIResources() {
    this.jComponent = null;
    this.outerJComponent = null;
  }

  public JComponent findControl(String id) {
    for (Component control : this.jComponent.getComponents()) {
      if (control instanceof JComponent && id.equals(((JComponent) control).getClientProperty(CONTROL_CLIENT_PROPERTY_KEY))) {
        return ((JComponent) control);
      }
    }

    throw new RuntimeException("Cannot find PreferenceForm control with id " + id);
  }

  public abstract void register();
  public abstract void unregister();

  protected abstract void init();
  @Nullable
  @Override
  public Class<?> getConfigurableType() {
    return this.getClass();
  }
}

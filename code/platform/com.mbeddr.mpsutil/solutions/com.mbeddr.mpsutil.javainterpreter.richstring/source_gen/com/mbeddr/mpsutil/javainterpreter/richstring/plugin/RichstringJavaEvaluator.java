package com.mbeddr.mpsutil.javainterpreter.richstring.plugin;

/*Generated by MPS */

import com.mbeddr.mpsutil.richstring.plugin.IRichstringEvaluator;
import com.mbeddr.mpsutil.interpreter.rt.IInterpreter;
import com.mbeddr.mpsutil.interpreter.rt.CombinedInterpreter;
import com.mbeddr.mpsutil.interpreter.rt.InterpreterRegistry;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SNodeOperations;
import org.jetbrains.mps.openapi.model.SNode;
import com.mbeddr.mpsutil.interpreter.rt.IContext;
import com.mbeddr.mpsutil.interpreter.rt.ContextImpl;
import com.mbeddr.mpsutil.interpreter.rt.NullCoverageAnalyzer;
import org.jetbrains.mps.openapi.language.SConcept;
import jetbrains.mps.smodel.adapter.structure.MetaAdapterFactory;

public class RichstringJavaEvaluator implements IRichstringEvaluator {
  private IInterpreter interpreter;

  public RichstringJavaEvaluator() {
  }

  private IInterpreter getInterpreterLazy() {
    if (interpreter == null) {
      this.interpreter = new CombinedInterpreter(InterpreterRegistry.getInterpreterExecutable(SNodeOperations.getNode("r:6de0fec9-28ce-4092-a00d-c37c6ae81d03(com.mbeddr.mpsutil.javainterpreter.plugin)", "902624672040616048")), InterpreterRegistry.getInterpreterExecutable(SNodeOperations.getNode("r:6de0fec9-28ce-4092-a00d-c37c6ae81d03(com.mbeddr.mpsutil.javainterpreter.plugin)", "902624672042114488")), InterpreterRegistry.getInterpreterExecutable(SNodeOperations.getNode("r:6de0fec9-28ce-4092-a00d-c37c6ae81d03(com.mbeddr.mpsutil.javainterpreter.plugin)", "902624672043046972")), InterpreterRegistry.getInterpreterExecutable(SNodeOperations.getNode("r:6de0fec9-28ce-4092-a00d-c37c6ae81d03(com.mbeddr.mpsutil.javainterpreter.plugin)", "902624672043750076")), InterpreterRegistry.getInterpreterExecutable(SNodeOperations.getNode("r:6de0fec9-28ce-4092-a00d-c37c6ae81d03(com.mbeddr.mpsutil.javainterpreter.plugin)", "902624672044062197")));
    }
    return interpreter;
  }

  public Object eval(SNode input) throws UnsupportedOperationException {
    if (!(SNodeOperations.isInstanceOf(input, CONCEPTS.Expression$mB))) {
      throw new UnsupportedOperationException("Only baseLanguage expressions can be evaluated");
    }

    IContext context = new ContextImpl(getInterpreterLazy());
    NullCoverageAnalyzer coverage = new NullCoverageAnalyzer();
    try {
      return getInterpreterLazy().evaluate(input, context, coverage, null, false);
    } catch (RuntimeException e) {
      throw new UnsupportedOperationException(e);
    }
  }

  private static final class CONCEPTS {
    /*package*/ static final SConcept Expression$mB = MetaAdapterFactory.getConcept(0xf3061a5392264cc5L, 0xa443f952ceaf5816L, 0xf8c37f506fL, "jetbrains.mps.baseLanguage.structure.Expression");
  }
}

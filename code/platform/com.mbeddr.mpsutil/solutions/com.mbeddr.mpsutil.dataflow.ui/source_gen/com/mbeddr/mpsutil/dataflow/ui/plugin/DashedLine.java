package com.mbeddr.mpsutil.dataflow.ui.plugin;

/*Generated by MPS */

import jetbrains.mps.ide.dataFlow.presentation.Line;
import jetbrains.mps.lang.dataFlow.framework.instructions.Instruction;
import jetbrains.mps.ide.dataFlow.presentation.LineDirection;
import java.awt.Graphics;
import java.awt.Graphics2D;
import java.awt.Stroke;
import java.awt.Font;
import java.awt.Color;
import java.awt.BasicStroke;
import com.mbeddr.mpsutil.dataflow.runtime.plugin.FunctionCallInstruction;
import com.mbeddr.mpsutil.dataflow.runtime.plugin.NestedProgramInstruction;
import com.mbeddr.mpsutil.dataflow.runtime.plugin.BaseInstruction;
import com.mbeddr.mpsutil.dataflow.runtime.plugin.InterProcEndInstruction;
import java.text.AttributedString;
import java.awt.font.TextAttribute;

public class DashedLine extends Line {

  protected Instruction source;
  protected Instruction target;

  public DashedLine(Instruction source, Instruction target, int first, int second, int level, LineDirection direction) {
    super(first, second, level, direction);
    this.source = source;
    this.target = target;
  }

  @Override
  protected void drawLine(Graphics g, int x1, int y1, int x2, int y2) {
    Graphics2D graphics = (Graphics2D) g;
    Stroke oldStroke = graphics.getStroke();
    Font oldFont = graphics.getFont();

    graphics.setPaint(Color.BLUE);
    graphics.setStroke(new BasicStroke(1.0f, BasicStroke.CAP_BUTT, BasicStroke.JOIN_MITER, 10.0f, new float[]{5.0f}, 0.0f));
    graphics.drawLine(x1, y1, x2, y2);
    if (myDirection == LineDirection.VERTICAL) {
      graphics.setFont(new Font("default", Font.BOLD, 16));
      String label = "";
      if (source instanceof FunctionCallInstruction || source instanceof NestedProgramInstruction) {
        label = "{" + ((BaseInstruction) source).getShortPresentation();
      } else if (source instanceof InterProcEndInstruction) {
        label = "}" + ((InterProcEndInstruction) source).getShortPresentation(target);
      }
      AttributedString attribute = new AttributedString(label);
      if (label.length() > 1) {
        attribute.addAttribute(TextAttribute.SUPERSCRIPT, TextAttribute.SUPERSCRIPT_SUB, 1, label.length());
      }
      graphics.drawString(attribute.getIterator(), (x1 + x2) / 2 + 5, (y1 + y2) / 2);
    }

    graphics.setStroke(oldStroke);
    graphics.setFont(oldFont);
    graphics.setPaint(Color.BLACK);
  }
}

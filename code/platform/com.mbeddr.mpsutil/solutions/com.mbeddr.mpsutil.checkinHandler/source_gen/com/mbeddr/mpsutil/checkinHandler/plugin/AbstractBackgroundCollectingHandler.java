package com.mbeddr.mpsutil.checkinHandler.plugin;

/*Generated by MPS */

import com.intellij.openapi.vcs.checkin.CommitCheck;
import com.intellij.util.concurrency.annotations.RequiresEdt;
import org.jetbrains.annotations.Nullable;
import org.jetbrains.annotations.NotNull;
import com.intellij.openapi.vcs.checkin.CommitInfo;
import kotlin.coroutines.Continuation;
import com.intellij.openapi.vcs.checkin.CommitProblem;
import jetbrains.mps.internal.collections.runtime.ListSequence;
import java.util.List;
import jetbrains.mps.internal.collections.runtime.Sequence;
import jetbrains.mps.smodel.structure.ExtensionPoint;

public abstract class AbstractBackgroundCollectingHandler extends CollectingCheckinHandler<BackgroundCheckinHandler> implements CommitCheck {

  @RequiresEdt
  @Nullable
  @Override
  public Object runCheck(@NotNull CommitInfo info, @NotNull Continuation<? super CommitProblem> continuation) {
    for (BackgroundCheckinHandler checkinHandler : ListSequence.fromList(handlers).where((it) -> it.getKeyValue())) {
      Object result = checkinHandler.runCheck(info, continuation);
      if (result != null) {
        return result;
      }
    }
    return null;
  }

  @RequiresEdt
  @Override
  public boolean isEnabled() {
    return ListSequence.fromList(queryHandlers()).isNotEmpty();
  }

  @Override
  public List<BackgroundCheckinHandler> queryHandlers() {
    return Sequence.fromIterable(new ExtensionPoint<BackgroundCheckinHandler>("com.mbeddr.mpsutil.checkinHandler.BackgroundCheckin").getObjects()).toList();
  }
}

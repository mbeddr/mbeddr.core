package com.mbeddr.mpsutil.genericactions.plugin;

/*Generated by MPS */

import jetbrains.mps.nodeEditor.EditorSettings;
import javax.swing.SwingUtilities;
import jetbrains.mps.project.Project;
import jetbrains.mps.internal.collections.runtime.ListSequence;
import jetbrains.mps.project.ProjectManager;
import jetbrains.mps.openapi.editor.EditorComponent;
import jetbrains.mps.internal.collections.runtime.Sequence;
import jetbrains.mps.ide.project.ProjectHelper;
import com.intellij.openapi.fileEditor.FileEditorManager;
import jetbrains.mps.ide.editor.MPSFileNodeEditor;

public class EditorFontSizeHelper {
  private static final double SCALE_FACTOR = 1.2;
  private static final int DEFAULT_FONT_SIZE = new EditorSettings.MyState().fontSize;

  public static void reset() {
    set(DEFAULT_FONT_SIZE);
  }

  public static void increase() {
    set((int) Math.ceil(get() * SCALE_FACTOR));
  }

  public static void decrease() {
    set((int) Math.ceil(get() / SCALE_FACTOR));
  }

  public static int get() {
    return EditorSettings.getInstance().getFontSize();
  }

  public static void set(int newFontSize) {
    EditorSettings editorSettings = EditorSettings.getInstance();
    EditorSettings.MyState state = editorSettings.getState();
    state.fontSize = newFontSize;
    editorSettings.loadState(state);
    EditorFontSizeHelper.updateAllEditors();
  }

  private static void updateAllEditors() {
    SwingUtilities.invokeLater(() -> {
      for (Project project : ListSequence.fromList(ProjectManager.getInstance().getOpenedProjects())) {
        for (EditorComponent editor : Sequence.fromIterable(collectAllEditors(ProjectHelper.toIdeaProject(project)))) {
          editor.update();
        }
      }
    });
  }
  private static Iterable<EditorComponent> collectAllEditors(com.intellij.openapi.project.Project ideaProject) {
    FileEditorManager fileEditorManager = FileEditorManager.getInstance(ideaProject);
    Iterable<MPSFileNodeEditor> editors = Sequence.fromIterable(Sequence.fromArray(fileEditorManager.getAllEditors())).ofType(MPSFileNodeEditor.class);

    return Sequence.fromIterable(editors).select((it) -> it.getNodeEditor()).select((it) -> it.getCurrentEditorComponent());
  }
}

package com.mbeddr.mpsutil.ecoreimporter.runtime.importerruntime;

/*Generated by MPS */

import org.eclipse.emf.ecore.xcore.XcoreStandaloneSetup;
import com.google.inject.Inject;
import com.google.inject.Injector;
import org.eclipse.xtext.resource.XtextResourceSet;
import java.util.List;
import java.util.ArrayList;
import java.util.Enumeration;
import java.net.URL;
import java.net.JarURLConnection;

public class XcoreResourceSetInitializerModuleClassLoader extends XcoreStandaloneSetup.XcoreStandaloneRuntimeModule.XcoreResourceSetInitializer {
  @Inject
  /*package*/ Injector injector;
  @Override
  public XtextResourceSet getInitializedResourceSet() {
    XtextResourceSet resourceSet = new XtextResourceSet();
    injector.injectMembers(resourceSet);
    resourceSet.eAdapters().add(new XcoreStandaloneSetup.XcoreStandaloneRuntimeModule.XcoreResourceSetInitializer.AllContainerAdapter(resourceSet));
    return resourceSet;
  }
  @Override
  public List<String> getClassPathEntries() {
    List<String> result = new ArrayList<String>();
    try {
      Enumeration<URL> resources = getClass().getClassLoader().getResources("META-INF");
      while (resources.hasMoreElements()) {
        URL nextElement = resources.nextElement();
        if ("jar".equals(nextElement.getProtocol())) {
          URL jarFileURL = ((JarURLConnection) nextElement.openConnection()).getJarFileURL();
          result.add(jarFileURL.toURI().getRawPath());
        }
      }
    } catch (Exception e) {
      // TODO Auto-generated catch block
      e.printStackTrace();
    }
    // TODO do we need this
    // result.addAll(super.getClassPathEntries());
    return result;
  }
}

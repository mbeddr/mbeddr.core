package com.mbeddr.mpsutil.dataflow.runtime.plugin;

/*Generated by MPS */

import jetbrains.mps.lang.dataFlow.MPSProgramFactory;
import java.util.Collection;
import jetbrains.mps.lang.dataFlow.framework.IDataFlowModeId;
import jetbrains.mps.lang.dataFlow.framework.Program;
import org.jetbrains.mps.openapi.model.SNode;
import jetbrains.mps.lang.dataFlow.framework.NamedAnalyzerId;
import java.util.Set;
import java.util.HashSet;
import jetbrains.mps.lang.dataFlow.framework.AnalyzerRules;

public class InterProceduralProgramFactory extends MPSProgramFactory {

  public InterProceduralProgramFactory(Collection<IDataFlowModeId> modes) {
    super(modes);
  }

  @Override
  public void prepareProgram(Program program, SNode node, NamedAnalyzerId analyzerId) {
    Set<SNode> nodes = new HashSet<SNode>();
    nodes.add(node);
    nodes.addAll(((InterProceduralDataFlowGraph) program).getAllEntryPoints());
    new AnalyzerRules(analyzerId.getAnalyzerFqName(), nodes, program, this.getContext()).apply();
  }

  @Override
  public Program createProgram(SNode node) {
    return new InterProceduralDataFlowGraphBuilder(this.getContext()).buildProgram(node);
  }

}

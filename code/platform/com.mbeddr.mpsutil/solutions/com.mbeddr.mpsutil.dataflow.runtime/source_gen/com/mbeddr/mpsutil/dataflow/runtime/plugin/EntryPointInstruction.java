package com.mbeddr.mpsutil.dataflow.runtime.plugin;

/*Generated by MPS */

import org.jetbrains.mps.openapi.model.SNode;
import java.util.List;
import jetbrains.mps.lang.dataFlow.framework.ProgramState;
import java.util.Set;
import jetbrains.mps.internal.collections.runtime.SetSequence;

public class EntryPointInstruction extends BaseInstruction {

  protected SNode node;
  protected String presentation;

  public EntryPointInstruction(SNode node) {
    super(node);
    this.node = node;
    this.presentation = BaseInstruction.getNodeId(node, true);
  }

  @Override
  public SNode getNode() {
    return this.node;
  }

  @Override
  public String commandPresentation() {
    if (this.presentation == null) {
      return "entry point null";
    } else {
      return "entry point " + this.presentation;
    }
  }

  @Override
  public List<ProgramState> pred(ProgramState state) {
    List<ProgramState> predecessors = super.pred(state);
    Set<FunctionCallInstruction> calls = getOwnProgram().getRootCallMapReversed().get(this);
    for (FunctionCallInstruction call : SetSequence.fromSet(calls)) {
      predecessors.add(new ProgramState(call, state.isReturnMode()));
    }
    return predecessors;
  }

  @Override
  public String getShortPresentation() {
    if (this.presentation == null) {
      return "";
    } else {
      return this.presentation;
    }
  }

}

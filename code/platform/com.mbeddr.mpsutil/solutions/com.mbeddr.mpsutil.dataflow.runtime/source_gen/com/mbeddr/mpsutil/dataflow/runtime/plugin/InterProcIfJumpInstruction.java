package com.mbeddr.mpsutil.dataflow.runtime.plugin;

/*Generated by MPS */

import jetbrains.mps.lang.dataFlow.framework.instructions.IfJumpInstruction;
import jetbrains.mps.lang.dataFlow.framework.Program;
import java.util.List;
import jetbrains.mps.lang.dataFlow.framework.ProgramState;

public class InterProcIfJumpInstruction extends IfJumpInstruction implements IInterProcAwareInstruction {

  public InterProcIfJumpInstruction() {
    super();
  }

  public InterProcIfJumpInstruction(String ruleNodeReference) {
    super(ruleNodeReference);
  }

  @Override
  public String toString() {
    return getIndex() + ": " + super.commandPresentation();
  }

  @Override
  public int getIndex() {
    return getProgram().indexOf(this);
  }

  @Override
  public Program getProgram() {
    return this.getRootProgram();
  }

  @Override
  public void updateJumps(int jumpTo) {
    getRootProgram().get(jumpTo).removeJump(this);
    getRootProgram().get(getJumpTo()).addJump(this);
  }

  @Override
  public void buildCaches() {
    getRootProgram().get(getJumpTo()).addJump(this);
  }

  @Override
  public List<ProgramState> succ(ProgramState state) {
    List<ProgramState> result = super.succ(state);
    result.add(new ProgramState(getRootProgram().get(getJumpTo()), state.isReturnMode()));
    return result;
  }

  @Override
  public List<ProgramState> pred(ProgramState state) {
    return BaseInstruction.pred(this, state);
  }

  @Override
  public InterProceduralDataFlowGraph getOwnProgram() {
    Program program = this.myProgram;
    assert program instanceof InterProceduralDataFlowGraph;
    return ((InterProceduralDataFlowGraph) program);
  }

  @Override
  public InterProceduralDataFlowGraph getParentProgram() {
    return this.getOwnProgram().getParent();
  }

  @Override
  public InterProceduralDataFlowGraph getRootProgram() {
    return this.getOwnProgram().getRoot();
  }

}

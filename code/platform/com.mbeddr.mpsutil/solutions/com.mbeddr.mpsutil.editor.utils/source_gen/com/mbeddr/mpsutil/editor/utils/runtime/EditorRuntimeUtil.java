package com.mbeddr.mpsutil.editor.utils.runtime;

/*Generated by MPS */

import jetbrains.mps.openapi.editor.EditorContext;
import jetbrains.mps.openapi.editor.cells.EditorCell;
import jetbrains.mps.nodeEditor.cells.EditorCell_Label;
import jetbrains.mps.openapi.editor.Editor;
import com.intellij.openapi.project.Project;
import com.intellij.openapi.fileEditor.FileEditorManager;
import jetbrains.mps.ide.editor.MPSFileNodeEditor;
import jetbrains.mps.internal.collections.runtime.Sequence;
import jetbrains.mps.openapi.editor.EditorComponent;

public class EditorRuntimeUtil {
  public static String getErrorText(EditorContext editorContext) {
    editorContext.getEditorComponent();
    EditorCell selectedCell = editorContext.getSelectedCell();

    if (!(selectedCell instanceof EditorCell_Label)) {
      return null;
    }

    EditorCell_Label editorCell = ((EditorCell_Label) selectedCell);

    if (!(editorCell.isErrorState())) {
      return null;
    }

    return editorCell.getRenderedText();
  }

  public static Iterable<Editor> collectAllOpenEditors(Project ideaProject) {
    FileEditorManager fileEditorManager = FileEditorManager.getInstance(ideaProject);
    Iterable<MPSFileNodeEditor> editors = Sequence.fromIterable(Sequence.fromArray(fileEditorManager.getAllEditors())).ofType(MPSFileNodeEditor.class);

    return Sequence.fromIterable(editors).select((it) -> it.getNodeEditor());
  }

  public static Iterable<EditorComponent> collectAllOpenEditorComponents(Project ideaProject) {
    return Sequence.fromIterable(collectAllOpenEditors(ideaProject)).select((it) -> it.getCurrentEditorComponent());
  }
}

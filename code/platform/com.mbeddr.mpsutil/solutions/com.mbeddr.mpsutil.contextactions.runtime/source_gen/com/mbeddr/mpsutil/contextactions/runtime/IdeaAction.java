package com.mbeddr.mpsutil.contextactions.runtime;

/*Generated by MPS */

import com.intellij.openapi.actionSystem.AnAction;
import com.intellij.openapi.actionSystem.AnActionEvent;
import org.jetbrains.annotations.NotNull;
import java.util.List;
import java.util.Collections;
import javax.swing.Icon;
import com.intellij.openapi.actionSystem.Presentation;
import com.intellij.openapi.actionSystem.DataContext;
import com.intellij.ide.DataManager;
import java.awt.Component;
import com.intellij.openapi.actionSystem.ActionPlaces;
import com.intellij.openapi.actionSystem.ActionManager;

public class IdeaAction extends AbstractContextAction implements IContextAction {

  private String myFolder;
  private AnAction myAction;

  public IdeaAction(AnAction action, String folder) {
    myAction = action;
    myFolder = folder;
  }

  @Override
  public void execute(IContext context) {
    AnActionEvent event = actionEventFromContext(context, myAction.getTemplatePresentation());
    myAction.actionPerformed(event);
  }

  @Override
  @NotNull
  public List<String> getFolders(IContext context) {
    return Collections.singletonList(myFolder);
  }

  @Override
  public Icon getIcon(IContext context) {
    return myAction.getTemplatePresentation().getIcon();
  }

  @Override
  @NotNull
  public String getLabel(IContext context) {
    String text = myAction.getTemplatePresentation().getText();
    if ((text != null && text.length() > 0)) {
      return text;
    }
    String description = myAction.getTemplatePresentation().getDescription();
    if ((description != null && description.length() > 0)) {
      return description;
    }
    return "" + myAction.getClass().getName();
  }

  public static AnActionEvent actionEventFromContext(IContext context, Presentation presentation) {
    DataContext dataContext = DataManager.getInstance().getDataContext(((Component) context.getEditorComponent()));
    return new AnActionEvent(null, dataContext, ActionPlaces.MAIN_MENU, presentation, ActionManager.getInstance(), 0);
  }

  @NotNull
  public ContextActionId getId() {
    String id = ActionManager.getInstance().getId(myAction);
    if (id != null) {
      return new ContextActionId(id);
    }
    return new ContextActionId(myAction.getClass().getName() + "#" + myAction.getTemplatePresentation().getText());
  }

  @Override
  public boolean isVisible(IContext context) {
    myAction.update(actionEventFromContext(context, myAction.getTemplatePresentation()));
    return myAction.getTemplatePresentation().isEnabledAndVisible();
  }
}

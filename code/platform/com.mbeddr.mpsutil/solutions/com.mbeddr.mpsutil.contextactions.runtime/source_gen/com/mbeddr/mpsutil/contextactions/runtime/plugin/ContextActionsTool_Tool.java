package com.mbeddr.mpsutil.contextactions.runtime.plugin;

/*Generated by MPS */

import jetbrains.mps.plugins.tool.GeneratedTool;
import javax.swing.Icon;
import com.intellij.icons.AllIcons;
import com.mbeddr.mpsutil.contextactions.runtime.ToolComponent;
import com.intellij.openapi.actionSystem.DefaultActionGroup;
import com.intellij.openapi.wm.ex.ToolWindowManagerListener;
import jetbrains.mps.logging.Logger;
import org.jetbrains.annotations.NotNull;
import com.intellij.openapi.wm.ToolWindow;
import java.util.Objects;
import com.intellij.openapi.project.Project;
import com.intellij.openapi.wm.ToolWindowAnchor;
import com.mbeddr.mpsutil.contextactions.runtime.ViewType;
import com.mbeddr.mpsutil.contextactions.runtime.ChangeViewAction;
import com.intellij.openapi.wm.ToolWindowManager;
import com.intellij.openapi.util.Disposer;
import com.mbeddr.mpsutil.contextactions.runtime.IContext;
import javax.swing.JComponent;

public class ContextActionsTool_Tool extends GeneratedTool {
  private static final Icon ICON = AllIcons.Actions.IntentionBulbGrey;
  private ContextActionsTool_Tool tool = ContextActionsTool_Tool.this;
  private ToolComponent myComponent;
  private DefaultActionGroup myGearActionGroup;
  private ToolWindowManagerListener toolWindowListener = new ToolWindowManagerListener() {
    private Logger LOG = Logger.getLogger(ContextActionsTool_Tool.this.getClass());
    @Override
    public void toolWindowShown(@NotNull ToolWindow toolWindow) {
      try {
        if (Objects.equals(toolWindow.getId(), ContextActionsTool_Tool.this.tool.getId())) {
          ContextActionsTool_Tool.this.myComponent.forceUpdate();
        }
      } catch (Exception ex) {
        LOG.error(ex);
      }
    }
  };
  public ContextActionsTool_Tool(Project project) {
    super(project, "Context Actions 2", null, ICON, ToolWindowAnchor.RIGHT, false);
  }
  public void init(Project project) {
    super.init(project);
    ContextActionsTool_Tool.this.myComponent = new ToolComponent(project, ContextActionsTool_Tool.this.tool);

    ContextActionsTool_Tool.this.myGearActionGroup = new DefaultActionGroup();
    for (ViewType type : ViewType.values()) {
      ContextActionsTool_Tool.this.myGearActionGroup.add(new ChangeViewAction(ContextActionsTool_Tool.this.myComponent, type));
    }
    ToolWindowManager.getInstance(project).invokeLater(() -> ContextActionsTool_Tool.this.tool.getToolWindow().setAdditionalGearActions(ContextActionsTool_Tool.this.myGearActionGroup));

    project.getMessageBus().connect(ContextActionsTool_Tool.this.myComponent).subscribe(ToolWindowManagerListener.TOPIC, ContextActionsTool_Tool.this.toolWindowListener);
  }
  public void dispose() {
    Disposer.dispose(ContextActionsTool_Tool.this.myComponent);
    super.dispose();
  }
  @Override
  protected boolean isInitiallyAvailable() {
    return true;
  }
  public void changeContext(IContext context) {
    ContextActionsTool_Tool.this.myComponent.update(context);
  }
  public JComponent getComponent() {
    return ContextActionsTool_Tool.this.myComponent;
  }
}

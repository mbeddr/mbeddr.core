package com.mbeddr.mpsutil.contextactions.runtime;

/*Generated by MPS */

import jetbrains.mps.openapi.editor.cells.SubstituteInfo;
import jetbrains.mps.openapi.editor.cells.EditorCell;
import java.util.Collections;
import jetbrains.mps.nodeEditor.cellActions.SideTransformSubstituteInfo;
import jetbrains.mps.internal.collections.runtime.Sequence;
import java.util.List;
import jetbrains.mps.openapi.editor.cells.SubstituteAction;
import jetbrains.mps.smodel.action.ModelActions;
import jetbrains.mps.internal.collections.runtime.ListSequence;
import org.jetbrains.annotations.NotNull;
import org.jetbrains.annotations.Nullable;

public class SideTransformActionSource extends AbstractActionSource implements IContextActionSource {

  public SideTransformActionSource() {
  }

  protected SubstituteInfo getSubstituteInfo(IContext context) {
    EditorCell cell = context.getCell();
    if (cell == null) {
      return null;
    }
    return cell.getSubstituteInfo();
  }

  @Override
  public Iterable<IContextAction> getActions(IContext context) {
    if (context.getSNode() == null || context.getCell() == null) {
      return Collections.emptyList();
    }

    Iterable<IContextAction> result = createSideTransformActions(SideTransformSubstituteInfo.Side.RIGHT, "right", context);
    result = Sequence.fromIterable(result).concat(Sequence.fromIterable(createSideTransformActions(SideTransformSubstituteInfo.Side.LEFT, "left", context)));

    return result;
  }

  protected Iterable<IContextAction> createSideTransformActions(final SideTransformSubstituteInfo.Side side, final String sideText, final IContext context) {
    List<SubstituteAction> substituteActions = ModelActions.createSideTransformSubstituteActions(context.getCell(), side);
    return ListSequence.fromList(substituteActions).where((it) -> includeAction(new SideTransformActionAdapter(it, side == SideTransformSubstituteInfo.Side.LEFT), context)).select((final SubstituteAction it) -> {
      return ((IContextAction) new SubstituteActionContextAction(it) {
        @Override
        @NotNull
        public List<String> getFolders(IContext context) {
          String folder = getFolder(new SideTransformActionAdapter(it, side == SideTransformSubstituteInfo.Side.LEFT), context);
          return (folder == null ? super.getFolders(context) : Collections.singletonList(folder + " (" + sideText + ")"));
        }
        @Nullable
        @Override
        public String getTooltip(IContext context) {
          return "Add to the " + sideText + ": " + getLabel(context);
        }
      });
    });
  }

  public String getFolder(IContext context) {
    return null;
  }

  public String getFolder(ISideTransformAction action, IContext context) {
    return getFolder(context);
  }

  protected boolean includeAction(ISideTransformAction action, IContext context) {
    return true;
  }
}

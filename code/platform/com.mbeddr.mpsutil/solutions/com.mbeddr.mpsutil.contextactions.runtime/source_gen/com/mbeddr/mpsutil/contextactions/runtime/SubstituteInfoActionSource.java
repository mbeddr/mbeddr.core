package com.mbeddr.mpsutil.contextactions.runtime;

/*Generated by MPS */

import jetbrains.mps.openapi.editor.cells.SubstituteInfo;
import jetbrains.mps.openapi.editor.cells.EditorCell;
import java.util.Collections;
import java.util.List;
import jetbrains.mps.openapi.editor.cells.SubstituteAction;
import jetbrains.mps.internal.collections.runtime.ListSequence;
import org.jetbrains.annotations.NotNull;
import org.jetbrains.annotations.Nullable;

public class SubstituteInfoActionSource extends AbstractActionSource implements IContextActionSource {

  public SubstituteInfoActionSource() {
  }

  protected SubstituteInfo getSubstituteInfo(IContext context) {
    EditorCell cell = context.getCell();
    if (cell == null) {
      return null;
    }
    return cell.getSubstituteInfo();
  }

  @Override
  public Iterable<IContextAction> getActions(final IContext context) {
    SubstituteInfo substituteInfo = getSubstituteInfo(context);
    if (substituteInfo == null) {
      return Collections.<IContextAction>emptyList();
    }

    List<SubstituteAction> substituteActions = substituteInfo.getMatchingActions("", false);
    Iterable<IContextAction> result = ListSequence.fromList(substituteActions).where((it) -> includeAction(new SubstituteActionAdapter(it), context)).select((final SubstituteAction action) -> {
      return ((IContextAction) new SubstituteActionContextAction(action) {
        @Override
        @NotNull
        public List<String> getFolders(IContext context) {
          final String folder = getFolder(new SubstituteActionAdapter(action), context);
          return (folder == null ? super.getFolders(context) : Collections.singletonList(folder));
        }
        @Nullable
        @Override
        public String getTooltip(IContext context) {
          return "Replace with: " + getLabel(context);
        }
      });
    });
    return result;
  }

  public String getFolder(IContext context) {
    return null;
  }

  public String getFolder(ISubstituteAction action, IContext context) {
    return getFolder(context);
  }

  protected boolean includeAction(ISubstituteAction action, IContext context) {
    return true;
  }
}

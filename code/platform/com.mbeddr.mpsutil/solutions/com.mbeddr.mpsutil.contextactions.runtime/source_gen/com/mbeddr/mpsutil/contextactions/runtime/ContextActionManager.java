package com.mbeddr.mpsutil.contextactions.runtime;

/*Generated by MPS */

import jetbrains.mps.smodel.LanguageAspect;
import jetbrains.mps.internal.collections.runtime.MapSequence;
import java.util.Map;
import java.util.List;
import java.util.HashMap;
import jetbrains.mps.internal.collections.runtime.Sequence;

public class ContextActionManager {

  private static ContextActionManager ourInstance = new ContextActionManager();

  public static ContextActionManager getInstance() {
    return ourInstance;
  }

  private DescriptorCollector myDescriptorCollector = new DescriptorCollector<IContextActionsDescriptor>(IContextActionsDescriptor.class, IContextActionsDescriptor.CLASS_NAME, new String[]{"plugin", LanguageAspect.INTENTIONS.getName(), LanguageAspect.REFACTORINGS.getName()}) {
    @Override
    public void loadDescriptor(IContextActionsDescriptor descriptor) {
      MapSequence.fromMap(myActionSources).put(descriptor, descriptor.getActionSources());
    }
    @Override
    public void unloadDescriptor(IContextActionsDescriptor descriptor) {
      MapSequence.fromMap(myActionSources).removeKey(descriptor);
    }
  };

  private Map<IContextActionsDescriptor, List<IContextActionSource>> myActionSources = MapSequence.fromMap(new HashMap<IContextActionsDescriptor, List<IContextActionSource>>());

  public void init() {
    myDescriptorCollector.start();
  }

  public void dispose() {
    myDescriptorCollector.dispose();
  }

  public Iterable<IContextActionSource> getActionSources() {
    return Sequence.fromIterable(MapSequence.fromMap(myActionSources).values()).translate((it) -> it);
  }

  public Map<IContextActionsDescriptor, List<IContextActionSource>> getActionSourcesAndDescriptors() {
    return myActionSources;
  }
}

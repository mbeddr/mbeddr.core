package com.mbeddr.mpsutil.spreferences.runtime;

/*Generated by MPS */

import jetbrains.mps.nodeEditor.EditorComponent;
import jetbrains.mps.nodeEditor.inspector.InspectorEditorComponent;
import org.jetbrains.mps.openapi.module.SRepository;
import javax.swing.KeyStroke;
import jetbrains.mps.nodeEditor.selection.SingularSelectionListenerAdapter;
import jetbrains.mps.openapi.editor.selection.SingularSelection;
import jetbrains.mps.project.Project;
import jetbrains.mps.ide.project.ProjectHelper;
import jetbrains.mps.openapi.editor.extensions.EditorExtensionUtil;

public class SPreferencesEditorComponent extends EditorComponent {
  private InspectorEditorComponent myInspector;
  public SPreferencesEditorComponent(SRepository repository, InspectorEditorComponent inspector) {
    super(repository);
    unregisterKeyboardAction(KeyStroke.getKeyStroke("ESCAPE"));
    myInspector = inspector;
    if (myInspector == null) {
      return;
    }
    getSelectionManager().addSelectionListener(new SingularSelectionListenerAdapter() {
      @Override
      protected void selectionChangedTo(jetbrains.mps.openapi.editor.EditorComponent editorComponent, final SingularSelection newSelection) {
        editorComponent.getEditorContext().getRepository().getModelAccess().runReadAction(() -> myInspector.editNode(newSelection.getEditorCell().getSNode()));
      }
    });
    Project project = ProjectHelper.getProject(repository);
    if (project != null) {
      EditorExtensionUtil.extendUsingProject(this, project);
    }
  }
  @Override
  public void dispose() {
    super.dispose();
    if (myInspector == null) {
      return;
    }
    myInspector.dispose();
  }

  @Override
  protected boolean notifiesCreation() {
    return true;
  }
}

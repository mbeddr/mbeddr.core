package com.mbeddr.mpsutil.actionsfilter.runtime;

/*Generated by MPS */

import java.util.List;
import com.intellij.openapi.actionSystem.AnAction;
import jetbrains.mps.internal.collections.runtime.Sequence;
import com.intellij.openapi.actionSystem.ActionManager;
import jetbrains.mps.internal.collections.runtime.NotNullWhereFilter;
import java.util.Collections;
import java.util.ArrayList;
import com.intellij.openapi.actionSystem.DefaultActionGroup;
import jetbrains.mps.internal.collections.runtime.ListSequence;
import java.util.Map;
import jetbrains.mps.internal.collections.runtime.MapSequence;
import java.util.HashMap;
import com.intellij.openapi.actionSystem.Presentation;

public class ActionHacks {

  public static List<AnAction> getActionsById(Iterable<String> ids) {
    return Sequence.fromIterable(ids).select((id) -> ActionManager.getInstance().getAction(id)).where(new NotNullWhereFilter()).toList();
  }

  public static void removeMenuActionId(String actionId) {
    AnAction action = ActionManager.getInstance().getAction(actionId);
    if (action != null) {
      removeMenuAction(action);
    }
  }

  public static void removeMenuActionsIds(Iterable<String> actionIds) {
    removeMenuActions(getActionsById(actionIds));
  }

  public static void removeMenuAction(AnAction group) {
    removeMenuActions(Collections.singletonList(group));
  }

  public static void removeMenuActions(List<AnAction> actions) {
    final ActionManager manager = ActionManager.getInstance();
    List<AnAction> mpsGroups = new ArrayList<AnAction>();
    for (AnAction action : actions) {
      mpsGroups.add(action);
    }
    // remove mps groups from IDEA groups
    List<String> actionIdList = manager.getActionIdList("");
    for (DefaultActionGroup staticGroup : ListSequence.fromList(actionIdList).select((it) -> manager.getAction(it)).ofType(DefaultActionGroup.class)) {
      removeActionsFromGroup(staticGroup, mpsGroups);
    }
  }

  public static void removeActionsFromGroup(DefaultActionGroup group, List<AnAction> actions) {
    AnAction[] children = group.getChildActionsOrStubs();
    for (AnAction child : children) {
      if (child instanceof DefaultActionGroup) {
        removeActionsFromGroup((DefaultActionGroup) child, actions);
      }
    }
    for (AnAction g : actions) {
      group.remove(g);
    }
  }

  public static List<String> getAllActionIds() {
    List<String> result = ListSequence.fromList(new ArrayList<String>());
    ListSequence.fromList(result).addSequence(ListSequence.fromList(ActionManager.getInstance().getActionIdList("")));
    return ListSequence.fromList(result).sort((it) -> it, true).toList();
  }

  public static List<AnAction> getAllActions() {
    final ActionManager manager = ActionManager.getInstance();
    return ListSequence.fromList(getAllActionIds()).select((it) -> manager.getAction(it)).toList();
  }

  public static List<String> getMainMenuActions() {
    List<String> result = ListSequence.fromList(new ArrayList<String>());
    collectActions(ActionManager.getInstance().getAction("MainMenu"), result, "");
    return result;
  }

  public static void collectActions(AnAction action, List<String> result, String indent) {
    String id = ActionManager.getInstance().getId(action);
    String text = check_qpgw9q_a0b0t(action.getTemplatePresentation());
    ListSequence.fromList(result).addElement(indent + text + " (" + id + ")");

    if (action instanceof DefaultActionGroup) {
      DefaultActionGroup group = (DefaultActionGroup) action;
      for (AnAction child : group.getChildActionsOrStubs()) {
        collectActions(child, result, indent + "  ");
      }
    }

  }

  public static String getActionText(String actionId) {
    AnAction action = ActionManager.getInstance().getAction(actionId);
    return check_qpgw9q_a1a12(check_qpgw9q_a0b0v(action));
  }

  public static List<String> findRootGroups() {
    final ActionManager manager = ActionManager.getInstance();
    List<String> actionIdList = manager.getActionIdList("");
    List<AnAction> actions = getActionsById(actionIdList);
    final Map<AnAction, AnAction> parents = MapSequence.fromMap(new HashMap<AnAction, AnAction>());
    for (DefaultActionGroup parent : ListSequence.fromList(actions).ofType(DefaultActionGroup.class)) {
      for (AnAction child : parent.getChildActionsOrStubs()) {
        MapSequence.fromMap(parents).put(child, parent);
      }
    }

    return ListSequence.fromList(actions).where((it) -> MapSequence.fromMap(parents).get(it) == null).select((it) -> (String) manager.getId(it)).toList();
  }
  private static String check_qpgw9q_a0b0t(Presentation checkedDotOperand) {
    if (null != checkedDotOperand) {
      return checkedDotOperand.getText();
    }
    return null;
  }
  private static String check_qpgw9q_a1a12(Presentation checkedDotOperand) {
    if (null != checkedDotOperand) {
      return checkedDotOperand.getText();
    }
    return null;
  }
  private static Presentation check_qpgw9q_a0b0v(AnAction checkedDotOperand) {
    if (null != checkedDotOperand) {
      return checkedDotOperand.getTemplatePresentation();
    }
    return null;
  }
}

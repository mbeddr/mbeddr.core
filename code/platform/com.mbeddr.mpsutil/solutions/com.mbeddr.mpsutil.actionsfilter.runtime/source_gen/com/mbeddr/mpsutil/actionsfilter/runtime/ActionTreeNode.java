package com.mbeddr.mpsutil.actionsfilter.runtime;

/*Generated by MPS */

import javax.swing.tree.DefaultMutableTreeNode;
import javax.swing.tree.TreeNode;
import com.intellij.openapi.actionSystem.AnAction;
import jetbrains.mps.internal.collections.runtime.ListSequence;
import java.util.List;
import com.intellij.openapi.actionSystem.ActionManager;
import com.intellij.openapi.actionSystem.Separator;
import jetbrains.mps.plugins.actions.LabelledAnchor;
import com.intellij.openapi.actionSystem.Presentation;

public class ActionTreeNode extends DefaultMutableTreeNode implements TreeNode {
  private AnAction myAction;
  private boolean myInitialized = false;
  protected FilterSettings myFilterModel;
  protected String myText;

  public ActionTreeNode(AnAction action, FilterSettings filterModel) {
    myAction = action;
    myFilterModel = filterModel;
    init();
  }

  public void init() {
    if (myInitialized) {
      return;
    }
    myInitialized = true;
    doInit();
  }

  protected void doInit() {
    for (AnAction action : ListSequence.fromList(getChildActions())) {
      ActionTreeNode node = new ActionTreeNode(action, myFilterModel);
      add(node);
      node.setParent(this);
    }
  }

  public void setText(String text) {
    myText = text;
  }

  protected List<AnAction> getChildActions() {
    return ActionFilter.getInstance().getUnfilteredChildActions(myAction);
  }

  public AnAction getAction() {
    return myAction;
  }

  public boolean isChecked() {
    String id = ActionManager.getInstance().getId(myAction);
    if (id == null) {
      return true;
    }
    return !(myFilterModel.isFiltered(id));
  }

  public void setChecked(boolean checked) {
    String id = ActionManager.getInstance().getId(myAction);
    if (id == null) {
      return;
    }
    if (checked) {
      myFilterModel.removedFilteredId(id);
    } else {
      myFilterModel.addFilteredId(id);
    }
  }

  @Override
  public String toString() {
    if (myText != null) {
      return myText;
    }
    String result = "";
    String id = ActionManager.getInstance().getId(myAction);
    if (myAction instanceof Separator) {
      result += "---------------";
    }
    if (myAction instanceof LabelledAnchor) {
      String separator = "_ActionGroup";
      String label = id;
      int pos = label.indexOf(separator);
      if (pos >= 0) {
        label = label.substring(pos + separator.length());
      }
      label = "#" + label;
      result += label;
    }

    String actionText = check_3vte3f_a0g0v(check_3vte3f_a0a6a12(myAction));
    if (actionText != null) {
      result += actionText;
    }

    return result;
  }
  private static String check_3vte3f_a0g0v(Presentation checkedDotOperand) {
    if (null != checkedDotOperand) {
      return checkedDotOperand.getText();
    }
    return null;
  }
  private static Presentation check_3vte3f_a0a6a12(AnAction checkedDotOperand) {
    if (null != checkedDotOperand) {
      return checkedDotOperand.getTemplatePresentation();
    }
    return null;
  }
}

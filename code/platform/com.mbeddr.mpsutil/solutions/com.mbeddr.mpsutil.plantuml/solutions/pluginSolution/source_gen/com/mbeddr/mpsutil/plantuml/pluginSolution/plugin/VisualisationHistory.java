package com.mbeddr.mpsutil.plantuml.pluginSolution.plugin;

/*Generated by MPS */

import jetbrains.mps.references.Reference;
import java.util.Deque;
import jetbrains.mps.internal.collections.runtime.LinkedListSequence;
import java.util.LinkedList;
import org.jetbrains.mps.openapi.module.SRepository;
import org.jetbrains.mps.openapi.model.SNode;
import org.jetbrains.mps.openapi.model.SNodeReference;
import jetbrains.mps.smodel.SNodePointer;

public class VisualisationHistory {
  private VisualizationHistoryElement myCurrent;
  public VisualizationHistoryElement getCurrent() {
    return this.myCurrent;
  }
  private void _setCurrent(VisualizationHistoryElement value) {
    this.myCurrent = value;
  }
  private VisualizationHistoryElement setCurrent(VisualizationHistoryElement value) {
    _setCurrent(value);
    return value;
  }
  private Reference<VisualizationHistoryElement> refToCurrent() {
    return new Reference<VisualizationHistoryElement>() {
      public VisualizationHistoryElement get() {
        return getCurrent();
      }
      public void set(VisualizationHistoryElement value) {
        _setCurrent(value);
      }
    };
  }
  private Deque<VisualizationHistoryElement> history = LinkedListSequence.fromLinkedList(new LinkedList<VisualizationHistoryElement>());
  private final SRepository myRepo;

  public VisualisationHistory(SRepository repo) {
    myRepo = repo;
  }
  public void add(SNode n, String category) {
    SNodeReference newPtr = new SNodePointer(n);
    addInternal(newPtr, category);
  }
  public void add(String category) {
    addInternal(getCurrent().nPtr, category);
  }
  private void addInternal(final SNodeReference newPtr, final String category) {
    VisualizationHistoryElement element = LinkedListSequence.fromLinkedListNew(history).findFirst((it) -> it.nPtr.equals(newPtr) && it.getCategory().equals(category));
    if (element != null) {
      // remove and add as last
      LinkedListSequence.fromLinkedListNew(history).removeElement(element);
      LinkedListSequence.fromLinkedListNew(history).addElement(element);
    } else {
      element = new VisualizationHistoryElement(newPtr, category);
      LinkedListSequence.fromLinkedListNew(history).addElement(element);
    }
    setCurrent(element);
  }
  public boolean hasNext() {
    return LinkedListSequence.fromLinkedListNew(history).last() != getCurrent();
  }
  public VisualizationHistoryElement next() {
    int currentIndex = LinkedListSequence.fromLinkedListNew(history).indexOf(getCurrent());
    setCurrent(LinkedListSequence.fromLinkedListNew(history).getElement(currentIndex + 1));
    return getCurrent();
  }
  public boolean hasPrevious() {
    return LinkedListSequence.fromLinkedListNew(history).first() != getCurrent();
  }
  public VisualizationHistoryElement previous() {
    int currentIndex = LinkedListSequence.fromLinkedListNew(history).indexOf(getCurrent());
    setCurrent(LinkedListSequence.fromLinkedListNew(history).getElement(currentIndex - 1));
    return getCurrent();
  }
  public class VisualizationHistoryElement {
    private String myCategory;
    public String getCategory() {
      return this.myCategory;
    }
    private void _setCategory(String value) {
      this.myCategory = value;
    }
    private String setCategory(String value) {
      _setCategory(value);
      return value;
    }
    private Reference<String> refToCategory() {
      return new Reference<String>() {
        public String get() {
          return getCategory();
        }
        public void set(String value) {
          _setCategory(value);
        }
      };
    }
    private SNodeReference nPtr;
    public VisualizationHistoryElement(SNodeReference node, String category) {
      this.nPtr = node;
      this.setCategory(category);
    }
    @Override
    public int hashCode() {
      return this.nPtr.hashCode() + getCategory().hashCode();
    }
    @Override
    public boolean equals(Object object) {
      if (object instanceof VisualizationHistoryElement) {
        VisualizationHistoryElement other = ((VisualizationHistoryElement) object);
        return nPtr.equals(other.nPtr) && getCategory().equals(other.getCategory());
      }
      return false;
    }
    public SNode resolvedNode() {
      return ((SNode) nPtr.resolve(myRepo));
    }
  }
}

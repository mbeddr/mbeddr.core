package com.mbeddr.core.base.pluginSolution.plugin;

/*Generated by MPS */

import javax.swing.table.AbstractTableModel;
import java.util.List;
import org.jetbrains.mps.openapi.module.SRepository;
import jetbrains.mps.internal.collections.runtime.ListSequence;
import javax.swing.ImageIcon;
import org.jetbrains.mps.openapi.model.SModel;
import jetbrains.mps.baseLanguage.closures.runtime.Wrappers;
import javax.swing.Icon;
import org.jetbrains.mps.openapi.model.SNode;
import jetbrains.mps.smodel.SNodePointer;
import jetbrains.mps.ide.icons.GlobalIconManager;
import javax.swing.event.TableModelListener;
import org.jetbrains.mps.openapi.model.SNodeReference;

public class ResultTableModel extends AbstractTableModel {
  private List<SearchResult> result;
  private SRepository repository;

  public ResultTableModel(SRepository repository, List<SearchResult> res) {
    this.repository = repository;
    this.result = res;
  }

  public int getRowCount() {
    if (result == null) {
      return 0;
    }
    return ListSequence.fromList(result).count();
  }

  public int getColumnCount() {
    return 4;
  }

  public String getColumnName(int i) {
    switch (i) {
      case 0:
        return "";
      case 1:
        return "Name";
      case 2:
        return "Namespace";
      case 3:
        return "Concept";
      default:
    }
    return null;
  }

  public Class<?> getColumnClass(int col) {
    if (col == 0) {
      return ImageIcon.class;
    }
    return String.class;
  }

  public boolean isCellEditable(int i, int i1) {
    return false;
  }

  public SModel getModelAt(int row) {
    return ListSequence.fromList(result).getElement(row).getModel();
  }

  public Object getValueAt(int row, int col) {
    if (row >= ListSequence.fromList(result).count()) {
      return null;
    }
    final SearchResult res = ListSequence.fromList(result).getElement(row);
    switch (col) {
      case 0:
        final Wrappers._T<Icon> icon = new Wrappers._T<Icon>(null);
        repository.getModelAccess().runReadAction(() -> {
          SModel m = res.getModel();
          SNode node = m.getNode(((SNodePointer) res.getNodePointer()).getNodeId());
          if (node != null) {
            icon.value = GlobalIconManager.getInstance().getIconFor(node);
          }
        });
        return icon.value;
      case 1:
        return res.getShortName();
      case 2:
        String qn = res.getNamespace();
        if (qn == null) {
          return "";
        }
        return qn;
      case 3:
        return res.getConcept();
      default:
    }
    return null;
  }

  public Object getLongestValue(int column) {
    int maxLength = -1;
    Object maxObject = null;
    for (int row = 0; row < this.getRowCount(); row++) {
      Object obj = getValueAt(row, column);
      int currentLength = (obj != null ? obj.toString().length() : 0);
      if (currentLength > maxLength) {
        maxLength = currentLength;
        maxObject = obj;
      }
    }
    return maxObject;
  }

  public void setValueAt(Object object, int i, int i1) {
  }

  public void addTableModelListener(TableModelListener listener) {
  }

  public void removeTableModelListener(TableModelListener listener) {
  }

  public SNodeReference getNodePointer(int row) {
    SearchResult res = ListSequence.fromList(result).getElement(row);
    return res.getNodePointer();
  }
}

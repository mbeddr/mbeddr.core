package com.mbeddr.core.base.pluginSolution.plugin;

/*Generated by MPS */

import com.mbeddr.core.base.behavior.ICustomTreeBuilder;
import jetbrains.mps.project.Solution;
import com.mbeddr.core.base.behavior.AbstractTreeViewNode;
import java.util.List;
import org.jetbrains.mps.openapi.model.SModel;
import org.jetbrains.mps.openapi.model.SNode;
import jetbrains.mps.internal.collections.runtime.ListSequence;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SModelOperations;
import org.jetbrains.mps.openapi.language.SAbstractConcept;
import jetbrains.mps.internal.collections.runtime.Sequence;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SNodeOperations;
import jetbrains.mps.lang.core.behavior.BaseConcept__BehaviorDescriptor;
import com.mbeddr.core.base.behavior.LeafNodeTreeViewNode;
import java.util.Objects;

public class SolutionTreeBuilder implements ICustomTreeBuilder {

  private Solution solution;

  public SolutionTreeBuilder(Solution s) {
    this.solution = s;
  }


  public String[] getTreeCategories() {
    return new String[]{"alphabetical", "by concept", "by model"};
  }


  public AbstractTreeViewNode getTreeNode(final String category) {
    final SolutionTreeBuilder xbuilder = this;
    final List<SModel> allModels = solution.getModels();
    final Iterable<SNode> allRoots = ListSequence.fromList(allModels).translate((it) -> SModelOperations.roots(((SModel) it), null));
    final Iterable<SAbstractConcept> rootConcepts = Sequence.fromIterable(allRoots).select((it) -> SNodeOperations.getConcept(it));
    if ("by model".equals(category)) {
      return new AbstractTreeViewNode(solution.toString(), null, category, getTreeCategories(), xbuilder) {
        public List<AbstractTreeViewNode> getChildrenFromModel() {
          return ListSequence.fromList(allModels).select((final SModel model) -> {
            return new AbstractTreeViewNode(model.getModelName(), null, category, getTreeCategories(), xbuilder) {
              public List<AbstractTreeViewNode> getChildrenFromModel() {
                return Sequence.fromIterable(allRoots).where((it) -> SNodeOperations.getModel(it) == model).sort((it) -> (String) BaseConcept__BehaviorDescriptor.getPresentation_idhEwIMiw.invoke(it), true).select((final SNode root) -> {
                  return new LeafNodeTreeViewNode(root, category, getTreeCategories()) {};
                }).ofType(AbstractTreeViewNode.class).toList();
              }
              public int getChildCountFromModel() {
                return Sequence.fromIterable(allRoots).where((it) -> SNodeOperations.getModel(it) == model).count();
              }
            };
          }).ofType(AbstractTreeViewNode.class).toList();
        }
        public int getChildCountFromModel() {
          return ListSequence.fromList(allModels).count();
        }
      };
    } else if ("by concept".equals(category)) {
      return new AbstractTreeViewNode(solution.toString(), null, category, getTreeCategories(), xbuilder) {
        public List<AbstractTreeViewNode> getChildrenFromModel() {
          return Sequence.fromIterable(rootConcepts).distinct().select((final SAbstractConcept rootConcept) -> {
            return new AbstractTreeViewNode(rootConcept.getName(), null, category, getTreeCategories(), xbuilder) {
              public List<AbstractTreeViewNode> getChildrenFromModel() {
                return Sequence.fromIterable(allRoots).where((it) -> Objects.equals(SNodeOperations.getConcept(it), rootConcept)).sort((it) -> (String) BaseConcept__BehaviorDescriptor.getPresentation_idhEwIMiw.invoke(it), true).select((final SNode root) -> {
                  return new LeafNodeTreeViewNode(root, category, getTreeCategories()) {
                    @Override
                    public String getTooltipText() {
                      return "model: " + SModelOperations.getModelName(SNodeOperations.getModel(root));
                    }
                  };
                }).ofType(AbstractTreeViewNode.class).toList();
              }
              public int getChildCountFromModel() {
                return Sequence.fromIterable(allRoots).where((it) -> Objects.equals(SNodeOperations.getConcept(it), rootConcept)).count();
              }
            };
          }).ofType(AbstractTreeViewNode.class).toList();
        }
        public int getChildCountFromModel() {
          return Sequence.fromIterable(rootConcepts).distinct().count();
        }
      };
    } else {
      return new AbstractTreeViewNode(solution.toString(), null, category, getTreeCategories(), xbuilder) {
        public List<AbstractTreeViewNode> getChildrenFromModel() {
          return Sequence.fromIterable(allRoots).sort((it) -> (String) BaseConcept__BehaviorDescriptor.getPresentation_idhEwIMiw.invoke(it), true).select((final SNode root) -> {
            return new LeafNodeTreeViewNode(root, category, getTreeCategories()) {
              @Override
              public String getTooltipText() {
                return "model: " + SModelOperations.getModelName(SNodeOperations.getModel(root));
              }
            };
          }).ofType(AbstractTreeViewNode.class).toList();
        }
        public int getChildCountFromModel() {
          return Sequence.fromIterable(allRoots).count();
        }
      };
    }
  }
}

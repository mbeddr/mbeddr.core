package com.mbeddr.mpsutil.toolrunner;

/*Generated by MPS */

import java.io.File;
import com.intellij.openapi.progress.ProgressIndicator;
import java.util.List;
import jetbrains.mps.internal.collections.runtime.ListSequence;
import java.util.LinkedList;

public interface ToolRunner {

  /**
   * Runs a tool in the current directory.
   * 
   * @param files the list of files on which the tool will be run
   * @param toolBinaryName the name of the binary representing the tool
   * @param argsList the list of arguments
   * @return an object that contains the standard output, error output, and delay
   */
  ToolRunResult runTool(Iterable<String> files, String toolBinaryName, Iterable<String> argsList);

  /**
   * Runs an external tool and returns the result.
   * 
   * @param files the list of files on which the tool will be run
   * @param toolBinaryName the binary name for the tool
   * @param args a list of arguments
   * @param dir directory in which the tool is run
   * @return an object that contains the standard output, error output, and delay
   */
  ToolRunResult runTool(Iterable<String> files, String toolBinaryName, Iterable<String> args, File dir);

  void setTimeout(int timeout);
  void setProgress(ProgressIndicator progress);

  /**
   * Encapsulates the result of running CBMC.
   */
  class ToolRunResult {

    /**
     * Command which was ran to obtain this result.
     */
    public String ranCommand;

    public List<String> outputResult;
    public List<String> errorResult;
    public int exitCode;
    public long delay;
    public boolean timeout;
    public boolean canceled;
    public boolean runtimeError;
    public Exception exception;

    public ToolRunResult(String ranCommand, List<String> output, List<String> error, long delay, boolean timeout, boolean canceled, int exitCode) {
      this.ranCommand = ranCommand;
      outputResult = output;
      errorResult = error;
      this.delay = delay;
      this.timeout = timeout;
      this.canceled = canceled;
      this.exitCode = exitCode;
      this.runtimeError = false;
    }

    public ToolRunResult(String ranCommand) {
      this.ranCommand = ranCommand;
      outputResult = ListSequence.fromList(new LinkedList<String>());
      errorResult = ListSequence.fromList(new LinkedList<String>());
      this.delay = 0;
      this.timeout = false;
      this.canceled = false;
      this.exitCode = -1;
      this.runtimeError = false;
    }

    public String getOutputString() {
      final StringBuffer sb = new StringBuffer();
      ListSequence.fromList(outputResult).visitAll((it) -> sb.append(it).append("\n"));
      return sb.toString();
    }

    public String getErrorString() {
      final StringBuffer sb = new StringBuffer();
      ListSequence.fromList(errorResult).visitAll((it) -> sb.append(it).append("\n"));
      return sb.toString();
    }

    public long getDelay() {
      return delay;
    }
  }

  class LazyToolRunResult extends ToolRunResult {
    public LazyToolRunResult() {
      super("LAZY_RESULT", ListSequence.fromList(new LinkedList<String>()), ListSequence.fromList(new LinkedList<String>()), -1, false, false, 0);
    }
  }

  /**
   * Factory for creating ToolRunner objects.
   */
  interface ToolRunnerFactory<T extends ToolRunner> {
    T createNewToolRunner();
  }
}

package com.mbeddr.mpsutil.collections.runtime;

/*Generated by MPS */

import com.google.common.base.Equivalence;
import org.jetbrains.mps.openapi.model.SNode;
import de.itemis.mps.comparator.code.MPSNodeComparator;
import org.jetbrains.mps.openapi.language.SProperty;
import org.jetbrains.mps.openapi.model.SReference;

public class NodeEquivalence extends Equivalence<SNode> {

  @Override
  protected boolean doEquivalent(SNode a, SNode b) {
    return new MPSNodeComparator().compare(a, b).areEquals();
  }

  @Override
  protected int doHash(SNode node) {
    return doHash(node, false);
  }

  protected int doHash(SNode node, boolean ignoreReferences) {
    SNode snode = node;
    int hash = snode.getConcept().hashCode();
    for (SProperty property : snode.getProperties()) {
      hash = 31 * hash + property.hashCode();
      hash = 31 * hash + snode.getProperty(property).hashCode();
    }
    for (SNode child : snode.getChildren()) {
      hash = 31 * hash + child.getContainmentLink().hashCode();
      hash = 31 * hash + doHash(child, true);
    }

    if (!(ignoreReferences)) {
      for (SReference reference : snode.getReferences()) {
        hash = 31 * hash + reference.getLink().hashCode();
        if (reference.getTargetNode() != null) {
          hash = 31 * hash + doHash(reference.getTargetNode(), true);
        }
      }
    }
    return hash;
  }
}

package com.mbeddr.mpsutil.targetchooser;

/*Generated by MPS */

import com.intellij.openapi.ui.DialogWrapper;
import com.intellij.openapi.project.Project;
import org.jetbrains.annotations.Nullable;
import jetbrains.mps.ide.project.ProjectHelper;
import jetbrains.mps.baseLanguage.closures.runtime._FunctionTypes;
import javax.swing.SwingUtilities;
import org.jetbrains.annotations.NotNull;
import javax.swing.JComponent;
import com.intellij.openapi.util.Disposer;
import com.intellij.openapi.ui.ValidationInfo;

public class TargetChooserDialog extends DialogWrapper {


  private SelectedTarget selection = null;

  /**
   * 
   * @deprecated Use TargetChooserOptions
   */
  @Deprecated
  public static SelectedTarget chooseTarget(Project project, Object initialValue, @Nullable SNodeFilter filter, @Nullable SelectionValidator selectionValidator) {
    TargetChooserOptions options = new TargetChooserOptions();
    options.setInitial(initialValue);
    options.setSNodeFilter(filter);
    options.setSelectionValidator(selectionValidator);
    return chooseTarget(project, options);
  }

  /**
   * 
   * @deprecated Use TargetChooserOptions
   */
  @Deprecated
  public static SelectedTarget chooseTarget(jetbrains.mps.project.Project project, Object initialValue, @Nullable SNodeFilter filter, @Nullable SelectionValidator selectionValidator) {
    return chooseTarget(ProjectHelper.toIdeaProject(project), initialValue, filter, selectionValidator);
  }

  /**
   * 
   * @deprecated Use TargetChooserOptions
   */
  @Deprecated
  public static void chooseTarget(final Project project, final Object initialValue, @Nullable final SNodeFilter filter, @Nullable final SelectionValidator selectionValidator, final _FunctionTypes._void_P1_E0<? super SelectedTarget> callback) {
    SwingUtilities.invokeLater(() -> {
      SelectedTarget selected = chooseTarget(project, initialValue, filter, selectionValidator);
      if (selected != null) {
        callback.invoke(selected);
      }
    });
  }

  public static SelectedTarget chooseTarget(@NotNull Project project, @NotNull TargetChooserOptions options) {
    TargetChooserDialog dialog = new TargetChooserDialog(project, options);
    dialog.show();
    return (dialog.isOK() ? dialog.getSelectedTarget() : null);
  }

  public static SelectedTarget chooseTarget(@NotNull jetbrains.mps.project.Project project, @NotNull TargetChooserOptions options) {
    return chooseTarget(ProjectHelper.toIdeaProject(project), options);
  }

  private Project myProject;
  private TargetChooser myChooser;
  private TargetChooserOptions myOptions;

  public TargetChooserDialog(@Nullable Project project, @NotNull TargetChooserOptions options) {
    super(project);
    myProject = project;
    myOptions = options;
    init();
  }

  @Nullable
  protected JComponent createCenterPanel() {
    myChooser = new TargetChooser(myProject, myOptions);
    JComponent centerPanel = myChooser.getComponent();
    Disposer.register(getDisposable(), myChooser);
    return centerPanel;
  }

  @Override
  protected void doOKAction() {
    this.selection = myChooser.getSelectedObject();
    super.doOKAction();
  }

  public SelectedTarget getSelectedTarget() {
    return this.selection;
  }

  @Nullable
  @Override
  protected ValidationInfo doValidate() {
    SelectedTarget selectedTarget = myChooser.getSelectedObject();
    if (selectedTarget == null) {
      return new ValidationInfo("Select a model or node", myChooser);
    }
    String errorMessage = myOptions.getSelectionValidator().validate(selectedTarget);
    if (errorMessage != null) {
      return new ValidationInfo(errorMessage, myChooser);
    }
    return null;
  }
}

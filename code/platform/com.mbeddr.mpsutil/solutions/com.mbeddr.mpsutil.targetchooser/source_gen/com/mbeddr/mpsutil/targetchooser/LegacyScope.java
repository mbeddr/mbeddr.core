package com.mbeddr.mpsutil.targetchooser;

/*Generated by MPS */

import org.jetbrains.mps.openapi.module.SModule;
import jetbrains.mps.project.Project;
import jetbrains.mps.internal.collections.runtime.Sequence;
import org.jetbrains.mps.openapi.model.SModel;
import org.jetbrains.mps.openapi.model.SNode;
import jetbrains.mps.internal.collections.runtime.ListSequence;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SModelOperations;
import org.jetbrains.mps.util.Condition;

public class LegacyScope extends AbstractTargetChooserScope {
  private ModuleScope myModuleScope;
  private ModelFilter myModelFilter;
  private SNodeFilter mySNodeFilter;

  public LegacyScope(ModuleScope moduleScope, ModelFilter modelFilter, SNodeFilter snodeFilter) {
    myModelFilter = modelFilter;
    myModuleScope = moduleScope;
    mySNodeFilter = snodeFilter;
  }

  public Iterable<SModule> getModules(Project project) {
    return Sequence.fromIterable(myModuleScope.getModules(project)).toList();
  }

  public boolean showModel(SModel model) {
    return myModelFilter.keep(model);
  }

  public Iterable<SNode> getRootNodes(SModel model) {
    return ListSequence.fromList(SModelOperations.roots(model, null)).where((it) -> mySNodeFilter.keep(it));
  }

  public Iterable<SNode> getChildNodes(SNode parent) {
    return TargetChooserUtil.getFirstLevelDescendants(parent, new Condition<SNode>() {
      public boolean met(SNode candidate) {
        return mySNodeFilter.keep(candidate);
      }
    });
  }

}

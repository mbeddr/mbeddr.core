package com.mbeddr.mpsutil.editingGuide.runtime.rt;

/*Generated by MPS */

import jetbrains.mps.openapi.editor.EditorContext;
import org.jetbrains.mps.openapi.model.SNode;
import jetbrains.mps.openapi.editor.cells.EditorCell;
import jetbrains.mps.smodel.SNodeMatcher;
import org.jetbrains.mps.openapi.language.SAbstractConcept;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SNodeOperations;
import jetbrains.mps.internal.collections.runtime.ListSequence;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SPropertyOperations;
import org.jetbrains.mps.openapi.module.SModule;
import org.jetbrains.mps.openapi.module.SRepository;
import java.util.Iterator;
import org.jetbrains.mps.openapi.language.SInterfaceConcept;
import jetbrains.mps.smodel.adapter.structure.MetaAdapterFactory;
import org.jetbrains.mps.openapi.language.SProperty;

public class Helper {

  public static boolean isSelected(EditorContext ctx, SNode node) {
    EditorCell c = ctx.getSelectedCell();
    if (c != null) {
      return new SNodeMatcher().match(c.getSNode(), node) && c.isBig();
    }
    return false;
  }

  public static boolean isSelectionOfConcept(EditorContext ctx, SAbstractConcept concept) {
    EditorCell c = ctx.getSelectedCell();
    if (c != null) {
      SNode selNode = c.getSNode();
      return SNodeOperations.isInstanceOf(selNode, SNodeOperations.asSConcept(concept)) && c.isBig();
    }
    return false;
  }

  public static MonitorResult returnThereIsAnInstanceOf(SNode program, final SAbstractConcept concept) {
    if (ListSequence.fromList(SNodeOperations.getNodeDescendants(program, null, true, new SAbstractConcept[]{})).any((it) -> SNodeOperations.isInstanceOf(it, SNodeOperations.asSConcept(concept)))) {
      return new MonitorResultDone();
    }
    return null;
  }

  public static MonitorResult returnThereIsAnNode(SNode program, SNode match) {
    return (thereIsANode(program, match) ? new MonitorResultDone() : null);
  }

  public static boolean thereIsANode(SNode program, SNode match) {
    return findNode(program, match) != null;
  }

  public static SNode findNode(SNode program, SNode match) {
    for (SNode d : ListSequence.fromList(SNodeOperations.getNodeDescendants(program, null, false, new SAbstractConcept[]{}))) {
      if (new SNodeMatcher().match(d, match)) {
        return d;
      }
    }
    return null;
  }

  public static SNode findNode(SNode program, SAbstractConcept c) {
    for (SNode d : ListSequence.fromList(SNodeOperations.getNodeDescendants(program, null, false, new SAbstractConcept[]{}))) {
      if (SNodeOperations.isInstanceOf(d, SNodeOperations.asSConcept(c))) {
        return d;
      }
    }
    return null;
  }

  public static SNode findNodeNamed(SNode program, String n) {
    for (SNode d : ListSequence.fromList(SNodeOperations.getNodeDescendants(program, null, false, new SAbstractConcept[]{}))) {
      if (SNodeOperations.isInstanceOf(d, CONCEPTS.INamedConcept$Kd) && n.equals(SPropertyOperations.getString(SNodeOperations.cast(d, CONCEPTS.INamedConcept$Kd), PROPS.name$MnvL))) {
        return d;
      }
    }
    return null;
  }

  public static SNode findNodeNamed(SNode program, String n, SAbstractConcept c) {
    for (SNode d : ListSequence.fromList(SNodeOperations.getNodeDescendants(program, null, false, new SAbstractConcept[]{}))) {
      if (SNodeOperations.isInstanceOf(d, CONCEPTS.INamedConcept$Kd) && SPropertyOperations.getString(SNodeOperations.cast(d, CONCEPTS.INamedConcept$Kd), PROPS.name$MnvL).equals(n) && SNodeOperations.isInstanceOf(d, SNodeOperations.asSConcept(c))) {
        return d;
      }
    }
    return null;
  }

  public static boolean thereIsANodeNamed(SNode program, String n, SAbstractConcept c) {
    return findNodeNamed(program, n, c) != null;
  }

  public static MonitorResult boolToResult(boolean b) {
    return (b ? new MonitorResultDone() : null);
  }

  public static SModule findSModuleByID(SRepository repo, String moduleId) {
    if (repo == null || (moduleId == null)) {
      return null;
    }

    Iterator<SModule> it = repo.getModules().iterator();
    while (it.hasNext()) {
      SModule module = it.next();
      if (module.getModuleId().toString().equals(moduleId)) {
        return module;
      }
    }
    return null;
  }

  private static final class CONCEPTS {
    /*package*/ static final SInterfaceConcept INamedConcept$Kd = MetaAdapterFactory.getInterfaceConcept(0xceab519525ea4f22L, 0x9b92103b95ca8c0cL, 0x110396eaaa4L, "jetbrains.mps.lang.core.structure.INamedConcept");
  }

  private static final class PROPS {
    /*package*/ static final SProperty name$MnvL = MetaAdapterFactory.getProperty(0xceab519525ea4f22L, 0x9b92103b95ca8c0cL, 0x110396eaaa4L, 0x110396ec041L, "name");
  }
}

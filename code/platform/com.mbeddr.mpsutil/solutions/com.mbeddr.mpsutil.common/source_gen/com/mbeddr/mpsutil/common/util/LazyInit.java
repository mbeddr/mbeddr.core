package com.mbeddr.mpsutil.common.util;

/*Generated by MPS */

import java.util.function.Supplier;
import jetbrains.mps.baseLanguage.closures.runtime._FunctionTypes;

/**
 * Supplier which memorizes its value after first call to get().
 * The implementation is very efficient as it does not need null-checks.
 * 
 * NOTE: This class is not thread-safe.
 * 
 * @param <T> generic type of supplied values
 */
public class LazyInit<T> implements Supplier<T> {

  /**
   * Static factory method to construct a memorizing supplier.
   * 
   * @param expensive the code which should only be executed once and on first demand
   * @param <T> type of supplied values
   * @return the memorizing supplier
   */
  public static <T> Supplier<T> lazy(_FunctionTypes._return_P0_E0<? extends T> expensive) {
    return new LazyInit<T>(expensive);
  }

  private _FunctionTypes._return_P0_E0<? extends T> innerSupplier;

  private LazyInit(final _FunctionTypes._return_P0_E0<? extends T> expensive) {
    this.innerSupplier = () -> {
      final T t = expensive.invoke();
      innerSupplier = () -> t;
      return t;
    };
  }

  @Override
  public T get() {
    return innerSupplier.invoke();
  }
}

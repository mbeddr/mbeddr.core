package com.mbeddr.mpsutil.traceExplorer.plugin;

/*Generated by MPS */

import javax.swing.JTree;
import java.util.List;
import java.util.Enumeration;
import javax.swing.tree.TreePath;
import jetbrains.mps.internal.collections.runtime.ListSequence;
import java.util.ArrayList;
import javax.swing.tree.DefaultMutableTreeNode;
import jetbrains.mps.baseLanguage.closures.runtime._FunctionTypes;

public class TreeExpansionUtil {


  public static String getExpansionState(JTree tree) {
    StringBuilder sb = new StringBuilder();
    for (int i = 0; i < tree.getRowCount(); i++) {
      if (tree.isExpanded(i)) {
        if (sb.length() != 0) {
          sb.append(",");
        }
        sb.append(i);
      }
    }
    return sb.toString();
  }

  public static List<ITraceRecord> getExpandedTraces(JTree tree) {
    Enumeration<TreePath> expandedDescendants = tree.getExpandedDescendants(new TreePath(tree.getModel().getRoot()));
    List<ITraceRecord> result = ListSequence.fromList(new ArrayList<ITraceRecord>());
    while (expandedDescendants.hasMoreElements()) {
      TreePath treePath = expandedDescendants.nextElement();
      ITraceRecord record = as_waxbmp_a0a1a2a4(as_waxbmp_a0a0a0b0c0e(treePath.getLastPathComponent(), DefaultMutableTreeNode.class).getUserObject(), ITraceRecord.class);
      ListSequence.fromList(result).addElement(record);
    }
    return result;
  }

  public static void setExpandedTraces(final JTree tree, List<ITraceRecord> expanded) {
    if (expanded != null) {
      for (int i = tree.getRowCount() - 1; i >= 0; i--) {
        tree.collapseRow(i);
      }
      ListSequence.fromList(expanded).visitAll(new _FunctionTypes._void_P1_E0<ITraceRecord>() {
        public void invoke(ITraceRecord seq) {
          DefaultMutableTreeNode childContainingTraceRecord = as_waxbmp_a0a0a0a0a0a0b0a0g(tree.getModel(), TraceTreeModel.class).getChildContainingTraceRecord(seq);
          if (childContainingTraceRecord != null) {
            tree.expandPath(new TreePath(childContainingTraceRecord.getPath()));
          }
        }
      });
    }
  }

  public static void setExpansionState(JTree tree, String s) {
    if ((s == null || s.length() == 0)) {
      return;
    }
    String[] indexes = s.split(",");
    for (String st : indexes) {
      int row = Integer.parseInt(st);
      tree.expandRow(row);
    }
  }


  private static <T> T as_waxbmp_a0a1a2a4(Object o, Class<T> type) {
    return (type.isInstance(o) ? (T) o : null);
  }
  private static <T> T as_waxbmp_a0a0a0b0c0e(Object o, Class<T> type) {
    return (type.isInstance(o) ? (T) o : null);
  }
  private static <T> T as_waxbmp_a0a0a0a0a0a0b0a0g(Object o, Class<T> type) {
    return (type.isInstance(o) ? (T) o : null);
  }
}

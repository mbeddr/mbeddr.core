package com.mbeddr.mpsutil.traceExplorer.plugin;

/*Generated by MPS */

import org.jetbrains.mps.openapi.module.SRepository;
import jetbrains.mps.ide.icons.BaseIconManager;
import jetbrains.mps.project.Project;
import jetbrains.mps.ide.icons.GlobalIconManager;
import org.jetbrains.annotations.NotNull;
import com.intellij.ui.ColoredTextContainer;
import jetbrains.mps.baseLanguage.closures.runtime.Wrappers;
import javax.swing.Icon;
import org.jetbrains.mps.openapi.model.SNodeReference;
import org.jetbrains.mps.openapi.model.SNode;
import com.intellij.ui.SimpleTextAttributes;

public class DefaultTraceRecordRenderer implements ITraceRecordRenderer<ITraceRecord> {
  private final SRepository repository;
  private final BaseIconManager iconManager;

  public DefaultTraceRecordRenderer(SRepository repository, BaseIconManager iconManager) {
    this.repository = repository;
    this.iconManager = iconManager;
  }

  public static DefaultTraceRecordRenderer forProject(Project project) {
    return new DefaultTraceRecordRenderer(project.getRepository(), GlobalIconManager.getInstance());
  }

  @Override
  public void render(@NotNull ITraceRecord record, @NotNull ColoredTextContainer output) {
    Object valueToRender = record.getName();
    final Wrappers._T<Icon> icon = new Wrappers._T<Icon>(null);

    final SNodeReference target = record.getTarget();
    if (target != null) {
      repository.getModelAccess().runReadAction(() -> {
        SNode node = target.resolve(repository);
        icon.value = (node == null ? null : iconManager.getIconFor(node));
      });
    }
    output.setIcon(icon.value);
    output.append((valueToRender == null ? "" : valueToRender.toString()), SimpleTextAttributes.REGULAR_ATTRIBUTES);
  }
}

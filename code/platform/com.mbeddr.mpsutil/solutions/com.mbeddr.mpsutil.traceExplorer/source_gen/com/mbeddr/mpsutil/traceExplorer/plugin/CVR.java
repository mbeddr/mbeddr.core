package com.mbeddr.mpsutil.traceExplorer.plugin;

/*Generated by MPS */

import java.util.List;
import jetbrains.mps.smodel.structure.ExtensionPoint;
import jetbrains.mps.internal.collections.runtime.ListSequence;
import java.util.ArrayList;
import jetbrains.mps.internal.collections.runtime.Sequence;
import javax.swing.JComponent;
import jetbrains.mps.project.MPSProject;
import jetbrains.mps.baseLanguage.closures.runtime.Wrappers;
import javax.swing.JLabel;

public class CVR {

  private static List<CustomValueRenderer> renderers;

  public static List<CustomValueRenderer> resolveRenderers() {
    if (renderers == null) {
      ExtensionPoint<CustomValueRenderer> ep = new ExtensionPoint<CustomValueRenderer>("com.mbeddr.mpsutil.traceExplorer.customValueRenderer");
      renderers = ListSequence.fromList(new ArrayList<CustomValueRenderer>());
      ListSequence.fromList(renderers).addSequence(Sequence.fromIterable(ep.getObjects()).ofType(CustomValueRenderer.class));
      if (ListSequence.fromList(renderers).isEmpty()) {
        ListSequence.fromList(renderers).addElement(new NullConceptValueRenderer());
        System.err.println("No CustomValueRenderer found. Using the default " + NullConceptValueRenderer.class.getName());
      }
    }
    return renderers;
  }

  public static JComponent render(final Object value, MPSProject project) {
    for (CustomValueRenderer cvr : ListSequence.fromList(resolveRenderers())) {
      JComponent c = cvr.render(value, project);
      if (c != null) {
        return c;
      }
    }
    final Wrappers._T<String> s = new Wrappers._T<String>("<none>");
    project.getRepository().getModelAccess().runReadAction(() -> {
      if (value != null) {
        s.value = value.toString();
      }
    });
    JLabel l = new JLabel(s.value);
    l.setOpaque(false);
    return l;
  }


}

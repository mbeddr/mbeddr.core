package com.mbeddr.mpsutil.traceExplorer.plugin;

/*Generated by MPS */

import jetbrains.mps.ide.tools.BaseTabbedProjectTool;
import javax.swing.Icon;
import com.intellij.icons.AllIcons;
import jetbrains.mps.project.MPSProject;
import com.intellij.openapi.project.Project;
import com.intellij.openapi.wm.ToolWindowAnchor;
import jetbrains.mps.ide.project.ProjectHelper;
import javax.swing.JComponent;
import org.jetbrains.annotations.NotNull;
import jetbrains.mps.baseLanguage.closures.runtime._FunctionTypes;
import javax.swing.JPanel;
import java.util.function.Consumer;
import org.jetbrains.mps.openapi.model.SNode;

public class TraceExplorer_Tool extends BaseTabbedProjectTool {
  private static final Icon ICON = AllIcons.Actions.TraceInto;
  private MPSProject mpsProject;
  public TraceExplorer_Tool(Project project) {
    super(project, "Trace Explorer", null, ICON, ToolWindowAnchor.BOTTOM, true);
  }
  public void init(Project project) {
    super.init(project);
    TraceExplorer_Tool.this.mpsProject = ProjectHelper.fromIdeaProject(project);
  }
  /**
   * Creates and activates a new trace explorer tab. The tab will be created with the provided tab factory.
   * Optionally, the created tab can be decorated in another panel, thereby providing the possibility to 
   * wrap it in other UI elements. 
   * 
   * @param options the options used to create the tab
   * @param tabFactory the tab factory
   * @param tabDecorator optional tab decorator
   * @return the UI component that got created (either the original tab or the decorator component)
   */
  public JComponent openTrace(@NotNull final TraceTabOptions options, @NotNull final _FunctionTypes._return_P0_E0<? extends TraceTab> tabFactory, final _FunctionTypes._return_P1_E0<? extends JPanel, ? super TraceTab> tabDecorator) {
    final TraceTab tab = tabFactory.invoke();
    final Consumer<JComponent> disposer = options.disposer;
    final JPanel wrapped = (tabDecorator == null ? tab : tabDecorator.invoke(tab));
    TraceExplorer_Tool.this.addTab(wrapped, options.title, options.tabIcon, (final JPanel p) -> {
      tab.dispose();
      if (disposer != null) {
        disposer.accept(p);
      }
    }, true);
    if (options.pin) {
      TraceExplorer_Tool.this.pinTab(wrapped);
    }
    return wrapped;
  }
  /**
   * Creates and activates a new trace explorer tab. Returns the component of the tab which can (and should) be used to
   * close the tab in case caller's classes are being unloaded.
   */
  public JComponent openTrace(final TraceTabOptions options) {
    final _FunctionTypes._return_P0_E0<? extends TraceTab> tabFactory = () -> new TraceTab((BaseTabbedProjectTool) TraceExplorer_Tool.this, TraceExplorer_Tool.this.mpsProject, options);
    return TraceExplorer_Tool.this.openTrace(options, tabFactory, null);
  }
  public boolean selectTraceForNodeInActiveTab(final SNode t, final boolean selectAll) {
    final JComponent tab = TraceExplorer_Tool.this.getSelectedTab();
    if (tab instanceof TraceTab) {
      return ((TraceTab) tab).selectNodeInTree(t, selectAll);
    }
    return false;
  }
  public boolean selectNextTraceForNodeInActiveTabAndInspect(final SNode t) {
    final JComponent tab = TraceExplorer_Tool.this.getSelectedTab();
    if (tab instanceof TraceTab) {
      ((TraceTab) tab).selectNodeInTreeAndInspectSource(t);
    }
    return false;
  }
  public void renderValue(final Object value) {
    if (value != null) {
      final JComponent tab = TraceExplorer_Tool.this.getSelectedTab();
      if (tab instanceof TraceTab) {
        ((TraceTab) tab).renderValue(value);
      }
    }
  }
}

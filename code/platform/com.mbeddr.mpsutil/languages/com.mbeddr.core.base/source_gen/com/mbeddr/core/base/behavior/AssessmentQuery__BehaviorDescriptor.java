package com.mbeddr.core.base.behavior;

/*Generated by MPS */

import jetbrains.mps.core.aspects.behaviour.BaseBHDescriptor;
import org.jetbrains.mps.openapi.language.SAbstractConcept;
import jetbrains.mps.smodel.adapter.structure.MetaAdapterFactory;
import jetbrains.mps.core.aspects.behaviour.api.SMethod;
import jetbrains.mps.core.aspects.behaviour.SMethodBuilder;
import jetbrains.mps.core.aspects.behaviour.SJavaCompoundTypeImpl;
import jetbrains.mps.core.aspects.behaviour.AccessPrivileges;
import org.jetbrains.mps.openapi.model.SNode;
import java.util.List;
import java.util.Arrays;
import org.jetbrains.annotations.NotNull;
import java.util.Map;
import jetbrains.mps.internal.collections.runtime.MapSequence;
import java.util.HashMap;
import jetbrains.mps.internal.collections.runtime.ListSequence;
import java.util.ArrayList;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SLinkOperations;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SNodeOperations;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SPropertyOperations;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SConceptOperations;
import jetbrains.mps.internal.collections.runtime.Sequence;
import jetbrains.mps.core.aspects.behaviour.api.SConstructor;
import org.jetbrains.annotations.Nullable;
import jetbrains.mps.core.aspects.behaviour.api.BHMethodNotFoundException;
import org.jetbrains.mps.openapi.language.SContainmentLink;
import org.jetbrains.mps.openapi.language.SProperty;

public final class AssessmentQuery__BehaviorDescriptor extends BaseBHDescriptor {
  private static final SAbstractConcept CONCEPT = MetaAdapterFactory.getConcept(0xd4280a54f6df4383L, 0xaa41d1b2bffa7eb1L, 0xc022423d582911bL, "com.mbeddr.core.base.structure.AssessmentQuery");

  public static final SMethod<Boolean> updateAutomatically_idKxraUPpeM7 = new SMethodBuilder<Boolean>(new SJavaCompoundTypeImpl(Boolean.TYPE)).name("updateAutomatically").modifiers(8, AccessPrivileges.PUBLIC).concept(CONCEPT).baseMethodId(874099300309986439L).languageId(0xaa41d1b2bffa7eb1L, 0xd4280a54f6df4383L).build2();
  public static final SMethod<Boolean> mustAlwaysBeOk_id6ibju500V9k = new SMethodBuilder<Boolean>(new SJavaCompoundTypeImpl(Boolean.TYPE)).name("mustAlwaysBeOk").modifiers(8, AccessPrivileges.PUBLIC).concept(CONCEPT).baseMethodId(7244970055392539220L).languageId(0xaa41d1b2bffa7eb1L, 0xd4280a54f6df4383L).build2();
  public static final SMethod<String> errorMessage_id3jNX2XuL9ku = new SMethodBuilder<String>(new SJavaCompoundTypeImpl(String.class)).name("errorMessage").modifiers(8, AccessPrivileges.PUBLIC).concept(CONCEPT).baseMethodId(3815661793603523870L).languageId(0xaa41d1b2bffa7eb1L, 0xd4280a54f6df4383L).build2(SMethodBuilder.createJavaParameter((Class<SNode>) ((Class) Object.class), ""));
  public static final SMethod<Void> prepareUpdate_id1gw9pCYwGF4 = new SMethodBuilder<Void>(new SJavaCompoundTypeImpl(Void.class)).name("prepareUpdate").modifiers(8, AccessPrivileges.PUBLIC).concept(CONCEPT).baseMethodId(1450200424417249988L).languageId(0xaa41d1b2bffa7eb1L, 0xd4280a54f6df4383L).build2(SMethodBuilder.createJavaParameter((Class<SNode>) ((Class) Object.class), ""));
  public static final SMethod<Void> executeQuery_idK292flwJAp = new SMethodBuilder<Void>(new SJavaCompoundTypeImpl(Void.class)).name("executeQuery").modifiers(0, AccessPrivileges.PUBLIC).concept(CONCEPT).baseMethodId(865293814733142425L).languageId(0xaa41d1b2bffa7eb1L, 0xd4280a54f6df4383L).build2(SMethodBuilder.createJavaParameter((Class<SNode>) ((Class) Object.class), ""));
  public static final SMethod<List<SNode>> runQuery_id7hIyKqbFNeu = new SMethodBuilder<List<SNode>>(new SJavaCompoundTypeImpl((Class<List<SNode>>) ((Class) Object.class))).name("runQuery").modifiers(12, AccessPrivileges.PUBLIC).concept(CONCEPT).baseMethodId(8389796016067392414L).languageId(0xaa41d1b2bffa7eb1L, 0xd4280a54f6df4383L).build2();
  public static final SMethod<List<SNode>> getSummaries_id_gCXGjoJQM = new SMethodBuilder<List<SNode>>(new SJavaCompoundTypeImpl((Class<List<SNode>>) ((Class) Object.class))).name("getSummaries").modifiers(8, AccessPrivileges.PUBLIC).concept(CONCEPT).baseMethodId(671216505796623794L).languageId(0xaa41d1b2bffa7eb1L, 0xd4280a54f6df4383L).build2(SMethodBuilder.createJavaParameter((Class<SNode>) ((Class) Object.class), ""));
  public static final SMethod<SNode> createDefaultSummary_id7sHl0myfjm0 = new SMethodBuilder<SNode>(new SJavaCompoundTypeImpl((Class<SNode>) ((Class) Object.class))).name("createDefaultSummary").modifiers(0, AccessPrivileges.PROTECTED).concept(CONCEPT).baseMethodId(8587612447638893952L).languageId(0xaa41d1b2bffa7eb1L, 0xd4280a54f6df4383L).build2(SMethodBuilder.createJavaParameter((Class<SNode>) ((Class) Object.class), ""));
  public static final SMethod<Boolean> useHorizontalSeparatorForResults_id1mECeeSGmO6 = new SMethodBuilder<Boolean>(new SJavaCompoundTypeImpl(Boolean.TYPE)).name("useHorizontalSeparatorForResults").modifiers(8, AccessPrivileges.PUBLIC).concept(CONCEPT).baseMethodId(1561237120753954054L).languageId(0xaa41d1b2bffa7eb1L, 0xd4280a54f6df4383L).build2();

  private static final List<SMethod<?>> BH_METHODS = Arrays.<SMethod<?>>asList(updateAutomatically_idKxraUPpeM7, mustAlwaysBeOk_id6ibju500V9k, errorMessage_id3jNX2XuL9ku, prepareUpdate_id1gw9pCYwGF4, executeQuery_idK292flwJAp, runQuery_id7hIyKqbFNeu, getSummaries_id_gCXGjoJQM, createDefaultSummary_id7sHl0myfjm0, useHorizontalSeparatorForResults_id1mECeeSGmO6);

  private static void ___init___(@NotNull SNode __thisNode__) {
  }

  /*package*/ static boolean updateAutomatically_idKxraUPpeM7(@NotNull SNode __thisNode__) {
    return false;
  }
  /*package*/ static boolean mustAlwaysBeOk_id6ibju500V9k(@NotNull SNode __thisNode__) {
    return false;
  }
  /*package*/ static String errorMessage_id3jNX2XuL9ku(@NotNull SNode __thisNode__, SNode ass) {
    return "assessment has failed";
  }
  /*package*/ static void prepareUpdate_id1gw9pCYwGF4(@NotNull SNode __thisNode__, SNode assessment) {
  }
  /*package*/ static void executeQuery_idK292flwJAp(@NotNull SNode __thisNode__, SNode assessment) {
    AssessmentQuery__BehaviorDescriptor.prepareUpdate_id1gw9pCYwGF4.invoke(__thisNode__, assessment);

    Map<String, SNode> reusableEntries = MapSequence.fromMap(new HashMap<String, SNode>());
    for (SNode oldEntry : ListSequence.fromListWithValues(new ArrayList<SNode>(), SLinkOperations.getChildren(assessment, LINKS.results$os$a))) {
      String identifier = AssessmentResult__BehaviorDescriptor.uniqueIdentifier_idK292flwHwe.invoke(SLinkOperations.getTarget(oldEntry, LINKS.result$YRDN));
      if (identifier == null || MapSequence.fromMap(reusableEntries).containsKey(identifier)) {
        SNodeOperations.deleteNode(oldEntry);
      } else {
        MapSequence.fromMap(reusableEntries).put(identifier, oldEntry);
      }
    }

    for (SNode newResult : ListSequence.fromList(AssessmentQuery__BehaviorDescriptor.runQuery_id7hIyKqbFNeu.invoke(__thisNode__))) {
      String identifier = AssessmentResult__BehaviorDescriptor.uniqueIdentifier_idK292flwHwe.invoke(newResult);
      SNode existing = MapSequence.fromMap(reusableEntries).removeKey(identifier);
      if ((existing != null)) {
        AssessmentResult__BehaviorDescriptor.updateValues_id5L$H31Kf5$y.invoke(SLinkOperations.getTarget(existing, LINKS.result$YRDN), newResult);
        SPropertyOperations.assign(existing, PROPS.lastFound$xF0r, System.currentTimeMillis() + "");
        SPropertyOperations.assign(existing, PROPS.isNew$XqpV, false);
      } else {
        SNode entry = SConceptOperations.createNewNode(MetaAdapterFactory.getConcept(0xd4280a54f6df4383L, 0xaa41d1b2bffa7eb1L, 0xc022423d5829cdeL, "com.mbeddr.core.base.structure.AssessmentResultEntry"));
        SLinkOperations.setTarget(entry, LINKS.result$YRDN, newResult);
        SPropertyOperations.assign(entry, PROPS.isNew$XqpV, true);
        SPropertyOperations.assign(entry, PROPS.lastFound$xF0r, System.currentTimeMillis() + "");
        ListSequence.fromList(SLinkOperations.getChildren(assessment, LINKS.results$os$a)).insertElement(0, entry);
      }
    }

    Sequence.fromIterable(MapSequence.fromMap(reusableEntries).values()).visitAll((it) -> SNodeOperations.deleteNode(it));

    if (ListSequence.fromList(SLinkOperations.getChildren(assessment, LINKS.results$os$a)).isNotEmpty() && ListSequence.fromList(SLinkOperations.getChildren(assessment, LINKS.results$os$a)).any((it) -> (boolean) AssessmentResultEntry__BehaviorDescriptor.beginsGroup_id26F1Swi9tri.invoke(it))) {
      SPropertyOperations.assign(assessment, PROPS.sorted$64Eg, true);
    }

    if (SPropertyOperations.getBoolean(assessment, PROPS.sorted$64Eg)) {
      List<SNode> toSort = SLinkOperations.getChildren(assessment, LINKS.results$os$a);
      Iterable<SNode> sorted = ListSequence.fromList(toSort).sort((it) -> (String) AssessmentResultEntry__BehaviorDescriptor.sortKey_id3greo4NDQMb.invoke(it), true).toList();
      ListSequence.fromList(SLinkOperations.getChildren(assessment, LINKS.results$os$a)).clear();
      ListSequence.fromList(SLinkOperations.getChildren(assessment, LINKS.results$os$a)).addSequence(Sequence.fromIterable(sorted));
    }

    ListSequence.fromList(SLinkOperations.getChildren(assessment, LINKS.summaries$lFRN)).clear();
    List<SNode> summaries = AssessmentQuery__BehaviorDescriptor.getSummaries_id_gCXGjoJQM.invoke(__thisNode__, assessment);
    ListSequence.fromList(SLinkOperations.getChildren(assessment, LINKS.summaries$lFRN)).addSequence(ListSequence.fromList(summaries));
  }
  /*package*/ static List<SNode> getSummaries_id_gCXGjoJQM(@NotNull SNode __thisNode__, SNode ass) {
    SNode s = AssessmentQuery__BehaviorDescriptor.createDefaultSummary_id7sHl0myfjm0.invoke(__thisNode__, ass);
    List<SNode> summaries = new ArrayList<SNode>();
    ListSequence.fromList(summaries).addElement(s);
    return summaries;
  }
  /*package*/ static SNode createDefaultSummary_id7sHl0myfjm0(@NotNull SNode __thisNode__, SNode ass) {
    SNode s = SConceptOperations.createNewNode(MetaAdapterFactory.getConcept(0xd4280a54f6df4383L, 0xaa41d1b2bffa7eb1L, 0x950a3db1362fdbaL, "com.mbeddr.core.base.structure.DefaultAssessmentSummary"));
    SPropertyOperations.assign(s, PROPS.totalCount$Si$G, ListSequence.fromList(SLinkOperations.getChildren(ass, LINKS.results$os$a)).count());
    SPropertyOperations.assign(s, PROPS.newlyAdded$Sj2I, ListSequence.fromList(SLinkOperations.getChildren(ass, LINKS.results$os$a)).where((it) -> SPropertyOperations.getBoolean(it, PROPS.isNew$XqpV)).count());
    SPropertyOperations.assign(s, PROPS.ok$SiNH, ListSequence.fromList(SLinkOperations.getChildren(ass, LINKS.results$os$a)).where((it) -> SPropertyOperations.getBoolean(it, PROPS.markedOk$pmda)).count());
    return s;
  }
  /*package*/ static boolean useHorizontalSeparatorForResults_id1mECeeSGmO6(@NotNull SNode __thisNode__) {
    return false;
  }

  /*package*/ AssessmentQuery__BehaviorDescriptor() {
  }

  @Override
  protected void initNode(@NotNull SNode node, @NotNull SConstructor constructor, @Nullable Object[] parameters) {
    ___init___(node);
  }

  @Override
  protected <T> T invokeSpecial0(@NotNull SNode node, @NotNull SMethod<T> method, @Nullable Object[] parameters) {
    int methodIndex = BH_METHODS.indexOf(method);
    if (methodIndex < 0) {
      throw new BHMethodNotFoundException(this, method);
    }
    switch (methodIndex) {
      case 0:
        return (T) ((Boolean) updateAutomatically_idKxraUPpeM7(node));
      case 1:
        return (T) ((Boolean) mustAlwaysBeOk_id6ibju500V9k(node));
      case 2:
        return (T) ((String) errorMessage_id3jNX2XuL9ku(node, (SNode) parameters[0]));
      case 3:
        prepareUpdate_id1gw9pCYwGF4(node, (SNode) parameters[0]);
        return null;
      case 4:
        executeQuery_idK292flwJAp(node, (SNode) parameters[0]);
        return null;
      case 6:
        return (T) ((List<SNode>) getSummaries_id_gCXGjoJQM(node, (SNode) parameters[0]));
      case 7:
        return (T) ((SNode) createDefaultSummary_id7sHl0myfjm0(node, (SNode) parameters[0]));
      case 8:
        return (T) ((Boolean) useHorizontalSeparatorForResults_id1mECeeSGmO6(node));
      default:
        throw new BHMethodNotFoundException(this, method);
    }
  }

  @Override
  protected <T> T invokeSpecial0(@NotNull SAbstractConcept concept, @NotNull SMethod<T> method, @Nullable Object[] parameters) {
    int methodIndex = BH_METHODS.indexOf(method);
    if (methodIndex < 0) {
      throw new BHMethodNotFoundException(this, method);
    }
    switch (methodIndex) {
      default:
        throw new BHMethodNotFoundException(this, method);
    }
  }

  @NotNull
  @Override
  public List<SMethod<?>> getDeclaredMethods() {
    return BH_METHODS;
  }

  @NotNull
  @Override
  public SAbstractConcept getConcept() {
    return CONCEPT;
  }

  private static final class LINKS {
    /*package*/ static final SContainmentLink result$YRDN = MetaAdapterFactory.getContainmentLink(0xd4280a54f6df4383L, 0xaa41d1b2bffa7eb1L, 0xc022423d5829cdeL, 0xc022423d582d813L, "result");
    /*package*/ static final SContainmentLink results$os$a = MetaAdapterFactory.getContainmentLink(0xd4280a54f6df4383L, 0xaa41d1b2bffa7eb1L, 0xc022423d5828abcL, 0xc022423d5829cdfL, "results");
    /*package*/ static final SContainmentLink summaries$lFRN = MetaAdapterFactory.getContainmentLink(0xd4280a54f6df4383L, 0xaa41d1b2bffa7eb1L, 0xc022423d5828abcL, 0x950a3db135ffebaL, "summaries");
  }

  private static final class PROPS {
    /*package*/ static final SProperty lastFound$xF0r = MetaAdapterFactory.getProperty(0xd4280a54f6df4383L, 0xaa41d1b2bffa7eb1L, 0xc022423d5829cdeL, 0x5bde1a10b4dad599L, "lastFound");
    /*package*/ static final SProperty isNew$XqpV = MetaAdapterFactory.getProperty(0xd4280a54f6df4383L, 0xaa41d1b2bffa7eb1L, 0xc022423d5829cdeL, 0x25a19da5519d5988L, "isNew");
    /*package*/ static final SProperty sorted$64Eg = MetaAdapterFactory.getProperty(0xd4280a54f6df4383L, 0xaa41d1b2bffa7eb1L, 0xc022423d5828abcL, 0x789e294e12c6881eL, "sorted");
    /*package*/ static final SProperty totalCount$Si$G = MetaAdapterFactory.getProperty(0xd4280a54f6df4383L, 0xaa41d1b2bffa7eb1L, 0x950a3db1362fdbaL, 0x950a3db1362fdbdL, "totalCount");
    /*package*/ static final SProperty newlyAdded$Sj2I = MetaAdapterFactory.getProperty(0xd4280a54f6df4383L, 0xaa41d1b2bffa7eb1L, 0x950a3db1362fdbaL, 0x950a3db1362fdbfL, "newlyAdded");
    /*package*/ static final SProperty ok$SiNH = MetaAdapterFactory.getProperty(0xd4280a54f6df4383L, 0xaa41d1b2bffa7eb1L, 0x950a3db1362fdbaL, 0x950a3db1362fdbeL, "ok");
    /*package*/ static final SProperty markedOk$pmda = MetaAdapterFactory.getProperty(0xd4280a54f6df4383L, 0xaa41d1b2bffa7eb1L, 0xc022423d5829cdeL, 0x25a19da551913fd9L, "markedOk");
  }
}

package com.mbeddr.core.base.behavior;

/*Generated by MPS */

import jetbrains.mps.nodeEditor.EditorComponent;
import jetbrains.mps.logging.Logger;
import org.jetbrains.mps.openapi.model.SNode;
import jetbrains.mps.smodel.IOperationContext;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SNodeOperations;
import org.jetbrains.mps.openapi.module.SRepository;
import javax.swing.SwingUtilities;
import jetbrains.mps.openapi.editor.TextBuilder;

public class FakeEditorComponent extends EditorComponent {
  private static final Logger LOG = Logger.getLogger(FakeEditorComponent.class);
  public FakeEditorComponent(final SNode node, IOperationContext operationContext) {
    this(node, SNodeOperations.getModel(node).getRepository());
  }

  public FakeEditorComponent(final SNode node, SRepository repository) {
    super(repository);
    editNode(node);
  }

  public static String getTextForNode(final SNode n, final IOperationContext ctx) {
    return getTextForNode(n, SNodeOperations.getModel(n).getRepository());
  }

  public static String getTextForNode(final SNode n, final SRepository repository) {
    final StringBuffer sb = new StringBuffer();
    try {
      SwingUtilities.invokeAndWait(new Runnable() {
        public void run() {
          sb.append(getTextForNodeInSwingContext(n, repository));
        }
      });
    } catch (Exception ex) {
      if (LOG.isErrorLevel()) {
        LOG.error(ex.getMessage(), ex);
      }
    }

    return sb.toString();
  }

  public static String getTextForNodeInSwingContext(final SNode n, final SRepository repository) {
    final StringBuffer sb = new StringBuffer();
    repository.getModelAccess().runReadAction(() -> {
      FakeEditorComponent component = new FakeEditorComponent(n, repository);
      TextBuilder renderText = component.getRootCell().renderText();
      sb.append(renderText.getText());
      component.dispose();
    });

    return sb.toString();
  }
}

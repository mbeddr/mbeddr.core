package com.mbeddr.core.base.behavior;

/*Generated by MPS */

import java.util.Map;
import org.jetbrains.mps.openapi.model.SNode;
import jetbrains.mps.internal.collections.runtime.MapSequence;
import java.util.HashMap;
import java.util.WeakHashMap;

public class VisibleContentsOfTypeCache {

  private static Map<SNode, Map<SNode, Iterable<SNode>>> cache = MapSequence.fromMap(new HashMap<SNode, Map<SNode, Iterable<SNode>>>());

  public static void put(SNode targetConcept, SNode key, Iterable<SNode> value) {
    if (isEnabled()) {
      Map<SNode, Iterable<SNode>> node2visibleContent = MapSequence.fromMap(cache).get(targetConcept);
      if (node2visibleContent == null) {
        node2visibleContent = MapSequence.fromMap(new WeakHashMap<SNode, Iterable<SNode>>());
        MapSequence.fromMap(cache).put(targetConcept, node2visibleContent);
      }
      MapSequence.fromMap(node2visibleContent).put(key, value);
    } else {
      // TODO Disabled cache. See http://youtrack.jetbrains.com/issue/MPS-19417
      throw new RuntimeException("Cache currently disabled. See http://youtrack.jetbrains.com/issue/MPS-19417");
    }
  }

  public static Iterable<SNode> get(SNode targetConcept, SNode key) {
    if (isEnabled()) {
      return MapSequence.fromMap(MapSequence.fromMap(cache).get(targetConcept)).get(key);
    } else {
      // TODO Disabled cache. See http://youtrack.jetbrains.com/issue/MPS-19417
      throw new RuntimeException("Cache currently disabled. See http://youtrack.jetbrains.com/issue/MPS-19417");
    }
  }

  public static boolean cacheEnabled = false;

  public static boolean isEnabled() {
    return VisibleContentsOfTypeCache.cacheEnabled;
  }
}

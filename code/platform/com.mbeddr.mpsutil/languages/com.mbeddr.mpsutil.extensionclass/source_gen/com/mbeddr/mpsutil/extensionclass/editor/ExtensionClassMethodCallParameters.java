package com.mbeddr.mpsutil.extensionclass.editor;

/*Generated by MPS */

import jetbrains.mps.editor.runtime.style.ParametersInformation;
import org.jetbrains.mps.openapi.model.SNode;
import jetbrains.mps.openapi.editor.EditorContext;
import java.util.List;
import jetbrains.mps.baseLanguage.editor.BaseMethodParameterInformationQueryUtil;
import jetbrains.mps.editor.runtime.style.StyledTextPrinter;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SNodeOperations;
import jetbrains.mps.internal.collections.runtime.ListSequence;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SModelOperations;
import java.util.Objects;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SLinkOperations;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SPropertyOperations;
import jetbrains.mps.lang.core.behavior.BaseConcept__BehaviorDescriptor;
import com.mbeddr.mpsutil.extensionclass.behavior.ExtensionClassMethodCall__BehaviorDescriptor;
import org.jetbrains.mps.openapi.language.SConcept;
import jetbrains.mps.smodel.adapter.structure.MetaAdapterFactory;
import org.jetbrains.mps.openapi.language.SReferenceLink;
import org.jetbrains.mps.openapi.language.SContainmentLink;
import org.jetbrains.mps.openapi.language.SProperty;

public class ExtensionClassMethodCallParameters implements ParametersInformation<SNode> {
  public ExtensionClassMethodCallParameters() {
  }
  public Iterable<SNode> getMethods(SNode node, EditorContext editorContext) {
    List<SNode> methodsToShow = BaseMethodParameterInformationQueryUtil.getMethodsToShow(node);
    return methodsToShow;
  }
  public void getStyledMethodPresentation(SNode node, EditorContext editorContext, SNode parameterObject, StyledTextPrinter styledText) {
    SNode methodCall = node;
    final SNode method = parameterObject;
    final SNode clazz = SNodeOperations.getNodeAncestor(method, CONCEPTS.ClassConcept$bK, false, false);
    SNode extensionClass = ListSequence.fromList(SModelOperations.rootsIncludingImported(SNodeOperations.getModel(methodCall), CONCEPTS.ExtensionClass$K)).findFirst((it) -> Objects.equals(SLinkOperations.getTarget(it, LINKS.class$kmno), clazz));

    SNode methodAnnotation = ListSequence.fromList(SLinkOperations.getChildren(extensionClass, LINKS.annotations$N1J6)).findFirst((it) -> Objects.equals(SLinkOperations.getTarget(it, LINKS.method$9MOt), method));

    SNode selectedActualArgument = this.getSelectedActualArgument(editorContext, methodCall);
    int argumentIndex = (selectedActualArgument != null ? SNodeOperations.getIndexInParent(selectedActualArgument) + 1 : -1);
    styledText.append(SPropertyOperations.getString(method, PROPS.name$MnvL));
    styledText.append("(");
    for (SNode param : ListSequence.fromList(SLinkOperations.getChildren(method, LINKS.parameter$5xBj)).where((it) -> SNodeOperations.getIndexInParent(it) != 0)) {
      if (SNodeOperations.getIndexInParent(param) > 1) {
        styledText.append(", ");
      }
      if (SNodeOperations.getIndexInParent(param) == argumentIndex) {
        styledText.setBold(true);
      }
      if (SLinkOperations.getTarget(param, LINKS.type$a1UY) != null) {
        styledText.append(BaseConcept__BehaviorDescriptor.getPresentation_idhEwIMiw.invoke(SLinkOperations.getTarget(param, LINKS.type$a1UY)));
      } else {
        styledText.append("???");
      }
      String name = ExtensionClassMethodCall__BehaviorDescriptor.getParameterName_id4X7wieqC1Yq.invoke(SNodeOperations.asSConcept(CONCEPTS.ExtensionClassMethodCall$2B), param, methodAnnotation);
      if (name != null) {
        styledText.append(" " + name);
      }
      styledText.setBold(false);
    }
    styledText.append(")");

  }
  public boolean isMethodCurrent(SNode node, EditorContext editorContext, SNode parameterObject) {
    return SLinkOperations.getTarget(node, LINKS.baseMethodDeclaration$pyYw) == parameterObject;
  }
  private SNode getSelectedActualArgument(EditorContext editorContext, final SNode methodCall) {
    SNode selectedNode = editorContext.getSelectedNode();
    if (selectedNode == null) {
      return null;
    }
    return ListSequence.fromList(SNodeOperations.getNodeAncestors(selectedNode, CONCEPTS.Expression$mB, true)).findFirst((it) -> SNodeOperations.getParent(it) == methodCall && Objects.equals(SNodeOperations.getContainingLink(it), LINKS.actualArgument$pzdx));
  }

  private static final class CONCEPTS {
    /*package*/ static final SConcept ClassConcept$bK = MetaAdapterFactory.getConcept(0xf3061a5392264cc5L, 0xa443f952ceaf5816L, 0xf8c108ca66L, "jetbrains.mps.baseLanguage.structure.ClassConcept");
    /*package*/ static final SConcept ExtensionClass$K = MetaAdapterFactory.getConcept(0xf39336d3128847eeL, 0xbbfead2ea7e4504eL, 0x4f4781239a213505L, "com.mbeddr.mpsutil.extensionclass.structure.ExtensionClass");
    /*package*/ static final SConcept ExtensionClassMethodCall$2B = MetaAdapterFactory.getConcept(0xf39336d3128847eeL, 0xbbfead2ea7e4504eL, 0x4f4781239a23a494L, "com.mbeddr.mpsutil.extensionclass.structure.ExtensionClassMethodCall");
    /*package*/ static final SConcept Expression$mB = MetaAdapterFactory.getConcept(0xf3061a5392264cc5L, 0xa443f952ceaf5816L, 0xf8c37f506fL, "jetbrains.mps.baseLanguage.structure.Expression");
  }

  private static final class LINKS {
    /*package*/ static final SReferenceLink class$kmno = MetaAdapterFactory.getReferenceLink(0xf39336d3128847eeL, 0xbbfead2ea7e4504eL, 0x4f4781239a213505L, 0x4f4781239a213506L, "class");
    /*package*/ static final SContainmentLink annotations$N1J6 = MetaAdapterFactory.getContainmentLink(0xf39336d3128847eeL, 0xbbfead2ea7e4504eL, 0x4f4781239a213505L, 0x4f4781239a797b55L, "annotations");
    /*package*/ static final SReferenceLink method$9MOt = MetaAdapterFactory.getReferenceLink(0xf39336d3128847eeL, 0xbbfead2ea7e4504eL, 0x4f4781239a7100dfL, 0x4f4781239a7100fbL, "method");
    /*package*/ static final SContainmentLink parameter$5xBj = MetaAdapterFactory.getContainmentLink(0xf3061a5392264cc5L, 0xa443f952ceaf5816L, 0xf8cc56b1fcL, 0xf8cc56b1feL, "parameter");
    /*package*/ static final SContainmentLink type$a1UY = MetaAdapterFactory.getContainmentLink(0xf3061a5392264cc5L, 0xa443f952ceaf5816L, 0x450368d90ce15bc3L, 0x4ed4d318133c80ceL, "type");
    /*package*/ static final SReferenceLink baseMethodDeclaration$pyYw = MetaAdapterFactory.getReferenceLink(0xf3061a5392264cc5L, 0xa443f952ceaf5816L, 0x11857355952L, 0xf8c78301adL, "baseMethodDeclaration");
    /*package*/ static final SContainmentLink actualArgument$pzdx = MetaAdapterFactory.getContainmentLink(0xf3061a5392264cc5L, 0xa443f952ceaf5816L, 0x11857355952L, 0xf8c78301aeL, "actualArgument");
  }

  private static final class PROPS {
    /*package*/ static final SProperty name$MnvL = MetaAdapterFactory.getProperty(0xceab519525ea4f22L, 0x9b92103b95ca8c0cL, 0x110396eaaa4L, 0x110396ec041L, "name");
  }
}

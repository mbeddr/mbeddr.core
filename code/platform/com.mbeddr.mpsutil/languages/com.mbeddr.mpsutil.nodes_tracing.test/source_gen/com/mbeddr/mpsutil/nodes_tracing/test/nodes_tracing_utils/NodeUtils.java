package com.mbeddr.mpsutil.nodes_tracing.test.nodes_tracing_utils;

/*Generated by MPS */

import java.io.File;

/**
 * General utility methods.
 */
public class NodeUtils {

  public static String GENERATED_ARTEFACTS_FOLDER = "generated_artefacts";

  /**
   * Returns the full unit name from a full path -- e.g. a.b.file from /Users/.../source_gen/a/b/file.c
   */
  private static String extractUnitName(String fullQualifiedFileName, String folderName) {
    String result;
    int startPos = fullQualifiedFileName.lastIndexOf(folderName);
    if (startPos >= 0) {
      String tmp = fullQualifiedFileName.substring(startPos + folderName.length());
      // under windows we have both slashes in path
      tmp = tmp.replaceAll("\\\\", ".");
      fullQualifiedFileName = tmp.replaceAll("/", ".");
      result = fullQualifiedFileName.substring(1, fullQualifiedFileName.length() - 2);
    } else {
      result = fullQualifiedFileName;
    }
    return result;
  }

  public static String getUnitNameFromPath(String path) {
    if (new File(path).isAbsolute()) {
      return getUnitName(path);
    }

    // the path is relative
    // under windows we have both slashes in path
    String tmp = path.replaceAll("\\\\", ".");
    tmp = tmp.replaceAll("/", ".");
    String res = tmp.substring(0, path.length() - 2);
    return res;
  }

  public static String getUnitName(String fullQualifiedFileName) throws IllegalArgumentException {
    if (!(fullQualifiedFileName.endsWith(".c") || fullQualifiedFileName.endsWith(".h"))) {
      throw new IllegalArgumentException(fullQualifiedFileName + " should be a .c or .h file");
    } else if (!(fullQualifiedFileName.contains("source_gen")) && !(fullQualifiedFileName.contains("classes_gen")) && !(fullQualifiedFileName.contains(GENERATED_ARTEFACTS_FOLDER))) {
      throw new IllegalArgumentException(fullQualifiedFileName + " should reside in a source_gen or classes_gen folder");
    }
    String result = null;
    if (fullQualifiedFileName.contains("source_gen")) {
      result = extractUnitName(fullQualifiedFileName, "source_gen");
    } else if (fullQualifiedFileName.contains("classes_gen")) {
      result = extractUnitName(fullQualifiedFileName, "classes_gen");
    } else if (fullQualifiedFileName.contains(GENERATED_ARTEFACTS_FOLDER)) {
      result = extractUnitName(fullQualifiedFileName, GENERATED_ARTEFACTS_FOLDER);
    }
    return result;
  }

  public static String getFileName(String fullQualifiedName) throws IllegalArgumentException {
    if (!(fullQualifiedName.endsWith(".c") || fullQualifiedName.endsWith(".h"))) {
      throw new IllegalArgumentException(fullQualifiedName + " should end with .c or with .h");
    }
    int winStartPos = fullQualifiedName.lastIndexOf('\\');
    int unixStartPos = fullQualifiedName.lastIndexOf('/');
    if (winStartPos >= 0) {
      return fullQualifiedName.substring(winStartPos + 1);
    } else if (unixStartPos >= 0) {
      return fullQualifiedName.substring(unixStartPos + 1);
    } else {
      return fullQualifiedName;
    }
  }
}

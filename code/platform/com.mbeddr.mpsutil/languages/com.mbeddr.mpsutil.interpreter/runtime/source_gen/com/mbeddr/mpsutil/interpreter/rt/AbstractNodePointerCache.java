package com.mbeddr.mpsutil.interpreter.rt;

/*Generated by MPS */

import java.util.WeakHashMap;
import jetbrains.mps.smodel.SNodePointer;
import org.jetbrains.mps.openapi.model.SNode;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SNodeOperations;

public abstract class AbstractNodePointerCache<External, Internal> {
  protected final WeakHashMap<SNodePointer, Internal> cache = new WeakHashMap<SNodePointer, Internal>();

  public void clear() {
    this.cache.clear();
  }

  public External get(SNode node) {
    return unwrap(this.cache.get(convertToPointer(node)), node);
  }

  public boolean isCached(SNode node) {
    return this.cache.containsKey(convertToPointer(node));
  }

  public void remove(SNode node) {
    this.cache.remove(convertToPointer(node));
  }

  public void set(SNode node, External t) {
    this.cache.put(convertToPointer(node), wrap(t));
  }

  protected SNodePointer convertToPointer(SNode node) {
    if (node == null) {
      return null;
    }
    return new SNodePointer(node);
  }

  protected SNode convertToNode(SNodePointer nodePointer, SNode referenceNode) {
    if (nodePointer == null || referenceNode == null) {
      return null;
    }
    return nodePointer.resolve(SNodeOperations.getModel(referenceNode).getRepository());
  }

  protected abstract Internal wrap(External external);

  protected abstract External unwrap(Internal internal, SNode referenceNode);
}

package com.mbeddr.mpsutil.interpreter.rt;

/*Generated by MPS */

import org.jetbrains.mps.openapi.model.SNode;
import jetbrains.mps.lang.core.behavior.BaseConcept__BehaviorDescriptor;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SNodeOperations;
import jetbrains.mps.internal.collections.runtime.ListSequence;
import jetbrains.mps.typechecking.TypecheckingFacade;

public class EvaluatorNotApplicableException extends InterpreterBaseException {
  private final SNode node;
  private String message;

  public EvaluatorNotApplicableException(SNode node) {
    super();
    this.node = node;
    compileMessage();
  }


  public SNode getNode() {
    return node;
  }

  protected void compileMessage() {
    this.message = "No evaluator was applicable for " + BaseConcept__BehaviorDescriptor.getPresentation_idhEwIMiw.invoke(node) + "@" + node.getNodeId() + "<" + SNodeOperations.getConcept(node) + ">" + details(node);
  }

  public String details(SNode node) {
    StringBuffer bf = new StringBuffer("\n");
    for (SNode c : ListSequence.fromList(SNodeOperations.getChildren(node))) {
      bf.append("  " + SNodeOperations.getContainingLink(c) + ": " + SNodeOperations.getConcept(c).getName() + " :==: " + TypecheckingFacade.getFromContext().getTypeOf(c) + "\n");
    }
    bf.append("Please consult the log file (\"None of the following evaluators matched\") for more information");
    return bf.toString();
  }

  @Override
  public String getMessage() {
    return this.message;
  }
}

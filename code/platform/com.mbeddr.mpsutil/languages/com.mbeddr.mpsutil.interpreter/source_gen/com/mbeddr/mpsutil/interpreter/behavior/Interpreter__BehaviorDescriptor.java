package com.mbeddr.mpsutil.interpreter.behavior;

/*Generated by MPS */

import jetbrains.mps.core.aspects.behaviour.BaseBHDescriptor;
import org.jetbrains.mps.openapi.language.SAbstractConcept;
import jetbrains.mps.smodel.adapter.structure.MetaAdapterFactory;
import jetbrains.mps.core.aspects.behaviour.api.SMethod;
import jetbrains.mps.core.aspects.behaviour.SMethodBuilder;
import jetbrains.mps.core.aspects.behaviour.SJavaCompoundTypeImpl;
import jetbrains.mps.core.aspects.behaviour.AccessPrivileges;
import org.jetbrains.mps.openapi.model.SNode;
import java.util.Set;
import java.util.List;
import java.util.Arrays;
import org.jetbrains.annotations.NotNull;
import org.jetbrains.mps.openapi.model.SModel;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SNodeOperations;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SModelOperations;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SPropertyOperations;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SLinkOperations;
import jetbrains.mps.internal.collections.runtime.SetSequence;
import java.util.LinkedHashSet;
import jetbrains.mps.internal.collections.runtime.Sequence;
import java.util.Map;
import jetbrains.mps.internal.collections.runtime.MapSequence;
import java.util.LinkedHashMap;
import jetbrains.mps.internal.collections.runtime.ListSequence;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SConceptOperations;
import jetbrains.mps.internal.collections.runtime.IMapping;
import java.util.ArrayList;
import org.jetbrains.mps.openapi.language.SLanguage;
import jetbrains.mps.internal.collections.runtime.NotNullWhereFilter;
import jetbrains.mps.internal.collections.runtime.IterableUtils;
import jetbrains.mps.core.aspects.behaviour.api.SConstructor;
import org.jetbrains.annotations.Nullable;
import jetbrains.mps.core.aspects.behaviour.api.BHMethodNotFoundException;
import org.jetbrains.mps.openapi.language.SProperty;
import org.jetbrains.mps.openapi.language.SContainmentLink;
import org.jetbrains.mps.openapi.language.SReferenceLink;
import org.jetbrains.mps.openapi.language.SConcept;

public final class Interpreter__BehaviorDescriptor extends BaseBHDescriptor {
  private static final SAbstractConcept CONCEPT = MetaAdapterFactory.getConcept(0x47f075a6558e4640L, 0xa6067ce0236c8023L, 0x778ee47a6de672eaL, "com.mbeddr.mpsutil.interpreter.structure.Interpreter");

  public static final SMethod<String> getFqClassName_id4X7QcQ4uRS$ = new SMethodBuilder<String>(new SJavaCompoundTypeImpl(String.class)).name("getFqClassName").modifiers(0, AccessPrivileges.PUBLIC).concept(CONCEPT).baseMethodId(5712773029545344548L).languageId(0xa6067ce0236c8023L, 0x47f075a6558e4640L).build2();
  public static final SMethod<String> genClassName_id3iWeQsv_hZU = new SMethodBuilder<String>(new SJavaCompoundTypeImpl(String.class)).name("genClassName").modifiers(0, AccessPrivileges.PUBLIC).concept(CONCEPT).baseMethodId(3799977499691393018L).languageId(0xa6067ce0236c8023L, 0x47f075a6558e4640L).build2();
  public static final SMethod<Iterable<SNode>> effectiveEvaluators_id2bBLuwRtGtC = new SMethodBuilder<Iterable<SNode>>(new SJavaCompoundTypeImpl((Class<Iterable<SNode>>) ((Class) Object.class))).name("effectiveEvaluators").modifiers(0, AccessPrivileges.PUBLIC).concept(CONCEPT).baseMethodId(2515196518063327080L).languageId(0xa6067ce0236c8023L, 0x47f075a6558e4640L).build2();
  public static final SMethod<Iterable<SNode>> collectAllRelationships_id5LSSDsNyu1z = new SMethodBuilder<Iterable<SNode>>(new SJavaCompoundTypeImpl((Class<Iterable<SNode>>) ((Class) Object.class))).name("collectAllRelationships").modifiers(0, AccessPrivileges.PUBLIC).concept(CONCEPT).baseMethodId(6663324787727261795L).languageId(0xa6067ce0236c8023L, 0x47f075a6558e4640L).build2();
  public static final SMethod<Set<SNode>> collectRelatedInterpreters_id27SkbdyRYmk = new SMethodBuilder<Set<SNode>>(new SJavaCompoundTypeImpl((Class<Set<SNode>>) ((Class) Object.class))).name("collectRelatedInterpreters").modifiers(0, AccessPrivileges.PUBLIC).concept(CONCEPT).baseMethodId(2447795128864073108L).languageId(0xa6067ce0236c8023L, 0x47f075a6558e4640L).build2();
  public static final SMethod<List<SNode>> listOrderedRelationships_id27SkbdyMwT$ = new SMethodBuilder<List<SNode>>(new SJavaCompoundTypeImpl((Class<List<SNode>>) ((Class) Object.class))).name("listOrderedRelationships").modifiers(0, AccessPrivileges.PUBLIC).concept(CONCEPT).baseMethodId(2447795128862641764L).languageId(0xa6067ce0236c8023L, 0x47f075a6558e4640L).build2();
  /*package*/ static final SMethod<Void> setupRelationshipSorter_id27SkbdyNmGh = new SMethodBuilder<Void>(new SJavaCompoundTypeImpl(Void.class)).name("setupRelationshipSorter").modifiers(0, AccessPrivileges.PRIVATE).concept(CONCEPT).baseMethodId(2447795128862862097L).languageId(0xa6067ce0236c8023L, 0x47f075a6558e4640L).build2(SMethodBuilder.createJavaParameter(InterpreterSorter.class, ""), SMethodBuilder.createJavaParameter((Class<SNode>) ((Class) Object.class), ""));
  public static final SMethod<List<SNode>> listSortedEvaluators_id5x677oPooet = new SMethodBuilder<List<SNode>>(new SJavaCompoundTypeImpl((Class<List<SNode>>) ((Class) Object.class))).name("listSortedEvaluators").modifiers(0, AccessPrivileges.PUBLIC).concept(CONCEPT).baseMethodId(6360802817734706077L).languageId(0xa6067ce0236c8023L, 0x47f075a6558e4640L).build2();
  public static final SMethod<Set<SNode>> collectRelatedTypeMappings_id5LSSDsNz8Zb = new SMethodBuilder<Set<SNode>>(new SJavaCompoundTypeImpl((Class<Set<SNode>>) ((Class) Object.class))).name("collectRelatedTypeMappings").modifiers(0, AccessPrivileges.PUBLIC).concept(CONCEPT).baseMethodId(6663324787727437771L).languageId(0xa6067ce0236c8023L, 0x47f075a6558e4640L).build2();
  public static final SMethod<Set<SNode>> collectAllTypeMappings_id5LSSDsN_VcY = new SMethodBuilder<Set<SNode>>(new SJavaCompoundTypeImpl((Class<Set<SNode>>) ((Class) Object.class))).name("collectAllTypeMappings").modifiers(0, AccessPrivileges.PUBLIC).concept(CONCEPT).baseMethodId(6663324787728167742L).languageId(0xa6067ce0236c8023L, 0x47f075a6558e4640L).build2();
  public static final SMethod<List<SNode>> collectRelatedEvaluators_id5LSSDsN$l14 = new SMethodBuilder<List<SNode>>(new SJavaCompoundTypeImpl((Class<List<SNode>>) ((Class) Object.class))).name("collectRelatedEvaluators").modifiers(0, AccessPrivileges.PUBLIC).concept(CONCEPT).baseMethodId(6663324787727749188L).languageId(0xa6067ce0236c8023L, 0x47f075a6558e4640L).build2();
  public static final SMethod<List<SNode>> collectAllEvaluators_id5LSSDsNAP6a = new SMethodBuilder<List<SNode>>(new SJavaCompoundTypeImpl((Class<List<SNode>>) ((Class) Object.class))).name("collectAllEvaluators").modifiers(0, AccessPrivileges.PUBLIC).concept(CONCEPT).baseMethodId(6663324787728404874L).languageId(0xa6067ce0236c8023L, 0x47f075a6558e4640L).build2();
  public static final SMethod<String> evaluatedLanguagesList_id3WUcYJ3sgIU = new SMethodBuilder<String>(new SJavaCompoundTypeImpl(String.class)).name("evaluatedLanguagesList").modifiers(0, AccessPrivileges.PUBLIC).concept(CONCEPT).baseMethodId(4556011060727974842L).languageId(0xa6067ce0236c8023L, 0x47f075a6558e4640L).build2();

  private static final List<SMethod<?>> BH_METHODS = Arrays.<SMethod<?>>asList(getFqClassName_id4X7QcQ4uRS$, genClassName_id3iWeQsv_hZU, effectiveEvaluators_id2bBLuwRtGtC, collectAllRelationships_id5LSSDsNyu1z, collectRelatedInterpreters_id27SkbdyRYmk, listOrderedRelationships_id27SkbdyMwT$, setupRelationshipSorter_id27SkbdyNmGh, listSortedEvaluators_id5x677oPooet, collectRelatedTypeMappings_id5LSSDsNz8Zb, collectAllTypeMappings_id5LSSDsN_VcY, collectRelatedEvaluators_id5LSSDsN$l14, collectAllEvaluators_id5LSSDsNAP6a, evaluatedLanguagesList_id3WUcYJ3sgIU);

  private static void ___init___(@NotNull SNode __thisNode__) {
  }

  /*package*/ static String getFqClassName_id4X7QcQ4uRS$(@NotNull SNode __thisNode__) {
    SModel model = SNodeOperations.getModel(__thisNode__);
    String modelName = SModelOperations.getModelName(model);
    String className = Interpreter__BehaviorDescriptor.genClassName_id3iWeQsv_hZU.invoke(__thisNode__);
    return modelName + "." + className;
  }
  /*package*/ static String genClassName_id3iWeQsv_hZU(@NotNull SNode __thisNode__) {
    return "Interpreter" + SPropertyOperations.getString(__thisNode__, PROPS.name$MnvL);
  }
  /*package*/ static Iterable<SNode> effectiveEvaluators_id2bBLuwRtGtC(@NotNull SNode __thisNode__) {
    return SNodeOperations.ofConcept(SLinkOperations.getChildren(__thisNode__, LINKS.evaluators$ivb4), CONCEPTS.AbstractEvaluator$A);
  }
  /*package*/ static Iterable<SNode> collectAllRelationships_id5LSSDsNyu1z(@NotNull SNode __thisNode__) {
    return SLinkOperations.getChildren(__thisNode__, LINKS.relationships$5tcg);
  }
  /*package*/ static Set<SNode> collectRelatedInterpreters_id27SkbdyRYmk(@NotNull SNode __thisNode__) {
    Set<SNode> result = SetSequence.fromSet(new LinkedHashSet<SNode>());
    SetSequence.fromSet(result).addSequence(Sequence.fromIterable(SLinkOperations.collect(Interpreter__BehaviorDescriptor.collectAllRelationships_id5LSSDsNyu1z.invoke(__thisNode__), LINKS.target$de6W)));
    return result;
  }
  /*package*/ static List<SNode> listOrderedRelationships_id27SkbdyMwT$(@NotNull SNode __thisNode__) {
    InterpreterSorter sorter = new InterpreterSorter();
    Interpreter__BehaviorDescriptor.setupRelationshipSorter_id27SkbdyNmGh.invokeSpecial(__thisNode__, sorter, __thisNode__);
    return sorter.sort();
  }
  /*package*/ static void setupRelationshipSorter_id27SkbdyNmGh(@NotNull SNode __thisNode__, InterpreterSorter sorter, SNode interpreter) {
    for (SNode relationship : Sequence.fromIterable(Interpreter__BehaviorDescriptor.collectAllRelationships_id5LSSDsNyu1z.invoke(interpreter))) {
      boolean dive = true;

      if (sorter.contains(SLinkOperations.getTarget(relationship, LINKS.target$de6W))) {
        dive = false;
      }
      sorter.add(interpreter, relationship);

      if (dive) {
        Interpreter__BehaviorDescriptor.setupRelationshipSorter_id27SkbdyNmGh.invokeSpecial(__thisNode__, sorter, SLinkOperations.getTarget(relationship, LINKS.target$de6W));
      }
    }
  }
  /*package*/ static List<SNode> listSortedEvaluators_id5x677oPooet(@NotNull SNode __thisNode__) {
    final Map<SNode, Integer> newlines = MapSequence.fromMap(new LinkedHashMap<SNode, Integer>(16, (float) 0.75, false));

    final List<SNode> children = SLinkOperations.getChildren(__thisNode__, LINKS.evaluators$ivb4);

    Sequence.fromIterable(SNodeOperations.ofConcept(SLinkOperations.getChildren(__thisNode__, LINKS.evaluators$ivb4), CONCEPTS.AbstractEvaluator$A)).visitAll((it) -> {
      int count = 0;
      for (int i = SNodeOperations.getIndexInParent(it) + 1; i < ListSequence.fromList(children).count() && SConceptOperations.isExactly(SNodeOperations.asSConcept(SNodeOperations.getConcept(ListSequence.fromList(children).getElement(i))), CONCEPTS.DummyEvaluator$Kz); i++) {
        count++;
      }

      if (count > 0) {
        MapSequence.fromMap(newlines).put(it, count);
      }
    });

    List<SNode> result = Sequence.fromIterable(SNodeOperations.ofConcept(SLinkOperations.getChildren(__thisNode__, LINKS.evaluators$ivb4), CONCEPTS.AbstractEvaluator$A)).sort((a, b) -> (int) DummyEvaluator__BehaviorDescriptor.compareTo_id5x677oPovws.invoke(a, b), true).toList();

    for (IMapping<SNode, Integer> anchor : MapSequence.fromMap(newlines)) {
      int index = ListSequence.fromList(result).indexOf(anchor.key()) + 1;
      for (int i = 0; i < anchor.value(); i++) {
        ListSequence.fromList(result).insertElement(index, SConceptOperations.createNewNode(MetaAdapterFactory.getConcept(0x47f075a6558e4640L, 0xa6067ce0236c8023L, 0x22e7c5e837506431L, "com.mbeddr.mpsutil.interpreter.structure.DummyEvaluator")));
      }
    }

    return result;
  }
  /*package*/ static Set<SNode> collectRelatedTypeMappings_id5LSSDsNz8Zb(@NotNull SNode __thisNode__) {
    final Set<SNode> result = SetSequence.fromSet(new LinkedHashSet<SNode>());
    SetSequence.fromSet(Interpreter__BehaviorDescriptor.collectRelatedInterpreters_id27SkbdyRYmk.invoke(__thisNode__)).visitAll((it) -> SetSequence.fromSet(result).addSequence(ListSequence.fromList(SLinkOperations.getChildren(it, LINKS.typeMappings$iuu1))));
    return result;
  }
  /*package*/ static Set<SNode> collectAllTypeMappings_id5LSSDsN_VcY(@NotNull SNode __thisNode__) {
    Set<SNode> result = SetSequence.fromSet(new LinkedHashSet<SNode>());
    SetSequence.fromSet(result).addSequence(ListSequence.fromList(SLinkOperations.getChildren(__thisNode__, LINKS.typeMappings$iuu1)));
    SetSequence.fromSet(result).addSequence(SetSequence.fromSet(Interpreter__BehaviorDescriptor.collectRelatedTypeMappings_id5LSSDsNz8Zb.invoke(__thisNode__)));
    return result;
  }
  /*package*/ static List<SNode> collectRelatedEvaluators_id5LSSDsN$l14(@NotNull SNode __thisNode__) {
    final List<SNode> result = new ArrayList<SNode>();
    SetSequence.fromSet(Interpreter__BehaviorDescriptor.collectRelatedInterpreters_id27SkbdyRYmk.invoke(__thisNode__)).visitAll((it) -> ListSequence.fromList(result).addSequence(Sequence.fromIterable(Interpreter__BehaviorDescriptor.effectiveEvaluators_id2bBLuwRtGtC.invoke(it))));
    return result;
  }
  /*package*/ static List<SNode> collectAllEvaluators_id5LSSDsNAP6a(@NotNull SNode __thisNode__) {
    List<SNode> result = new ArrayList<SNode>();
    ListSequence.fromList(result).addSequence(Sequence.fromIterable(Interpreter__BehaviorDescriptor.effectiveEvaluators_id2bBLuwRtGtC.invoke(__thisNode__)));
    ListSequence.fromList(result).addSequence(ListSequence.fromList(Interpreter__BehaviorDescriptor.collectRelatedEvaluators_id5LSSDsN$l14.invoke(__thisNode__)));
    return result;
  }
  /*package*/ static String evaluatedLanguagesList_id3WUcYJ3sgIU(@NotNull SNode __thisNode__) {
    Iterable<SNode> conceptEvaluators = SNodeOperations.ofConcept(Interpreter__BehaviorDescriptor.effectiveEvaluators_id2bBLuwRtGtC.invoke(__thisNode__), CONCEPTS.ConceptEvaluator$R2);
    if (Sequence.fromIterable(conceptEvaluators).isNotEmpty()) {
      // ? operation has been added for more robustness during migration scenarios, where NPE were occurring here
      Iterable<SLanguage> langs = Sequence.fromIterable(conceptEvaluators).select((it) -> check_5rw02j_a0a0a0a0a1a1a21(SNodeOperations.asSConcept(SLinkOperations.getTarget(it, LINKS.concept$r$Lj)))).where(new NotNullWhereFilter()).distinct();
      return IterableUtils.join(Sequence.fromIterable(langs).select((it) -> it.getQualifiedName()), "\n");
    } else {
      return "(derived from evaluators)";
    }
  }

  /*package*/ Interpreter__BehaviorDescriptor() {
  }

  @Override
  protected void initNode(@NotNull SNode node, @NotNull SConstructor constructor, @Nullable Object[] parameters) {
    ___init___(node);
  }

  @Override
  protected <T> T invokeSpecial0(@NotNull SNode node, @NotNull SMethod<T> method, @Nullable Object[] parameters) {
    int methodIndex = BH_METHODS.indexOf(method);
    if (methodIndex < 0) {
      throw new BHMethodNotFoundException(this, method);
    }
    switch (methodIndex) {
      case 0:
        return (T) ((String) getFqClassName_id4X7QcQ4uRS$(node));
      case 1:
        return (T) ((String) genClassName_id3iWeQsv_hZU(node));
      case 2:
        return (T) ((Iterable<SNode>) effectiveEvaluators_id2bBLuwRtGtC(node));
      case 3:
        return (T) ((Iterable<SNode>) collectAllRelationships_id5LSSDsNyu1z(node));
      case 4:
        return (T) ((Set<SNode>) collectRelatedInterpreters_id27SkbdyRYmk(node));
      case 5:
        return (T) ((List<SNode>) listOrderedRelationships_id27SkbdyMwT$(node));
      case 6:
        setupRelationshipSorter_id27SkbdyNmGh(node, (InterpreterSorter) parameters[0], (SNode) parameters[1]);
        return null;
      case 7:
        return (T) ((List<SNode>) listSortedEvaluators_id5x677oPooet(node));
      case 8:
        return (T) ((Set<SNode>) collectRelatedTypeMappings_id5LSSDsNz8Zb(node));
      case 9:
        return (T) ((Set<SNode>) collectAllTypeMappings_id5LSSDsN_VcY(node));
      case 10:
        return (T) ((List<SNode>) collectRelatedEvaluators_id5LSSDsN$l14(node));
      case 11:
        return (T) ((List<SNode>) collectAllEvaluators_id5LSSDsNAP6a(node));
      case 12:
        return (T) ((String) evaluatedLanguagesList_id3WUcYJ3sgIU(node));
      default:
        throw new BHMethodNotFoundException(this, method);
    }
  }

  @Override
  protected <T> T invokeSpecial0(@NotNull SAbstractConcept concept, @NotNull SMethod<T> method, @Nullable Object[] parameters) {
    int methodIndex = BH_METHODS.indexOf(method);
    if (methodIndex < 0) {
      throw new BHMethodNotFoundException(this, method);
    }
    switch (methodIndex) {
      default:
        throw new BHMethodNotFoundException(this, method);
    }
  }

  @NotNull
  @Override
  public List<SMethod<?>> getDeclaredMethods() {
    return BH_METHODS;
  }

  @NotNull
  @Override
  public SAbstractConcept getConcept() {
    return CONCEPT;
  }
  private static SLanguage check_5rw02j_a0a0a0a0a1a1a21(SAbstractConcept checkedDotOperand) {
    if (null != checkedDotOperand) {
      return checkedDotOperand.getLanguage();
    }
    return null;
  }

  private static final class PROPS {
    /*package*/ static final SProperty name$MnvL = MetaAdapterFactory.getProperty(0xceab519525ea4f22L, 0x9b92103b95ca8c0cL, 0x110396eaaa4L, 0x110396ec041L, "name");
  }

  private static final class LINKS {
    /*package*/ static final SContainmentLink evaluators$ivb4 = MetaAdapterFactory.getContainmentLink(0x47f075a6558e4640L, 0xa6067ce0236c8023L, 0x778ee47a6de672eaL, 0x778ee47a6de67c0dL, "evaluators");
    /*package*/ static final SContainmentLink relationships$5tcg = MetaAdapterFactory.getContainmentLink(0x47f075a6558e4640L, 0xa6067ce0236c8023L, 0x778ee47a6de672eaL, 0x5c78e297336844c3L, "relationships");
    /*package*/ static final SReferenceLink target$de6W = MetaAdapterFactory.getReferenceLink(0x47f075a6558e4640L, 0xa6067ce0236c8023L, 0x5c78e2973360a2c1L, 0x5c78e29733672c61L, "target");
    /*package*/ static final SContainmentLink typeMappings$iuu1 = MetaAdapterFactory.getContainmentLink(0x47f075a6558e4640L, 0xa6067ce0236c8023L, 0x778ee47a6de672eaL, 0x778ee47a6de67c0aL, "typeMappings");
    /*package*/ static final SReferenceLink concept$r$Lj = MetaAdapterFactory.getReferenceLink(0x47f075a6558e4640L, 0xa6067ce0236c8023L, 0x778ee47a6de6793bL, 0x778ee47a6de67c48L, "concept");
  }

  private static final class CONCEPTS {
    /*package*/ static final SConcept AbstractEvaluator$A = MetaAdapterFactory.getConcept(0x47f075a6558e4640L, 0xa6067ce0236c8023L, 0x525a35a38d72237cL, "com.mbeddr.mpsutil.interpreter.structure.AbstractEvaluator");
    /*package*/ static final SConcept DummyEvaluator$Kz = MetaAdapterFactory.getConcept(0x47f075a6558e4640L, 0xa6067ce0236c8023L, 0x22e7c5e837506431L, "com.mbeddr.mpsutil.interpreter.structure.DummyEvaluator");
    /*package*/ static final SConcept ConceptEvaluator$R2 = MetaAdapterFactory.getConcept(0x47f075a6558e4640L, 0xa6067ce0236c8023L, 0x778ee47a6de6793bL, "com.mbeddr.mpsutil.interpreter.structure.ConceptEvaluator");
  }
}

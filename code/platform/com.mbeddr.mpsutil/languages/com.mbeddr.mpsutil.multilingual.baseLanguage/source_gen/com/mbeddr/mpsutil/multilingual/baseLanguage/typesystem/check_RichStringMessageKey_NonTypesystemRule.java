package com.mbeddr.mpsutil.multilingual.baseLanguage.typesystem;

/*Generated by MPS */

import jetbrains.mps.lang.typesystem.runtime.AbstractNonTypesystemRule_Runtime;
import jetbrains.mps.lang.typesystem.runtime.NonTypesystemRule_Runtime;
import org.jetbrains.mps.openapi.model.SNode;
import jetbrains.mps.typesystem.inference.TypeCheckingContext;
import jetbrains.mps.lang.typesystem.runtime.IsApplicableStatus;
import java.util.List;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SNodeOperations;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SLinkOperations;
import org.jetbrains.mps.openapi.language.SAbstractConcept;
import jetbrains.mps.internal.collections.runtime.ListSequence;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SPropertyOperations;
import java.util.Collections;
import jetbrains.mps.errors.messageTargets.MessageTarget;
import jetbrains.mps.errors.messageTargets.NodeMessageTarget;
import jetbrains.mps.errors.IErrorReporter;
import java.util.NoSuchElementException;
import org.jetbrains.mps.openapi.language.SContainmentLink;
import jetbrains.mps.smodel.adapter.structure.MetaAdapterFactory;
import org.jetbrains.mps.openapi.language.SConcept;
import org.jetbrains.mps.openapi.language.SProperty;

public class check_RichStringMessageKey_NonTypesystemRule extends AbstractNonTypesystemRule_Runtime implements NonTypesystemRule_Runtime {
  public check_RichStringMessageKey_NonTypesystemRule() {
  }
  public void applyRule(final SNode richStringMessageKey, final TypeCheckingContext typeCheckingContext, IsApplicableStatus status) {

    List<SNode> entries = SNodeOperations.getNodeDescendants(SLinkOperations.getTarget(richStringMessageKey, LINKS.richDefault$98lc), CONCEPTS.MultilingualInlineFormat$MK, false, new SAbstractConcept[]{});
    List<Integer> indicies = ListSequence.fromList(entries).select((it) -> SPropertyOperations.getInteger(it, PROPS.argumentIndex$euNt)).toList();


    try {
      int maxIndex = Collections.max(indicies);
      for (int i = 1; i <= maxIndex; i++) {
        // I expect collection of inline indexes to be very small to bother with effective list iteration
        int count = Collections.frequency(indicies, i);
        if (count == 0) {
          {
            final MessageTarget errorTarget = new NodeMessageTarget();
            IErrorReporter _reporter_2309309498 = typeCheckingContext.reportTypeError(richStringMessageKey, "index not set: " + i, "d2a1d976-43a2-462f-ac3a-9b258ced839d/r:b2834b64-265d-4877-941d-d9125f9bc1d6(com.mbeddr.mpsutil.multilingual.baseLanguage/com.mbeddr.mpsutil.multilingual.baseLanguage.typesystem)", "9087294576176750451", null, errorTarget);
          }
        } else if (count > 1) {
          for (SNode it : ListSequence.fromList(entries)) {
            if (SPropertyOperations.getInteger(it, PROPS.argumentIndex$euNt) == i) {
              {
                final MessageTarget errorTarget = new NodeMessageTarget();
                IErrorReporter _reporter_2309309498 = typeCheckingContext.reportTypeError(it, "index used several times: " + i, "d2a1d976-43a2-462f-ac3a-9b258ced839d/r:b2834b64-265d-4877-941d-d9125f9bc1d6(com.mbeddr.mpsutil.multilingual.baseLanguage/com.mbeddr.mpsutil.multilingual.baseLanguage.typesystem)", "7151873359526944164", null, errorTarget);
              }
            }
          }
        }
      }
    } catch (NoSuchElementException e) {
    }

  }
  public SAbstractConcept getApplicableConcept() {
    return CONCEPTS.RichStringMessageKey$ac;
  }
  public IsApplicableStatus isApplicableAndPattern(SNode argument) {
    return new IsApplicableStatus(argument.getConcept().isSubConceptOf(getApplicableConcept()), null);
  }
  public boolean overrides() {
    return false;
  }

  private static final class LINKS {
    /*package*/ static final SContainmentLink richDefault$98lc = MetaAdapterFactory.getContainmentLink(0xd2a1d97643a2462fL, 0xac3a9b258ced839dL, 0x7e1c8e453e27ae8aL, 0x7e1c8e453e2c94f7L, "richDefault");
  }

  private static final class CONCEPTS {
    /*package*/ static final SConcept MultilingualInlineFormat$MK = MetaAdapterFactory.getConcept(0xd2a1d97643a2462fL, 0xac3a9b258ced839dL, 0x7e1c8e453e3ae0bbL, "com.mbeddr.mpsutil.multilingual.baseLanguage.structure.MultilingualInlineFormat");
    /*package*/ static final SConcept RichStringMessageKey$ac = MetaAdapterFactory.getConcept(0xd2a1d97643a2462fL, 0xac3a9b258ced839dL, 0x7e1c8e453e27ae8aL, "com.mbeddr.mpsutil.multilingual.baseLanguage.structure.RichStringMessageKey");
  }

  private static final class PROPS {
    /*package*/ static final SProperty argumentIndex$euNt = MetaAdapterFactory.getProperty(0xd2a1d97643a2462fL, 0xac3a9b258ced839dL, 0x7e1c8e453e3ae0bbL, 0x7e1c8e453e3afb0cL, "argumentIndex");
  }
}

package com.mbeddr.mpsutil.multilingual.baseLanguage.typesystem;

/*Generated by MPS */

import jetbrains.mps.lang.typesystem.runtime.AbstractNonTypesystemRule_Runtime;
import jetbrains.mps.lang.typesystem.runtime.NonTypesystemRule_Runtime;
import org.jetbrains.mps.openapi.model.SNode;
import jetbrains.mps.typesystem.inference.TypeCheckingContext;
import jetbrains.mps.lang.typesystem.runtime.IsApplicableStatus;
import java.util.List;
import jetbrains.mps.internal.collections.runtime.ListSequence;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SNodeOperations;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SLinkOperations;
import org.jetbrains.mps.openapi.language.SAbstractConcept;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SPropertyOperations;
import jetbrains.mps.errors.messageTargets.MessageTarget;
import jetbrains.mps.errors.messageTargets.NodeMessageTarget;
import jetbrains.mps.errors.IErrorReporter;
import jetbrains.mps.typesystem.inference.TypeChecker;
import com.mbeddr.mpsutil.richstring.behavior.IInlineFormat__BehaviorDescriptor;
import com.mbeddr.mpsutil.richstring.typesystem.InlineFormatTypecheckHelper;
import com.mbeddr.mpsutil.richstring.behavior.IInlineFormatCategory__BehaviorDescriptor;
import org.jetbrains.mps.openapi.language.SReferenceLink;
import jetbrains.mps.smodel.adapter.structure.MetaAdapterFactory;
import org.jetbrains.mps.openapi.language.SContainmentLink;
import org.jetbrains.mps.openapi.language.SConcept;
import org.jetbrains.mps.openapi.language.SProperty;

public class check_MultilingualJavaRichString_NonTypesystemRule extends AbstractNonTypesystemRule_Runtime implements NonTypesystemRule_Runtime {
  public check_MultilingualJavaRichString_NonTypesystemRule() {
  }
  public void applyRule(final SNode multilingualJavaRichString, final TypeCheckingContext typeCheckingContext, IsApplicableStatus status) {
    List<SNode> formats = ListSequence.fromList(SNodeOperations.getNodeDescendants(SLinkOperations.getTarget(multilingualJavaRichString, LINKS.key$qYDz), CONCEPTS.MultilingualInlineFormat$MK, false, new SAbstractConcept[]{})).sort((it) -> SPropertyOperations.getInteger(it, PROPS.argumentIndex$euNt), true).toList();
    List<SNode> expressions = SLinkOperations.getChildren(multilingualJavaRichString, LINKS.expressions$vApI);

    if (ListSequence.fromList(formats).count() != ListSequence.fromList(expressions).count()) {
      {
        final MessageTarget errorTarget = new NodeMessageTarget();
        IErrorReporter _reporter_2309309498 = typeCheckingContext.reportTypeError(((ListSequence.fromList(expressions).first() != null) ? ListSequence.fromList(expressions).first() : multilingualJavaRichString), "number of inline formats (" + ListSequence.fromList(formats).count() + ") and expressions (" + ListSequence.fromList(expressions).count() + ") differ", "d2a1d976-43a2-462f-ac3a-9b258ced839d/r:b2834b64-265d-4877-941d-d9125f9bc1d6(com.mbeddr.mpsutil.multilingual.baseLanguage/com.mbeddr.mpsutil.multilingual.baseLanguage.typesystem)", "9087294576179370579", null, errorTarget);
      }
    }

    for (int i = 0; i < ListSequence.fromList(formats).count() && i < ListSequence.fromList(expressions).count(); i++) {
      if ((ListSequence.fromList(expressions).getElement(i) == null) || (ListSequence.fromList(formats).getElement(i) == null)) {
        continue;
      }

      SNode typeOf = TypeChecker.getInstance().getTypeOf(ListSequence.fromList(expressions).getElement(i));
      SAbstractConcept calculateCategory = IInlineFormat__BehaviorDescriptor.calculateCategory2_id38BeNG_3AFp.invoke(ListSequence.fromList(formats).getElement(i));

      if (typeOf == null || calculateCategory == null) {
        continue;
      }

      if (!(InlineFormatTypecheckHelper.matchesCategory(typeOf, calculateCategory))) {
        {
          final MessageTarget errorTarget = new NodeMessageTarget();
          IErrorReporter _reporter_2309309498 = typeCheckingContext.reportTypeError(ListSequence.fromList(expressions).getElement(i), "not applicable for " + IInlineFormatCategory__BehaviorDescriptor.getExpressionDescription_id6Go9U2yp2P0.invoke(SNodeOperations.asSConcept(calculateCategory)) + " expressions", "d2a1d976-43a2-462f-ac3a-9b258ced839d/r:b2834b64-265d-4877-941d-d9125f9bc1d6(com.mbeddr.mpsutil.multilingual.baseLanguage/com.mbeddr.mpsutil.multilingual.baseLanguage.typesystem)", "9087294576179481414", null, errorTarget);
        }
      }
    }
  }
  public SAbstractConcept getApplicableConcept() {
    return CONCEPTS.MultilingualJavaRichString$Bh;
  }
  public IsApplicableStatus isApplicableAndPattern(SNode argument) {
    return new IsApplicableStatus(argument.getConcept().isSubConceptOf(getApplicableConcept()), null);
  }
  public boolean overrides() {
    return false;
  }

  private static final class LINKS {
    /*package*/ static final SReferenceLink key$qYDz = MetaAdapterFactory.getReferenceLink(0x23f985f2965f4af1L, 0xaee8a32677429514L, 0x22d74031dd0626dbL, 0x22d74031dd0626dcL, "key");
    /*package*/ static final SContainmentLink expressions$vApI = MetaAdapterFactory.getContainmentLink(0xd2a1d97643a2462fL, 0xac3a9b258ced839dL, 0x7e1c8e453e27a8e4L, 0x7e1c8e453e544d2aL, "expressions");
  }

  private static final class CONCEPTS {
    /*package*/ static final SConcept MultilingualInlineFormat$MK = MetaAdapterFactory.getConcept(0xd2a1d97643a2462fL, 0xac3a9b258ced839dL, 0x7e1c8e453e3ae0bbL, "com.mbeddr.mpsutil.multilingual.baseLanguage.structure.MultilingualInlineFormat");
    /*package*/ static final SConcept MultilingualJavaRichString$Bh = MetaAdapterFactory.getConcept(0xd2a1d97643a2462fL, 0xac3a9b258ced839dL, 0x7e1c8e453e27a8e4L, "com.mbeddr.mpsutil.multilingual.baseLanguage.structure.MultilingualJavaRichString");
  }

  private static final class PROPS {
    /*package*/ static final SProperty argumentIndex$euNt = MetaAdapterFactory.getProperty(0xd2a1d97643a2462fL, 0xac3a9b258ced839dL, 0x7e1c8e453e3ae0bbL, 0x7e1c8e453e3afb0cL, "argumentIndex");
  }
}

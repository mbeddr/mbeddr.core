package com.mbeddr.mpsutil.review.behavior;

/*Generated by MPS */

import java.text.DateFormat;
import java.util.Date;
import java.time.Duration;
import java.util.TimeZone;
import java.text.SimpleDateFormat;

public class TimeHelper {
  private static final long SECONDS = 1000;
  private static final long MINUTES = 60;
  private static final long HOURS = 60;
  private static final long DAYS = 24;
  private static final long WEEKS = 7;
  private static final long MONTHS = 30;

  public static String asDateString(long timeMillis) {
    return DateFormat.getDateInstance().format(new Date(Long.valueOf(timeMillis)));
  }

  public static String asTimeString(long timeMillis) {
    return DateFormat.getTimeInstance().format(new Date(Long.valueOf(timeMillis)));
  }

  public static String asDateTimeString(long timeMillis) {
    return DateFormat.getDateTimeInstance().format(new Date(Long.valueOf(timeMillis)));
  }

  public static String asReadableDeltaString(long earlier, long later) {
    long delta = later - earlier;
    Duration d = Duration.ofMillis(delta);

    if (d.getSeconds() < 3) {
      return "just now";
    }
    if (d.getSeconds() < 7) {
      return "moments ago";
    }
    if (d.getSeconds() < 120) {
      return (d.getSeconds()) + " s ago";
    }
    if (d.toMinutes() < 120) {
      return (d.toMinutes()) + " min ago";
    }
    if (d.toHours() < 48) {
      return (d.toHours()) + " h ago";
    }
    if (d.toDays() < 21) {
      return (d.toDays()) + " d ago";
    }
    if (d.toDays() / WEEKS < 6) {
      return (d.toDays() / 7) + " w ago";
    }
    return (d.toDays() / MONTHS) + " months ago";
  }

  public static String asRelevantString(long time, long now) {
    long delta = now - time;
    if (delta < 24 * TimeHelper.HOURS * TimeHelper.MINUTES * TimeHelper.SECONDS) {
      return asTimeString(time);
    }
    if (delta < 2 * TimeHelper.DAYS * TimeHelper.HOURS * TimeHelper.MINUTES * TimeHelper.SECONDS) {
      return asDateTimeString(time);
    }
    return asDateString(time);
  }

  public static String asTotalInfo(long time, long now) {
    long delta = now - time;
    if (delta < 1 * TimeHelper.DAYS * TimeHelper.HOURS * TimeHelper.MINUTES * TimeHelper.SECONDS) {
      return asReadableDeltaString(time, now);
    }
    return asRelevantString(time, now) + " (" + asReadableDeltaString(time, now) + ")";
  }

  public static String asRelativeToNow(String time) {
    return asTotalInfo(Long.valueOf(time), System.currentTimeMillis());
  }

  public static String encodeCurrentGMTAsStandardString() {
    DateFormat df = DateFormat.getDateTimeInstance();
    df.setTimeZone(TimeZone.getTimeZone("gmt"));
    return df.format(new Date());
  }

  public static String transcodeToLocalTimeZone(String standardTimeString) {
    try {
      DateFormat df = DateFormat.getDateTimeInstance();
      df.setTimeZone(TimeZone.getTimeZone("gmt"));
      Date p = df.parse(standardTimeString);
      return new SimpleDateFormat("dd/MM/yy HH:mm").format(p);
    } catch (Exception ex) {
      return standardTimeString;
    }
  }
  public static long transcodeToLocalTimeZoneMillis(String standardTimeString) {
    try {
      DateFormat df = DateFormat.getDateTimeInstance();
      df.setTimeZone(TimeZone.getTimeZone("gmt"));
      Date p = df.parse(standardTimeString);
      return p.getTime();
    } catch (Exception ex) {
      return 0;
    }
  }

}

package com.mbeddr.mpsutil.conceptdiagram.editor;

/*Generated by MPS */

import jetbrains.mps.editor.runtime.descriptor.AbstractEditorBuilder;
import org.jetbrains.annotations.NotNull;
import org.jetbrains.mps.openapi.model.SNode;
import jetbrains.mps.openapi.editor.EditorContext;
import jetbrains.mps.openapi.editor.cells.EditorCell;
import jetbrains.mps.nodeEditor.cells.EditorCell_Collection;
import jetbrains.mps.nodeEditor.cellLayout.CellLayout_Vertical;
import org.jetbrains.mps.openapi.language.SProperty;
import jetbrains.mps.openapi.editor.menus.transformation.SPropertyInfo;
import jetbrains.mps.nodeEditor.cells.EditorCell_Property;
import jetbrains.mps.nodeEditor.cells.SPropertyAccessor;
import jetbrains.mps.nodeEditor.cellMenu.SPropertySubstituteInfo;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SNodeOperations;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.IAttributeDescriptor;
import jetbrains.mps.internal.collections.runtime.Sequence;
import java.util.Objects;
import jetbrains.mps.lang.core.behavior.PropertyAttribute__BehaviorDescriptor;
import jetbrains.mps.nodeEditor.EditorManager;
import jetbrains.mps.openapi.editor.update.AttributeKind;
import jetbrains.mps.nodeEditor.cells.EditorCell_Constant;
import jetbrains.mps.openapi.editor.style.Style;
import jetbrains.mps.editor.runtime.style.StyleImpl;
import jetbrains.mps.lang.structure.editor.structure_StyleSheet.GrayOutStyleClass;
import jetbrains.mps.baseLanguage.closures.runtime.Wrappers;
import de.itemis.mps.editor.diagram.runtime.jgraph.BaseDiagramECell;
import de.itemis.mps.editor.diagram.runtime.EditorUtil;
import de.itemis.mps.editor.diagram.runtime.jgraph.DiagramCreationContext;
import de.itemis.mps.editor.diagram.runtime.DiagramContext;
import de.itemis.mps.editor.diagram.runtime.ContextVariables;
import de.itemis.mps.editor.diagram.runtime.model.DiagramModel;
import de.itemis.mps.editor.diagram.runtime.jgraph.ElkLayouter;
import de.itemis.mps.editor.diagram.runtime.jgraph.LayeredLayouter;
import org.eclipse.elk.core.options.Direction;
import jetbrains.mps.baseLanguage.closures.runtime._FunctionTypes;
import de.itemis.mps.editor.diagram.runtime.model.IDiagramAccessor;
import de.itemis.mps.editor.diagram.runtime.model.AbstractDiagramAccessor;
import java.util.List;
import de.itemis.mps.editor.diagram.runtime.model.IDiagramElementAccessor;
import de.itemis.mps.editor.diagram.runtime.model.IAccessorFactory;
import java.util.ArrayList;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SLinkOperations;
import com.mbeddr.mpsutil.conceptdiagram.behavior.ConceptDiagram__BehaviorDescriptor;
import de.itemis.mps.editor.diagram.runtime.model.Port;
import de.itemis.mps.editor.diagram.shapes.EmptyShape;
import de.itemis.mps.editor.diagram.runtime.jgraph.MyGraph;
import jetbrains.mps.internal.collections.runtime.ListSequence;
import de.itemis.mps.editor.diagram.runtime.shape.IShape;
import de.itemis.mps.editor.diagram.runtime.model.AbstractBoxAccessor;
import de.itemis.mps.editor.diagram.runtime.model.EndpointUtil;
import org.jetbrains.annotations.Nullable;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SPropertyOperations;
import java.util.Collections;
import jetbrains.mps.baseLanguage.tuples.runtime.Tuples;
import java.util.Set;
import jetbrains.mps.internal.collections.runtime.SetSequence;
import java.util.LinkedHashSet;
import jetbrains.mps.baseLanguage.tuples.runtime.MultiTuple;
import de.itemis.mps.editor.diagram.runtime.DiagramUtil;
import de.itemis.mps.editor.diagram.runtime.model.AbstractEdgeAccessor;
import de.itemis.mps.editor.diagram.runtime.model.AccessorKey;
import de.itemis.mps.editor.diagram.runtime.model.IConnectionEndpoint_Internal;
import de.itemis.mps.editor.diagram.runtime.model.Box;
import de.itemis.mps.editor.diagram.runtime.model.IConnectionEndpointReference;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SEnumOperations;
import jetbrains.mps.editor.runtime.style.StyleAttributes;
import de.itemis.mps.editor.diagram.styles.editor.LineStyle;
import de.itemis.mps.editor.diagram.runtime.model.IConnectionType;
import java.util.Collection;
import de.itemis.mps.editor.diagram.runtime.model.AbstractConnectionType;
import de.itemis.mps.editor.diagram.runtime.model.IConnectionEndpoint;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SConceptOperations;
import jetbrains.mps.lang.structure.behavior.AbstractConceptDeclaration__BehaviorDescriptor;
import jetbrains.mps.smodel.action.SNodeFactoryOperations;
import jetbrains.mps.smodel.adapter.structure.MetaAdapterFactory;
import com.mxgraph.swing.mxGraphComponent;
import java.awt.Color;
import de.itemis.mps.editor.diagram.runtime.jgraph.MyGraphComponent;
import de.itemis.mps.editor.diagram.runtime.model.IPaletteEntryProvider;
import de.itemis.mps.editor.diagram.runtime.model.CompositePaletteEntryProvider;
import de.itemis.mps.editor.diagram.runtime.model.SubstituteInfoPaletteEntryProvider;
import jetbrains.mps.openapi.editor.cells.SubstituteInfo;
import de.itemis.mps.editor.diagram.runtime.substitute.SubstituteInfoFactory;
import de.itemis.mps.editor.diagram.runtime.jgraph.SubDiagramECell;
import de.itemis.mps.editor.diagram.runtime.jgraph.RootDiagramECell;
import javax.swing.JButton;
import java.awt.event.ActionListener;
import java.awt.event.ActionEvent;
import jetbrains.mps.project.Project;
import jetbrains.mps.ide.project.ProjectHelper;
import de.itemis.mps.editor.diagram.runtime.jgraph.DiagramActionsUtil;
import jetbrains.mps.nodeEditor.cells.EditorCell_Component;
import org.eclipse.elk.core.math.ElkPadding;
import org.eclipse.elk.alg.layered.options.LayeringStrategy;
import de.itemis.mps.editor.diagram.runtime.jgraph.RootDCell;
import de.itemis.mps.editor.diagram.runtime.jgraph.ContextButton;
import com.mxgraph.view.mxCellState;
import java.util.LinkedList;
import de.itemis.mps.editor.diagram.runtime.jgraph.MaximizeDiagramButton;
import de.itemis.mps.editor.diagram.runtime.jgraph.ResetViewButton;
import de.itemis.mps.editor.diagram.runtime.jgraph.ZoomInButton;
import de.itemis.mps.editor.diagram.runtime.jgraph.ZoomOutButton;
import de.itemis.mps.editor.diagram.runtime.jgraph.FitSizeAllDiagramButton;
import de.itemis.mps.editor.diagram.runtime.jgraph.TogglePortsLabelsButton;
import de.itemis.mps.editor.diagram.runtime.jgraph.ShowRootAllEdgesButton;
import de.itemis.mps.editor.diagram.runtime.jgraph.TranslateToOriginButton;
import de.itemis.mps.editor.diagram.runtime.jgraph.ToggleGridDiagramButton;
import de.itemis.mps.editor.diagram.runtime.jgraph.ToggleGridSnappingDiagramButton;
import de.itemis.mps.editor.diagram.runtime.jgraph.ExportDiagramAsPNGButton;
import de.itemis.mps.editor.diagram.runtime.jgraph.ExportDiagramAsSVGButton;
import de.itemis.mps.editor.diagram.runtime.jgraph.BoxBaseDCell;
import de.itemis.mps.editor.diagram.runtime.jgraph.FitSizeButton;
import de.itemis.mps.editor.diagram.runtime.jgraph.BoxDCell;
import de.itemis.mps.editor.diagram.runtime.jgraph.ShowAllEdgesButton;
import de.itemis.mps.editor.diagram.runtime.jgraph.HideAllEdgesButton;
import de.itemis.mps.editor.diagram.runtime.jgraph.OpenNodeButton;
import de.itemis.mps.editor.diagram.runtime.jgraph.EdgeDCell;
import de.itemis.mps.editor.diagram.runtime.jgraph.HideEdgeButton;
import jetbrains.mps.nodeEditor.MPSFonts;
import jetbrains.mps.nodeEditor.cellLayout.CellLayout_Horizontal;
import de.itemis.mps.editor.diagram.runtime.model.Edge;
import org.jetbrains.mps.openapi.language.SConcept;
import org.jetbrains.mps.openapi.language.SContainmentLink;
import org.jetbrains.mps.openapi.language.SReferenceLink;

/*package*/ class ConceptDiagram_EditorBuilder_a extends AbstractEditorBuilder {
  @NotNull
  private SNode myNode;

  public ConceptDiagram_EditorBuilder_a(@NotNull EditorContext context, @NotNull SNode node) {
    super(context);
    myNode = node;
  }

  @NotNull
  @Override
  public SNode getNode() {
    return myNode;
  }

  /*package*/ EditorCell createCell() {
    return createCollection_0();
  }

  private EditorCell createCollection_0() {
    EditorCell_Collection editorCell = new EditorCell_Collection(getEditorContext(), myNode, new CellLayout_Vertical());
    editorCell.setCellId("Collection_alumpc_a");
    editorCell.setBig(true);
    setCellContext(editorCell);
    editorCell.addEditorCell(createProperty_0());
    editorCell.addEditorCell(createConstant_0());
    editorCell.addEditorCell(createConstant_1());
    editorCell.addEditorCell(createConstant_2());
    editorCell.addEditorCell(createDiagram_1());
    return editorCell;
  }
  private EditorCell createProperty_0() {
    getCellFactory().pushCellContext();
    try {
      final SProperty property = PROPS.name$MnvL;
      getCellFactory().setPropertyInfo(new SPropertyInfo(myNode, property));
      EditorCell_Property editorCell = EditorCell_Property.create(getEditorContext(), new SPropertyAccessor(myNode, property, false, false), myNode);
      editorCell.setDefaultText("<no name>");
      editorCell.setCellId("property_name");
      editorCell.setSubstituteInfo(new SPropertySubstituteInfo(editorCell, property));
      setCellContext(editorCell);
      Iterable<SNode> propertyAttributes = SNodeOperations.ofConcept(new IAttributeDescriptor.AllAttributes().list(myNode), CONCEPTS.PropertyAttribute$Gb);
      Iterable<SNode> currentPropertyAttributes = Sequence.fromIterable(propertyAttributes).where((it) -> Objects.equals(PropertyAttribute__BehaviorDescriptor.getProperty_id1avfQ4BBzOo.invoke(it), property));
      if (Sequence.fromIterable(currentPropertyAttributes).isNotEmpty()) {
        EditorManager manager = EditorManager.getInstanceFromContext(getEditorContext());
        return manager.createNodeRoleAttributeCell(Sequence.fromIterable(currentPropertyAttributes).first(), AttributeKind.PROPERTY, editorCell);
      } else
      return editorCell;
    } finally {
      getCellFactory().popCellContext();
    }
  }
  private EditorCell createConstant_0() {
    EditorCell_Constant editorCell = new EditorCell_Constant(getEditorContext(), myNode, "");
    editorCell.setCellId("Constant_alumpc_b0");
    editorCell.setDefaultText("");
    return editorCell;
  }
  private EditorCell createConstant_1() {
    EditorCell_Constant editorCell = new EditorCell_Constant(getEditorContext(), myNode, "configuration in inspector");
    editorCell.setCellId("Constant_alumpc_c0");
    Style style = new StyleImpl();
    new GrayOutStyleClass(this).apply(style, editorCell);
    editorCell.getStyle().putAll(style);
    editorCell.setDefaultText("");
    return editorCell;
  }
  private EditorCell createConstant_2() {
    EditorCell_Constant editorCell = new EditorCell_Constant(getEditorContext(), myNode, "");
    editorCell.setCellId("Constant_alumpc_d0");
    editorCell.setDefaultText("");
    return editorCell;
  }
  private EditorCell createDiagram_0(final EditorContext editorContext, final SNode node) {
    final Wrappers._T<BaseDiagramECell> editorCell = new Wrappers._T<BaseDiagramECell>(null);
    final Wrappers._T<EditorCell> alternativeCell = new Wrappers._T<EditorCell>(null);

    EditorUtil.noCaching(editorContext, () -> {
      DiagramCreationContext.createDiagram(() -> {
        DiagramContext.withContext(node, () -> editorCell.value, () -> {
          ContextVariables.withValue("thisNode", node, () -> {
            final ContextVariables _variablesContext = ContextVariables.getCurrent();
            DiagramModel model = DiagramModel.getModel(editorContext, node, "2634829965775448091");
            final ElkLayouter layouter = new LayeredLayouter(Direction.UP);
            layouter.toggleConnectBoxesWithoutDummyPort(false);
            ((_FunctionTypes._void_P0_E0) () -> {
              // the closure is necessary so that we can declare the style variable again in the current scope
              Style style = new StyleImpl();
              layouter.setParentsStyle(style);
            }).invoke();

            model.setLayouter(layouter);

            IDiagramAccessor accessor = new AbstractDiagramAccessor(node) {
              public List<? extends IDiagramElementAccessor> getElements(IAccessorFactory accessorFactory) {
                final List<IDiagramElementAccessor> elements = new ArrayList<IDiagramElementAccessor>();
                for (final SNode parameterObject : new Object() {
                  public Iterable<SNode> query() {
                    return SLinkOperations.collect(ConceptDiagram__BehaviorDescriptor.getContents_id1FnP670tLPB.invoke(node), LINKS.concept$p3Wi);
                  }
                }.query()) {
                  ContextVariables.withParentAndValue(_variablesContext, "parameterObject", parameterObject, new Runnable() {
                    public void run() {
                      final ContextVariables _variablesContext = ContextVariables.getCurrent();
                      final EditorCell editorCell = new Inline_Builder_alumpc_a0e0(editorContext, parameterObject).createCell();

                      final List<Port> ports = new ArrayList<Port>();
                      {
                        Port port = new Port("extensions");
                        port.setRelativeX(0.5);
                        port.setRelativeY(0.0);
                        port.setShape(new EmptyShape());
                        Style style = new StyleImpl();
                        MyGraph rootGraph = DiagramCreationContext.getRootGraph();
                        if (port.getBox() != null && rootGraph != null) {
                          ElkLayouter layouter = (ElkLayouter) rootGraph.getRootDiagramModel().getLayouter();
                          layouter.addPortsStyle(style, port.getBox().getAccessor().getId());
                        }
                        ports.add(port);
                      }
                      {
                        Port port = new Port("subtypes");
                        port.setRelativeX(0.5);
                        port.setRelativeY(1.0);
                        port.setShape(new EmptyShape());
                        Style style = new StyleImpl();
                        MyGraph rootGraph = DiagramCreationContext.getRootGraph();
                        if (port.getBox() != null && rootGraph != null) {
                          ElkLayouter layouter = (ElkLayouter) rootGraph.getRootDiagramModel().getLayouter();
                          layouter.addPortsStyle(style, port.getBox().getAccessor().getId());
                        }
                        ports.add(port);
                      }
                      for (final SNode portObject : ListSequence.fromList(SLinkOperations.getChildren(((SNode) _variablesContext.getValue("parameterObject")), LINKS.linkDeclaration$YU1f))) {
                        ContextVariables.withParentAndValue(_variablesContext, "portObject", portObject, new Runnable() {
                          public void run() {
                            final ContextVariables _variablesContext = ContextVariables.getCurrent();
                            {
                              Port port = new Port("link" + SNodeOperations.getIndexInParent(((SNode) _variablesContext.getValue("portObject"))));
                              port.setRelativeX(1.0);
                              port.setShape(new EmptyShape());
                              port.setSNodeAndDummyCell(portObject, editorContext);
                              Style style = new StyleImpl();
                              MyGraph rootGraph = DiagramCreationContext.getRootGraph();
                              if (port.getBox() != null && rootGraph != null) {
                                ElkLayouter layouter = (ElkLayouter) rootGraph.getRootDiagramModel().getLayouter();
                                layouter.addPortsStyle(style, port.getBox().getAccessor().getId());
                              }
                              ports.add(port);
                            }
                          }
                        });
                      }
                      for (final SNode portObject : Sequence.fromIterable(DiagramHelper.collectAllIncomingLinks(((SNode) _variablesContext.getValue("parameterObject")), ConceptDiagram__BehaviorDescriptor.getDiagram_id1FnP670UhSa.invoke(((SNode) _variablesContext.getValue("thisNode")))))) {
                        ContextVariables.withParentAndValue(_variablesContext, "portObject", portObject, new Runnable() {
                          public void run() {
                            final ContextVariables _variablesContext = ContextVariables.getCurrent();
                            {
                              Port port = new Port("linkInput" + Sequence.fromIterable(DiagramHelper.collectAllIncomingLinks(((SNode) _variablesContext.getValue("parameterObject")), ConceptDiagram__BehaviorDescriptor.getDiagram_id1FnP670UhSa.invoke(((SNode) _variablesContext.getValue("thisNode"))))).indexOf(((SNode) _variablesContext.getValue("portObject"))));
                              port.setRelativeX(1.0);
                              port.setShape(new EmptyShape());
                              port.setSNodeAndDummyCell(portObject, editorContext);
                              Style style = new StyleImpl();
                              MyGraph rootGraph = DiagramCreationContext.getRootGraph();
                              if (port.getBox() != null && rootGraph != null) {
                                ElkLayouter layouter = (ElkLayouter) rootGraph.getRootDiagramModel().getLayouter();
                                layouter.addPortsStyle(style, port.getBox().getAccessor().getId());
                              }
                              ports.add(port);
                            }
                          }
                        });
                      }

                      final IShape shape = null;

                      AbstractBoxAccessor accessor = new AbstractBoxAccessor(EndpointUtil.createAccessorKeyForSNode(((SNode) _variablesContext.getValue("parameterObject")))) {
                        @Nullable
                        public SNode getSNode() {
                          return parameterObject;
                        }
                        public void delete() {
                          if (SPropertyOperations.getBoolean(node, PROPS.readonly$NiOU)) {
                            return;
                          }
                          SNode a = ListSequence.fromList(ConceptDiagram__BehaviorDescriptor.getContents_id1FnP670tLPB.invoke(node)).findFirst((it) -> Objects.equals(SLinkOperations.getTarget(it, LINKS.concept$p3Wi), ((SNode) _variablesContext.getValue("parameterObject"))));
                          SNode b = ((SNode) _variablesContext.getValue("parameterObject"));
                          SNodeOperations.deleteNode(a);
                          SNodeOperations.deleteNode(b);
                        }
                        @NotNull
                        @Override
                        public List<EditorCell> getContentCells() {
                          return Collections.singletonList(editorCell);
                        }
                        @NotNull
                        @Override
                        public List<Port> getPorts() {
                          return ports;
                        }
                        @Override
                        public IShape getShape() {
                          return shape;
                        }
                        @Override
                        public boolean allowConnectionsToBox() {
                          return !(SPropertyOperations.getBoolean(node, PROPS.readonly$NiOU));
                        }
                        @NotNull
                        @Override
                        public Iterable<SNode> getNavigationTargets() {
                          Iterable<SNode> result = Sequence.fromIterable(Collections.<SNode>emptyList());
                          result = Sequence.fromIterable(result).concat(Sequence.fromIterable(Sequence.<SNode>singleton(((SNode) _variablesContext.getValue("parameterObject")))));
                          return result;
                        }
                        @Override
                        public boolean allowScaling() {
                          return !(SPropertyOperations.getBoolean(node, PROPS.readonly$NiOU));
                        }
                      };
                      accessor.setRootCell(editorCell);
                      MyGraph rootGraph = DiagramCreationContext.getRootGraph();
                      if (rootGraph != null) {
                        ElkLayouter layouter = (ElkLayouter) rootGraph.getRootDiagramModel().getLayouter();
                        layouter.addNodesStyle(accessor.getStyle(), accessor.getId());
                      }

                      elements.add(accessor);
                    }
                  });
                }
                for (final Tuples._2<SNode, SNode> parameterObject : new Object() {
                  public Iterable<Tuples._2<SNode, SNode>> query() {
                    Set<Tuples._2<SNode, SNode>> result = SetSequence.fromSet(new LinkedHashSet<Tuples._2<SNode, SNode>>());
                    final List<SNode> contents = ConceptDiagram__BehaviorDescriptor.getContents_id1FnP670tLPB.invoke(node);

                    SetSequence.fromSet(result).addSequence(Sequence.fromIterable(SNodeOperations.ofConcept(SLinkOperations.collect(contents, LINKS.concept$p3Wi), CONCEPTS.ConceptDeclaration$gH)).where((it) -> (SLinkOperations.getTarget(it, LINKS.extends$_Isg) != null) && Sequence.fromIterable(SLinkOperations.collect(contents, LINKS.concept$p3Wi)).contains(SLinkOperations.getTarget(it, LINKS.extends$_Isg))).select((it) -> MultiTuple.<SNode,SNode>from(it, SLinkOperations.getTarget(it, LINKS.extends$_Isg))));

                    SetSequence.fromSet(result).addSequence(Sequence.fromIterable(SNodeOperations.ofConcept(SLinkOperations.collect(contents, LINKS.concept$p3Wi), CONCEPTS.InterfaceConceptDeclaration$CG)).where((it) -> ListSequence.fromList(SLinkOperations.getChildren(it, LINKS.extends$nawU)).isNotEmpty() && Sequence.fromIterable(SLinkOperations.collect(contents, LINKS.concept$p3Wi)).intersect(Sequence.fromIterable(SLinkOperations.collect(SLinkOperations.getChildren(it, LINKS.extends$nawU), LINKS.intfc$zM4e))).isNotEmpty()).translate((final SNode base) -> ListSequence.fromList(SLinkOperations.getChildren(base, LINKS.extends$nawU)).where((it) -> Sequence.fromIterable(SLinkOperations.collect(contents, LINKS.concept$p3Wi)).contains(SLinkOperations.getTarget(it, LINKS.intfc$zM4e))).select((extendz) -> MultiTuple.<SNode,SNode>from(base, SLinkOperations.getTarget(extendz, LINKS.intfc$zM4e)))));

                    return result;
                  }
                }.query()) {
                  ContextVariables.withParentAndValue(_variablesContext, "parameterObject", parameterObject, new Runnable() {
                    public void run() {
                      final ContextVariables _variablesContext = ContextVariables.getCurrent();
                      final EditorCell_Collection editorCell = EditorCell_Collection.createHorizontal(editorContext, node);
                      editorCell.setCellId("transformedGraphElement_b4a" + "." + "" + ((Tuples._2<SNode, SNode>) _variablesContext.getValue("parameterObject")));

                      final EditorCell labelCell = DiagramUtil.getCellIfNotEmpty(new Inline_Builder_alumpc_a1e0(editorContext, node).createCell());
                      if (labelCell != null) {
                        editorCell.addEditorCell(labelCell);
                      }

                      final IShape startShape = null;
                      final IShape endShape = new WhiteArrowHead(1.0, false);
                      AbstractEdgeAccessor accessor = new AbstractEdgeAccessor(new AccessorKey("" + ((Tuples._2<SNode, SNode>) _variablesContext.getValue("parameterObject")))) {
                        @Override
                        public void writeFrom(IConnectionEndpoint_Internal endpoint) {
                          writeFrom(EndpointUtil.getSNode(endpoint), EndpointUtil.getBox(endpoint), EndpointUtil.getPortName(endpoint));
                        }
                        public void writeFrom(final SNode targetNode, Box targetDNode, final String port) {
                        }
                        @Override
                        public void writeTo(IConnectionEndpoint_Internal endpoint) {
                          writeTo(EndpointUtil.getSNode(endpoint), EndpointUtil.getBox(endpoint), EndpointUtil.getPortName(endpoint));
                        }
                        public void writeTo(final SNode targetNode, Box targetDNode, final String port) {
                        }
                        @Override
                        public IConnectionEndpointReference readFrom() {
                          return EndpointUtil.createEndpointReferenceForPortSafe(EndpointUtil.createEndpointReferenceForNodeSafe(((Tuples._2<SNode, SNode>) _variablesContext.getValue("parameterObject"))._0()), "extensions");
                        }
                        @Override
                        public IConnectionEndpointReference readTo() {
                          return EndpointUtil.createEndpointReferenceForPortSafe(EndpointUtil.createEndpointReferenceForNodeSafe(((Tuples._2<SNode, SNode>) _variablesContext.getValue("parameterObject"))._1()), "subtypes");
                        }
                        @Override
                        public IShape getStartShape() {
                          return startShape;
                        }
                        @Override
                        public IShape getEndShape() {
                          return endShape;
                        }
                        @Nullable
                        @Override
                        public Double getEndShapeSize() {
                          return ((double) (8));
                        }
                        @Override
                        public EditorCell getLabelCell() {
                          return labelCell;
                        }
                        @Override
                        public void delete() {
                          if (SPropertyOperations.getBoolean(node, PROPS.readonly$NiOU)) {
                            return;
                          }
                          SNode source = ((Tuples._2<SNode, SNode>) _variablesContext.getValue("parameterObject"))._0();
                          if (SNodeOperations.isInstanceOf(source, CONCEPTS.ConceptDeclaration$gH)) {
                            SLinkOperations.setTarget(SNodeOperations.cast(source, CONCEPTS.ConceptDeclaration$gH), LINKS.extends$_Isg, null);
                          } else {
                            SNode x = ListSequence.fromList(SLinkOperations.getChildren(SNodeOperations.cast(source, CONCEPTS.InterfaceConceptDeclaration$CG), LINKS.extends$nawU)).findFirst((it) -> Objects.equals(SLinkOperations.getTarget(it, LINKS.intfc$zM4e), ((Tuples._2<SNode, SNode>) _variablesContext.getValue("parameterObject"))._1()));
                            SNodeOperations.deleteNode(x);
                          }
                        }
                        @Nullable
                        public SNode getSNode() {
                          return null;
                        }

                        @NotNull
                        @Override
                        public Iterable<SNode> getNavigationTargets() {
                          Iterable<SNode> result = Sequence.fromIterable(Collections.<SNode>emptyList());
                          result = Sequence.fromIterable(result).concat(Sequence.fromIterable(Sequence.<SNode>singleton((SNodeOperations.isInstanceOf(((Tuples._2<SNode, SNode>) _variablesContext.getValue("parameterObject"))._0(), CONCEPTS.ConceptDeclaration$gH) ? ((Tuples._2<SNode, SNode>) _variablesContext.getValue("parameterObject"))._0() : ListSequence.fromList(SLinkOperations.getChildren(SNodeOperations.cast(((Tuples._2<SNode, SNode>) _variablesContext.getValue("parameterObject"))._0(), CONCEPTS.InterfaceConceptDeclaration$CG), LINKS.extends$nawU)).findFirst((it) -> Objects.equals(SLinkOperations.getTarget(it, LINKS.intfc$zM4e), ((Tuples._2<SNode, SNode>) _variablesContext.getValue("parameterObject"))._1()))))));
                          return result;
                        }
                      };
                      accessor.setRootCell(editorCell);
                      MyGraph rootGraph = DiagramCreationContext.getRootGraph();
                      if (rootGraph != null) {
                        ElkLayouter layouter = (ElkLayouter) rootGraph.getRootDiagramModel().getLayouter();
                        layouter.addEdgesStyle(accessor.getStyle(), accessor.getId());
                        layouter.addLabelsStyle(accessor.getStyle(), accessor.getId());
                      }

                      elements.add(accessor);
                    }
                  });
                }
                for (final SNode parameterObject : new Object() {
                  public Iterable<SNode> query() {
                    final List<SNode> contents = ConceptDiagram__BehaviorDescriptor.getContents_id1FnP670tLPB.invoke(((SNode) _variablesContext.getValue("thisNode")));

                    return Sequence.fromIterable(SLinkOperations.collectMany(SLinkOperations.collect(contents, LINKS.concept$p3Wi), LINKS.linkDeclaration$YU1f)).where((it) -> Sequence.fromIterable(SLinkOperations.collect(contents, LINKS.concept$p3Wi)).contains(SLinkOperations.getTarget(it, LINKS.target$m40F)));
                  }
                }.query()) {
                  ContextVariables.withParentAndValue(_variablesContext, "parameterObject", parameterObject, new Runnable() {
                    public void run() {
                      final ContextVariables _variablesContext = ContextVariables.getCurrent();
                      final EditorCell_Collection editorCell = EditorCell_Collection.createHorizontal(editorContext, parameterObject);
                      editorCell.setCellId("transformedGraphElement_c4a" + "." + ((SNode) _variablesContext.getValue("parameterObject")));

                      final EditorCell labelCell = DiagramUtil.getCellIfNotEmpty(new Inline_Builder_alumpc_a2e0(editorContext, parameterObject).createCell());
                      final EditorCell endRoleCell = DiagramUtil.getCellIfNotEmpty(new Inline_Builder_alumpc_a0c4a(editorContext, parameterObject).createCell());
                      if (labelCell != null) {
                        editorCell.addEditorCell(labelCell);
                      }
                      if (endRoleCell != null) {
                        editorCell.addEditorCell(endRoleCell);
                      }

                      final IShape startShape = new Diamond(SEnumOperations.isMember(SPropertyOperations.getEnum(((SNode) _variablesContext.getValue("parameterObject")), PROPS.metaClass$PeKc), 0xfc6f4e95b9L), 2.0);
                      final IShape endShape = null;
                      AbstractEdgeAccessor accessor = new AbstractEdgeAccessor(EndpointUtil.createAccessorKeyForSNode(((SNode) _variablesContext.getValue("parameterObject")))) {
                        @Override
                        public void writeFrom(IConnectionEndpoint_Internal endpoint) {
                          writeFrom(EndpointUtil.getSNode(endpoint), EndpointUtil.getBox(endpoint), EndpointUtil.getPortName(endpoint));
                        }
                        public void writeFrom(final SNode targetNode, Box targetDNode, final String port) {
                        }
                        @Override
                        public void writeTo(IConnectionEndpoint_Internal endpoint) {
                          writeTo(EndpointUtil.getSNode(endpoint), EndpointUtil.getBox(endpoint), EndpointUtil.getPortName(endpoint));
                        }
                        public void writeTo(final SNode targetNode, Box targetDNode, final String port) {
                        }
                        @Override
                        public IConnectionEndpointReference readFrom() {
                          return EndpointUtil.createEndpointReferenceForPortSafe(EndpointUtil.createEndpointReferenceForNodeSafe(SNodeOperations.getParent(((SNode) _variablesContext.getValue("parameterObject")))), "link" + SNodeOperations.getIndexInParent(((SNode) _variablesContext.getValue("parameterObject"))));
                        }
                        @Override
                        public IConnectionEndpointReference readTo() {
                          return EndpointUtil.createEndpointReferenceForPortSafe(EndpointUtil.createEndpointReferenceForNodeSafe(SLinkOperations.getTarget(((SNode) _variablesContext.getValue("parameterObject")), LINKS.target$m40F)), "linkInput" + Sequence.fromIterable(DiagramHelper.collectAllIncomingLinks(SLinkOperations.getTarget(((SNode) _variablesContext.getValue("parameterObject")), LINKS.target$m40F), ConceptDiagram__BehaviorDescriptor.getDiagram_id1FnP670UhSa.invoke(((SNode) _variablesContext.getValue("thisNode"))))).indexOf(((SNode) _variablesContext.getValue("parameterObject"))));
                        }
                        @Override
                        public IShape getStartShape() {
                          return startShape;
                        }
                        @Override
                        public IShape getEndShape() {
                          return endShape;
                        }
                        @Override
                        public EditorCell getLabelCell() {
                          return labelCell;
                        }
                        @Override
                        public EditorCell getEndRoleCell() {
                          return endRoleCell;
                        }
                        @Override
                        public void delete() {
                          if (SPropertyOperations.getBoolean(node, PROPS.readonly$NiOU)) {
                            return;
                          }
                          SNodeOperations.deleteNode(((SNode) _variablesContext.getValue("parameterObject")));
                        }
                        @Nullable
                        public SNode getSNode() {
                          return parameterObject;
                        }

                        @NotNull
                        @Override
                        public Iterable<SNode> getNavigationTargets() {
                          Iterable<SNode> result = Sequence.fromIterable(Collections.<SNode>emptyList());
                          result = Sequence.fromIterable(result).concat(Sequence.fromIterable(Sequence.<SNode>singleton(((SNode) _variablesContext.getValue("parameterObject")))));
                          return result;
                        }
                      };
                      accessor.setRootCell(editorCell);
                      MyGraph rootGraph = DiagramCreationContext.getRootGraph();
                      if (rootGraph != null) {
                        ElkLayouter layouter = (ElkLayouter) rootGraph.getRootDiagramModel().getLayouter();
                        layouter.addEdgesStyle(accessor.getStyle(), accessor.getId());
                        layouter.addLabelsStyle(accessor.getStyle(), accessor.getId());
                      }

                      elements.add(accessor);
                    }
                  });
                }
                for (final SNode parameterObject : new Object() {
                  public Iterable<SNode> query() {
                    final List<SNode> contents = ConceptDiagram__BehaviorDescriptor.getContents_id1FnP670tLPB.invoke(((SNode) _variablesContext.getValue("thisNode")));
                    return Sequence.fromIterable(SLinkOperations.collectMany(SNodeOperations.ofConcept(SLinkOperations.collect(contents, LINKS.concept$p3Wi), CONCEPTS.ConceptDeclaration$gH), LINKS.implements$u_P2)).where((it) -> Sequence.fromIterable(SLinkOperations.collect(contents, LINKS.concept$p3Wi)).contains(SLinkOperations.getTarget(it, LINKS.intfc$zM4e)));
                  }
                }.query()) {
                  ContextVariables.withParentAndValue(_variablesContext, "parameterObject", parameterObject, new Runnable() {
                    public void run() {
                      final ContextVariables _variablesContext = ContextVariables.getCurrent();
                      final EditorCell_Collection editorCell = EditorCell_Collection.createHorizontal(editorContext, parameterObject);
                      editorCell.setCellId("transformedGraphElement_d4a" + "." + ((SNode) _variablesContext.getValue("parameterObject")));

                      final EditorCell labelCell = DiagramUtil.getCellIfNotEmpty(new Inline_Builder_alumpc_a3e0(editorContext, parameterObject).createCell());
                      if (labelCell != null) {
                        editorCell.addEditorCell(labelCell);
                      }

                      final IShape startShape = null;
                      final IShape endShape = new WhiteArrowHead(1.0, false);
                      AbstractEdgeAccessor accessor = new AbstractEdgeAccessor(EndpointUtil.createAccessorKeyForSNode(((SNode) _variablesContext.getValue("parameterObject")))) {
                        @Override
                        public void writeFrom(IConnectionEndpoint_Internal endpoint) {
                          writeFrom(EndpointUtil.getSNode(endpoint), EndpointUtil.getBox(endpoint), EndpointUtil.getPortName(endpoint));
                        }
                        public void writeFrom(final SNode targetNode, Box targetDNode, final String port) {
                        }
                        @Override
                        public void writeTo(IConnectionEndpoint_Internal endpoint) {
                          writeTo(EndpointUtil.getSNode(endpoint), EndpointUtil.getBox(endpoint), EndpointUtil.getPortName(endpoint));
                        }
                        public void writeTo(final SNode targetNode, Box targetDNode, final String port) {
                        }
                        @Override
                        public IConnectionEndpointReference readFrom() {
                          return EndpointUtil.createEndpointReferenceForPortSafe(EndpointUtil.createEndpointReferenceForNodeSafe(SNodeOperations.getParent(((SNode) _variablesContext.getValue("parameterObject")))), "extensions");
                        }
                        @Override
                        public IConnectionEndpointReference readTo() {
                          return EndpointUtil.createEndpointReferenceForPortSafe(EndpointUtil.createEndpointReferenceForNodeSafe(SLinkOperations.getTarget(((SNode) _variablesContext.getValue("parameterObject")), LINKS.intfc$zM4e)), "subtypes");
                        }
                        @Override
                        public IShape getStartShape() {
                          return startShape;
                        }
                        @Override
                        public IShape getEndShape() {
                          return endShape;
                        }
                        @Nullable
                        @Override
                        public Double getEndShapeSize() {
                          return ((double) (8));
                        }
                        @Override
                        public EditorCell getLabelCell() {
                          return labelCell;
                        }
                        @Override
                        public void delete() {
                          if (SPropertyOperations.getBoolean(node, PROPS.readonly$NiOU)) {
                            return;
                          }
                          SNodeOperations.deleteNode(((SNode) _variablesContext.getValue("parameterObject")));
                        }
                        @Nullable
                        public SNode getSNode() {
                          return parameterObject;
                        }

                        @NotNull
                        @Override
                        public Iterable<SNode> getNavigationTargets() {
                          Iterable<SNode> result = Sequence.fromIterable(Collections.<SNode>emptyList());
                          result = Sequence.fromIterable(result).concat(Sequence.fromIterable(Sequence.<SNode>singleton(((SNode) _variablesContext.getValue("parameterObject")))));
                          return result;
                        }
                      };
                      accessor.setRootCell(editorCell);
                      Style style = new StyleImpl();
                      style.set(StyleAttributes.getInstance().<LineStyle>getAttribute("de.itemis.mps.editor.diagram.styles", "__line-style"), _StyleParameter_QueryFunction_alumpc_a0d4a());
                      accessor.setStyle(style);
                      MyGraph rootGraph = DiagramCreationContext.getRootGraph();
                      if (rootGraph != null) {
                        ElkLayouter layouter = (ElkLayouter) rootGraph.getRootDiagramModel().getLayouter();
                        layouter.addEdgesStyle(accessor.getStyle(), accessor.getId());
                        layouter.addLabelsStyle(accessor.getStyle(), accessor.getId());
                      }

                      elements.add(accessor);
                    }
                  });
                }
                return elements;
              }
              @Override
              public List<IConnectionType> getConnectionTypes() {
                List<IConnectionType> connectionTypes = new ArrayList<IConnectionType>();
                connectionTypes.addAll(new Object() {
                  public Collection<IConnectionType> queryMany() {
                    return ListSequence.fromListAndArray(new ArrayList<IConnectionType>(), new AbstractConnectionType() {
                      public String getName() {
                        return "extends";
                      }
                      @Override
                      public boolean canCreate(IConnectionEndpoint from, IConnectionEndpoint to, List<String> reasons) {
                        if (SPropertyOperations.getBoolean(node, PROPS.readonly$NiOU)) {
                          return false;
                        }

                        return SConceptOperations.isSubConceptOf(SNodeOperations.asSConcept(SNodeOperations.getConcept(from.getSNode())), CONCEPTS.AbstractConceptDeclaration$KA) && Objects.equals(SNodeOperations.getConcept(from.getSNode()), SNodeOperations.getConcept(to.getSNode())) && !(Sequence.fromIterable(AbstractConceptDeclaration__BehaviorDescriptor.getAllSuperConcepts_id2A8AB0rAWpG.invoke(SNodeOperations.cast(from.getSNode(), CONCEPTS.AbstractConceptDeclaration$KA), ((boolean) false))).contains(SNodeOperations.cast(to.getSNode(), CONCEPTS.AbstractConceptDeclaration$KA))) && !(Sequence.fromIterable(AbstractConceptDeclaration__BehaviorDescriptor.getAllSuperConcepts_id2A8AB0rAWpG.invoke(SNodeOperations.cast(to.getSNode(), CONCEPTS.AbstractConceptDeclaration$KA), ((boolean) false))).contains(SNodeOperations.cast(from.getSNode(), CONCEPTS.AbstractConceptDeclaration$KA)));
                      }
                      @Override
                      public void create(IConnectionEndpoint from, IConnectionEndpoint to) {
                        if (SNodeOperations.isInstanceOf(from.getSNode(), CONCEPTS.ConceptDeclaration$gH)) {
                          SNode tFrom = ((SNode) from.getSNode());
                          SNode tTo = ((SNode) to.getSNode());
                          SLinkOperations.setTarget(tFrom, LINKS.extends$_Isg, tTo);
                        } else {
                          SNode tFrom = SNodeOperations.cast(from.getSNode(), CONCEPTS.InterfaceConceptDeclaration$CG);
                          SNode tTo = SNodeOperations.cast(to.getSNode(), CONCEPTS.InterfaceConceptDeclaration$CG);
                          SLinkOperations.setTarget(SNodeFactoryOperations.addNewChild(tFrom, LINKS.extends$nawU, null), LINKS.intfc$zM4e, tTo);
                        }
                      }
                    }, new AbstractConnectionType() {
                      public String getName() {
                        return "implements";
                      }
                      @Override
                      public boolean canCreate(IConnectionEndpoint from, IConnectionEndpoint to, List<String> reasons) {
                        if (SPropertyOperations.getBoolean(node, PROPS.readonly$NiOU)) {
                          return false;
                        }

                        return Objects.equals(SNodeOperations.getConcept(from.getSNode()), CONCEPTS.ConceptDeclaration$gH) && Objects.equals(SNodeOperations.getConcept(to.getSNode()), CONCEPTS.InterfaceConceptDeclaration$CG);
                      }
                      @Override
                      public void create(IConnectionEndpoint from, IConnectionEndpoint to) {
                        SNode tFrom = SNodeOperations.cast(from.getSNode(), CONCEPTS.ConceptDeclaration$gH);
                        SNode tTo = SNodeOperations.cast(to.getSNode(), CONCEPTS.InterfaceConceptDeclaration$CG);

                        SLinkOperations.setTarget(SNodeFactoryOperations.addNewChild(tFrom, LINKS.implements$u_P2, null), LINKS.intfc$zM4e, tTo);
                      }
                    }, new AbstractConnectionType() {
                      public String getName() {
                        return "aggregation";
                      }
                      @Override
                      public boolean canCreate(IConnectionEndpoint from, IConnectionEndpoint to, List<String> reasons) {
                        if (SPropertyOperations.getBoolean(node, PROPS.readonly$NiOU)) {
                          return false;
                        }

                        return SConceptOperations.isSubConceptOf(SNodeOperations.asSConcept(SNodeOperations.getConcept(from.getSNode())), CONCEPTS.AbstractConceptDeclaration$KA) && SConceptOperations.isSubConceptOf(SNodeOperations.asSConcept(SNodeOperations.getConcept(to.getSNode())), CONCEPTS.AbstractConceptDeclaration$KA);
                      }
                      @Override
                      public void create(IConnectionEndpoint from, IConnectionEndpoint to) {
                        SNode tFrom = SNodeOperations.cast(from.getSNode(), CONCEPTS.AbstractConceptDeclaration$KA);
                        SNode tTo = SNodeOperations.cast(to.getSNode(), CONCEPTS.AbstractConceptDeclaration$KA);

                        SNode link = SNodeFactoryOperations.addNewChild(tFrom, LINKS.linkDeclaration$YU1f, null);
                        SPropertyOperations.assignEnum(link, PROPS.metaClass$PeKc, SEnumOperations.getMember(MetaAdapterFactory.getEnumeration(0xc72da2b97cce4447L, 0x8389f407dc1158b7L, 0xfc6f4e95b7L, "jetbrains.mps.lang.structure.structure.LinkMetaclass"), 0xfc6f4e95b9L, "aggregation"));
                        SLinkOperations.setTarget(link, LINKS.target$m40F, tTo);
                      }
                    }, new AbstractConnectionType() {
                      public String getName() {
                        return "reference";
                      }
                      @Override
                      public boolean canCreate(IConnectionEndpoint from, IConnectionEndpoint to, List<String> reasons) {
                        if (SPropertyOperations.getBoolean(node, PROPS.readonly$NiOU)) {
                          return false;
                        }

                        return SConceptOperations.isSubConceptOf(SNodeOperations.asSConcept(SNodeOperations.getConcept(from.getSNode())), CONCEPTS.AbstractConceptDeclaration$KA) && SConceptOperations.isSubConceptOf(SNodeOperations.asSConcept(SNodeOperations.getConcept(to.getSNode())), CONCEPTS.AbstractConceptDeclaration$KA);
                      }
                      @Override
                      public void create(IConnectionEndpoint from, IConnectionEndpoint to) {
                        SNode tFrom = SNodeOperations.cast(from.getSNode(), CONCEPTS.AbstractConceptDeclaration$KA);
                        SNode tTo = SNodeOperations.cast(to.getSNode(), CONCEPTS.AbstractConceptDeclaration$KA);

                        SNode link = SNodeFactoryOperations.addNewChild(tFrom, LINKS.linkDeclaration$YU1f, null);
                        SPropertyOperations.assignEnum(link, PROPS.metaClass$PeKc, SEnumOperations.getMember(MetaAdapterFactory.getEnumeration(0xc72da2b97cce4447L, 0x8389f407dc1158b7L, 0xfc6f4e95b7L, "jetbrains.mps.lang.structure.structure.LinkMetaclass"), 0xfc6f4e95b8L, "reference"));
                        SLinkOperations.setTarget(link, LINKS.target$m40F, tTo);
                      }
                    });
                  }
                }.queryMany());
                return connectionTypes;
              }




              private boolean nodeCondition_alumpc_a4a() {
                return !(SPropertyOperations.getBoolean(myNode, PROPS.dontSaveLayoutData$p$y9));
              }

              @Override
              public boolean saveDiagramLayout() {
                return nodeCondition_alumpc_a4a();
              }

              private boolean nodeCondition_alumpc_a4a_0() {
                return SPropertyOperations.getBoolean(myNode, PROPS.autoLayoutOnInit$I5W_);
              }















              @Override
              public boolean runAutoLayoutOnInit() {
                boolean autoLayoutFlag = false;
                autoLayoutFlag = nodeCondition_alumpc_a4a_0();
                return autoLayoutFlag;
              }

              @Override
              public boolean runAutoLayoutOnChange() {
                boolean autoLayoutFlag = false;
                return autoLayoutFlag;
              }

              @Override
              public boolean fitToSizeOnInit() {
                boolean fitToSize = false;
                return fitToSize;
              }

              @Override
              public boolean disableNodeEditing() {
                boolean disableEditing = false;
                return disableEditing;
              }

              @Override
              public boolean syncWithModelOnlyOnOpening() {
                boolean flag = false;
                return flag;
              }

              @Override
              public boolean allowElementsToBeBelowRequiredSize() {
                boolean flag = false;
                return flag;
              }

              @Override
              public boolean showGrid() {
                boolean flag = false;
                return flag;
              }

              @Override
              public int getGridSize() {
                int size = 10;
                return size;
              }


              @Override
              public int getGridStyle() {
                try {
                  return mxGraphComponent.class.getDeclaredField("GRID_STYLE_DOT").getInt(null);
                } catch (Exception ex) {
                  return 0;
                }
              }

              @Override
              public Color getGridColor() {
                Color color = null;
                return color;
              }

              @Override
              public boolean useGridSnapping() {
                boolean flag = false;
                return flag;
              }


              @Override
              public double getArrowKeyMoveAmount() {
                double amount = MyGraphComponent.DEFAULT_ARROW_KEY_MOVE_AMOUNT;
                return amount;
              }

              @Override
              public double getArrowKeyMoveAmountSlow() {
                double amount = MyGraphComponent.DEFAULT_ARROW_KEY_MOVE_AMOUNT_SLOW;
                return amount;
              }

              @Override
              public double getPanAmount() {
                double amount = MyGraphComponent.DEFAULT_PAN_AMOUNT;
                return amount;
              }

              @Override
              public double getPanAmountSlow() {
                double amount = MyGraphComponent.DEFAULT_PAN_AMOUNT_SLOW;
                return amount;
              }

              @Override
              public double getMinimumScale() {
                double scale = MyGraphComponent.DEFAULT_MINIMUM_SCALE;
                return scale;
              }
            };

            model.setDiagramAccessor(accessor);

            IPaletteEntryProvider paletteEntryProvider = new CompositePaletteEntryProvider(new SubstituteInfoPaletteEntryProvider(new Object() {
              public SubstituteInfo get(SubstituteInfoFactory factory) {
                return new ConceptDiagramSubstituteInfo(ConceptDiagram__BehaviorDescriptor.getDiagram_id1FnP670UhSa.invoke(((SNode) _variablesContext.getValue("thisNode"))), SNodeOperations.getModel(node).getRepository());
              }
            }.get(new SubstituteInfoFactory(editorContext, node))));
            model.setPaletteEntryProvider(paletteEntryProvider);

            if (DiagramCreationContext.isSubdiagram()) {
              editorCell.value = new SubDiagramECell(editorContext, node, model);
            } else {
              editorCell.value = new RootDiagramECell(editorContext, node, model);
              RootDiagramECell rootCell = (RootDiagramECell) editorCell.value;
              if (rootCell.showInViewer()) {
                JButton openedInViewer = new JButton("open diagram in editor");
                openedInViewer.setOpaque(false);
                openedInViewer.addActionListener(new ActionListener() {
                  @Override
                  public void actionPerformed(ActionEvent e) {
                    Project mpsProject = ProjectHelper.getProject(editorContext.getRepository());
                    if (mpsProject == null) {
                      return;
                    }
                    com.intellij.openapi.project.Project ideaProject = ProjectHelper.toIdeaProject(mpsProject);
                    if (ideaProject == null) {
                      return;
                    }

                    DiagramActionsUtil.updateViewer(ideaProject, rootCell, editorContext.getEditorComponent());
                  }
                });
                alternativeCell.value = new EditorCell_Component(editorContext, node, openedInViewer);
                return;
              }
              rootCell.runAutoLayouterOnInit(node, accessor.runAutoLayoutOnInit());
              rootCell.fitToSizeOnInit(node, accessor.fitToSizeOnInit());
              if (accessor.disableNodeEditing()) {
                rootCell.getGraph().getGraphComponent().getCellEditor().setDisabled(true);
              }
            }
            editorCell.value.setCellId("Diagram_alumpc_e0");
            Style style = new StyleImpl();
            style.set(StyleAttributes.getInstance().<Double>getAttribute("de.itemis.mps.editor.diagram", "diagram-layout-edge-node-spacing"), _StyleParameter_QueryFunction_alumpc_a0e0());
            style.set(StyleAttributes.getInstance().<Double>getAttribute("de.itemis.mps.editor.diagram", "diagram-layout-layered-edge-node-between-layers-spacing"), _StyleParameter_QueryFunction_alumpc_a1e0());
            style.set(StyleAttributes.getInstance().<Double>getAttribute("de.itemis.mps.editor.diagram", "diagram-layout-edge-spacing"), _StyleParameter_QueryFunction_alumpc_a2e0());
            style.set(StyleAttributes.getInstance().<ElkPadding>getAttribute("de.itemis.mps.editor.diagram", "diagram-layout-padding"), _StyleParameter_QueryFunction_alumpc_a3e0());
            style.set(StyleAttributes.getInstance().<LayeringStrategy>getAttribute("de.itemis.mps.editor.diagram", "diagram-layout-layered-node-layering-strategy"), _StyleParameter_QueryFunction_alumpc_a4e0());
            style.set(StyleAttributes.READ_ONLY, _StyleParameter_QueryFunction_alumpc_a5e0());
            editorCell.value.getStyle().putAll(style);
            layouter.setParentsStyle(style);

            if (editorCell.value.getContextGraph() != null) {
              Object defaultParent = editorCell.value.getContextGraph().getDefaultParent();
              if (defaultParent instanceof RootDCell) {
                RootDCell rootDCell = ((RootDCell) defaultParent);
                {
                  Style styleDiagram = new StyleImpl();
                  styleDiagram.set(StyleAttributes.getInstance().<_FunctionTypes._return_P3_E0<? extends List<ContextButton>, ? super jetbrains.mps.nodeEditor.EditorContext, ? super SNode, ? super mxCellState>>getAttribute("de.itemis.mps.editor.diagram.styles", "__root-button-creator"), new _FunctionTypes._return_P3_E0<List<ContextButton>, EditorContext, SNode, mxCellState>() {
                    public List<ContextButton> invoke(EditorContext context, SNode node, mxCellState state) {
                      List<ContextButton> buttons = ListSequence.fromList(new LinkedList<ContextButton>());
                      ListSequence.fromList(buttons).addElement(new MaximizeDiagramButton(ContextButton.DEFAULT_BUTTON_SIZE, state));
                      ListSequence.fromList(buttons).addElement(new ResetViewButton(ContextButton.DEFAULT_BUTTON_SIZE, state));
                      ListSequence.fromList(buttons).addElement(new ZoomInButton(ContextButton.DEFAULT_BUTTON_SIZE, state));
                      ListSequence.fromList(buttons).addElement(new ZoomOutButton(ContextButton.DEFAULT_BUTTON_SIZE, state));
                      ListSequence.fromList(buttons).addElement(new FitSizeAllDiagramButton(ContextButton.DEFAULT_BUTTON_SIZE, state));
                      ListSequence.fromList(buttons).addElement(new TogglePortsLabelsButton(ContextButton.DEFAULT_BUTTON_SIZE, state));
                      ListSequence.fromList(buttons).addElement(new ShowRootAllEdgesButton(ContextButton.DEFAULT_BUTTON_SIZE, state));
                      ListSequence.fromList(buttons).addElement(new TranslateToOriginButton(ContextButton.DEFAULT_BUTTON_SIZE, state));
                      ListSequence.fromList(buttons).addElement(new ToggleGridDiagramButton(ContextButton.DEFAULT_BUTTON_SIZE, state));
                      ListSequence.fromList(buttons).addElement(new ToggleGridSnappingDiagramButton(ContextButton.DEFAULT_BUTTON_SIZE, state));
                      ListSequence.fromList(buttons).addElement(new ExportDiagramAsPNGButton(ContextButton.DEFAULT_BUTTON_SIZE * 2, ContextButton.DEFAULT_BUTTON_SIZE, state));
                      ListSequence.fromList(buttons).addElement(new ExportDiagramAsSVGButton(ContextButton.DEFAULT_BUTTON_SIZE * 2, ContextButton.DEFAULT_BUTTON_SIZE, state));
                      return buttons;
                    }
                  });
                  styleDiagram.set(StyleAttributes.getInstance().<_FunctionTypes._return_P3_E0<? extends List<ContextButton>, ? super jetbrains.mps.nodeEditor.EditorContext, ? super SNode, ? super mxCellState>>getAttribute("de.itemis.mps.editor.diagram.styles", "__vertex-button-creator"), new _FunctionTypes._return_P3_E0<List<ContextButton>, EditorContext, SNode, mxCellState>() {
                    public List<ContextButton> invoke(EditorContext context, SNode node, mxCellState state) {
                      List<ContextButton> buttons = ListSequence.fromList(new LinkedList<ContextButton>());
                      double size = ContextButton.DEFAULT_BUTTON_SIZE;
                      if (state.getCell() instanceof BoxBaseDCell) {
                        ListSequence.fromList(buttons).addElement(new FitSizeButton(size, state));
                      }

                      if (state.getCell() instanceof BoxDCell) {
                        BoxDCell boxCell = ((BoxDCell) state.getCell());
                        DiagramModel boxModel = boxCell.getBox().getModel();
                        if (boxModel.hasInvisibleEdges(boxCell.getBox())) {
                          ListSequence.fromList(buttons).addElement(new ShowAllEdgesButton(size, state));
                        }

                        if (boxModel.hasVisibleEdges(boxCell.getBox())) {
                          ListSequence.fromList(buttons).addElement(new HideAllEdgesButton(size, state));
                        }

                        for (SNode target : ListSequence.fromList(boxCell.getBox().getNavigationTargets())) {
                          ListSequence.fromList(buttons).addElement(new OpenNodeButton(size, state, target));
                        }
                      }

                      return buttons;
                    }
                  });
                  styleDiagram.set(StyleAttributes.getInstance().<_FunctionTypes._return_P3_E0<? extends List<ContextButton>, ? super jetbrains.mps.nodeEditor.EditorContext, ? super SNode, ? super mxCellState>>getAttribute("de.itemis.mps.editor.diagram.styles", "__edge-button-creator"), new _FunctionTypes._return_P3_E0<List<ContextButton>, EditorContext, SNode, mxCellState>() {
                    public List<ContextButton> invoke(EditorContext context, SNode node, mxCellState state) {
                      List<ContextButton> buttons = ListSequence.fromList(new LinkedList<ContextButton>());
                      double size = ContextButton.DEFAULT_BUTTON_SIZE;
                      if (state.getCell() instanceof EdgeDCell) {
                        EdgeDCell edgeCell = ((EdgeDCell) state.getCell());

                        ListSequence.fromList(buttons).addElement(new HideEdgeButton(size, state));

                        for (SNode target : ListSequence.fromList(check_oumt7y_a4a2a1a0d0b0b0bb0c0a0c0a0a0a0b0d0n(edgeCell.getEdge()))) {
                          ListSequence.fromList(buttons).addElement(new OpenNodeButton(size, state, target));
                        }
                      }

                      return buttons;
                    }
                  });
                  rootDCell.updateButtonConfig(styleDiagram);
                }
              }
            }
          });
        });
      });
    });


    if (alternativeCell.value != null) {
      return alternativeCell.value;
    }
    return editorCell.value;
  }
  private EditorCell createDiagram_1() {
    return createDiagram_0(getEditorContext(), myNode);
  }
  private LineStyle _StyleParameter_QueryFunction_alumpc_a0d4a() {
    return LineStyle.DASHED;
  }
  private double _StyleParameter_QueryFunction_alumpc_a0e0() {
    return 0;
  }
  private double _StyleParameter_QueryFunction_alumpc_a1e0() {
    return 0;
  }
  private double _StyleParameter_QueryFunction_alumpc_a2e0() {
    return 0;
  }
  private ElkPadding _StyleParameter_QueryFunction_alumpc_a3e0() {
    return new ElkPadding(0);
  }
  private LayeringStrategy _StyleParameter_QueryFunction_alumpc_a4e0() {
    return LayeringStrategy.COFFMAN_GRAHAM;
  }
  private boolean _StyleParameter_QueryFunction_alumpc_a5e0() {
    return SPropertyOperations.getBoolean(getNode(), PROPS.readonly$NiOU);
  }
  /*package*/ static class Inline_Builder_alumpc_a0e0 extends AbstractEditorBuilder {
    @NotNull
    private SNode myNode;

    /*package*/ Inline_Builder_alumpc_a0e0(@NotNull EditorContext context, @NotNull SNode node) {
      super(context);
      myNode = node;
    }

    /*package*/ EditorCell createCell() {
      return createComponent_0();
    }

    @NotNull
    @Override
    public SNode getNode() {
      return myNode;
    }

    private EditorCell createComponent_0() {
      EditorCell editorCell = getCellFactory().createEditorComponentCell(myNode, "com.mbeddr.mpsutil.conceptdiagram.editor.AbstractConceptDeclarationBox");
      return editorCell;
    }
  }
  /*package*/ static class Inline_Builder_alumpc_a1e0 extends AbstractEditorBuilder {
    @NotNull
    private SNode myNode;

    /*package*/ Inline_Builder_alumpc_a1e0(@NotNull EditorContext context, @NotNull SNode node) {
      super(context);
      myNode = node;
    }

    /*package*/ EditorCell createCell() {
      return createConstant_3();
    }

    @NotNull
    @Override
    public SNode getNode() {
      return myNode;
    }

    private EditorCell createConstant_3() {
      EditorCell_Constant editorCell = new EditorCell_Constant(getEditorContext(), myNode, "extends");
      editorCell.setCellId("Constant_alumpc_a0b4a");
      Style style = new StyleImpl();
      style.set(StyleAttributes.FONT_SIZE, _StyleParameter_QueryFunction_alumpc_a0a0b4a());
      style.set(StyleAttributes.FONT_STYLE, MPSFonts.PLAIN);
      style.set(StyleAttributes.DRAW_BORDER, false);
      editorCell.getStyle().putAll(style);
      editorCell.setDefaultText("");
      return editorCell;
    }
    private int _StyleParameter_QueryFunction_alumpc_a0a0b4a() {
      return 10;
    }
  }
  /*package*/ static class Inline_Builder_alumpc_a0c4a extends AbstractEditorBuilder {
    @NotNull
    private SNode myNode;

    /*package*/ Inline_Builder_alumpc_a0c4a(@NotNull EditorContext context, @NotNull SNode node) {
      super(context);
      myNode = node;
    }

    /*package*/ EditorCell createCell() {
      return createCollection_1();
    }

    @NotNull
    @Override
    public SNode getNode() {
      return myNode;
    }

    private EditorCell createCollection_1() {
      EditorCell_Collection editorCell = new EditorCell_Collection(getEditorContext(), myNode, new CellLayout_Horizontal());
      editorCell.setCellId("Collection_alumpc_a0a2e0");
      Style style = new StyleImpl();
      style.set(StyleAttributes.SELECTABLE, false);
      editorCell.getStyle().putAll(style);
      editorCell.addEditorCell(createProperty_1());
      return editorCell;
    }
    private EditorCell createProperty_1() {
      getCellFactory().pushCellContext();
      try {
        final SProperty property = PROPS.sourceCardinality$cxYK;
        getCellFactory().setPropertyInfo(new SPropertyInfo(myNode, property));
        EditorCell_Property editorCell = EditorCell_Property.create(getEditorContext(), new SPropertyAccessor(myNode, property, false, false), myNode);
        editorCell.setDefaultText("<no sourceCardinality>");
        editorCell.setCellId("property_sourceCardinality");
        editorCell.setSubstituteInfo(new SPropertySubstituteInfo(editorCell, property));
        setCellContext(editorCell);
        Iterable<SNode> propertyAttributes = SNodeOperations.ofConcept(new IAttributeDescriptor.AllAttributes().list(myNode), CONCEPTS.PropertyAttribute$Gb);
        Iterable<SNode> currentPropertyAttributes = Sequence.fromIterable(propertyAttributes).where((it) -> Objects.equals(PropertyAttribute__BehaviorDescriptor.getProperty_id1avfQ4BBzOo.invoke(it), property));
        if (Sequence.fromIterable(currentPropertyAttributes).isNotEmpty()) {
          EditorManager manager = EditorManager.getInstanceFromContext(getEditorContext());
          return manager.createNodeRoleAttributeCell(Sequence.fromIterable(currentPropertyAttributes).first(), AttributeKind.PROPERTY, editorCell);
        } else
        return editorCell;
      } finally {
        getCellFactory().popCellContext();
      }
    }
  }
  /*package*/ static class Inline_Builder_alumpc_a2e0 extends AbstractEditorBuilder {
    @NotNull
    private SNode myNode;

    /*package*/ Inline_Builder_alumpc_a2e0(@NotNull EditorContext context, @NotNull SNode node) {
      super(context);
      myNode = node;
    }

    /*package*/ EditorCell createCell() {
      return createCollection_2();
    }

    @NotNull
    @Override
    public SNode getNode() {
      return myNode;
    }

    private EditorCell createCollection_2() {
      EditorCell_Collection editorCell = new EditorCell_Collection(getEditorContext(), myNode, new CellLayout_Horizontal());
      editorCell.setCellId("Collection_alumpc_a0c4a");
      Style style = new StyleImpl();
      style.set(StyleAttributes.SELECTABLE, false);
      editorCell.getStyle().putAll(style);
      editorCell.addEditorCell(createProperty_2());
      return editorCell;
    }
    private EditorCell createProperty_2() {
      getCellFactory().pushCellContext();
      try {
        final SProperty property = PROPS.role$Nsjf;
        getCellFactory().setPropertyInfo(new SPropertyInfo(myNode, property));
        EditorCell_Property editorCell = EditorCell_Property.create(getEditorContext(), new SPropertyAccessor(myNode, property, false, false), myNode);
        editorCell.setDefaultText("<no role>");
        editorCell.setCellId("property_role");
        editorCell.setSubstituteInfo(new SPropertySubstituteInfo(editorCell, property));
        setCellContext(editorCell);
        Iterable<SNode> propertyAttributes = SNodeOperations.ofConcept(new IAttributeDescriptor.AllAttributes().list(myNode), CONCEPTS.PropertyAttribute$Gb);
        Iterable<SNode> currentPropertyAttributes = Sequence.fromIterable(propertyAttributes).where((it) -> Objects.equals(PropertyAttribute__BehaviorDescriptor.getProperty_id1avfQ4BBzOo.invoke(it), property));
        if (Sequence.fromIterable(currentPropertyAttributes).isNotEmpty()) {
          EditorManager manager = EditorManager.getInstanceFromContext(getEditorContext());
          return manager.createNodeRoleAttributeCell(Sequence.fromIterable(currentPropertyAttributes).first(), AttributeKind.PROPERTY, editorCell);
        } else
        return editorCell;
      } finally {
        getCellFactory().popCellContext();
      }
    }
  }
  /*package*/ static class Inline_Builder_alumpc_a3e0 extends AbstractEditorBuilder {
    @NotNull
    private SNode myNode;

    /*package*/ Inline_Builder_alumpc_a3e0(@NotNull EditorContext context, @NotNull SNode node) {
      super(context);
      myNode = node;
    }

    /*package*/ EditorCell createCell() {
      return createConstant_4();
    }

    @NotNull
    @Override
    public SNode getNode() {
      return myNode;
    }

    private EditorCell createConstant_4() {
      EditorCell_Constant editorCell = new EditorCell_Constant(getEditorContext(), myNode, "implements");
      editorCell.setCellId("Constant_alumpc_a0d4a");
      Style style = new StyleImpl();
      style.set(StyleAttributes.FONT_STYLE, MPSFonts.PLAIN);
      style.set(StyleAttributes.FONT_SIZE, _StyleParameter_QueryFunction_alumpc_a1a0d4a());
      editorCell.getStyle().putAll(style);
      editorCell.setDefaultText("");
      return editorCell;
    }
    private int _StyleParameter_QueryFunction_alumpc_a1a0d4a() {
      return 10;
    }
  }
  private static List<SNode> check_oumt7y_a4a2a1a0d0b0b0bb0c0a0c0a0a0a0b0d0n(Edge checkedDotOperand) {
    if (null != checkedDotOperand) {
      return checkedDotOperand.getNavigationTargets();
    }
    return null;
  }

  private static final class PROPS {
    /*package*/ static final SProperty name$MnvL = MetaAdapterFactory.getProperty(0xceab519525ea4f22L, 0x9b92103b95ca8c0cL, 0x110396eaaa4L, 0x110396ec041L, "name");
    /*package*/ static final SProperty readonly$NiOU = MetaAdapterFactory.getProperty(0x9d1cb9f82ae04895L, 0x91c8ff32e8afc27dL, 0x2490cbe4d990691aL, 0x6117e922fde38586L, "readonly");
    /*package*/ static final SProperty metaClass$PeKc = MetaAdapterFactory.getProperty(0xc72da2b97cce4447L, 0x8389f407dc1158b7L, 0xf979bd086aL, 0xf980556927L, "metaClass");
    /*package*/ static final SProperty dontSaveLayoutData$p$y9 = MetaAdapterFactory.getProperty(0x9d1cb9f82ae04895L, 0x91c8ff32e8afc27dL, 0x2490cbe4d990691aL, 0x1ad7d461c02e91e6L, "dontSaveLayoutData");
    /*package*/ static final SProperty autoLayoutOnInit$I5W_ = MetaAdapterFactory.getProperty(0x9d1cb9f82ae04895L, 0x91c8ff32e8afc27dL, 0x2490cbe4d990691aL, 0x1ad7d461c03730cdL, "autoLayoutOnInit");
    /*package*/ static final SProperty sourceCardinality$cxYK = MetaAdapterFactory.getProperty(0xc72da2b97cce4447L, 0x8389f407dc1158b7L, 0xf979bd086aL, 0xf98054bb04L, "sourceCardinality");
    /*package*/ static final SProperty role$Nsjf = MetaAdapterFactory.getProperty(0xc72da2b97cce4447L, 0x8389f407dc1158b7L, 0xf979bd086aL, 0xf98052f333L, "role");
  }

  private static final class CONCEPTS {
    /*package*/ static final SConcept PropertyAttribute$Gb = MetaAdapterFactory.getConcept(0xceab519525ea4f22L, 0x9b92103b95ca8c0cL, 0x2eb1ad060897da56L, "jetbrains.mps.lang.core.structure.PropertyAttribute");
    /*package*/ static final SConcept ConceptDeclaration$gH = MetaAdapterFactory.getConcept(0xc72da2b97cce4447L, 0x8389f407dc1158b7L, 0xf979ba0450L, "jetbrains.mps.lang.structure.structure.ConceptDeclaration");
    /*package*/ static final SConcept InterfaceConceptDeclaration$CG = MetaAdapterFactory.getConcept(0xc72da2b97cce4447L, 0x8389f407dc1158b7L, 0x1103556dcafL, "jetbrains.mps.lang.structure.structure.InterfaceConceptDeclaration");
    /*package*/ static final SConcept AbstractConceptDeclaration$KA = MetaAdapterFactory.getConcept(0xc72da2b97cce4447L, 0x8389f407dc1158b7L, 0x1103553c5ffL, "jetbrains.mps.lang.structure.structure.AbstractConceptDeclaration");
  }

  private static final class LINKS {
    /*package*/ static final SContainmentLink linkDeclaration$YU1f = MetaAdapterFactory.getContainmentLink(0xc72da2b97cce4447L, 0x8389f407dc1158b7L, 0x1103553c5ffL, 0xf979c3ba6bL, "linkDeclaration");
    /*package*/ static final SReferenceLink concept$p3Wi = MetaAdapterFactory.getReferenceLink(0x9d1cb9f82ae04895L, 0x91c8ff32e8afc27dL, 0x2490cbe4d9d63687L, 0x2490cbe4d9d63688L, "concept");
    /*package*/ static final SReferenceLink extends$_Isg = MetaAdapterFactory.getReferenceLink(0xc72da2b97cce4447L, 0x8389f407dc1158b7L, 0xf979ba0450L, 0xf979be93cfL, "extends");
    /*package*/ static final SContainmentLink extends$nawU = MetaAdapterFactory.getContainmentLink(0xc72da2b97cce4447L, 0x8389f407dc1158b7L, 0x1103556dcafL, 0x110356e9df4L, "extends");
    /*package*/ static final SReferenceLink intfc$zM4e = MetaAdapterFactory.getReferenceLink(0xc72da2b97cce4447L, 0x8389f407dc1158b7L, 0x110356fc618L, 0x110356fe029L, "intfc");
    /*package*/ static final SReferenceLink target$m40F = MetaAdapterFactory.getReferenceLink(0xc72da2b97cce4447L, 0x8389f407dc1158b7L, 0xf979bd086aL, 0xf98055fef0L, "target");
    /*package*/ static final SContainmentLink implements$u_P2 = MetaAdapterFactory.getContainmentLink(0xc72da2b97cce4447L, 0x8389f407dc1158b7L, 0xf979ba0450L, 0x110358d693eL, "implements");
  }
}

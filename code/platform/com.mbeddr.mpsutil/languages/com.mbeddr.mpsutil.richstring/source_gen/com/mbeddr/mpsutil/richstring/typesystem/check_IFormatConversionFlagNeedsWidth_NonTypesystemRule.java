package com.mbeddr.mpsutil.richstring.typesystem;

/*Generated by MPS */

import jetbrains.mps.lang.typesystem.runtime.AbstractNonTypesystemRule_Runtime;
import jetbrains.mps.lang.typesystem.runtime.NonTypesystemRule_Runtime;
import org.jetbrains.mps.openapi.model.SNode;
import jetbrains.mps.typesystem.inference.TypeCheckingContext;
import jetbrains.mps.lang.typesystem.runtime.IsApplicableStatus;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SNodeOperations;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SLinkOperations;
import jetbrains.mps.errors.messageTargets.MessageTarget;
import jetbrains.mps.errors.messageTargets.NodeMessageTarget;
import jetbrains.mps.errors.IErrorReporter;
import com.mbeddr.mpsutil.richstring.behavior.IFormatConversionFlag__BehaviorDescriptor;
import java.util.List;
import jetbrains.mps.internal.collections.runtime.ListSequence;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SConceptOperations;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SPropertyOperations;
import org.jetbrains.mps.openapi.language.SAbstractConcept;
import org.jetbrains.mps.openapi.language.SConcept;
import jetbrains.mps.smodel.adapter.structure.MetaAdapterFactory;
import org.jetbrains.mps.openapi.language.SInterfaceConcept;
import org.jetbrains.mps.openapi.language.SContainmentLink;
import org.jetbrains.mps.openapi.language.SProperty;

public class check_IFormatConversionFlagNeedsWidth_NonTypesystemRule extends AbstractNonTypesystemRule_Runtime implements NonTypesystemRule_Runtime {
  public check_IFormatConversionFlagNeedsWidth_NonTypesystemRule() {
  }
  public void applyRule(final SNode iFormatConversionFlagNeedsWidth, final TypeCheckingContext typeCheckingContext, IsApplicableStatus status) {
    SNode inlineFormat = SNodeOperations.getNodeAncestor(iFormatConversionFlagNeedsWidth, CONCEPTS.InlineFormat$AE, false, false);
    if ((SLinkOperations.getTarget(inlineFormat, LINKS.width$hZIq) == null)) {
      {
        final MessageTarget errorTarget = new NodeMessageTarget();
        IErrorReporter _reporter_2309309498 = typeCheckingContext.reportTypeError(iFormatConversionFlagNeedsWidth, "flag " + IFormatConversionFlag__BehaviorDescriptor.getConversionFlagSymbol_id2UbT3C4ekKT.invoke(iFormatConversionFlagNeedsWidth) + " needs a width defined", "r:f7af3984-a112-4e63-b8bb-3a0771bf3a31(com.mbeddr.mpsutil.richstring.typesystem)", "7716961532374963564", null, errorTarget);
      }
    }

    List<SNode> subConcepts = ListSequence.fromList(ListSequence.fromList(SConceptOperations.getAllSubConcepts(CONCEPTS.IFormatConversionFlagNeedsWidth$1U, SNodeOperations.getModel(iFormatConversionFlagNeedsWidth))).select((it) -> SNodeOperations.cast(SNodeOperations.asNode(it), CONCEPTS.AbstractConceptDeclaration$KA)).toList()).removeWhere((it) -> SPropertyOperations.getBoolean(it, PROPS.abstract$ibpT) || !(SConceptOperations.isExactly(SNodeOperations.asSConcept(SNodeOperations.getConcept(it)), CONCEPTS.ConceptDeclaration$gH)));
    if (ListSequence.fromList(SLinkOperations.getChildren(inlineFormat, LINKS.flags$hZvp)).select((it) -> SNodeOperations.asNode(SNodeOperations.getConcept(it))).containsSequence(ListSequence.fromList(subConcepts))) {
      {
        final MessageTarget errorTarget = new NodeMessageTarget();
        IErrorReporter _reporter_2309309498 = typeCheckingContext.reportTypeError(iFormatConversionFlagNeedsWidth, "only one of the following flags can be used: " + ListSequence.fromList(subConcepts).select((it) -> SPropertyOperations.getString(it, PROPS.conceptAlias$OL_L)), "r:f7af3984-a112-4e63-b8bb-3a0771bf3a31(com.mbeddr.mpsutil.richstring.typesystem)", "7716961532375484750", null, errorTarget);
      }
    }
  }
  public SAbstractConcept getApplicableConcept() {
    return CONCEPTS.IFormatConversionFlagNeedsWidth$1U;
  }
  public IsApplicableStatus isApplicableAndPattern(SNode argument) {
    return new IsApplicableStatus(argument.getConcept().isSubConceptOf(getApplicableConcept()), null);
  }
  public boolean overrides() {
    return false;
  }

  private static final class CONCEPTS {
    /*package*/ static final SConcept InlineFormat$AE = MetaAdapterFactory.getConcept(0x442d3b7dfe4a4293L, 0xa7c16744d440ecaaL, 0x2e8be43a04395836L, "com.mbeddr.mpsutil.richstring.structure.InlineFormat");
    /*package*/ static final SInterfaceConcept IFormatConversionFlagNeedsWidth$1U = MetaAdapterFactory.getInterfaceConcept(0x442d3b7dfe4a4293L, 0xa7c16744d440ecaaL, 0x6b1827a0a2978e5eL, "com.mbeddr.mpsutil.richstring.structure.IFormatConversionFlagNeedsWidth");
    /*package*/ static final SConcept AbstractConceptDeclaration$KA = MetaAdapterFactory.getConcept(0xc72da2b97cce4447L, 0x8389f407dc1158b7L, 0x1103553c5ffL, "jetbrains.mps.lang.structure.structure.AbstractConceptDeclaration");
    /*package*/ static final SConcept ConceptDeclaration$gH = MetaAdapterFactory.getConcept(0xc72da2b97cce4447L, 0x8389f407dc1158b7L, 0xf979ba0450L, "jetbrains.mps.lang.structure.structure.ConceptDeclaration");
  }

  private static final class LINKS {
    /*package*/ static final SContainmentLink width$hZIq = MetaAdapterFactory.getContainmentLink(0x442d3b7dfe4a4293L, 0xa7c16744d440ecaaL, 0x2e8be43a04395836L, 0x6b1827a0a209a5f6L, "width");
    /*package*/ static final SContainmentLink flags$hZvp = MetaAdapterFactory.getContainmentLink(0x442d3b7dfe4a4293L, 0xa7c16744d440ecaaL, 0x2e8be43a04395836L, 0x6b1827a0a209a5f5L, "flags");
  }

  private static final class PROPS {
    /*package*/ static final SProperty abstract$ibpT = MetaAdapterFactory.getProperty(0xc72da2b97cce4447L, 0x8389f407dc1158b7L, 0x1103553c5ffL, 0x403a32c5772c7ec2L, "abstract");
    /*package*/ static final SProperty conceptAlias$OL_L = MetaAdapterFactory.getProperty(0xc72da2b97cce4447L, 0x8389f407dc1158b7L, 0x1103553c5ffL, 0x46ab0ad5826c74caL, "conceptAlias");
  }
}

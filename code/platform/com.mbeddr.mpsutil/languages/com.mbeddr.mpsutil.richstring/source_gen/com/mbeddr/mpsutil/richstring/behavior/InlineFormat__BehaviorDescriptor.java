package com.mbeddr.mpsutil.richstring.behavior;

/*Generated by MPS */

import jetbrains.mps.core.aspects.behaviour.BaseBHDescriptor;
import org.jetbrains.mps.openapi.language.SAbstractConcept;
import jetbrains.mps.smodel.adapter.structure.MetaAdapterFactory;
import jetbrains.mps.core.aspects.behaviour.api.SMethod;
import jetbrains.mps.core.aspects.behaviour.SMethodBuilder;
import jetbrains.mps.core.aspects.behaviour.SJavaCompoundTypeImpl;
import jetbrains.mps.core.aspects.behaviour.AccessPrivileges;
import org.jetbrains.mps.openapi.model.SNode;
import java.util.List;
import java.util.Arrays;
import org.jetbrains.annotations.NotNull;
import java.util.IllegalFormatException;
import jetbrains.mps.internal.collections.runtime.ListSequence;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SLinkOperations;
import jetbrains.mps.internal.collections.runtime.IterableUtils;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SNodeOperations;
import jetbrains.mps.typesystem.inference.TypeChecker;
import jetbrains.mps.typesystem.inference.SubtypingManager;
import jetbrains.mps.internal.collections.runtime.Sequence;
import java.util.ArrayList;
import com.mbeddr.mpsutil.richstring.plugin.IRichstringEvaluator;
import jetbrains.mps.smodel.structure.ExtensionPoint;
import jetbrains.mps.core.aspects.behaviour.api.SConstructor;
import org.jetbrains.annotations.Nullable;
import jetbrains.mps.core.aspects.behaviour.api.BHMethodNotFoundException;
import org.jetbrains.mps.openapi.language.SContainmentLink;
import org.jetbrains.mps.openapi.language.SConcept;

public final class InlineFormat__BehaviorDescriptor extends BaseBHDescriptor {
  private static final SAbstractConcept CONCEPT = MetaAdapterFactory.getConcept(0x442d3b7dfe4a4293L, 0xa7c16744d440ecaaL, 0x2e8be43a04395836L, "com.mbeddr.mpsutil.richstring.structure.InlineFormat");

  public static final SMethod<String> renderExampleString_id2UbT3C4dfVQ = new SMethodBuilder<String>(new SJavaCompoundTypeImpl(String.class)).name("renderExampleString").modifiers(8, AccessPrivileges.PUBLIC).concept(CONCEPT).baseMethodId(3354025285337284342L).languageId(0xa7c16744d440ecaaL, 0x442d3b7dfe4a4293L).build2();
  public static final SMethod<String> toTextString_id3Q5enzfMT4t = new SMethodBuilder<String>(new SJavaCompoundTypeImpl(String.class)).name("toTextString").modifiers(8, AccessPrivileges.PUBLIC).concept(CONCEPT).baseMethodId(4433012599261204765L).languageId(0xa676c7604efe3504L, 0x92d2ea165a424fdfL).build2();
  public static final SMethod<String> concatFormatString_id5qZNa$QMfx1 = new SMethodBuilder<String>(new SJavaCompoundTypeImpl(String.class)).name("concatFormatString").modifiers(8, AccessPrivileges.PUBLIC).concept(CONCEPT).baseMethodId(6250939834954217537L).languageId(0xa7c16744d440ecaaL, 0x442d3b7dfe4a4293L).build2();
  public static final SMethod<SNode> calculateCategory_id6Go9U2z7T3y = new SMethodBuilder<SNode>(new SJavaCompoundTypeImpl((Class<SNode>) ((Class) Object.class))).name("calculateCategory").modifiers(8, AccessPrivileges.PUBLIC).concept(CONCEPT).baseMethodId(7716961532384350434L).languageId(0xa7c16744d440ecaaL, 0x442d3b7dfe4a4293L).build2();
  public static final SMethod<SAbstractConcept> calculateCategory2_id38BeNG_3AFp = new SMethodBuilder<SAbstractConcept>(new SJavaCompoundTypeImpl((Class<SAbstractConcept>) ((Class) Object.class))).name("calculateCategory2").modifiers(8, AccessPrivileges.PUBLIC).concept(CONCEPT).baseMethodId(3613922351198923481L).languageId(0xa7c16744d440ecaaL, 0x442d3b7dfe4a4293L).build2();
  public static final SMethod<List<SAbstractConcept>> listAvailableCategories_id6Go9U2y2H03 = new SMethodBuilder<List<SAbstractConcept>>(new SJavaCompoundTypeImpl((Class<List<SAbstractConcept>>) ((Class) Object.class))).name("listAvailableCategories").modifiers(9, AccessPrivileges.PUBLIC).concept(CONCEPT).baseMethodId(7716961532366213123L).languageId(0xa7c16744d440ecaaL, 0x442d3b7dfe4a4293L).build2();
  public static final SMethod<Object> getExampleValue_idM6L5HumnCS = new SMethodBuilder<Object>(new SJavaCompoundTypeImpl(Object.class)).name("getExampleValue").modifiers(8, AccessPrivileges.PUBLIC).concept(CONCEPT).baseMethodId(902624672038353464L).languageId(0xa7c16744d440ecaaL, 0x442d3b7dfe4a4293L).build2();
  public static final SMethod<SNode> getExpressionType_id7Ssz$kYjeZx = new SMethodBuilder<SNode>(new SJavaCompoundTypeImpl((Class<SNode>) ((Class) Object.class))).name("getExpressionType").modifiers(8, AccessPrivileges.PUBLIC).concept(CONCEPT).baseMethodId(9087294576175935457L).languageId(0xa7c16744d440ecaaL, 0x442d3b7dfe4a4293L).build2();

  private static final List<SMethod<?>> BH_METHODS = Arrays.<SMethod<?>>asList(renderExampleString_id2UbT3C4dfVQ, toTextString_id3Q5enzfMT4t, concatFormatString_id5qZNa$QMfx1, calculateCategory_id6Go9U2z7T3y, calculateCategory2_id38BeNG_3AFp, listAvailableCategories_id6Go9U2y2H03, getExampleValue_idM6L5HumnCS, getExpressionType_id7Ssz$kYjeZx);

  private static void ___init___(@NotNull SNode __thisNode__) {
  }

  /*package*/ static String renderExampleString_id2UbT3C4dfVQ(@NotNull SNode __thisNode__) {
    Object exampleObject = IInlineFormat__BehaviorDescriptor.getExampleValue_idM6L5HumnCS.invoke(__thisNode__);
    try {
      return String.format(InlineFormat__BehaviorDescriptor.concatFormatString_id5qZNa$QMfx1.invoke(__thisNode__), exampleObject);
    } catch (IllegalFormatException e) {
      return e.getMessage();
    }
  }
  /*package*/ static String toTextString_id3Q5enzfMT4t(@NotNull SNode __thisNode__) {
    return ((String) InlineFormat__BehaviorDescriptor.concatFormatString_id5qZNa$QMfx1.invoke(__thisNode__));
  }
  /*package*/ static String concatFormatString_id5qZNa$QMfx1(@NotNull SNode __thisNode__) {
    String flags = ((ListSequence.fromList(SLinkOperations.getChildren(__thisNode__, LINKS.flags$hZvp)).isNotEmpty() ? IterableUtils.join(ListSequence.fromList(SLinkOperations.getChildren(__thisNode__, LINKS.flags$hZvp)).select((it) -> (String) IFormatConversionFlag__BehaviorDescriptor.getConversionFlagSymbol_id2UbT3C4ekKT.invoke(it)), "") : ""));
    String width = (((SLinkOperations.getTarget(__thisNode__, LINKS.width$hZIq) != null) ? IFormatConversionWidth__BehaviorDescriptor.getWidth_id2UbT3C4eBa7.invoke(SLinkOperations.getTarget(__thisNode__, LINKS.width$hZIq)) : ""));
    String precision = (((SLinkOperations.getTarget(__thisNode__, LINKS.precision$ll5k) != null) ? IFormatConversionPrecision__BehaviorDescriptor.getPrecision_id2UbT3C4eBk$.invoke(SLinkOperations.getTarget(__thisNode__, LINKS.precision$ll5k)) : ""));
    String conversionSymbol = IFormatConversion__BehaviorDescriptor.getConversionSymbol_id2UbT3C4ekvK.invoke(SLinkOperations.getTarget(__thisNode__, LINKS.conversion$hZXr));
    return "%" + flags + width + precision + conversionSymbol;
  }
  /*package*/ static SNode calculateCategory_id6Go9U2z7T3y(@NotNull SNode __thisNode__) {
    // fall-back implementation for compatibility purpose (in case code calls calculateCategory() not the 
    // new calculateCategory2()
    return SNodeOperations.asNode(IInlineFormat__BehaviorDescriptor.calculateCategory2_id38BeNG_3AFp.invoke(__thisNode__));
  }
  /*package*/ static SAbstractConcept calculateCategory2_id38BeNG_3AFp(@NotNull SNode __thisNode__) {
    TypeChecker typeChecker = TypeChecker.getInstance();
    SubtypingManager subtypingManager = typeChecker.getSubtypingManager();

    SNode expressionType = typeChecker.getTypeOf(SLinkOperations.getTarget(__thisNode__, LINKS.expression$i0cs));

    for (SAbstractConcept category : ListSequence.fromList(InlineFormat__BehaviorDescriptor.listAvailableCategories_id6Go9U2y2H03.invoke(__thisNode__.getConcept()))) {
      Iterable<SNode> typicalTypes = IInlineFormatCategory__BehaviorDescriptor.getTypicalTypes_id6Go9U2y64Le.invoke(SNodeOperations.asSConcept(category));
      for (SNode typicalType : Sequence.fromIterable(typicalTypes)) {
        if (subtypingManager.isSubtype(expressionType, typicalType, false)) {
          return category;
        }
      }
    }

    return CONCEPTS.FormatCategoryUnknown$kt;
  }
  /*package*/ static List<SAbstractConcept> listAvailableCategories_id6Go9U2y2H03(@NotNull SAbstractConcept __thisConcept__) {
    return ListSequence.fromListAndArray(new ArrayList<SAbstractConcept>(), CONCEPTS.FormatCategoryDateTime$Sn, CONCEPTS.FormatCategoryCharacter$6q, CONCEPTS.FormatCategoryIntegralInt$uh, CONCEPTS.FormatCategoryIntegralLong$Wy, CONCEPTS.FormatCategoryIntegralBigInt$i9, CONCEPTS.FormatCategoryFloatingPointDouble$Ek, CONCEPTS.FormatCategoryFloatingPointBigDecimal$y2, CONCEPTS.FormatCategoryGeneralBool$h4, CONCEPTS.FormatCategoryGeneralObject$rj);
  }
  /*package*/ static Object getExampleValue_idM6L5HumnCS(@NotNull SNode __thisNode__) {
    for (IRichstringEvaluator evaluator : Sequence.fromIterable(new ExtensionPoint<IRichstringEvaluator>("com.mbeddr.mpsutil.richstring.RichstringEvaluator").getObjects())) {
      try {
        return evaluator.eval(SLinkOperations.getTarget(__thisNode__, LINKS.expression$i0cs));
      } catch (UnsupportedOperationException e) {
        // do nothing, try next one
      }
    }
    return IInlineFormatCategory__BehaviorDescriptor.getExampleObject_id6Go9U2y2SeO.invoke(SNodeOperations.asSConcept(IInlineFormat__BehaviorDescriptor.calculateCategory2_id38BeNG_3AFp.invoke(__thisNode__)));
  }
  /*package*/ static SNode getExpressionType_id7Ssz$kYjeZx(@NotNull SNode __thisNode__) {
    return TypeChecker.getInstance().getTypeOf(SLinkOperations.getTarget(__thisNode__, LINKS.expression$i0cs));
  }

  /*package*/ InlineFormat__BehaviorDescriptor() {
  }

  @Override
  protected void initNode(@NotNull SNode node, @NotNull SConstructor constructor, @Nullable Object[] parameters) {
    ___init___(node);
  }

  @Override
  protected <T> T invokeSpecial0(@NotNull SNode node, @NotNull SMethod<T> method, @Nullable Object[] parameters) {
    int methodIndex = BH_METHODS.indexOf(method);
    if (methodIndex < 0) {
      throw new BHMethodNotFoundException(this, method);
    }
    switch (methodIndex) {
      case 0:
        return (T) ((String) renderExampleString_id2UbT3C4dfVQ(node));
      case 1:
        return (T) ((String) toTextString_id3Q5enzfMT4t(node));
      case 2:
        return (T) ((String) concatFormatString_id5qZNa$QMfx1(node));
      case 3:
        return (T) ((SNode) calculateCategory_id6Go9U2z7T3y(node));
      case 4:
        return (T) ((SAbstractConcept) calculateCategory2_id38BeNG_3AFp(node));
      case 6:
        return (T) ((Object) getExampleValue_idM6L5HumnCS(node));
      case 7:
        return (T) ((SNode) getExpressionType_id7Ssz$kYjeZx(node));
      default:
        throw new BHMethodNotFoundException(this, method);
    }
  }

  @Override
  protected <T> T invokeSpecial0(@NotNull SAbstractConcept concept, @NotNull SMethod<T> method, @Nullable Object[] parameters) {
    int methodIndex = BH_METHODS.indexOf(method);
    if (methodIndex < 0) {
      throw new BHMethodNotFoundException(this, method);
    }
    switch (methodIndex) {
      case 5:
        return (T) ((List<SAbstractConcept>) listAvailableCategories_id6Go9U2y2H03(concept));
      default:
        throw new BHMethodNotFoundException(this, method);
    }
  }

  @NotNull
  @Override
  public List<SMethod<?>> getDeclaredMethods() {
    return BH_METHODS;
  }

  @NotNull
  @Override
  public SAbstractConcept getConcept() {
    return CONCEPT;
  }

  private static final class LINKS {
    /*package*/ static final SContainmentLink flags$hZvp = MetaAdapterFactory.getContainmentLink(0x442d3b7dfe4a4293L, 0xa7c16744d440ecaaL, 0x2e8be43a04395836L, 0x6b1827a0a209a5f5L, "flags");
    /*package*/ static final SContainmentLink width$hZIq = MetaAdapterFactory.getContainmentLink(0x442d3b7dfe4a4293L, 0xa7c16744d440ecaaL, 0x2e8be43a04395836L, 0x6b1827a0a209a5f6L, "width");
    /*package*/ static final SContainmentLink precision$ll5k = MetaAdapterFactory.getContainmentLink(0x442d3b7dfe4a4293L, 0xa7c16744d440ecaaL, 0x2e8be43a04395836L, 0x2e8be43a04395da9L, "precision");
    /*package*/ static final SContainmentLink conversion$hZXr = MetaAdapterFactory.getContainmentLink(0x442d3b7dfe4a4293L, 0xa7c16744d440ecaaL, 0x2e8be43a04395836L, 0x6b1827a0a209a5f7L, "conversion");
    /*package*/ static final SContainmentLink expression$i0cs = MetaAdapterFactory.getContainmentLink(0x442d3b7dfe4a4293L, 0xa7c16744d440ecaaL, 0x2e8be43a04395836L, 0x6b1827a0a209a5f8L, "expression");
  }

  private static final class CONCEPTS {
    /*package*/ static final SConcept FormatCategoryUnknown$kt = MetaAdapterFactory.getConcept(0x442d3b7dfe4a4293L, 0xa7c16744d440ecaaL, 0x6b1827a0a20aaddeL, "com.mbeddr.mpsutil.richstring.structure.FormatCategoryUnknown");
    /*package*/ static final SConcept FormatCategoryDateTime$Sn = MetaAdapterFactory.getConcept(0x442d3b7dfe4a4293L, 0xa7c16744d440ecaaL, 0x6b1827a0a20aadceL, "com.mbeddr.mpsutil.richstring.structure.FormatCategoryDateTime");
    /*package*/ static final SConcept FormatCategoryCharacter$6q = MetaAdapterFactory.getConcept(0x442d3b7dfe4a4293L, 0xa7c16744d440ecaaL, 0x6b1827a0a20aadd6L, "com.mbeddr.mpsutil.richstring.structure.FormatCategoryCharacter");
    /*package*/ static final SConcept FormatCategoryIntegralInt$uh = MetaAdapterFactory.getConcept(0x442d3b7dfe4a4293L, 0xa7c16744d440ecaaL, 0x6b1827a0a20aad92L, "com.mbeddr.mpsutil.richstring.structure.FormatCategoryIntegralInt");
    /*package*/ static final SConcept FormatCategoryIntegralLong$Wy = MetaAdapterFactory.getConcept(0x442d3b7dfe4a4293L, 0xa7c16744d440ecaaL, 0x59d510d3db85df70L, "com.mbeddr.mpsutil.richstring.structure.FormatCategoryIntegralLong");
    /*package*/ static final SConcept FormatCategoryIntegralBigInt$i9 = MetaAdapterFactory.getConcept(0x442d3b7dfe4a4293L, 0xa7c16744d440ecaaL, 0x59d510d3dbbd5341L, "com.mbeddr.mpsutil.richstring.structure.FormatCategoryIntegralBigInt");
    /*package*/ static final SConcept FormatCategoryFloatingPointDouble$Ek = MetaAdapterFactory.getConcept(0x442d3b7dfe4a4293L, 0xa7c16744d440ecaaL, 0x6b1827a0a20aadc6L, "com.mbeddr.mpsutil.richstring.structure.FormatCategoryFloatingPointDouble");
    /*package*/ static final SConcept FormatCategoryFloatingPointBigDecimal$y2 = MetaAdapterFactory.getConcept(0x442d3b7dfe4a4293L, 0xa7c16744d440ecaaL, 0x747b73832a1a2686L, "com.mbeddr.mpsutil.richstring.structure.FormatCategoryFloatingPointBigDecimal");
    /*package*/ static final SConcept FormatCategoryGeneralBool$h4 = MetaAdapterFactory.getConcept(0x442d3b7dfe4a4293L, 0xa7c16744d440ecaaL, 0x59d510d3dba4e56eL, "com.mbeddr.mpsutil.richstring.structure.FormatCategoryGeneralBool");
    /*package*/ static final SConcept FormatCategoryGeneralObject$rj = MetaAdapterFactory.getConcept(0x442d3b7dfe4a4293L, 0xa7c16744d440ecaaL, 0x6b1827a0a20aadbcL, "com.mbeddr.mpsutil.richstring.structure.FormatCategoryGeneralObject");
  }
}

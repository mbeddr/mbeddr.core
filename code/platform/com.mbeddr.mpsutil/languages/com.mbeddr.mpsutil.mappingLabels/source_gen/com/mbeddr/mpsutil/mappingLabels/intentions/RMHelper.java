package com.mbeddr.mpsutil.mappingLabels.intentions;

/*Generated by MPS */

import org.jetbrains.mps.openapi.model.SNode;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SLinkOperations;
import jetbrains.mps.internal.collections.runtime.ListSequence;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SNodeOperations;
import org.jetbrains.mps.openapi.language.SAbstractConcept;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SPropertyOperations;
import jetbrains.mps.smodel.builder.SNodeBuilder;
import org.jetbrains.mps.openapi.language.SContainmentLink;
import jetbrains.mps.smodel.adapter.structure.MetaAdapterFactory;
import org.jetbrains.mps.openapi.language.SReferenceLink;
import org.jetbrains.mps.openapi.language.SConcept;
import org.jetbrains.mps.openapi.language.SProperty;

public class RMHelper {

  public static Iterable<SNode> has(SNode mc) {
    return SLinkOperations.getChildren(mc, LINKS.mappingLabel$Wvfj);
  }

  public static boolean isNodeDotGen(SNode pm) {
    SNode firstStatement = ListSequence.fromList(SLinkOperations.getChildren(SLinkOperations.getTarget(SLinkOperations.getTarget(pm, LINKS.referentFunction$6c9k), LINKS.body$e68K), LINKS.statement$53DE)).first();
    if (!(SNodeOperations.isInstanceOf(firstStatement, CONCEPTS.ExpressionStatement$O8))) {
      return false;
    }
    SNode expr = SLinkOperations.getTarget(SNodeOperations.cast(firstStatement, CONCEPTS.ExpressionStatement$O8), LINKS.expression$5L7M);
    if (!(SNodeOperations.isInstanceOf(expr, CONCEPTS.DotExpression$yW))) {
      return false;
    }
    SNode call = ListSequence.fromList(SNodeOperations.getNodeDescendants(expr, CONCEPTS.Node_ConceptMethodCall$mz, false, new SAbstractConcept[]{})).first();
    if (call == null) {
      return false;
    }
    return SNodeOperations.isInstanceOf(SLinkOperations.getTarget(SLinkOperations.getTarget(SNodeOperations.cast(call, CONCEPTS.Node_ConceptMethodCall$mz), LINKS.baseMethodDeclaration$pyYw), LINKS.returnType$5xoi), CONCEPTS.StringType$uX);
  }

  public static SNode inputNode(SNode pm) {
    SNode firstStatement = ListSequence.fromList(SLinkOperations.getChildren(SLinkOperations.getTarget(SLinkOperations.getTarget(pm, LINKS.referentFunction$6c9k), LINKS.body$e68K), LINKS.statement$53DE)).first();
    if (!(SNodeOperations.isInstanceOf(firstStatement, CONCEPTS.ExpressionStatement$O8))) {
      return null;
    }
    SNode expr = SLinkOperations.getTarget(SNodeOperations.cast(firstStatement, CONCEPTS.ExpressionStatement$O8), LINKS.expression$5L7M);
    if (!(SNodeOperations.isInstanceOf(expr, CONCEPTS.DotExpression$yW))) {
      return null;
    }
    SNode call = ListSequence.fromList(SNodeOperations.getNodeDescendants(expr, CONCEPTS.Node_ConceptMethodCall$mz, false, new SAbstractConcept[]{})).first();
    return SLinkOperations.getTarget(SNodeOperations.cast(SNodeOperations.getParent(call), CONCEPTS.DotExpression$yW), LINKS.operand$w6IR);
  }


  public static String labelName(SNode rm) {
    SNode firstStatement = ListSequence.fromList(SLinkOperations.getChildren(SLinkOperations.getTarget(SLinkOperations.getTarget(rm, LINKS.referentFunction$6c9k), LINKS.body$e68K), LINKS.statement$53DE)).first();
    if (!(SNodeOperations.isInstanceOf(firstStatement, CONCEPTS.ExpressionStatement$O8))) {
      return null;
    }
    SNode expr = SLinkOperations.getTarget(SNodeOperations.cast(firstStatement, CONCEPTS.ExpressionStatement$O8), LINKS.expression$5L7M);
    if (!(SNodeOperations.isInstanceOf(expr, CONCEPTS.DotExpression$yW))) {
      return null;
    }
    SNode call = ListSequence.fromList(SNodeOperations.getNodeDescendants(expr, CONCEPTS.Node_ConceptMethodCall$mz, false, new SAbstractConcept[]{})).first();
    if (call == null) {
      return null;
    }
    SNode cmd = SLinkOperations.getTarget(SNodeOperations.cast(call, CONCEPTS.Node_ConceptMethodCall$mz), LINKS.baseMethodDeclaration$pyYw);
    return SPropertyOperations.getString(SLinkOperations.getTarget(SNodeOperations.getNodeAncestor(cmd, CONCEPTS.ConceptBehavior$2, false, false), LINKS.concept$u6dL), PROPS.name$MnvL) + "_" + SPropertyOperations.getString(cmd, PROPS.name$MnvL);
  }


  public static void replaceWithResolveExpression(SNode expr, final String labelName, SNode mc) {

    SNode inputNode = inputNode(expr);
    SNode label = ListSequence.fromList(SLinkOperations.getChildren(mc, LINKS.mappingLabel$Wvfj)).findFirst((it) -> SPropertyOperations.getString(it, PROPS.name$MnvL).equals(labelName));
    ListSequence.fromList(SLinkOperations.getChildren(SLinkOperations.getTarget(SLinkOperations.getTarget(expr, LINKS.referentFunction$6c9k), LINKS.body$e68K), LINKS.statement$53DE)).clear();
    ListSequence.fromList(SLinkOperations.getChildren(SLinkOperations.getTarget(SLinkOperations.getTarget(expr, LINKS.referentFunction$6c9k), LINKS.body$e68K), LINKS.statement$53DE)).addElement(createExpressionStatement_oezox0_a0a4a11(inputNode, label));
  }

  private static SNode createExpressionStatement_oezox0_a0a4a11(SNode p0, SNode p1) {
    SNodeBuilder n0 = new SNodeBuilder().init(CONCEPTS.ExpressionStatement$O8);
    {
      SNodeBuilder n1 = n0.forChild(LINKS.expression$5L7M).init(CONCEPTS.DotExpression$yW);
      {
        SNodeBuilder n2 = n1.forChild(LINKS.operation$gs9E).init(CONCEPTS.GenerationContextOp_GetOutputByLabelAndInput$Kl);
        n2.forChild(LINKS.inputNode$VGCv).initNode(p0, CONCEPTS.Expression$mB, true);
        n2.setReferenceTarget(LINKS.label$VAL6, p1);
      }
      n1.forChild(LINKS.operand$w6IR).init(CONCEPTS.TemplateFunctionParameter_generationContext$Yo);
    }
    return n0.getResult();
  }

  private static final class LINKS {
    /*package*/ static final SContainmentLink mappingLabel$Wvfj = MetaAdapterFactory.getContainmentLink(0xb401a68083254110L, 0x8fd384331ff25befL, 0xff0bea0475L, 0x1179be725f9L, "mappingLabel");
    /*package*/ static final SContainmentLink referentFunction$6c9k = MetaAdapterFactory.getContainmentLink(0xb401a68083254110L, 0x8fd384331ff25befL, 0xfd7f44d616L, 0x10fe489d9feL, "referentFunction");
    /*package*/ static final SContainmentLink body$e68K = MetaAdapterFactory.getContainmentLink(0xf3061a5392264cc5L, 0xa443f952ceaf5816L, 0x108bbca0f48L, 0x108bbd29b4aL, "body");
    /*package*/ static final SContainmentLink statement$53DE = MetaAdapterFactory.getContainmentLink(0xf3061a5392264cc5L, 0xa443f952ceaf5816L, 0xf8cc56b200L, 0xf8cc6bf961L, "statement");
    /*package*/ static final SContainmentLink expression$5L7M = MetaAdapterFactory.getContainmentLink(0xf3061a5392264cc5L, 0xa443f952ceaf5816L, 0xf8cc56b213L, 0xf8cc56b214L, "expression");
    /*package*/ static final SReferenceLink baseMethodDeclaration$pyYw = MetaAdapterFactory.getReferenceLink(0xf3061a5392264cc5L, 0xa443f952ceaf5816L, 0x11857355952L, 0xf8c78301adL, "baseMethodDeclaration");
    /*package*/ static final SContainmentLink returnType$5xoi = MetaAdapterFactory.getContainmentLink(0xf3061a5392264cc5L, 0xa443f952ceaf5816L, 0xf8cc56b1fcL, 0xf8cc56b1fdL, "returnType");
    /*package*/ static final SContainmentLink operand$w6IR = MetaAdapterFactory.getContainmentLink(0xf3061a5392264cc5L, 0xa443f952ceaf5816L, 0x116b46a08c4L, 0x116b46a4416L, "operand");
    /*package*/ static final SReferenceLink concept$u6dL = MetaAdapterFactory.getReferenceLink(0xaf65afd8f0dd4942L, 0x87d963a55f2a9db1L, 0x11d43447b1aL, 0x11d43447b1fL, "concept");
    /*package*/ static final SContainmentLink operation$gs9E = MetaAdapterFactory.getContainmentLink(0xf3061a5392264cc5L, 0xa443f952ceaf5816L, 0x116b46a08c4L, 0x116b46b36c4L, "operation");
    /*package*/ static final SContainmentLink inputNode$VGCv = MetaAdapterFactory.getContainmentLink(0xd7706f639be2479cL, 0xa3daae92af1e64d5L, 0x11b5282d0dbL, 0x11b5282d0e0L, "inputNode");
    /*package*/ static final SReferenceLink label$VAL6 = MetaAdapterFactory.getReferenceLink(0xd7706f639be2479cL, 0xa3daae92af1e64d5L, 0x11b5282d0dbL, 0x11b5282d0dcL, "label");
  }

  private static final class CONCEPTS {
    /*package*/ static final SConcept ExpressionStatement$O8 = MetaAdapterFactory.getConcept(0xf3061a5392264cc5L, 0xa443f952ceaf5816L, 0xf8cc56b213L, "jetbrains.mps.baseLanguage.structure.ExpressionStatement");
    /*package*/ static final SConcept DotExpression$yW = MetaAdapterFactory.getConcept(0xf3061a5392264cc5L, 0xa443f952ceaf5816L, 0x116b46a08c4L, "jetbrains.mps.baseLanguage.structure.DotExpression");
    /*package*/ static final SConcept Node_ConceptMethodCall$mz = MetaAdapterFactory.getConcept(0x7866978ea0f04cc7L, 0x81bc4d213d9375e1L, 0x1129a43046bL, "jetbrains.mps.lang.smodel.structure.Node_ConceptMethodCall");
    /*package*/ static final SConcept StringType$uX = MetaAdapterFactory.getConcept(0xf3061a5392264cc5L, 0xa443f952ceaf5816L, 0x11d47da71ecL, "jetbrains.mps.baseLanguage.structure.StringType");
    /*package*/ static final SConcept ConceptBehavior$2 = MetaAdapterFactory.getConcept(0xaf65afd8f0dd4942L, 0x87d963a55f2a9db1L, 0x11d43447b1aL, "jetbrains.mps.lang.behavior.structure.ConceptBehavior");
    /*package*/ static final SConcept GenerationContextOp_GetOutputByLabelAndInput$Kl = MetaAdapterFactory.getConcept(0xd7706f639be2479cL, 0xa3daae92af1e64d5L, 0x11b5282d0dbL, "jetbrains.mps.lang.generator.generationContext.structure.GenerationContextOp_GetOutputByLabelAndInput");
    /*package*/ static final SConcept Expression$mB = MetaAdapterFactory.getConcept(0xf3061a5392264cc5L, 0xa443f952ceaf5816L, 0xf8c37f506fL, "jetbrains.mps.baseLanguage.structure.Expression");
    /*package*/ static final SConcept TemplateFunctionParameter_generationContext$Yo = MetaAdapterFactory.getConcept(0xd7706f639be2479cL, 0xa3daae92af1e64d5L, 0x11b5282d0e3L, "jetbrains.mps.lang.generator.generationContext.structure.TemplateFunctionParameter_generationContext");
  }

  private static final class PROPS {
    /*package*/ static final SProperty name$MnvL = MetaAdapterFactory.getProperty(0xceab519525ea4f22L, 0x9b92103b95ca8c0cL, 0x110396eaaa4L, 0x110396ec041L, "name");
  }
}

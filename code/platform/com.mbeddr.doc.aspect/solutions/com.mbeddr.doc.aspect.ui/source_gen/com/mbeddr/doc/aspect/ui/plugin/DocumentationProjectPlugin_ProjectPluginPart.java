package com.mbeddr.doc.aspect.ui.plugin;

/*Generated by MPS */

import jetbrains.mps.plugins.part.ProjectPluginPart;
import de.slisson.mps.hacks.editor.EditorComponentCreationListener;
import jetbrains.mps.openapi.editor.selection.SelectionListener;
import jetbrains.mps.openapi.editor.selection.SingularSelection;
import jetbrains.mps.project.MPSProject;
import jetbrains.mps.nodeEditor.selection.SingularSelectionListenerAdapter;
import jetbrains.mps.openapi.editor.EditorComponent;
import java.util.Objects;

public class DocumentationProjectPlugin_ProjectPluginPart extends ProjectPluginPart {
  private EditorComponentCreationListener editorComponentListener;
  private SelectionListener selectionListener;
  private DocumentationHandler documentationHandler;
  private SingularSelection lastSelection;
  public DocumentationProjectPlugin_ProjectPluginPart() {
  }
  @Override
  public void init(MPSProject project) {
    DocumentationProjectPlugin_ProjectPluginPart.this.documentationHandler = new DocumentationHandler(project);
    DocumentationProjectPlugin_ProjectPluginPart.this.lastSelection = null;
    DocumentationProjectPlugin_ProjectPluginPart.this.selectionListener = new SingularSelectionListenerAdapter() {
      @Override
      protected void selectionChangedTo(final EditorComponent component, final SingularSelection selection) {
        if (DocumentationProjectPlugin_ProjectPluginPart.this.lastSelection != null && !(Objects.equals(DocumentationProjectPlugin_ProjectPluginPart.this.lastSelection.getSelectedNodes(), selection.getSelectedNodes()))) {
          DocumentationProjectPlugin_ProjectPluginPart.this.documentationHandler.showDoc(component, selection);
        }
        DocumentationProjectPlugin_ProjectPluginPart.this.lastSelection = selection;
      }
    };
    DocumentationProjectPlugin_ProjectPluginPart.this.editorComponentListener = new EditorComponentCreationListener(project) {

      @Override
      public void editorComponentCreate(final jetbrains.mps.nodeEditor.EditorComponent editorComponent) {
        editorComponent.getSelectionManager().addSelectionListener(DocumentationProjectPlugin_ProjectPluginPart.this.selectionListener);

        // Collect newly created editor components to add "onShow" listeners later in the "selectionChange" handler as the tool may not be initialized yet (see DocumentationHandler#showDoc).
        DocumentationProjectPlugin_ProjectPluginPart.this.documentationHandler.addOnShowDocTabListenerForComponent(editorComponent);
      }

      @Override
      public void editorComponentDisposed(final jetbrains.mps.nodeEditor.EditorComponent editorComponent) {
        editorComponent.getSelectionManager().removeSelectionListener(DocumentationProjectPlugin_ProjectPluginPart.this.selectionListener);
        DocumentationProjectPlugin_ProjectPluginPart.this.documentationHandler.removeOnShowDocTabListenerForComponent(editorComponent);
      }
    };
    DocumentationProjectPlugin_ProjectPluginPart.this.editorComponentListener.start(true);
  }
  @Override
  public void dispose(MPSProject project) {
    DocumentationProjectPlugin_ProjectPluginPart.this.documentationHandler.removeAllOnShowDocTabListeners();
    DocumentationProjectPlugin_ProjectPluginPart.this.editorComponentListener.stop();
  }
}

package com.mbeddr.core.modules.typesystem;

/*Generated by MPS */

import jetbrains.mps.lang.typesystem.runtime.AbstractNonTypesystemRule_Runtime;
import jetbrains.mps.lang.typesystem.runtime.NonTypesystemRule_Runtime;
import org.jetbrains.mps.openapi.model.SNode;
import jetbrains.mps.typesystem.inference.TypeCheckingContext;
import jetbrains.mps.lang.typesystem.runtime.IsApplicableStatus;
import java.util.List;
import com.mbeddr.core.modules.behavior.ICallLike__BehaviorDescriptor;
import jetbrains.mps.internal.collections.runtime.ListSequence;
import java.util.Iterator;
import jetbrains.mps.typechecking.TypecheckingFacade;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SNodeOperations;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SLinkOperations;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SPropertyOperations;
import jetbrains.mps.errors.messageTargets.MessageTarget;
import jetbrains.mps.errors.messageTargets.NodeMessageTarget;
import jetbrains.mps.errors.IErrorReporter;
import org.jetbrains.mps.openapi.language.SAbstractConcept;
import org.jetbrains.mps.openapi.language.SConcept;
import jetbrains.mps.smodel.adapter.structure.MetaAdapterFactory;
import org.jetbrains.mps.openapi.language.SInterfaceConcept;
import org.jetbrains.mps.openapi.language.SContainmentLink;
import org.jetbrains.mps.openapi.language.SProperty;

public class check_constVolatileICallLike_NonTypesystemRule extends AbstractNonTypesystemRule_Runtime implements NonTypesystemRule_Runtime {
  public check_constVolatileICallLike_NonTypesystemRule() {
  }
  public void applyRule(final SNode callLike, final TypeCheckingContext typeCheckingContext, IsApplicableStatus status) {
    List<SNode> actuals = ICallLike__BehaviorDescriptor.getActuals_id6WGVxckB05Y.invoke(callLike);
    List<SNode> formals = ICallLike__BehaviorDescriptor.getFormals_id6WGVxckB065.invoke(callLike);
    if (ListSequence.fromList(actuals).count() >= ListSequence.fromList(formals).count()) {
      {
        Iterator<SNode> actual_it = ListSequence.fromList(actuals).iterator();
        Iterator<SNode> formal_it = ListSequence.fromList(formals).iterator();
        SNode actual_var;
        SNode formal_var;
        while (actual_it.hasNext() && formal_it.hasNext()) {
          actual_var = actual_it.next();
          formal_var = formal_it.next();
          SNode actualTypeNode = TypecheckingFacade.getFromContext().getTypeOf(actual_var);
          // Ignore meet types - they are only used with constants
          if (SNodeOperations.isInstanceOf(actual_var, CONCEPTS.Literal$7X) || SNodeOperations.isInstanceOf(actualTypeNode, CONCEPTS.PC99MeetType$$K)) {
            break;
          }

          if (SNodeOperations.isInstanceOf(actualTypeNode, CONCEPTS.Type$dP)) {
            SNode actualType = SNodeOperations.cast(actualTypeNode, CONCEPTS.Type$dP);
            if (SNodeOperations.isInstanceOf(actualType, CONCEPTS.ITypeContainingType$9B) && SNodeOperations.isInstanceOf(SLinkOperations.getTarget(formal_var, LINKS.type$sXU3), CONCEPTS.ITypeContainingType$9B)) {
              SNode actualBaseType = SLinkOperations.getTarget(SNodeOperations.cast(actualType, CONCEPTS.ITypeContainingType$9B), LINKS.baseType$zMGV);
              SNode formalBaseType = SLinkOperations.getTarget(SNodeOperations.cast(SLinkOperations.getTarget(formal_var, LINKS.type$sXU3), CONCEPTS.ITypeContainingType$9B), LINKS.baseType$zMGV);
              if (SNodeOperations.isInstanceOf(actualBaseType, CONCEPTS.Type$dP) && SNodeOperations.isInstanceOf(formalBaseType, CONCEPTS.Type$dP)) {
                if (SPropertyOperations.getBoolean(SNodeOperations.cast(actualBaseType, CONCEPTS.Type$dP), PROPS.const$VWr7) && !(SPropertyOperations.getBoolean(SNodeOperations.cast(formalBaseType, CONCEPTS.Type$dP), PROPS.const$VWr7))) {
                  {
                    final MessageTarget errorTarget = new NodeMessageTarget();
                    IErrorReporter _reporter_2309309498 = typeCheckingContext.reportTypeError(actual_var, "cannot pass pointer to const value as argument to parameter expecting pointer to non-const value", "r:7b158038-abbe-4e11-b171-d5a959b4e91a(com.mbeddr.core.modules.typesystem)", "5249288609506979730", null, errorTarget);
                  }
                }
                if (SPropertyOperations.getBoolean(SNodeOperations.cast(actualBaseType, CONCEPTS.Type$dP), PROPS.volatile$hJNe) && !(SPropertyOperations.getBoolean(SNodeOperations.cast(formalBaseType, CONCEPTS.Type$dP), PROPS.volatile$hJNe))) {
                  {
                    final MessageTarget errorTarget = new NodeMessageTarget();
                    IErrorReporter _reporter_2309309498 = typeCheckingContext.reportTypeError(actual_var, "cannot pass pointer to volatile value as argument to parameter expecting pointer to non-volatile value", "r:7b158038-abbe-4e11-b171-d5a959b4e91a(com.mbeddr.core.modules.typesystem)", "5249288609506979850", null, errorTarget);
                  }
                }
              }

              if (SPropertyOperations.getBoolean(actualType, PROPS.const$VWr7) && !(SPropertyOperations.getBoolean(SLinkOperations.getTarget(formal_var, LINKS.type$sXU3), PROPS.const$VWr7))) {
                // Be less strict with parameters of functions in external modules to avoid pointless typesystem errors in
                // conjunction with external API that we have hardly able to change
                if ((SNodeOperations.getNodeAncestor(formal_var, CONCEPTS.ExternalModule$xK, false, false) == null)) {
                  {
                    final MessageTarget errorTarget = new NodeMessageTarget();
                    IErrorReporter _reporter_2309309498 = typeCheckingContext.reportTypeError(actual_var, "cannot pass const pointer as argument to parameter expecting non-const pointer", "r:7b158038-abbe-4e11-b171-d5a959b4e91a(com.mbeddr.core.modules.typesystem)", "6683206499712830512", null, errorTarget);
                  }
                }
              }
              if (SPropertyOperations.getBoolean(actualType, PROPS.volatile$hJNe) && !(SPropertyOperations.getBoolean(SLinkOperations.getTarget(formal_var, LINKS.type$sXU3), PROPS.volatile$hJNe))) {
                // Be less strict with parameters of functions in external modules to avoid pointless typesystem errors in
                // conjunction with external API that we have hardly able to change
                if ((SNodeOperations.getNodeAncestor(formal_var, CONCEPTS.ExternalModule$xK, false, false) == null)) {
                  {
                    final MessageTarget errorTarget = new NodeMessageTarget();
                    IErrorReporter _reporter_2309309498 = typeCheckingContext.reportTypeError(actual_var, "cannot pass volatile pointer as argument to parameter expecting non-volatile pointer", "r:7b158038-abbe-4e11-b171-d5a959b4e91a(com.mbeddr.core.modules.typesystem)", "6683206499712830527", null, errorTarget);
                  }
                }
              }
            } else if (SNodeOperations.isInstanceOf(actualType, CONCEPTS.StringType$2K) && SNodeOperations.isInstanceOf(SLinkOperations.getTarget(formal_var, LINKS.type$sXU3), CONCEPTS.ITypeContainingType$9B)) {
              // Never occurs in practice
            } else if (SNodeOperations.isInstanceOf(actualType, CONCEPTS.StringArrayType$DF) && SNodeOperations.isInstanceOf(SLinkOperations.getTarget(formal_var, LINKS.type$sXU3), CONCEPTS.ITypeContainingType$9B)) {
              SNode formalBaseType = SLinkOperations.getTarget(SNodeOperations.cast(SLinkOperations.getTarget(formal_var, LINKS.type$sXU3), CONCEPTS.ITypeContainingType$9B), LINKS.baseType$zMGV);
              if (SNodeOperations.isInstanceOf(formalBaseType, CONCEPTS.Type$dP)) {
                if (SPropertyOperations.getBoolean(actualType, PROPS.const$VWr7) && !(SPropertyOperations.getBoolean(SNodeOperations.cast(formalBaseType, CONCEPTS.Type$dP), PROPS.const$VWr7))) {
                  {
                    final MessageTarget errorTarget = new NodeMessageTarget();
                    IErrorReporter _reporter_2309309498 = typeCheckingContext.reportTypeError(actual_var, "cannot pass const string as argument to parameter expecting non-const string", "r:7b158038-abbe-4e11-b171-d5a959b4e91a(com.mbeddr.core.modules.typesystem)", "5249288609505875907", null, errorTarget);
                  }
                }
                if (SPropertyOperations.getBoolean(actualType, PROPS.volatile$hJNe) && !(SPropertyOperations.getBoolean(SNodeOperations.cast(formalBaseType, CONCEPTS.Type$dP), PROPS.volatile$hJNe))) {
                  {
                    final MessageTarget errorTarget = new NodeMessageTarget();
                    IErrorReporter _reporter_2309309498 = typeCheckingContext.reportTypeError(actual_var, "cannot pass volatile string as argument to parameter expecting non-volatile string", "r:7b158038-abbe-4e11-b171-d5a959b4e91a(com.mbeddr.core.modules.typesystem)", "5249288609505875922", null, errorTarget);
                  }
                }
              }
            } else if (SNodeOperations.isInstanceOf(actualType, CONCEPTS.ITypeContainingType$9B) && SNodeOperations.isInstanceOf(SLinkOperations.getTarget(formal_var, LINKS.type$sXU3), CONCEPTS.StringType$2K)) {
              SNode actualBaseType = SLinkOperations.getTarget(SNodeOperations.cast(actualType, CONCEPTS.ITypeContainingType$9B), LINKS.baseType$zMGV);
              if (SNodeOperations.isInstanceOf(actualBaseType, CONCEPTS.Type$dP)) {
                if (SPropertyOperations.getBoolean(SNodeOperations.cast(actualBaseType, CONCEPTS.Type$dP), PROPS.const$VWr7) && !(SPropertyOperations.getBoolean(SLinkOperations.getTarget(formal_var, LINKS.type$sXU3), PROPS.const$VWr7))) {
                  {
                    final MessageTarget errorTarget = new NodeMessageTarget();
                    IErrorReporter _reporter_2309309498 = typeCheckingContext.reportTypeError(actual_var, "cannot pass pointer to const character as argument to parameter expecting non-const string", "r:7b158038-abbe-4e11-b171-d5a959b4e91a(com.mbeddr.core.modules.typesystem)", "5249288609507158181", null, errorTarget);
                  }
                }
                if (SPropertyOperations.getBoolean(SNodeOperations.cast(actualBaseType, CONCEPTS.Type$dP), PROPS.volatile$hJNe) && !(SPropertyOperations.getBoolean(SLinkOperations.getTarget(formal_var, LINKS.type$sXU3), PROPS.volatile$hJNe))) {
                  {
                    final MessageTarget errorTarget = new NodeMessageTarget();
                    IErrorReporter _reporter_2309309498 = typeCheckingContext.reportTypeError(actual_var, "cannot pass pointer to volatile character as argument to parameter expecting non-volatile string", "r:7b158038-abbe-4e11-b171-d5a959b4e91a(com.mbeddr.core.modules.typesystem)", "5249288609507158196", null, errorTarget);
                  }
                }
              }

              if (SPropertyOperations.getBoolean(actualType, PROPS.const$VWr7) && !(SPropertyOperations.getBoolean(SLinkOperations.getTarget(formal_var, LINKS.type$sXU3), PROPS.const$VWr7))) {
                {
                  final MessageTarget errorTarget = new NodeMessageTarget();
                  IErrorReporter _reporter_2309309498 = typeCheckingContext.reportTypeError(actual_var, "cannot pass const character pointer or string as argument to parameter expecting non-const string", "r:7b158038-abbe-4e11-b171-d5a959b4e91a(com.mbeddr.core.modules.typesystem)", "5249288609507166532", null, errorTarget);
                }
              }
              if (SPropertyOperations.getBoolean(actualType, PROPS.volatile$hJNe) && !(SPropertyOperations.getBoolean(SLinkOperations.getTarget(formal_var, LINKS.type$sXU3), PROPS.volatile$hJNe))) {
                {
                  final MessageTarget errorTarget = new NodeMessageTarget();
                  IErrorReporter _reporter_2309309498 = typeCheckingContext.reportTypeError(actual_var, "cannot pass volatile character pointer or string as argument to parameter expecting non-volatile string", "r:7b158038-abbe-4e11-b171-d5a959b4e91a(com.mbeddr.core.modules.typesystem)", "5249288609507166547", null, errorTarget);
                }
              }
            } else if (SNodeOperations.isInstanceOf(actualType, CONCEPTS.StringType$2K) && SNodeOperations.isInstanceOf(SLinkOperations.getTarget(formal_var, LINKS.type$sXU3), CONCEPTS.StringType$2K)) {
              // Never occurs in practice
            } else if (SNodeOperations.isInstanceOf(actualType, CONCEPTS.StringArrayType$DF) && SNodeOperations.isInstanceOf(SLinkOperations.getTarget(formal_var, LINKS.type$sXU3), CONCEPTS.StringType$2K)) {
              if (SPropertyOperations.getBoolean(actualType, PROPS.const$VWr7) && !(SPropertyOperations.getBoolean(SLinkOperations.getTarget(formal_var, LINKS.type$sXU3), PROPS.const$VWr7))) {
                {
                  final MessageTarget errorTarget = new NodeMessageTarget();
                  IErrorReporter _reporter_2309309498 = typeCheckingContext.reportTypeError(actual_var, "cannot pass const string as argument to parameter expecting non-const string", "r:7b158038-abbe-4e11-b171-d5a959b4e91a(com.mbeddr.core.modules.typesystem)", "5249288609506873757", null, errorTarget);
                }
              }
              if (SPropertyOperations.getBoolean(actualType, PROPS.volatile$hJNe) && !(SPropertyOperations.getBoolean(SLinkOperations.getTarget(formal_var, LINKS.type$sXU3), PROPS.volatile$hJNe))) {
                {
                  final MessageTarget errorTarget = new NodeMessageTarget();
                  IErrorReporter _reporter_2309309498 = typeCheckingContext.reportTypeError(actual_var, "cannot pass volatile string as argument to parameter expecting non-volatile string", "r:7b158038-abbe-4e11-b171-d5a959b4e91a(com.mbeddr.core.modules.typesystem)", "5249288609506873771", null, errorTarget);
                }
              }
            } else if (SNodeOperations.isInstanceOf(actualType, CONCEPTS.ITypeContainingType$9B) && SNodeOperations.isInstanceOf(SLinkOperations.getTarget(formal_var, LINKS.type$sXU3), CONCEPTS.StringArrayType$DF)) {
              // Never occurs in practice
            } else if (SNodeOperations.isInstanceOf(actualType, CONCEPTS.StringType$2K) && SNodeOperations.isInstanceOf(SLinkOperations.getTarget(formal_var, LINKS.type$sXU3), CONCEPTS.StringArrayType$DF)) {
              // Never occurs in practice
            } else if (SNodeOperations.isInstanceOf(actualType, CONCEPTS.StringArrayType$DF) && SNodeOperations.isInstanceOf(SLinkOperations.getTarget(formal_var, LINKS.type$sXU3), CONCEPTS.StringArrayType$DF)) {
              // Never occurs in practice
            } else {
              // primitive types are passed by value, it makes no sense to check their storage
              if (SNodeOperations.isInstanceOf(actualType, CONCEPTS.ITypeContainingType$9B)) {
                if (SPropertyOperations.getBoolean(actualType, PROPS.const$VWr7) && !(SPropertyOperations.getBoolean(SLinkOperations.getTarget(formal_var, LINKS.type$sXU3), PROPS.const$VWr7))) {
                  {
                    final MessageTarget errorTarget = new NodeMessageTarget();
                    IErrorReporter _reporter_2309309498 = typeCheckingContext.reportTypeError(actual_var, "cannot pass const argument to non-const parameter", "r:7b158038-abbe-4e11-b171-d5a959b4e91a(com.mbeddr.core.modules.typesystem)", "3625157027073323763", null, errorTarget);
                  }
                }
                if (SPropertyOperations.getBoolean(actualType, PROPS.volatile$hJNe) && !(SPropertyOperations.getBoolean(SLinkOperations.getTarget(formal_var, LINKS.type$sXU3), PROPS.volatile$hJNe))) {
                  {
                    final MessageTarget errorTarget = new NodeMessageTarget();
                    IErrorReporter _reporter_2309309498 = typeCheckingContext.reportTypeError(actual_var, "cannot pass volatile argument to non-volatile parameter", "r:7b158038-abbe-4e11-b171-d5a959b4e91a(com.mbeddr.core.modules.typesystem)", "3625157027073440023", null, errorTarget);
                  }
                }
              }
            }
          }
        }
      }
    }
  }
  public SAbstractConcept getApplicableConcept() {
    return CONCEPTS.ICallLike$AL;
  }
  public IsApplicableStatus isApplicableAndPattern(SNode argument) {
    return new IsApplicableStatus(argument.getConcept().isSubConceptOf(getApplicableConcept()), null);
  }
  public boolean overrides() {
    return false;
  }

  private static final class CONCEPTS {
    /*package*/ static final SConcept Literal$7X = MetaAdapterFactory.getConcept(0x61c69711ed614850L, 0x81d97714ff227fb0L, 0x7af69e2e83a1ba5aL, "com.mbeddr.core.expressions.structure.Literal");
    /*package*/ static final SConcept PC99MeetType$$K = MetaAdapterFactory.getConcept(0x61c69711ed614850L, 0x81d97714ff227fb0L, 0x34ab7f1366694273L, "com.mbeddr.core.expressions.structure.PC99MeetType");
    /*package*/ static final SConcept Type$dP = MetaAdapterFactory.getConcept(0x61c69711ed614850L, 0x81d97714ff227fb0L, 0x7af69e2e83a1ba36L, "com.mbeddr.core.expressions.structure.Type");
    /*package*/ static final SInterfaceConcept ITypeContainingType$9B = MetaAdapterFactory.getInterfaceConcept(0xa9d696470840491eL, 0xbf392eb0805d2011L, 0x6bbcdccef5e46755L, "com.mbeddr.core.statements.structure.ITypeContainingType");
    /*package*/ static final SConcept ExternalModule$xK = MetaAdapterFactory.getConcept(0x6d11763d483d4b2bL, 0x8efc09336c1b0001L, 0x54e261614fd1abc1L, "com.mbeddr.core.modules.structure.ExternalModule");
    /*package*/ static final SConcept StringType$2K = MetaAdapterFactory.getConcept(0x3bf5377ae9044dedL, 0x97545a516023bfaaL, 0x54d65a8361ae7b04L, "com.mbeddr.core.pointers.structure.StringType");
    /*package*/ static final SConcept StringArrayType$DF = MetaAdapterFactory.getConcept(0x3bf5377ae9044dedL, 0x97545a516023bfaaL, 0x4ee1acbf0c8d52c9L, "com.mbeddr.core.pointers.structure.StringArrayType");
    /*package*/ static final SInterfaceConcept ICallLike$AL = MetaAdapterFactory.getInterfaceConcept(0x6d11763d483d4b2bL, 0x8efc09336c1b0001L, 0x6f2cee13149c017aL, "com.mbeddr.core.modules.structure.ICallLike");
  }

  private static final class LINKS {
    /*package*/ static final SContainmentLink baseType$zMGV = MetaAdapterFactory.getContainmentLink(0xa9d696470840491eL, 0xbf392eb0805d2011L, 0x6bbcdccef5e46755L, 0x6bbcdccef5e46756L, "baseType");
    /*package*/ static final SContainmentLink type$sXU3 = MetaAdapterFactory.getContainmentLink(0x61c69711ed614850L, 0x81d97714ff227fb0L, 0x46a2a92ac61b183L, 0x46a2a92ac61b184L, "type");
  }

  private static final class PROPS {
    /*package*/ static final SProperty const$VWr7 = MetaAdapterFactory.getProperty(0x61c69711ed614850L, 0x81d97714ff227fb0L, 0x7af69e2e83a1ba36L, 0x28d183d9a4cc7da8L, "const");
    /*package*/ static final SProperty volatile$hJNe = MetaAdapterFactory.getProperty(0x61c69711ed614850L, 0x81d97714ff227fb0L, 0x7af69e2e83a1ba36L, 0x28d183d9a4fae02fL, "volatile");
  }
}

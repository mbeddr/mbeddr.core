package com.mbeddr.core.modules.intentions;

/*Generated by MPS */

import jetbrains.mps.openapi.editor.EditorContext;
import org.jetbrains.mps.openapi.model.SNode;
import jetbrains.mps.openapi.editor.cells.EditorCell;
import jetbrains.mps.nodeEditor.cells.EditorCell_Label;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SNodeOperations;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SLinkOperations;
import jetbrains.mps.typechecking.TypecheckingFacade;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SConceptOperations;
import jetbrains.mps.smodel.adapter.structure.MetaAdapterFactory;
import org.jetbrains.mps.openapi.language.SConcept;
import org.jetbrains.mps.openapi.language.SContainmentLink;

public class CreateReferencedUtil {

  public static boolean isApplicable(EditorContext editorContext, SNode node) {
    return CreateReferencedUtil.getTextInCell(editorContext) != null;
  }

  public static String getTextInCell(EditorContext editorContext) {
    EditorCell selectedCell = editorContext.getSelectedCell();
    if (!(selectedCell instanceof EditorCell_Label)) {
      return null;
    }
    EditorCell_Label editorCell = ((EditorCell_Label) editorContext.getSelectedCell());
    if (!(editorCell.isErrorState())) {
      return null;
    }
    String name = editorCell.getRenderedText();
    if (name.endsWith("()")) {
      name = name.substring(0, name.length() - 2);
    }
    if (!(name.matches("[a-zA-Z0-9_]*"))) {
      return null;
    }
    return name;
  }

  public static SNode guessType(SNode ctx, SNode createdConcept) {
    SNode parent = SNodeOperations.getParent(ctx);
    if (SNodeOperations.isInstanceOf(parent, CONCEPTS.BinaryExpression$cR)) {
      SNode be = SNodeOperations.cast(parent, CONCEPTS.BinaryExpression$cR);
      if (SLinkOperations.getTarget(be, LINKS.left$SkXz) != null) {
        return SNodeOperations.cast(SNodeOperations.copyNode(TypecheckingFacade.getFromContext().getTypeOf(SLinkOperations.getTarget(be, LINKS.left$SkXz))), CONCEPTS.Type$dP);
      }
      if (SLinkOperations.getTarget(be, LINKS.right$Slc$) != null) {
        return SNodeOperations.cast(SNodeOperations.copyNode(TypecheckingFacade.getFromContext().getTypeOf(SLinkOperations.getTarget(be, LINKS.right$Slc$))), CONCEPTS.Type$dP);
      }
    }
    if (SNodeOperations.isInstanceOf(parent, CONCEPTS.LocalVariableDeclaration$ft)) {
      if (SLinkOperations.getTarget(SNodeOperations.cast(parent, CONCEPTS.LocalVariableDeclaration$ft), LINKS.type$sXU3) != null) {
        return SNodeOperations.cast(SNodeOperations.copyNode(TypecheckingFacade.getFromContext().getTypeOf(SLinkOperations.getTarget(SNodeOperations.cast(parent, CONCEPTS.LocalVariableDeclaration$ft), LINKS.type$sXU3))), CONCEPTS.Type$dP);
      }
    }
    if (SNodeOperations.isInstanceOf(parent, CONCEPTS.AssignmentExpr$mZ)) {
      if (SLinkOperations.getTarget(SNodeOperations.cast(parent, CONCEPTS.AssignmentExpr$mZ), LINKS.left$SkXz) != null) {
        return SNodeOperations.cast(SNodeOperations.copyNode(TypecheckingFacade.getFromContext().getTypeOf(SLinkOperations.getTarget(SNodeOperations.cast(parent, CONCEPTS.AssignmentExpr$mZ), LINKS.left$SkXz))), CONCEPTS.Type$dP);
      }
    }
    if (createdConcept == CONCEPTS.Function$K8.getDeclarationNode()) {
      return SConceptOperations.createNewNode(MetaAdapterFactory.getConcept(0x61c69711ed614850L, 0x81d97714ff227fb0L, 0x6d872ef9245a0d19L, "com.mbeddr.core.expressions.structure.VoidType"));
    }
    return SConceptOperations.createNewNode(MetaAdapterFactory.getConcept(0x61c69711ed614850L, 0x81d97714ff227fb0L, 0x75739ed9f39e387aL, "com.mbeddr.core.expressions.structure.Int8tType"));
  }

  private static final class CONCEPTS {
    /*package*/ static final SConcept BinaryExpression$cR = MetaAdapterFactory.getConcept(0x61c69711ed614850L, 0x81d97714ff227fb0L, 0x7af69e2e83a1ba34L, "com.mbeddr.core.expressions.structure.BinaryExpression");
    /*package*/ static final SConcept Type$dP = MetaAdapterFactory.getConcept(0x61c69711ed614850L, 0x81d97714ff227fb0L, 0x7af69e2e83a1ba36L, "com.mbeddr.core.expressions.structure.Type");
    /*package*/ static final SConcept LocalVariableDeclaration$ft = MetaAdapterFactory.getConcept(0xa9d696470840491eL, 0xbf392eb0805d2011L, 0x3a16e3a9c7ad96e6L, "com.mbeddr.core.statements.structure.LocalVariableDeclaration");
    /*package*/ static final SConcept AssignmentExpr$mZ = MetaAdapterFactory.getConcept(0x61c69711ed614850L, 0x81d97714ff227fb0L, 0x4e85add925440dL, "com.mbeddr.core.expressions.structure.AssignmentExpr");
    /*package*/ static final SConcept Function$K8 = MetaAdapterFactory.getConcept(0x6d11763d483d4b2bL, 0x8efc09336c1b0001L, 0x595522006a5b97e1L, "com.mbeddr.core.modules.structure.Function");
  }

  private static final class LINKS {
    /*package*/ static final SContainmentLink left$SkXz = MetaAdapterFactory.getContainmentLink(0x61c69711ed614850L, 0x81d97714ff227fb0L, 0x7af69e2e83a1ba34L, 0x7af69e2e83a1ba40L, "left");
    /*package*/ static final SContainmentLink right$Slc$ = MetaAdapterFactory.getContainmentLink(0x61c69711ed614850L, 0x81d97714ff227fb0L, 0x7af69e2e83a1ba34L, 0x7af69e2e83a1ba41L, "right");
    /*package*/ static final SContainmentLink type$sXU3 = MetaAdapterFactory.getContainmentLink(0x61c69711ed614850L, 0x81d97714ff227fb0L, 0x46a2a92ac61b183L, 0x46a2a92ac61b184L, "type");
  }
}

package com.mbeddr.core.modules.generator.com.mbeddr.core.modules.util;

/*Generated by MPS */

import org.jetbrains.mps.openapi.model.SNode;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SNodeOperations;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SLinkOperations;
import jetbrains.mps.internal.collections.runtime.ListSequence;
import jetbrains.mps.typechecking.TypecheckingFacade;
import org.jetbrains.mps.openapi.language.SAbstractConcept;
import java.util.List;
import jetbrains.mps.baseLanguage.closures.runtime.Wrappers;
import jetbrains.mps.baseLanguage.closures.runtime._FunctionTypes;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SConceptOperations;
import jetbrains.mps.smodel.adapter.structure.MetaAdapterFactory;
import java.util.ArrayList;
import com.mbeddr.core.pointers.behavior.ArrayType__BehaviorDescriptor;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SPropertyOperations;
import org.jetbrains.mps.openapi.language.SConcept;
import org.jetbrains.mps.openapi.language.SContainmentLink;
import org.jetbrains.mps.openapi.language.SProperty;

public class ArrayCopyUtil {

  public static boolean validType(SNode type) {
    if (SNodeOperations.isInstanceOf(type, CONCEPTS.ArrayType$WW)) {
      return validType(SLinkOperations.getTarget(SNodeOperations.cast(type, CONCEPTS.ArrayType$WW), LINKS.baseType$zMGV));
    } else {
      return SNodeOperations.isInstanceOf(SNodeOperations.getParent(type), CONCEPTS.ArrayType$WW);
    }
  }

  public static void flattenAssignment(SNode statementList, SNode assignExpr) {
    SNode leftBaseArrayType = ListSequence.fromList(SNodeOperations.getNodeDescendants(TypecheckingFacade.getFromContext().getTypeOf(SLinkOperations.getTarget(assignExpr, LINKS.left$SkXz)), CONCEPTS.ArrayType$WW, true, new SAbstractConcept[]{})).last();
    SNode rightBaseArrayType = ListSequence.fromList(SNodeOperations.getNodeDescendants(TypecheckingFacade.getFromContext().getTypeOf(SLinkOperations.getTarget(assignExpr, LINKS.right$Slc$)), CONCEPTS.ArrayType$WW, true, new SAbstractConcept[]{})).last();
    final List<SNode> leftArrayAccessExprs = buttomUpAssignmExprs(leftBaseArrayType, null, SLinkOperations.getTarget(assignExpr, LINKS.left$SkXz));
    final List<SNode> rightArrayAccessExprs = buttomUpAssignmExprs(rightBaseArrayType, null, SLinkOperations.getTarget(assignExpr, LINKS.right$Slc$));
    for (final Wrappers._int index = new Wrappers._int(0); index.value < ListSequence.fromList(leftArrayAccessExprs).count(); index.value++) {
      ListSequence.fromList(SLinkOperations.getChildren(statementList, LINKS.statements$euTV)).addElement(((_FunctionTypes._return_P0_E0<SNode>) () -> {
        final SNode node_5656577636281492353 = ((_FunctionTypes._return_P0_E0<SNode>) () -> {
          SNode res = ListSequence.fromList(leftArrayAccessExprs).getElement(index.value);
          return res;
        }).invoke();
        final SNode node_5656577636281492535 = ((_FunctionTypes._return_P0_E0<SNode>) () -> {
          SNode res = ListSequence.fromList(rightArrayAccessExprs).getElement(index.value);
          return res;
        }).invoke();
        final SNode node_5656577636281489600 = ((_FunctionTypes._return_P0_E0<SNode>) () -> {
          SNode res = SConceptOperations.createNewNode(MetaAdapterFactory.getConcept(0x61c69711ed614850L, 0x81d97714ff227fb0L, 0x4e85add925440dL, "com.mbeddr.core.expressions.structure.AssignmentExpr"));
          SLinkOperations.setTarget(res, LINKS.left$SkXz, node_5656577636281492353);
          SLinkOperations.setTarget(res, LINKS.right$Slc$, node_5656577636281492535);
          return res;
        }).invoke();
        SNode node_5656577636281485489 = ((_FunctionTypes._return_P0_E0<SNode>) () -> {
          SNode res = SConceptOperations.createNewNode(MetaAdapterFactory.getConcept(0xa9d696470840491eL, 0xbf392eb0805d2011L, 0x64ae61a4018a8592L, "com.mbeddr.core.statements.structure.ExpressionStatement"));
          SLinkOperations.setTarget(res, LINKS.expr$vamr, node_5656577636281489600);
          return res;
        }).invoke();
        return node_5656577636281485489;
      }).invoke());
    }
  }

  private static List<SNode> buttomUpAssignmExprs(SNode type, List<SNode> topLevelAccessExpr, final SNode expr) {
    List<SNode> res = new ArrayList<SNode>();
    for (final Wrappers._int i = new Wrappers._int(0); i.value < ArrayType__BehaviorDescriptor.getSize_id5Y5RBjHqwn9.invoke(SNodeOperations.cast(type, CONCEPTS.ArrayType$WW)).intValue(); i.value++) {
      if (!(SNodeOperations.isInstanceOf(SLinkOperations.getTarget(type, LINKS.baseType$zMGV), CONCEPTS.ArrayType$WW))) {
        ListSequence.fromList(res).addElement(((_FunctionTypes._return_P0_E0<SNode>) () -> {
          final SNode node_5656577636297753543 = new _FunctionTypes._return_P0_E0<SNode>() {
            public SNode invoke() {
              SNode res = SConceptOperations.createNewNode(MetaAdapterFactory.getConcept(0x61c69711ed614850L, 0x81d97714ff227fb0L, 0x7af69e2e83a1ba67L, "com.mbeddr.core.expressions.structure.NumberLiteral"));
              SPropertyOperations.assign(res, PROPS.value$qZmE, (String.valueOf(i.value)));
              return res;
            }
          }.invoke();
          final SNode node_5656577636297753548 = new _FunctionTypes._return_P0_E0<SNode>() {
            public SNode invoke() {
              SNode res = SConceptOperations.createNewNode(MetaAdapterFactory.getConcept(0x3bf5377ae9044dedL, 0x97545a516023bfaaL, 0x49ac54536384df46L, "com.mbeddr.core.pointers.structure.NullExpression"));
              return res;
            }
          }.invoke();
          SNode node_5656577636297753542 = new _FunctionTypes._return_P0_E0<SNode>() {
            public SNode invoke() {
              SNode res = SConceptOperations.createNewNode(MetaAdapterFactory.getConcept(0x3bf5377ae9044dedL, 0x97545a516023bfaaL, 0x572f431af7922901L, "com.mbeddr.core.pointers.structure.ArrayAccessExpr"));
              SLinkOperations.setTarget(res, LINKS.indexExpr$2oee, node_5656577636297753543);
              SLinkOperations.setTarget(res, LINKS.expression$PfNq, node_5656577636297753548);
              return res;
            }
          }.invoke();
          return node_5656577636297753542;
        }).invoke());
      } else {
        for (SNode accessExpr : ListSequence.fromList(topLevelAccessExpr)) {
          SNode copy = SNodeOperations.copyNode(accessExpr);
          SNode bottomExpr = ListSequence.fromList(SNodeOperations.getNodeDescendants(copy, CONCEPTS.ArrayAccessExpr$IH, true, new SAbstractConcept[]{})).last();
          SLinkOperations.setTarget(bottomExpr, LINKS.expression$PfNq, ((_FunctionTypes._return_P0_E0<SNode>) () -> {
            final SNode node_5656577636300781203 = new _FunctionTypes._return_P0_E0<SNode>() {
              public SNode invoke() {
                SNode res = SConceptOperations.createNewNode(MetaAdapterFactory.getConcept(0x61c69711ed614850L, 0x81d97714ff227fb0L, 0x7af69e2e83a1ba67L, "com.mbeddr.core.expressions.structure.NumberLiteral"));
                SPropertyOperations.assign(res, PROPS.value$qZmE, (String.valueOf(i.value)));
                return res;
              }
            }.invoke();
            final SNode node_5656577636300781208 = new _FunctionTypes._return_P0_E0<SNode>() {
              public SNode invoke() {
                SNode res = SConceptOperations.createNewNode(MetaAdapterFactory.getConcept(0x3bf5377ae9044dedL, 0x97545a516023bfaaL, 0x49ac54536384df46L, "com.mbeddr.core.pointers.structure.NullExpression"));
                return res;
              }
            }.invoke();
            SNode node_5656577636300781202 = new _FunctionTypes._return_P0_E0<SNode>() {
              public SNode invoke() {
                SNode res = SConceptOperations.createNewNode(MetaAdapterFactory.getConcept(0x3bf5377ae9044dedL, 0x97545a516023bfaaL, 0x572f431af7922901L, "com.mbeddr.core.pointers.structure.ArrayAccessExpr"));
                SLinkOperations.setTarget(res, LINKS.indexExpr$2oee, node_5656577636300781203);
                SLinkOperations.setTarget(res, LINKS.expression$PfNq, node_5656577636300781208);
                return res;
              }
            }.invoke();
            return node_5656577636300781202;
          }).invoke());
          ListSequence.fromList(res).addElement(copy);
        }
      }
    }
    if (SNodeOperations.isInstanceOf(SNodeOperations.getParent(type), CONCEPTS.ArrayType$WW)) {
      return buttomUpAssignmExprs(SNodeOperations.cast(SNodeOperations.getParent(type), CONCEPTS.ArrayType$WW), res, expr);
    } else {
      ListSequence.fromList(res).visitAll((it) -> SLinkOperations.setTarget(ListSequence.fromList(SNodeOperations.getNodeDescendants(it, CONCEPTS.ArrayAccessExpr$IH, true, new SAbstractConcept[]{})).last(), LINKS.expression$PfNq, SNodeOperations.copyNode(expr)));
      return res;
    }
  }

  private static final class CONCEPTS {
    /*package*/ static final SConcept ArrayType$WW = MetaAdapterFactory.getConcept(0x3bf5377ae9044dedL, 0x97545a516023bfaaL, 0x4ed16d83a1d30c81L, "com.mbeddr.core.pointers.structure.ArrayType");
    /*package*/ static final SConcept ArrayAccessExpr$IH = MetaAdapterFactory.getConcept(0x3bf5377ae9044dedL, 0x97545a516023bfaaL, 0x572f431af7922901L, "com.mbeddr.core.pointers.structure.ArrayAccessExpr");
  }

  private static final class LINKS {
    /*package*/ static final SContainmentLink baseType$zMGV = MetaAdapterFactory.getContainmentLink(0xa9d696470840491eL, 0xbf392eb0805d2011L, 0x6bbcdccef5e46755L, 0x6bbcdccef5e46756L, "baseType");
    /*package*/ static final SContainmentLink left$SkXz = MetaAdapterFactory.getContainmentLink(0x61c69711ed614850L, 0x81d97714ff227fb0L, 0x7af69e2e83a1ba34L, 0x7af69e2e83a1ba40L, "left");
    /*package*/ static final SContainmentLink right$Slc$ = MetaAdapterFactory.getContainmentLink(0x61c69711ed614850L, 0x81d97714ff227fb0L, 0x7af69e2e83a1ba34L, 0x7af69e2e83a1ba41L, "right");
    /*package*/ static final SContainmentLink statements$euTV = MetaAdapterFactory.getContainmentLink(0xa9d696470840491eL, 0xbf392eb0805d2011L, 0x3a16e3a9c7ad9955L, 0x3a16e3a9c7ad9956L, "statements");
    /*package*/ static final SContainmentLink expr$vamr = MetaAdapterFactory.getContainmentLink(0xa9d696470840491eL, 0xbf392eb0805d2011L, 0x64ae61a4018a8592L, 0x64ae61a4018a8593L, "expr");
    /*package*/ static final SContainmentLink indexExpr$2oee = MetaAdapterFactory.getContainmentLink(0x3bf5377ae9044dedL, 0x97545a516023bfaaL, 0x572f431af7922901L, 0x572f431af7922903L, "indexExpr");
    /*package*/ static final SContainmentLink expression$PfNq = MetaAdapterFactory.getContainmentLink(0x61c69711ed614850L, 0x81d97714ff227fb0L, 0x29b5b7c4a3763232L, 0x64ae61a4018a9c50L, "expression");
  }

  private static final class PROPS {
    /*package*/ static final SProperty value$qZmE = MetaAdapterFactory.getProperty(0x61c69711ed614850L, 0x81d97714ff227fb0L, 0x1eb611a68febd3e5L, 0x1eb611a68fec38b0L, "value");
  }
}

package com.mbeddr.core.checks.dataFlow;

/*Generated by MPS */

import java.util.Map;
import org.jetbrains.mps.openapi.model.SNode;
import java.util.List;
import jetbrains.mps.internal.collections.runtime.MapSequence;
import java.util.HashMap;
import jetbrains.mps.internal.collections.runtime.SetSequence;
import jetbrains.mps.internal.collections.runtime.ListSequence;
import java.util.ArrayList;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SNodeOperations;

public class VariableValuesMapping implements Cloneable {


  /*package*/ Map<SNode, List<Object>> vars2PossibleValues = MapSequence.fromMap(new HashMap<SNode, List<Object>>());

  public void clear() {
    MapSequence.fromMap(vars2PossibleValues).clear();
  }

  public void merge(VariableValuesMapping vvm) {
    for (SNode var : SetSequence.fromSet(MapSequence.fromMap(vvm.vars2PossibleValues).keySet())) {
      for (Object val : MapSequence.fromMap(vvm.vars2PossibleValues).get(var)) {
        doMerge(var, val);
      }
    }
  }

  private void doMerge(SNode var, Object val) {
    List<Object> values = MapSequence.fromMap(vars2PossibleValues).get(var);
    if (values == null) {
      values = ListSequence.fromList(new ArrayList<Object>());
      MapSequence.fromMap(vars2PossibleValues).put(var, values);
    }

    if (!(ListSequence.fromList(values).contains(val))) {
      ListSequence.fromList(values).addElement(val);
    }
  }

  public void overwrite(SNode var, Object val) {
    if (val == null) {
      MapSequence.fromMap(vars2PossibleValues).removeKey(var);
      return;
    }
    List<Object> values = ListSequence.fromList(new ArrayList<Object>());
    MapSequence.fromMap(vars2PossibleValues).put(var, values);
    ListSequence.fromList(values).addElement(val);
  }

  public void overwrite(SNode var, List<Object> vals) {
    if (vals == null) {
      MapSequence.fromMap(vars2PossibleValues).removeKey(var);
      return;
    }
    List<Object> values = ListSequence.fromList(new ArrayList<Object>());
    MapSequence.fromMap(vars2PossibleValues).put(var, values);
    ListSequence.fromList(values).addSequence(ListSequence.fromList(vals));
  }

  public List<Object> getPossibleValues(SNode var) {
    return MapSequence.fromMap(vars2PossibleValues).get(var);
  }

  @Override
  protected VariableValuesMapping clone() {
    VariableValuesMapping res = new VariableValuesMapping();
    MapSequence.fromMap(res.vars2PossibleValues).putAll(vars2PossibleValues);
    return res;
  }

  @Override
  public boolean equals(Object object) {
    if (!(object instanceof VariableValuesMapping)) {
      return false;
    }
    return ((VariableValuesMapping) object).vars2PossibleValues.equals(vars2PossibleValues);
  }

  public void debugVar(SNode var) {
    System.err.print("  -------- VariableValuesMapping ------ DEBUG --- " + SNodeOperations.present(var) + " : ");
    List<Object> values = getPossibleValues(var);
    for (Object v : values) {
      System.err.print(v + ", ");
    }
    System.err.println();
  }

  public void debugMap(String msg) {
    System.err.println("\n>>>>>>>>>>>>>>>> VariableValuesMapping ------ DEBUG MAPPING ---------------- " + msg);
    for (SNode k : SetSequence.fromSet(MapSequence.fromMap(vars2PossibleValues).keySet())) {
      debugVar(k);
    }
    System.err.println("---------------- VariableValuesMapping ------ DEBUG MAPPING <<<<<<<<<<<<<<<<<<\n");
  }

}

package com.mbeddr.core.dependencies.plugin;

/*Generated by MPS */

import javax.swing.JFrame;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SNodeOperations;
import java.awt.BorderLayout;
import javax.swing.JPanel;
import java.awt.GridLayout;
import javax.swing.JButton;
import java.awt.event.ActionListener;
import java.awt.event.ActionEvent;
import org.jetbrains.mps.openapi.model.SNode;
import jetbrains.mps.internal.collections.runtime.Sequence;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SPropertyOperations;
import javax.swing.JLabel;
import org.jetbrains.mps.openapi.language.SInterfaceConcept;
import jetbrains.mps.smodel.adapter.structure.MetaAdapterFactory;
import org.jetbrains.mps.openapi.language.SProperty;

public class DependencyAnalyzerDialog {

  public static void show(MbeddrCodeBlockAnalyer analyzer) {
    final JFrame f = new JFrame();
    f.setLocation(300, 300);
    f.setSize(400, 400);
    f.setTitle("Code Dependencies for " + SNodeOperations.present(analyzer.getContextNode()));

    f.setLayout(new BorderLayout());
    JPanel p = new JPanel();
    f.add(p, BorderLayout.CENTER);


    p.setLayout(new GridLayout(0, 2));
    addPair(p, "Generic Dependencies", analyzer.findGenericOutsideReferences());
    addPair(p, "Global Variable Refs", analyzer.findGlobalVarRefs());
    addPair(p, "Global Constant Refs", analyzer.findGlobalConstantRefs());
    addPair(p, "Function Calls", analyzer.findFunctionCalls());
    addPair(p, "Function Refs", analyzer.findFunctionRefs());
    addPair(p, "Used Typedefs", analyzer.findUsedTypeDefs());
    addPair(p, "Structs", analyzer.findStructTypes());
    addPair(p, "Structs", analyzer.findStructTypes());
    addPair(p, "Enums", analyzer.findEnumTypes());
    addPair(p, "Static Variables", analyzer.findStaticVariables());

    JPanel buttons = new JPanel();
    JButton close = new JButton("Close");
    buttons.add(close);
    close.addActionListener(new ActionListener() {
      public void actionPerformed(ActionEvent p0) {
        f.setVisible(false);
      }
    });
    close.transferFocus();

    f.add(buttons, BorderLayout.SOUTH);

    f.pack();
    f.setVisible(true);
  }

  private static String toString(Iterable<SNode> nodes) {
    StringBuilder sb = new StringBuilder();
    int i = 0;
    sb.toString();
    for (SNode n : Sequence.fromIterable(nodes)) {
      if (i > 0) {
        sb.append(", ");
      }
      if (SNodeOperations.isInstanceOf(n, CONCEPTS.INamedConcept$Kd)) {
        sb.append(SPropertyOperations.getString(SNodeOperations.cast(n, CONCEPTS.INamedConcept$Kd), PROPS.name$MnvL));
      } else {
        sb.append(n);
      }
      i++;
    }
    return sb.toString();
  }

  private static void addPair(JPanel p, String label, Iterable<SNode> nodes) {
    p.add(new JLabel("  " + label + ":   "));
    p.add(new JLabel(toString(nodes) + "  "));
  }

  private static final class CONCEPTS {
    /*package*/ static final SInterfaceConcept INamedConcept$Kd = MetaAdapterFactory.getInterfaceConcept(0xceab519525ea4f22L, 0x9b92103b95ca8c0cL, 0x110396eaaa4L, "jetbrains.mps.lang.core.structure.INamedConcept");
  }

  private static final class PROPS {
    /*package*/ static final SProperty name$MnvL = MetaAdapterFactory.getProperty(0xceab519525ea4f22L, 0x9b92103b95ca8c0cL, 0x110396eaaa4L, 0x110396ec041L, "name");
  }
}

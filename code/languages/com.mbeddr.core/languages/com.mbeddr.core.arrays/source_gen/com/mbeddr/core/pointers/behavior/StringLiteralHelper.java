package com.mbeddr.core.pointers.behavior;

/*Generated by MPS */

import java.util.regex.Pattern;

/**
 * See https://en.wikipedia.org/wiki/Escape_sequences_in_C#Table_of_escape_sequences for details.
 */
public class StringLiteralHelper {

  private static final String SPECIAL_CHARACTER_SUBSTITUTES = "abfnrtv\\\\'\"\\?";
  private static final String OCT_ENCODED_CHARACTER_DIGIT = "\\d";
  private static final String HEX_ENCODED_CHARACTER_PREFX = "x";
  private static final String HEX_ENCODED_CHARACTER_DIGITS = "\\dABCDEFabcdef";

  public static final Pattern SPECIAL_CHARACTER = Pattern.compile("\\\\[" + SPECIAL_CHARACTER_SUBSTITUTES + "]");
  public static final Pattern OCT_ENCODED_CHARACTER = Pattern.compile("\\\\" + OCT_ENCODED_CHARACTER_DIGIT + "{1,3}");
  public static final Pattern HEX_ENCODED_CHARACTER = Pattern.compile("\\\\" + HEX_ENCODED_CHARACTER_PREFX + "[" + HEX_ENCODED_CHARACTER_DIGITS + "]{1,2}");

  public static final Pattern ESCAPED_QUOTE = Pattern.compile("(\\\\)(\")");
  public static final Pattern ESCAPED_BACKSLASH = Pattern.compile("(\\\\)(\\\\)");
  public static final Pattern ESCAPED_HORIZONTAL_TAB = Pattern.compile("\\\\t");
  public static final Pattern ESCAPED_LINE_SEPARATOR = Pattern.compile("(\\\\r)?\\\\n");
  public static final Pattern REPEATED_SPACES = Pattern.compile(" {2,}");

  public static final Pattern UNESCAPED_QUOTE = Pattern.compile("(^\"|(?<!\\\\)\")");
  public static final Pattern UNESCAPED_TRAILING_BACKSLASH = Pattern.compile("(?<!\\\\)\\\\$");
  public static final Pattern UNESCAPED_HORIZONTAL_TAB = Pattern.compile("\\t");
  public static final Pattern UNESCAPED_LINE_SEPARATOR = Pattern.compile("\\R");
  public static final Pattern UNESCAPED_TRAILING_LINE_SEPARATOR = Pattern.compile("\\R$");
  public static final Pattern UNKNOWN_ESCAPE_SEQUENCE = Pattern.compile("(?<!\\\\)\\\\[^" + SPECIAL_CHARACTER_SUBSTITUTES + OCT_ENCODED_CHARACTER_DIGIT + HEX_ENCODED_CHARACTER_PREFX + "]");
  public static final Pattern INVALID_HEX_ENCODED_CHARACTER = Pattern.compile("(?<!\\\\)\\\\" + HEX_ENCODED_CHARACTER_PREFX + "([^" + HEX_ENCODED_CHARACTER_DIGITS + "]|$)");

  public static String unescape(String text) {
    // Unescape quotes and backslashes
    text = ESCAPED_QUOTE.matcher(text).replaceAll("$2");
    text = ESCAPED_BACKSLASH.matcher(text).replaceAll("$2");

    // Translate horizontal tabs and line breaks
    text = ESCAPED_HORIZONTAL_TAB.matcher(text).replaceAll("\t");
    text = ESCAPED_LINE_SEPARATOR.matcher(text).replaceAll(System.lineSeparator());
    return text;
  }

  public static String escape(String text) {
    // Translate horizontal tabs and line breaks
    text = UNESCAPED_TRAILING_LINE_SEPARATOR.matcher(text).replaceFirst("");
    text = UNESCAPED_LINE_SEPARATOR.matcher(text).replaceAll("\\\\n");
    text = UNESCAPED_HORIZONTAL_TAB.matcher(text).replaceAll("\\\\t");

    // Escape quotes and backslashes
    text = UNESCAPED_QUOTE.matcher(text).replaceAll("\\\\$0");
    text = UNESCAPED_TRAILING_BACKSLASH.matcher(text).replaceAll("\\\\$0");
    text = UNKNOWN_ESCAPE_SEQUENCE.matcher(text).replaceAll("\\\\$0");
    text = INVALID_HEX_ENCODED_CHARACTER.matcher(text).replaceAll("\\\\$0");
    return text;
  }

  public static String stripFormatting(String text) {
    text = ESCAPED_HORIZONTAL_TAB.matcher(text).replaceAll("");
    text = ESCAPED_LINE_SEPARATOR.matcher(text).replaceAll("");
    text = REPEATED_SPACES.matcher(text).replaceAll("");
    return text;
  }
}

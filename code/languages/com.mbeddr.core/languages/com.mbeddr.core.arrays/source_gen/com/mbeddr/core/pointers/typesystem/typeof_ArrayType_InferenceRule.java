package com.mbeddr.core.pointers.typesystem;

/*Generated by MPS */

import jetbrains.mps.lang.typesystem.runtime.AbstractInferenceRule_Runtime;
import jetbrains.mps.lang.typesystem.runtime.InferenceRule_Runtime;
import org.jetbrains.mps.openapi.model.SNode;
import jetbrains.mps.typesystem.inference.TypeCheckingContext;
import jetbrains.mps.lang.typesystem.runtime.IsApplicableStatus;
import com.mbeddr.mpsutil.suppresswarning.behavior.SuppressWarnings__BehaviorDescriptor;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SNodeOperations;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SLinkOperations;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SConceptOperations;
import jetbrains.mps.smodel.adapter.structure.MetaAdapterFactory;
import com.mbeddr.core.expressions.behavior.Expression__BehaviorDescriptor;
import jetbrains.mps.errors.messageTargets.MessageTarget;
import jetbrains.mps.errors.messageTargets.NodeMessageTarget;
import jetbrains.mps.errors.IErrorReporter;
import jetbrains.mps.internal.collections.runtime.ListSequence;
import org.jetbrains.mps.openapi.language.SAbstractConcept;
import com.mbeddr.core.base.behavior.ISuppressStaticEvalWarnings__BehaviorDescriptor;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SPropertyOperations;
import jetbrains.mps.typesystem.inference.EquationInfo;
import org.jetbrains.mps.openapi.language.SContainmentLink;
import org.jetbrains.mps.openapi.language.SInterfaceConcept;
import org.jetbrains.mps.openapi.language.SConcept;
import org.jetbrains.mps.openapi.language.SProperty;

public class typeof_ArrayType_InferenceRule extends AbstractInferenceRule_Runtime implements InferenceRule_Runtime {
  public typeof_ArrayType_InferenceRule() {
  }
  public void applyRule(final SNode arrayType, final TypeCheckingContext typeCheckingContext, IsApplicableStatus status) {
    if ((boolean) SuppressWarnings__BehaviorDescriptor.isNotSuppressed_id7U3Fobb_8Eq.invoke(SNodeOperations.asSConcept(CONCEPTS.SuppressWarnings$uu), arrayType)) {
      {
        final SNode baseT = typeCheckingContext.typeOf(SLinkOperations.getTarget(arrayType, LINKS.baseType$zMGV), "r:54210dde-4071-421e-b973-a22bb864eeac(com.mbeddr.core.pointers.typesystem)", "2319970887607334219", true);
        typeCheckingContext.whenConcrete(baseT, () -> {
          SNode at = SConceptOperations.createNewNode(MetaAdapterFactory.getConcept(0x3bf5377ae9044dedL, 0x97545a516023bfaaL, 0x4ed16d83a1d30c81L, "com.mbeddr.core.pointers.structure.ArrayType"));
          SLinkOperations.setTarget(at, LINKS.baseType$zMGV, SNodeOperations.cast(SNodeOperations.copyNode(typeCheckingContext.getExpandedNode(baseT)), CONCEPTS.IType$a9));
          if (SLinkOperations.getTarget(arrayType, LINKS.sizeExpr$S0Eu) != null) {
            if ((boolean) Expression__BehaviorDescriptor.isStaticallyEvaluatable_id3ilck8Kr3zN.invoke(SLinkOperations.getTarget(arrayType, LINKS.sizeExpr$S0Eu))) {
              Object evaluateStatically = null;
              try {
                evaluateStatically = Expression__BehaviorDescriptor.evaluateStatically_id6OxpEKG0KPv.invoke(SLinkOperations.getTarget(arrayType, LINKS.sizeExpr$S0Eu));
              } catch (Exception e) {
                {
                  final MessageTarget errorTarget = new NodeMessageTarget();
                  IErrorReporter _reporter_2309309498 = typeCheckingContext.reportTypeError(arrayType, "array size must evaluate to an integer", "r:54210dde-4071-421e-b973-a22bb864eeac(com.mbeddr.core.pointers.typesystem)", "7200401247512571521", null, errorTarget);
                }
                return;
              }
              if (evaluateStatically == null) {
                if (!(ListSequence.fromList(SNodeOperations.getNodeDescendants(SLinkOperations.getTarget(arrayType, LINKS.sizeExpr$S0Eu), CONCEPTS.ISuppressStaticEvalWarnings$1r, true, new SAbstractConcept[]{})).any((it) -> (boolean) ISuppressStaticEvalWarnings__BehaviorDescriptor.isSuppressionAllowed_id6ucVliiGyWC.invoke(it)))) {
                  {
                    final MessageTarget errorTarget = new NodeMessageTarget();
                    IErrorReporter _reporter_2309309498 = typeCheckingContext.reportWarning(arrayType, "array size is marked staticallyEvaluatable, but return nothing from evaluateStatically", "r:54210dde-4071-421e-b973-a22bb864eeac(com.mbeddr.core.pointers.typesystem)", "7058269619788391486", null, errorTarget);
                  }
                }

              } else {
                String evaluateStaticallyAsString = evaluateStatically.toString();
                try {
                  int evalAsInt = Integer.parseInt(evaluateStaticallyAsString);
                  SNode nl = SConceptOperations.createNewNode(MetaAdapterFactory.getConcept(0x61c69711ed614850L, 0x81d97714ff227fb0L, 0x7af69e2e83a1ba67L, "com.mbeddr.core.expressions.structure.NumberLiteral"));
                  SPropertyOperations.assign(nl, PROPS.value$qZmE, evalAsInt + "");
                  SLinkOperations.setTarget(at, LINKS.sizeExpr$S0Eu, nl);
                  if (evalAsInt < 1) {
                    {
                      final MessageTarget errorTarget = new NodeMessageTarget();
                      IErrorReporter _reporter_2309309498 = typeCheckingContext.reportTypeError(arrayType, "array size must be greater than zero", "r:54210dde-4071-421e-b973-a22bb864eeac(com.mbeddr.core.pointers.typesystem)", "3133909913442919091", null, errorTarget);
                    }
                  }
                } catch (Exception ex) {
                  {
                    final MessageTarget errorTarget = new NodeMessageTarget();
                    IErrorReporter _reporter_2309309498 = typeCheckingContext.reportWarning(arrayType, "does not evaluate to integer (was: " + evaluateStaticallyAsString + ")", "r:54210dde-4071-421e-b973-a22bb864eeac(com.mbeddr.core.pointers.typesystem)", "7058269619788382389", null, errorTarget);
                  }
                }
              }
            } else if ((SNodeOperations.getNodeAncestor(arrayType, CONCEPTS.LocalVariableDeclaration$ft, false, false) == null) && (SNodeOperations.getNodeAncestor(arrayType, CONCEPTS.IDoNotRequireStaticallyEvaluatableSize$7B, false, false) == null)) {
              {
                final MessageTarget errorTarget = new NodeMessageTarget();
                IErrorReporter _reporter_2309309498 = typeCheckingContext.reportWarning(arrayType, "array size is not statically evaluatable", "r:54210dde-4071-421e-b973-a22bb864eeac(com.mbeddr.core.pointers.typesystem)", "1070628221330432400", null, errorTarget);
              }
            }
          }
          SPropertyOperations.assign(at, PROPS.const$VWr7, SPropertyOperations.getBoolean(arrayType, PROPS.const$VWr7));
          SPropertyOperations.assign(at, PROPS.volatile$hJNe, SPropertyOperations.getBoolean(arrayType, PROPS.volatile$hJNe));
          {
            SNode _nodeToCheck_1029348928467 = arrayType;
            EquationInfo _info_12389875345 = new EquationInfo(_nodeToCheck_1029348928467, null, "r:54210dde-4071-421e-b973-a22bb864eeac(com.mbeddr.core.pointers.typesystem)", "5679441017214059548", 0, null);
            typeCheckingContext.createEquation((SNode) typeCheckingContext.typeOf(_nodeToCheck_1029348928467, "r:54210dde-4071-421e-b973-a22bb864eeac(com.mbeddr.core.pointers.typesystem)", "5679441017214059545", true), (SNode) at, _info_12389875345);
          }
        }, "r:54210dde-4071-421e-b973-a22bb864eeac(com.mbeddr.core.pointers.typesystem)", "2319970887607334216", false, false);
      }
    }

  }
  public SAbstractConcept getApplicableConcept() {
    return CONCEPTS.ArrayType$WW;
  }
  public IsApplicableStatus isApplicableAndPattern(SNode argument) {
    return new IsApplicableStatus(argument.getConcept().isSubConceptOf(getApplicableConcept()), null);
  }
  public boolean overrides() {
    return true;
  }

  private static final class LINKS {
    /*package*/ static final SContainmentLink baseType$zMGV = MetaAdapterFactory.getContainmentLink(0xa9d696470840491eL, 0xbf392eb0805d2011L, 0x6bbcdccef5e46755L, 0x6bbcdccef5e46756L, "baseType");
    /*package*/ static final SContainmentLink sizeExpr$S0Eu = MetaAdapterFactory.getContainmentLink(0x3bf5377ae9044dedL, 0x97545a516023bfaaL, 0x4ed16d83a1d30c81L, 0x1429cfd56a064333L, "sizeExpr");
  }

  private static final class CONCEPTS {
    /*package*/ static final SInterfaceConcept IType$a9 = MetaAdapterFactory.getInterfaceConcept(0xceab519525ea4f22L, 0x9b92103b95ca8c0cL, 0x11f8a0774f2L, "jetbrains.mps.lang.core.structure.IType");
    /*package*/ static final SInterfaceConcept ISuppressStaticEvalWarnings$1r = MetaAdapterFactory.getInterfaceConcept(0xd4280a54f6df4383L, 0xaa41d1b2bffa7eb1L, 0x678ced5492b1e8dcL, "com.mbeddr.core.base.structure.ISuppressStaticEvalWarnings");
    /*package*/ static final SInterfaceConcept IDoNotRequireStaticallyEvaluatableSize$7B = MetaAdapterFactory.getInterfaceConcept(0x3bf5377ae9044dedL, 0x97545a516023bfaaL, 0xedba2b1e2ddbcb0L, "com.mbeddr.core.pointers.structure.IDoNotRequireStaticallyEvaluatableSize");
    /*package*/ static final SConcept LocalVariableDeclaration$ft = MetaAdapterFactory.getConcept(0xa9d696470840491eL, 0xbf392eb0805d2011L, 0x3a16e3a9c7ad96e6L, "com.mbeddr.core.statements.structure.LocalVariableDeclaration");
    /*package*/ static final SConcept SuppressWarnings$uu = MetaAdapterFactory.getConcept(0xc1c2a88a323c4605L, 0xa37d9ab77a2ccbd2L, 0x7e83ad82cb948a95L, "com.mbeddr.mpsutil.suppresswarning.structure.SuppressWarnings");
    /*package*/ static final SConcept ArrayType$WW = MetaAdapterFactory.getConcept(0x3bf5377ae9044dedL, 0x97545a516023bfaaL, 0x4ed16d83a1d30c81L, "com.mbeddr.core.pointers.structure.ArrayType");
  }

  private static final class PROPS {
    /*package*/ static final SProperty value$qZmE = MetaAdapterFactory.getProperty(0x61c69711ed614850L, 0x81d97714ff227fb0L, 0x1eb611a68febd3e5L, 0x1eb611a68fec38b0L, "value");
    /*package*/ static final SProperty const$VWr7 = MetaAdapterFactory.getProperty(0x61c69711ed614850L, 0x81d97714ff227fb0L, 0x7af69e2e83a1ba36L, 0x28d183d9a4cc7da8L, "const");
    /*package*/ static final SProperty volatile$hJNe = MetaAdapterFactory.getProperty(0x61c69711ed614850L, 0x81d97714ff227fb0L, 0x7af69e2e83a1ba36L, 0x28d183d9a4fae02fL, "volatile");
  }
}

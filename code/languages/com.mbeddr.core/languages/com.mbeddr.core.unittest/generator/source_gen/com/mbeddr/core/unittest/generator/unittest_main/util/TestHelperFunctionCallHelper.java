package com.mbeddr.core.unittest.generator.unittest_main.util;

/*Generated by MPS */

import org.jetbrains.mps.openapi.model.SNode;
import jetbrains.mps.internal.collections.runtime.Sequence;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SLinkOperations;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SNodeOperations;
import org.jetbrains.mps.openapi.language.SAbstractConcept;
import java.util.Set;
import jetbrains.mps.internal.collections.runtime.SetSequence;
import java.util.HashSet;
import jetbrains.mps.internal.collections.runtime.ListSequence;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.IAttributeDescriptor;
import org.jetbrains.mps.openapi.language.SConcept;
import jetbrains.mps.smodel.adapter.structure.MetaAdapterFactory;
import org.jetbrains.mps.openapi.language.SReferenceLink;

public class TestHelperFunctionCallHelper {



  public static Iterable<SNode> usedMessageDefsWithCount(SNode tc) {
    Iterable<SNode> countedMsgDefs = Sequence.fromIterable(calledTestHelpers(tc)).translate((it) -> SLinkOperations.collect(SNodeOperations.getNodeDescendants(it, CONCEPTS.MessageCountExpr$_m, false, new SAbstractConcept[]{}), LINKS.msgDef$w2ik));


    return Sequence.fromIterable(SLinkOperations.collect(SNodeOperations.getNodeDescendants(tc, CONCEPTS.MessageCountExpr$_m, false, new SAbstractConcept[]{}), LINKS.msgDef$w2ik)).union(Sequence.fromIterable(countedMsgDefs)).distinct();
  }

  public static Iterable<SNode> calledTestHelpers(SNode tc) {

    final Set<SNode> calledFunctions = SetSequence.fromSet(new HashSet<SNode>());

    Iterable<SNode> seq = SNodeOperations.ofConcept(SLinkOperations.collect(ListSequence.fromList(SNodeOperations.getNodeDescendants(tc, CONCEPTS.FunctionCall$4q, false, new SAbstractConcept[]{})).where((it) -> (new IAttributeDescriptor.NodeAttribute(CONCEPTS.TestHelperFunctionAnnotation$yr).get(SLinkOperations.getTarget(it, LINKS.function$oBh5)) != null)), LINKS.function$oBh5), CONCEPTS.Function$K8);


    Sequence.fromIterable(seq).visitAll((it) -> checkFunctionForTestHelperCall(it, calledFunctions));

    return calledFunctions;
  }


  private static void checkFunctionForTestHelperCall(SNode f, final Set<SNode> result) {
    if (SetSequence.fromSet(result).contains(f)) {
      return;
    }
    SetSequence.fromSet(result).addElement(f);

    Sequence.fromIterable(SNodeOperations.ofConcept(SLinkOperations.collect(ListSequence.fromList(SNodeOperations.getNodeDescendants(f, CONCEPTS.FunctionCall$4q, false, new SAbstractConcept[]{})).where((it) -> (new IAttributeDescriptor.NodeAttribute(CONCEPTS.TestHelperFunctionAnnotation$yr).get(SLinkOperations.getTarget(it, LINKS.function$oBh5)) != null)), LINKS.function$oBh5), CONCEPTS.Function$K8)).visitAll((it) -> checkFunctionForTestHelperCall(it, result));
  }

  private static final class CONCEPTS {
    /*package*/ static final SConcept MessageCountExpr$_m = MetaAdapterFactory.getConcept(0x6d68b77b6994918L, 0x83b8857e63787800L, 0x24263512a7a650c1L, "com.mbeddr.core.unittest.structure.MessageCountExpr");
    /*package*/ static final SConcept FunctionCall$4q = MetaAdapterFactory.getConcept(0x6d11763d483d4b2bL, 0x8efc09336c1b0001L, 0x52941adca601b38cL, "com.mbeddr.core.modules.structure.FunctionCall");
    /*package*/ static final SConcept TestHelperFunctionAnnotation$yr = MetaAdapterFactory.getConcept(0x6d68b77b6994918L, 0x83b8857e63787800L, 0x7239701714738629L, "com.mbeddr.core.unittest.structure.TestHelperFunctionAnnotation");
    /*package*/ static final SConcept Function$K8 = MetaAdapterFactory.getConcept(0x6d11763d483d4b2bL, 0x8efc09336c1b0001L, 0x595522006a5b97e1L, "com.mbeddr.core.modules.structure.Function");
  }

  private static final class LINKS {
    /*package*/ static final SReferenceLink msgDef$w2ik = MetaAdapterFactory.getReferenceLink(0x6d68b77b6994918L, 0x83b8857e63787800L, 0x24263512a7a650c1L, 0x24263512a7a650c3L, "msgDef");
    /*package*/ static final SReferenceLink function$oBh5 = MetaAdapterFactory.getReferenceLink(0x6d11763d483d4b2bL, 0x8efc09336c1b0001L, 0x52941adca601b38cL, 0x52941adca601b38dL, "function");
  }
}

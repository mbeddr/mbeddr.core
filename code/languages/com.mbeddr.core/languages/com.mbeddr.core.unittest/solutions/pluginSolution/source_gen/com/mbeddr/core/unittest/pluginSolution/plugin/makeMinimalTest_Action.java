package com.mbeddr.core.unittest.pluginSolution.plugin;

/*Generated by MPS */

import jetbrains.mps.workbench.action.BaseAction;
import javax.swing.Icon;
import jetbrains.mps.workbench.action.ActionAccess;
import com.intellij.openapi.actionSystem.AnActionEvent;
import java.util.Map;
import com.intellij.openapi.project.Project;
import com.intellij.openapi.actionSystem.CommonDataKeys;
import org.jetbrains.mps.openapi.model.SModel;
import jetbrains.mps.ide.actions.MPSCommonDataKeys;
import jetbrains.mps.project.MPSProject;
import org.jetbrains.annotations.NotNull;
import jetbrains.mps.ide.platform.refactoring.StringChooserDialog;
import org.jetbrains.mps.openapi.model.SNode;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SConceptOperations;
import jetbrains.mps.smodel.adapter.structure.MetaAdapterFactory;
import com.mbeddr.core.modules.behavior.MainFunctionHelper;
import jetbrains.mps.internal.collections.runtime.ListSequence;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SLinkOperations;
import com.mbeddr.core.util.pluginSolution.plugin.WizardHelper;
import jetbrains.mps.smodel.builder.SNodeBuilder;
import org.jetbrains.mps.openapi.language.SContainmentLink;
import org.jetbrains.mps.openapi.language.SReferenceLink;
import org.jetbrains.mps.openapi.language.SConcept;
import org.jetbrains.mps.openapi.language.SInterfaceConcept;
import org.jetbrains.mps.openapi.language.SProperty;

public class makeMinimalTest_Action extends BaseAction {
  private static final Icon ICON = null;

  public makeMinimalTest_Action() {
    super("Create Minimal Test", "", ICON);
    this.setIsAlwaysVisible(false);
    this.setActionAccess(ActionAccess.NONE);
    updateInBackground(true);
  }
  @Override
  public boolean isDumbAware() {
    return true;
  }
  @Override
  protected boolean collectActionData(AnActionEvent event, final Map<String, Object> _params) {
    if (!(super.collectActionData(event, _params))) {
      return false;
    }
    {
      Project p = event.getData(CommonDataKeys.PROJECT);
      if (p == null) {
        return false;
      }
    }
    {
      SModel p = event.getData(MPSCommonDataKeys.CONTEXT_MODEL);
      if (p == null) {
        return false;
      }
    }
    {
      MPSProject p = event.getData(MPSCommonDataKeys.MPS_PROJECT);
      if (p == null) {
        return false;
      }
    }
    return true;
  }
  @Override
  public void doExecute(@NotNull final AnActionEvent event, final Map<String, Object> _params) {

    final String name = StringChooserDialog.getString(event.getData(CommonDataKeys.PROJECT), "Name of the System", "Name of the System", "");
    if (name == null) {
      return;
    }

    event.getData(MPSCommonDataKeys.MPS_PROJECT).getRepository().getModelAccess().executeCommand(() -> {
      SNode tc = createTestCase_213i4i_a0a0a4a0(SConceptOperations.createNewNode(MetaAdapterFactory.getConcept(0x61c69711ed614850L, 0x81d97714ff227fb0L, 0x6d872ef9245a0d19L, "com.mbeddr.core.expressions.structure.VoidType")));

      SNode main = MainFunctionHelper.createMainFunction();

      SNode immo = createImplementationModule_213i4i_a0e0a4a0(name, main, tc);

      SNode ret = createReturnStatement_213i4i_a0g0a4a0(tc);

      ListSequence.fromList(SLinkOperations.getChildren(SLinkOperations.getTarget(main, LINKS.body$1GE0), LINKS.statements$euTV)).clear();
      ListSequence.fromList(SLinkOperations.getChildren(SLinkOperations.getTarget(main, LINKS.body$1GE0), LINKS.statements$euTV)).addElement(ret);

      SNode bc = WizardHelper.makeBuildConfig();
      SNode exe = WizardHelper.makeExecutableWithModule(name, immo, bc);
      ListSequence.fromList(SLinkOperations.getChildren(bc, LINKS.binaries$R6lf)).addElement(exe);

      SModel model = event.getData(MPSCommonDataKeys.CONTEXT_MODEL);
      model.addRootNode(immo);
      model.addRootNode(bc);

    });
  }
  private static SNode createTestCase_213i4i_a0a0a4a0(SNode p0) {
    SNodeBuilder n0 = new SNodeBuilder().init(CONCEPTS.TestCase$$t);
    n0.forChild(LINKS.type$sXU3).initNode(p0, CONCEPTS.Type$dP, true);
    n0.forChild(LINKS.body$$xPO).init(CONCEPTS.StatementList$y1);
    n0.setProperty(PROPS.name$MnvL, "testCase1");
    return n0.getResult();
  }
  private static SNode createImplementationModule_213i4i_a0e0a4a0(String p0, SNode p1, SNode p2) {
    SNodeBuilder n0 = new SNodeBuilder().init(CONCEPTS.ImplementationModule$Gy);
    n0.setProperty(PROPS.name$MnvL, p0);
    {
      SNodeBuilder n1 = n0.forChild(LINKS.contents$3Vmy).initNode(p1, CONCEPTS.IModuleContent$H1, false);
      SNodeBuilder n2 = n1.forSibling().initNode(p2, CONCEPTS.IModuleContent$H1, false);
    }
    return n0.getResult();
  }
  private static SNode createReturnStatement_213i4i_a0g0a4a0(SNode p0) {
    SNodeBuilder n0 = new SNodeBuilder().init(CONCEPTS.ReturnStatement$Kx);
    {
      SNodeBuilder n1 = n0.forChild(LINKS.expression$ayfU).init(CONCEPTS.ExecuteTestExpression$FP);
      {
        SNodeBuilder n2 = n1.forChild(LINKS.tests$XDB_).init(CONCEPTS.TestCaseRef$6w);
        n2.setReferenceTarget(LINKS.testcase$9iCj, p0);
      }
    }
    return n0.getResult();
  }

  private static final class LINKS {
    /*package*/ static final SContainmentLink body$1GE0 = MetaAdapterFactory.getContainmentLink(0x6d11763d483d4b2bL, 0x8efc09336c1b0001L, 0x595522006a5b97e1L, 0x3a16e3a9c7ad9954L, "body");
    /*package*/ static final SContainmentLink statements$euTV = MetaAdapterFactory.getContainmentLink(0xa9d696470840491eL, 0xbf392eb0805d2011L, 0x3a16e3a9c7ad9955L, 0x3a16e3a9c7ad9956L, "statements");
    /*package*/ static final SContainmentLink binaries$R6lf = MetaAdapterFactory.getContainmentLink(0x2d7fadf533f64e80L, 0xa78f0f739add2bdeL, 0x6b1af9f9f43c2f48L, 0x46097107c8de43cbL, "binaries");
    /*package*/ static final SContainmentLink type$sXU3 = MetaAdapterFactory.getContainmentLink(0x61c69711ed614850L, 0x81d97714ff227fb0L, 0x46a2a92ac61b183L, 0x46a2a92ac61b184L, "type");
    /*package*/ static final SContainmentLink body$$xPO = MetaAdapterFactory.getContainmentLink(0x6d68b77b6994918L, 0x83b8857e63787800L, 0x5718179e5b1b7f5bL, 0x5718179e5b1b7f5dL, "body");
    /*package*/ static final SContainmentLink contents$3Vmy = MetaAdapterFactory.getContainmentLink(0x6d11763d483d4b2bL, 0x8efc09336c1b0001L, 0x595522006a5b933dL, 0x595522006a5b9351L, "contents");
    /*package*/ static final SContainmentLink expression$ayfU = MetaAdapterFactory.getContainmentLink(0x6d11763d483d4b2bL, 0x8efc09336c1b0001L, 0x7c747300dbd94ea5L, 0x7c747300dbd94ea6L, "expression");
    /*package*/ static final SContainmentLink tests$XDB_ = MetaAdapterFactory.getContainmentLink(0x6d68b77b6994918L, 0x83b8857e63787800L, 0x297d618d90ae7a5L, 0x4eeaa4ca8222cf98L, "tests");
    /*package*/ static final SReferenceLink testcase$9iCj = MetaAdapterFactory.getReferenceLink(0x6d68b77b6994918L, 0x83b8857e63787800L, 0x4eeaa4ca8222cf79L, 0x4eeaa4ca8222cf7aL, "testcase");
  }

  private static final class CONCEPTS {
    /*package*/ static final SConcept TestCase$$t = MetaAdapterFactory.getConcept(0x6d68b77b6994918L, 0x83b8857e63787800L, 0x5718179e5b1b7f5bL, "com.mbeddr.core.unittest.structure.TestCase");
    /*package*/ static final SConcept Type$dP = MetaAdapterFactory.getConcept(0x61c69711ed614850L, 0x81d97714ff227fb0L, 0x7af69e2e83a1ba36L, "com.mbeddr.core.expressions.structure.Type");
    /*package*/ static final SConcept StatementList$y1 = MetaAdapterFactory.getConcept(0xa9d696470840491eL, 0xbf392eb0805d2011L, 0x3a16e3a9c7ad9955L, "com.mbeddr.core.statements.structure.StatementList");
    /*package*/ static final SConcept ImplementationModule$Gy = MetaAdapterFactory.getConcept(0x6d11763d483d4b2bL, 0x8efc09336c1b0001L, 0x595522006a5b934eL, "com.mbeddr.core.modules.structure.ImplementationModule");
    /*package*/ static final SInterfaceConcept IModuleContent$H1 = MetaAdapterFactory.getInterfaceConcept(0x6d11763d483d4b2bL, 0x8efc09336c1b0001L, 0x595522006a5b934fL, "com.mbeddr.core.modules.structure.IModuleContent");
    /*package*/ static final SConcept ReturnStatement$Kx = MetaAdapterFactory.getConcept(0x6d11763d483d4b2bL, 0x8efc09336c1b0001L, 0x7c747300dbd94ea5L, "com.mbeddr.core.modules.structure.ReturnStatement");
    /*package*/ static final SConcept ExecuteTestExpression$FP = MetaAdapterFactory.getConcept(0x6d68b77b6994918L, 0x83b8857e63787800L, 0x297d618d90ae7a5L, "com.mbeddr.core.unittest.structure.ExecuteTestExpression");
    /*package*/ static final SConcept TestCaseRef$6w = MetaAdapterFactory.getConcept(0x6d68b77b6994918L, 0x83b8857e63787800L, 0x4eeaa4ca8222cf79L, "com.mbeddr.core.unittest.structure.TestCaseRef");
  }

  private static final class PROPS {
    /*package*/ static final SProperty name$MnvL = MetaAdapterFactory.getProperty(0xceab519525ea4f22L, 0x9b92103b95ca8c0cL, 0x110396eaaa4L, 0x110396ec041L, "name");
  }
}

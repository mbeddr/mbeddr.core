package com.mbeddr.core.make.typesystem;

/*Generated by MPS */

import jetbrains.mps.errors.QuickFix_Runtime;
import jetbrains.mps.smodel.SNodePointer;
import org.jetbrains.mps.openapi.model.SNode;
import com.mbeddr.core.make.behavior.Variable__BehaviorDescriptor;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SNodeOperations;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SPropertyOperations;
import com.mbeddr.core.make.behavior.IMakefileItem__BehaviorDescriptor;
import jetbrains.mps.internal.collections.runtime.Sequence;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SLinkOperations;
import java.util.Objects;
import jetbrains.mps.lang.core.behavior.PropertyAttribute__BehaviorDescriptor;
import jetbrains.mps.lang.core.behavior.LinkAttribute__BehaviorDescriptor;
import jetbrains.mps.internal.collections.runtime.ListSequence;
import jetbrains.mps.smodel.builder.SNodeBuilder;
import org.jetbrains.mps.openapi.language.SProperty;
import jetbrains.mps.smodel.adapter.structure.MetaAdapterFactory;
import org.jetbrains.mps.openapi.language.SContainmentLink;
import org.jetbrains.mps.openapi.language.SReferenceLink;
import org.jetbrains.mps.openapi.language.SConcept;

public class fix_extractVariableRefFromPlainText_QuickFix extends QuickFix_Runtime {
  public fix_extractVariableRefFromPlainText_QuickFix() {
    super(new SNodePointer("r:b8819a61-c3aa-4469-b5b3-43fb13a35cb6(com.mbeddr.core.make.typesystem)", "8844796466762727056"));
  }
  public String getDescription(SNode node) {
    return "Extract " + Variable__BehaviorDescriptor.getReferencePresentation_id7EZ1Spo0Yz_.invoke(((SNode) fix_extractVariableRefFromPlainText_QuickFix.this.getField("referencedVariable")[0]), SNodeOperations.getParent(((SNode) fix_extractVariableRefFromPlainText_QuickFix.this.getField("plainTextFragment")[0]))) + " from Plain Text Fragment";
  }
  public void execute(SNode node) {
    SNode variableRef = createVariableRef_n7i55p_a0a0c(((SNode) fix_extractVariableRefFromPlainText_QuickFix.this.getField("referencedVariable")[0]));

    String prefix = null;
    String postfix = null;
    int variableRefIdx = SPropertyOperations.getString(((SNode) fix_extractVariableRefFromPlainText_QuickFix.this.getField("plainTextFragment")[0]), PROPS.text$Iv7e).indexOf(Variable__BehaviorDescriptor.getReferencePresentation_id7EZ1Spo0Yz_.invoke(((SNode) fix_extractVariableRefFromPlainText_QuickFix.this.getField("referencedVariable")[0]), SNodeOperations.getParent(((SNode) fix_extractVariableRefFromPlainText_QuickFix.this.getField("plainTextFragment")[0]))));
    if (variableRefIdx < 0) {
      return;
    }
    if (variableRefIdx > 0) {
      SPropertyOperations.assign(variableRef, PROPS.escaped$Vhnz, SPropertyOperations.getString(((SNode) fix_extractVariableRefFromPlainText_QuickFix.this.getField("plainTextFragment")[0]), PROPS.text$Iv7e).substring(0, variableRefIdx).endsWith(IMakefileItem__BehaviorDescriptor.getEscapePrefix_id7EZ1Spo3k6R.invoke(variableRef)));
      prefix = (SPropertyOperations.getBoolean(variableRef, PROPS.escaped$Vhnz) ? SPropertyOperations.getString(((SNode) fix_extractVariableRefFromPlainText_QuickFix.this.getField("plainTextFragment")[0]), PROPS.text$Iv7e).substring(0, variableRefIdx - IMakefileItem__BehaviorDescriptor.getEscapePrefix_id7EZ1Spo3k6R.invoke(variableRef).length()) : SPropertyOperations.getString(((SNode) fix_extractVariableRefFromPlainText_QuickFix.this.getField("plainTextFragment")[0]), PROPS.text$Iv7e).substring(0, variableRefIdx));
    }
    if (variableRefIdx + Variable__BehaviorDescriptor.getReferencePresentation_id7EZ1Spo0Yz_.invoke(((SNode) fix_extractVariableRefFromPlainText_QuickFix.this.getField("referencedVariable")[0]), SNodeOperations.getParent(((SNode) fix_extractVariableRefFromPlainText_QuickFix.this.getField("plainTextFragment")[0]))).length() < SPropertyOperations.getString(((SNode) fix_extractVariableRefFromPlainText_QuickFix.this.getField("plainTextFragment")[0]), PROPS.text$Iv7e).length()) {
      postfix = SPropertyOperations.getString(((SNode) fix_extractVariableRefFromPlainText_QuickFix.this.getField("plainTextFragment")[0]), PROPS.text$Iv7e).substring(variableRefIdx + Variable__BehaviorDescriptor.getReferencePresentation_id7EZ1Spo0Yz_.invoke(((SNode) fix_extractVariableRefFromPlainText_QuickFix.this.getField("referencedVariable")[0]), SNodeOperations.getParent(((SNode) fix_extractVariableRefFromPlainText_QuickFix.this.getField("plainTextFragment")[0]))).length());

    }

    if (prefix == null && postfix == null) {
      SNode plainTextFragmentTextPropertyMacro = Sequence.fromIterable(SNodeOperations.ofConcept(SLinkOperations.getChildren(((SNode) fix_extractVariableRefFromPlainText_QuickFix.this.getField("plainTextFragment")[0]), LINKS.smodelAttribute$KJ43), CONCEPTS.PropertyMacro$c9)).findFirst((it) -> Objects.equals(PropertyAttribute__BehaviorDescriptor.getProperty_id1avfQ4BBzOo.invoke(it), PROPS.text$Iv7e));
      if ((plainTextFragmentTextPropertyMacro != null)) {
        SNode variableReferenceMacro = createReferenceMacro_n7i55p_a0a0b0j0c(SNodeOperations.copyNode(SLinkOperations.getTarget(SLinkOperations.getTarget(plainTextFragmentTextPropertyMacro, LINKS.propertyValueFunction$7Sh_), LINKS.body$e68K)));
        LinkAttribute__BehaviorDescriptor.setLink_id6Gg5KlvuxxF.invoke(variableReferenceMacro, LINKS.variable$INyz);
        ListSequence.fromList(SLinkOperations.getChildren(variableRef, LINKS.smodelAttribute$KJ43)).addElement(variableReferenceMacro);
      }

      SNode plainTextFragmentNodeMacro = Sequence.fromIterable(SNodeOperations.ofConcept(SLinkOperations.getChildren(((SNode) fix_extractVariableRefFromPlainText_QuickFix.this.getField("plainTextFragment")[0]), LINKS.smodelAttribute$KJ43), CONCEPTS.NodeMacro$qU)).first();
      if ((plainTextFragmentNodeMacro != null)) {
        SNode variableRefNodeMacro = SNodeOperations.copyNode(plainTextFragmentNodeMacro);
        ListSequence.fromList(SLinkOperations.getChildren(variableRef, LINKS.smodelAttribute$KJ43)).addElement(variableRefNodeMacro);
      }

      SNodeOperations.replaceWithAnother(((SNode) fix_extractVariableRefFromPlainText_QuickFix.this.getField("plainTextFragment")[0]), variableRef);
    } else {
      if (prefix != null) {
        SNodeOperations.insertPrevSiblingChild(((SNode) fix_extractVariableRefFromPlainText_QuickFix.this.getField("plainTextFragment")[0]), createPlainTextFragment_n7i55p_a0a0a0a0j0c(prefix));
      }
      SNodeOperations.insertPrevSiblingChild(((SNode) fix_extractVariableRefFromPlainText_QuickFix.this.getField("plainTextFragment")[0]), variableRef);
      if (postfix != null) {
        SNodeOperations.insertPrevSiblingChild(((SNode) fix_extractVariableRefFromPlainText_QuickFix.this.getField("plainTextFragment")[0]), createPlainTextFragment_n7i55p_a0a0a2a0j0c(postfix));
      }
      SNodeOperations.deleteNode(((SNode) fix_extractVariableRefFromPlainText_QuickFix.this.getField("plainTextFragment")[0]));
    }
  }
  private static SNode createVariableRef_n7i55p_a0a0c(SNode p0) {
    SNodeBuilder n0 = new SNodeBuilder().init(CONCEPTS.VariableRef$$5);
    n0.setReferenceTarget(LINKS.variable$INyz, p0);
    return n0.getResult();
  }
  private static SNode createReferenceMacro_n7i55p_a0a0b0j0c(SNode p0) {
    SNodeBuilder n0 = new SNodeBuilder().init(CONCEPTS.ReferenceMacro$30);
    {
      SNodeBuilder n1 = n0.forChild(LINKS.referentFunction$6c9k).init(CONCEPTS.ReferenceMacro_GetReferent$ww);
      n1.forChild(LINKS.body$e68K).initNode(p0, CONCEPTS.StatementList$m_, true);
    }
    return n0.getResult();
  }
  private static SNode createPlainTextFragment_n7i55p_a0a0a0a0j0c(String p0) {
    SNodeBuilder n0 = new SNodeBuilder().init(CONCEPTS.PlainTextFragment$55);
    n0.setProperty(PROPS.text$Iv7e, p0);
    return n0.getResult();
  }
  private static SNode createPlainTextFragment_n7i55p_a0a0a2a0j0c(String p0) {
    SNodeBuilder n0 = new SNodeBuilder().init(CONCEPTS.PlainTextFragment$55);
    n0.setProperty(PROPS.text$Iv7e, p0);
    return n0.getResult();
  }

  private static final class PROPS {
    /*package*/ static final SProperty text$Iv7e = MetaAdapterFactory.getProperty(0xf93d1dbebfd142ddL, 0x932af375fa6f5373L, 0x2ed28d95c2ca1923L, 0x2ed28d95c2ca1924L, "text");
    /*package*/ static final SProperty escaped$Vhnz = MetaAdapterFactory.getProperty(0xf93d1dbebfd142ddL, 0x932af375fa6f5373L, 0x4d97d3d526ace831L, 0xa9bb2127b8b4dd5L, "escaped");
  }

  private static final class LINKS {
    /*package*/ static final SContainmentLink smodelAttribute$KJ43 = MetaAdapterFactory.getContainmentLink(0xceab519525ea4f22L, 0x9b92103b95ca8c0cL, 0x10802efe25aL, 0x47bf8397520e5942L, "smodelAttribute");
    /*package*/ static final SContainmentLink propertyValueFunction$7Sh_ = MetaAdapterFactory.getContainmentLink(0xb401a68083254110L, 0x8fd384331ff25befL, 0xfd47e9f6f0L, 0x10fe3b4023fL, "propertyValueFunction");
    /*package*/ static final SContainmentLink body$e68K = MetaAdapterFactory.getContainmentLink(0xf3061a5392264cc5L, 0xa443f952ceaf5816L, 0x108bbca0f48L, 0x108bbd29b4aL, "body");
    /*package*/ static final SReferenceLink variable$INyz = MetaAdapterFactory.getReferenceLink(0xf93d1dbebfd142ddL, 0x932af375fa6f5373L, 0x2ed28d95c2ca1939L, 0x2ed28d95c2ca193aL, "variable");
    /*package*/ static final SContainmentLink referentFunction$6c9k = MetaAdapterFactory.getContainmentLink(0xb401a68083254110L, 0x8fd384331ff25befL, 0xfd7f44d616L, 0x10fe489d9feL, "referentFunction");
  }

  private static final class CONCEPTS {
    /*package*/ static final SConcept PropertyMacro$c9 = MetaAdapterFactory.getConcept(0xb401a68083254110L, 0x8fd384331ff25befL, 0xfd47e9f6f0L, "jetbrains.mps.lang.generator.structure.PropertyMacro");
    /*package*/ static final SConcept NodeMacro$qU = MetaAdapterFactory.getConcept(0xb401a68083254110L, 0x8fd384331ff25befL, 0xfd47ed6742L, "jetbrains.mps.lang.generator.structure.NodeMacro");
    /*package*/ static final SConcept VariableRef$$5 = MetaAdapterFactory.getConcept(0xf93d1dbebfd142ddL, 0x932af375fa6f5373L, 0x2ed28d95c2ca1939L, "com.mbeddr.core.make.structure.VariableRef");
    /*package*/ static final SConcept ReferenceMacro$30 = MetaAdapterFactory.getConcept(0xb401a68083254110L, 0x8fd384331ff25befL, 0xfd7f44d616L, "jetbrains.mps.lang.generator.structure.ReferenceMacro");
    /*package*/ static final SConcept ReferenceMacro_GetReferent$ww = MetaAdapterFactory.getConcept(0xb401a68083254110L, 0x8fd384331ff25befL, 0x10fe485cc9bL, "jetbrains.mps.lang.generator.structure.ReferenceMacro_GetReferent");
    /*package*/ static final SConcept StatementList$m_ = MetaAdapterFactory.getConcept(0xf3061a5392264cc5L, 0xa443f952ceaf5816L, 0xf8cc56b200L, "jetbrains.mps.baseLanguage.structure.StatementList");
    /*package*/ static final SConcept PlainTextFragment$55 = MetaAdapterFactory.getConcept(0xf93d1dbebfd142ddL, 0x932af375fa6f5373L, 0x2ed28d95c2ca1923L, "com.mbeddr.core.make.structure.PlainTextFragment");
  }
}

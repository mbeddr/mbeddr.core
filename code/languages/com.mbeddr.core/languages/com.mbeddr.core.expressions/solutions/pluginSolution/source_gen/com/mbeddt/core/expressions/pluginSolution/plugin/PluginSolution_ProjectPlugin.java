package com.mbeddt.core.expressions.pluginSolution.plugin;

/*Generated by MPS */

import com.mbeddr.mpsutil.spreferences.runtime.SPreferencesProjectPlugin;
import java.util.List;
import jetbrains.mps.plugins.prefs.BaseProjectPrefsComponent;
import com.intellij.openapi.project.Project;
import java.util.ArrayList;
import com.mbeddr.mpsutil.spreferences.runtime.SPreferencesModelFactory;
import org.jetbrains.mps.openapi.model.SModel;
import com.mbeddr.mpsutil.spreferences.runtime.PreferenceModules;
import com.mbeddr.mpsutil.spreferences.runtime.SPreferencesUtil;
import jetbrains.mps.smodel.ModuleRepositoryFacade;
import org.jetbrains.mps.openapi.persistence.PersistenceFacade;
import jetbrains.mps.smodel.Language;
import org.jetbrains.mps.openapi.model.SNode;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SModelOperations;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SConceptOperations;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SNodeOperations;
import jetbrains.mps.project.Solution;
import org.jetbrains.mps.openapi.model.EditableSModel;
import com.mbeddr.core.expressions.behavior.TypeSizeConfiguration__BehaviorDescriptor;
import com.mbeddr.mpsutil.spreferences.runtime.SPrefererencesComponent;
import org.jetbrains.mps.openapi.language.SAbstractConcept;
import org.jetbrains.mps.openapi.language.SConcept;
import jetbrains.mps.smodel.adapter.structure.MetaAdapterFactory;

public class PluginSolution_ProjectPlugin extends SPreferencesProjectPlugin {

  @Override
  protected List<BaseProjectPrefsComponent> createPreferencesComponents(final Project project) {
    List<BaseProjectPrefsComponent> components = new ArrayList<BaseProjectPrefsComponent>();

    SPreferencesModelFactory factory = new SPreferencesModelFactory() {
      public SModel getModel(final jetbrains.mps.project.Project mpsProject) {
        String id = "TypeSizeConfiguration";
        String title = "Type Size Configuration";
        String modelName = PreferenceModules.getModelName(mpsProject, false, id);
        String folder = PreferenceModules.getFolder(mpsProject, id, false, false);
        final SModel model = PreferenceModules.getModel(folder, modelName, mpsProject);

        mpsProject.getRepository().getModelAccess().executeCommand(new Runnable() {
          public void run() {
            SPreferencesUtil.useLanguage(model, ModuleRepositoryFacade.getInstance().getModule(PersistenceFacade.getInstance().createModuleReference("61c69711-ed61-4850-81d9-7714ff227fb0(com.mbeddr.core.expressions)"), Language.class), mpsProject);

            List<SNode> pageNodes = SModelOperations.roots(model, CONCEPTS.TypeSizeConfiguration$OP);
            boolean isInit = pageNodes.isEmpty();
            SNode pageNode = (isInit ? null : pageNodes.get(0));
            if (isInit) {
              pageNode = SConceptOperations.createNewNode(SNodeOperations.asInstanceConcept(CONCEPTS.TypeSizeConfiguration$OP));
              SModelOperations.addRootNode(model, pageNode);
            }

            initUpdate(isInit, pageNode, mpsProject);

            Solution solution = ((Solution) model.getModule());
            if (solution.isChanged() && !(solution.isReadOnly())) {
              solution.save();
            }

            EditableSModel editableModel = ((EditableSModel) model);
            if (editableModel.isChanged() && !(editableModel.isReadOnly())) {
              editableModel.save();
            }
          }
          public void initUpdate(boolean isInit, SNode node, jetbrains.mps.project.Project project) {
            if (isInit) {
              TypeSizeConfiguration__BehaviorDescriptor.populateWithDesktopDefault_id6w9JOkHS5pu.invoke(node);
            }
          }
        });

        return model;
      }
    };
    components.add(new SPrefererencesComponent(project, "Type Size Configuration", PluginSolution_ProjectPlugin.this.getClass().getName(), factory) {
      @Override
      protected boolean enabled(jetbrains.mps.project.Project project) {
        return PluginSolution_ProjectPlugin.this.enabled(project);
      }

      protected SAbstractConcept getRootConcept() {
        return CONCEPTS.TypeSizeConfiguration$OP;
      }
    });

    return components;
  }


  private static final class CONCEPTS {
    /*package*/ static final SConcept TypeSizeConfiguration$OP = MetaAdapterFactory.getConcept(0x61c69711ed614850L, 0x81d97714ff227fb0L, 0x2e4bd40f1cbdfd34L, "com.mbeddr.core.expressions.structure.TypeSizeConfiguration");
  }
}

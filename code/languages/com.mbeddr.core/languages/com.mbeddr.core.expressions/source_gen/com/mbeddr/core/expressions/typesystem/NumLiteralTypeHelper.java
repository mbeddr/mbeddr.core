package com.mbeddr.core.expressions.typesystem;

/*Generated by MPS */

import org.jetbrains.mps.openapi.model.SNode;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SPropertyOperations;
import com.mbeddr.core.expressions.behavior.TypeSizeConfiguration__BehaviorDescriptor;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SNodeOperations;
import jetbrains.mps.internal.collections.runtime.ListSequence;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SLinkOperations;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SConceptOperations;
import jetbrains.mps.smodel.adapter.structure.MetaAdapterFactory;
import com.mbeddr.core.expressions.behavior.PrimitiveC99IntegralType__BehaviorDescriptor;
import org.jetbrains.mps.openapi.language.SProperty;
import org.jetbrains.mps.openapi.language.SConcept;
import org.jetbrains.mps.openapi.language.SContainmentLink;

public class NumLiteralTypeHelper {
  public static SNode type(SNode ili) {
    String value = SPropertyOperations.getString(ili, PROPS.value$qZmE);
    SNode tsc = TypeSizeConfiguration__BehaviorDescriptor.findTypeSizeConfig_id3LaV6lLNTR2.invoke(SNodeOperations.asSConcept(CONCEPTS.TypeSizeConfiguration$OP), ili);

    return NumLiteralTypeHelper.typeForValue(value, tsc);

  }
  public static SNode type(Object o, SNode ctx) {
    SNode tsc = TypeSizeConfiguration__BehaviorDescriptor.findTypeSizeConfig_id3LaV6lLNTR2.invoke(SNodeOperations.asSConcept(CONCEPTS.TypeSizeConfiguration$OP), ctx);

    SNode type = typeForValue(o.toString(), tsc);
    if (SNodeOperations.isInstanceOf(type, CONCEPTS.MeetType$ZG) && ListSequence.fromList(SLinkOperations.getChildren(SNodeOperations.cast(type, CONCEPTS.MeetType$ZG), LINKS.argument$r2cT)).isEmpty()) {
      throw new IllegalArgumentException("Not a number: " + o.getClass().getName());
    }
    return type;
  }
  private static SNode typeForValue(String value, SNode tsc) throws NumberFormatException {
    SNode meet = SConceptOperations.createNewNode(MetaAdapterFactory.getConcept(0x61c69711ed614850L, 0x81d97714ff227fb0L, 0x34ab7f1366694273L, "com.mbeddr.core.expressions.structure.PC99MeetType"));
    String upperCase = value.toUpperCase();
    if (value.contains(".")) {
      if (upperCase.endsWith("F")) {
        SNode ft = SConceptOperations.createNewNode(MetaAdapterFactory.getConcept(0x61c69711ed614850L, 0x81d97714ff227fb0L, 0x41c7cca6a7ab279fL, "com.mbeddr.core.expressions.structure.FloatType"));
        ConstVolatileHelper.addAllPossibleTypes(ft, SLinkOperations.getChildren(meet, LINKS.argument$r2cT));
      } else if (upperCase.endsWith("L")) {
        SNode ldt = SConceptOperations.createNewNode(MetaAdapterFactory.getConcept(0x61c69711ed614850L, 0x81d97714ff227fb0L, 0x7efa919be7fda110L, "com.mbeddr.core.expressions.structure.LongDoubleType"));
        ConstVolatileHelper.addAllPossibleTypes(ldt, SLinkOperations.getChildren(meet, LINKS.argument$r2cT));
      } else {
        // from C99: "An unsuffixed floating constant has type double."
        SNode dt = SConceptOperations.createNewNode(MetaAdapterFactory.getConcept(0x61c69711ed614850L, 0x81d97714ff227fb0L, 0x7b064baaf4444619L, "com.mbeddr.core.expressions.structure.DoubleType"));
        ConstVolatileHelper.addAllPossibleTypes(dt, SLinkOperations.getChildren(meet, LINKS.argument$r2cT));
      }
    } else if (value.contains("E")) {
      SNode dt = SConceptOperations.createNewNode(MetaAdapterFactory.getConcept(0x61c69711ed614850L, 0x81d97714ff227fb0L, 0x7b064baaf4444619L, "com.mbeddr.core.expressions.structure.DoubleType"));
      ConstVolatileHelper.addAllPossibleTypes(dt, SLinkOperations.getChildren(meet, LINKS.argument$r2cT));
    } else if (upperCase.endsWith("ULL")) {
      SNode pt = PrimitiveC99IntegralType__BehaviorDescriptor.createUnsignedLongLongType_id5WkjTayGvxM.invoke(SNodeOperations.asSConcept(CONCEPTS.PrimitiveC99IntegralType$E_));
      ConstVolatileHelper.addAllPossibleTypes(pt, SLinkOperations.getChildren(meet, LINKS.argument$r2cT));

    } else if (upperCase.endsWith("LL")) {
      SNode pt = PrimitiveC99IntegralType__BehaviorDescriptor.createLongLongType_id5WkjTayGE3r.invoke(SNodeOperations.asSConcept(CONCEPTS.PrimitiveC99IntegralType$E_));
      ConstVolatileHelper.addAllPossibleTypes(pt, SLinkOperations.getChildren(meet, LINKS.argument$r2cT));

    } else if (upperCase.endsWith("UL")) {
      SNode pt = PrimitiveC99IntegralType__BehaviorDescriptor.createUnsignedLongType_id7mgWOZ6TNg4.invoke(SNodeOperations.asSConcept(CONCEPTS.PrimitiveC99IntegralType$E_));
      ConstVolatileHelper.addAllPossibleTypes(pt, SLinkOperations.getChildren(meet, LINKS.argument$r2cT));

    } else if (upperCase.endsWith("L")) {
      SNode pt = PrimitiveC99IntegralType__BehaviorDescriptor.createLongType_id2pPw_DEktdk.invoke(SNodeOperations.asSConcept(CONCEPTS.PrimitiveC99IntegralType$E_));
      ConstVolatileHelper.addAllPossibleTypes(pt, SLinkOperations.getChildren(meet, LINKS.argument$r2cT));

    } else if (upperCase.endsWith("U")) {
      SNode pt = PrimitiveC99IntegralType__BehaviorDescriptor.createSmallestUnSignedTypeFor_id5cvgcpwpK$Z.invoke(SNodeOperations.asSConcept(CONCEPTS.PrimitiveC99IntegralType$E_), value.substring(0, value.length() - 1), ((int) 10));
      ConstVolatileHelper.addAllPossibleTypes(pt, SLinkOperations.getChildren(meet, LINKS.argument$r2cT));

    } else {
      if (!(value.startsWith("-"))) {
        SNode unsignedType = PrimitiveC99IntegralType__BehaviorDescriptor.createSmallestUnSignedTypeFor_id5cvgcpwpK$Z.invoke(SNodeOperations.asSConcept(CONCEPTS.PrimitiveC99IntegralType$E_), value, ((int) 10));
        ConstVolatileHelper.addAllPossibleTypes(unsignedType, SLinkOperations.getChildren(meet, LINKS.argument$r2cT));
      }

      // test for a bug
      SNode signedType = PrimitiveC99IntegralType__BehaviorDescriptor.createSmallestSignedTypeFor_id2TbP0WsLZ7C.invoke(SNodeOperations.asSConcept(CONCEPTS.PrimitiveC99IntegralType$E_), value, ((int) 10));
      ConstVolatileHelper.addAllPossibleTypes(signedType, SLinkOperations.getChildren(meet, LINKS.argument$r2cT));
    }
    if (ListSequence.fromList(SLinkOperations.getChildren(meet, LINKS.argument$r2cT)).count() == 1) {
      return ListSequence.fromList(SLinkOperations.getChildren(meet, LINKS.argument$r2cT)).first();
    } else {
      return meet;
    }
  }

  private static final class PROPS {
    /*package*/ static final SProperty value$qZmE = MetaAdapterFactory.getProperty(0x61c69711ed614850L, 0x81d97714ff227fb0L, 0x1eb611a68febd3e5L, 0x1eb611a68fec38b0L, "value");
  }

  private static final class CONCEPTS {
    /*package*/ static final SConcept TypeSizeConfiguration$OP = MetaAdapterFactory.getConcept(0x61c69711ed614850L, 0x81d97714ff227fb0L, 0x2e4bd40f1cbdfd34L, "com.mbeddr.core.expressions.structure.TypeSizeConfiguration");
    /*package*/ static final SConcept MeetType$ZG = MetaAdapterFactory.getConcept(0x7a5dda6291404668L, 0xab76d5ed1746f2b2L, 0x114b68ad132L, "jetbrains.mps.lang.typesystem.structure.MeetType");
    /*package*/ static final SConcept PrimitiveC99IntegralType$E_ = MetaAdapterFactory.getConcept(0x61c69711ed614850L, 0x81d97714ff227fb0L, 0x75739ed9f39c4635L, "com.mbeddr.core.expressions.structure.PrimitiveC99IntegralType");
  }

  private static final class LINKS {
    /*package*/ static final SContainmentLink argument$r2cT = MetaAdapterFactory.getContainmentLink(0x7a5dda6291404668L, 0xab76d5ed1746f2b2L, 0x114b68ad132L, 0x114b68b040bL, "argument");
  }
}

package com.mbeddr.core.statements.behavior;

/*Generated by MPS */

import java.util.Map;
import org.jetbrains.mps.openapi.model.SNode;
import jetbrains.mps.internal.collections.runtime.MapSequence;
import java.util.HashMap;
import jetbrains.mps.internal.collections.runtime.Sequence;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SPropertyOperations;
import jetbrains.mps.internal.collections.runtime.IMapping;
import org.jetbrains.mps.openapi.language.SProperty;
import jetbrains.mps.smodel.adapter.structure.MetaAdapterFactory;

public class LocalVarScope {
  public static final int NO_POSITION = -1;
  private LocalVarScope outerScope;
  private Map<String, SNode> localVars = MapSequence.fromMap(new HashMap<String, SNode>());

  public LocalVarScope(Iterable<SNode> all) {
    for (SNode lvd : Sequence.fromIterable(all)) {
      MapSequence.fromMap(localVars).put(SPropertyOperations.getString(lvd, PROPS.name$MnvL), lvd);
    }
  }

  public void setOuterScope(LocalVarScope outer) {
    this.outerScope = outer;
  }

  public Iterable<SNode> getVisibleLocalVars() {
    Map<String, SNode> result = MapSequence.fromMap(new HashMap<String, SNode>());

    LocalVarScope current = this;
    while (current != null) {
      for (IMapping<String, SNode> var : MapSequence.fromMap(current.localVars)) {
        if (!(MapSequence.fromMap(result).containsKey(var.key()))) {
          MapSequence.fromMap(result).put(var.key(), var.value());
        }
      }
      current = current.outerScope;
    }

    return MapSequence.fromMap(result).values();
  }

  public SNode getLocalVarByName(final String name) {
    return Sequence.fromIterable(getVisibleLocalVars()).findFirst((it) -> SPropertyOperations.getString(it, PROPS.name$MnvL).equals(name));
  }

  private static final class PROPS {
    /*package*/ static final SProperty name$MnvL = MetaAdapterFactory.getProperty(0xceab519525ea4f22L, 0x9b92103b95ca8c0cL, 0x110396eaaa4L, 0x110396ec041L, "name");
  }
}

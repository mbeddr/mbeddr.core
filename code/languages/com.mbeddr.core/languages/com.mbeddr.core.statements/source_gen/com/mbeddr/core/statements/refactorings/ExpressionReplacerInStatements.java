package com.mbeddr.core.statements.refactorings;

/*Generated by MPS */

import java.util.List;
import org.jetbrains.mps.openapi.model.SNode;
import java.util.ArrayList;
import jetbrains.mps.internal.collections.runtime.ListSequence;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SNodeOperations;
import jetbrains.mps.internal.collections.runtime.Sequence;
import org.jetbrains.mps.openapi.language.SAbstractConcept;
import jetbrains.mps.lang.pattern.util.MatchingUtil;
import org.jetbrains.mps.openapi.language.SConcept;
import jetbrains.mps.smodel.adapter.structure.MetaAdapterFactory;

public class ExpressionReplacerInStatements {
  private List<SNode> matchedExpressions = new ArrayList<SNode>();
  public ExpressionReplacerInStatements() {
  }
  public void collectMatchingExpressions(SNode selExpr, SNode selStatement) {
    Iterable<SNode> siblings = ListSequence.fromList(SNodeOperations.getAllSiblings(selStatement, false)).union(Sequence.fromIterable(Sequence.<SNode>singleton(selStatement)));
    int index = SNodeOperations.getIndexInParent(selStatement);
    for (SNode s : Sequence.fromIterable(siblings)) {
      if (SNodeOperations.getIndexInParent(s) >= index) {
        for (SNode e : ListSequence.fromList(SNodeOperations.getNodeDescendants(s, CONCEPTS.Expression$bT, false, new SAbstractConcept[]{}))) {
          if (MatchingUtil.matchNodes(selExpr, e)) {
            ListSequence.fromList(matchedExpressions).addElement(e);
          }
        }
      }
    }
  }
  public void replaceMatchedExpressions(SNode newExpression) {
    for (SNode e : ListSequence.fromList(matchedExpressions)) {
      SNodeOperations.replaceWithAnother(e, SNodeOperations.copyNode(newExpression));
    }
  }

  private static final class CONCEPTS {
    /*package*/ static final SConcept Expression$bT = MetaAdapterFactory.getConcept(0x61c69711ed614850L, 0x81d97714ff227fb0L, 0x7af69e2e83a1ba32L, "com.mbeddr.core.expressions.structure.Expression");
  }
}

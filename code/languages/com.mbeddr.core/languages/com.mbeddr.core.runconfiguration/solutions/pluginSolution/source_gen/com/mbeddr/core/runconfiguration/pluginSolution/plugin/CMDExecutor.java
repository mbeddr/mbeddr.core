package com.mbeddr.core.runconfiguration.pluginSolution.plugin;

/*Generated by MPS */

import java.util.concurrent.FutureTask;
import java.util.concurrent.Callable;
import org.apache.commons.lang3.SystemUtils;
import org.jetbrains.annotations.Nullable;
import java.io.File;
import java.util.List;
import jetbrains.mps.internal.collections.runtime.ListSequence;
import java.util.ArrayList;
import jetbrains.mps.internal.collections.runtime.Sequence;

public class CMDExecutor {

  public static FutureTask<Boolean> execute(final String name, final String option) {
    return new FutureTask(new Callable<Boolean>() {
      public Boolean call() throws Exception {
        int processExitValue = -1;
        try {
          String[] command;
          if (SystemUtils.IS_OS_WINDOWS) {
            command = new String[]{"cmd.exe", "/C", name, option};
          } else {
            command = new String[]{name, option};
          }
          Process process = Runtime.getRuntime().exec(command);
          new StreamClearer(process.getInputStream()).start();
          new StreamClearer(process.getErrorStream()).start();
          processExitValue = process.waitFor();
        } catch (Exception ex) {
        }
        return processExitValue == 0;
      }
    });
  }

  public static boolean executeTool(final String commandName, final String[] parameters, @Nullable final File directory) {
    int processExitValue = -1;
    try {
      List<String> command = ListSequence.fromList(new ArrayList<String>());
      if (SystemUtils.IS_OS_WINDOWS) {
        ListSequence.fromList(command).addElement("cmd.exe");
        ListSequence.fromList(command).addElement("/C");
      }
      ListSequence.fromList(command).addElement(commandName);
      ListSequence.fromList(command).addSequence(Sequence.fromIterable(Sequence.fromArray(parameters)));

      Process process;
      if (directory != null) {
        process = Runtime.getRuntime().exec(ListSequence.fromList(command).toGenericArray(String.class), null, directory);
      } else {
        process = Runtime.getRuntime().exec(ListSequence.fromList(command).toGenericArray(String.class));
      }

      new StreamClearer(process.getInputStream()).start();
      new StreamClearer(process.getErrorStream()).start();
      processExitValue = process.waitFor();
    } catch (Exception ex) {
    }
    return processExitValue == 0;
  }


}

package com.mbeddr.core.runconfiguration.pluginSolution.plugin;

/*Generated by MPS */

import java.util.List;
import com.intellij.execution.junit.RuntimeConfigurationProducer;
import com.intellij.execution.configurations.ConfigurationType;
import com.intellij.execution.configurations.ConfigurationFactory;
import jetbrains.mps.internal.collections.runtime.ListSequence;
import java.util.ArrayList;
import jetbrains.mps.execution.api.configurations.BaseMpsProducer;
import org.jetbrains.mps.openapi.model.SNode;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SNodeOperations;
import jetbrains.mps.plugins.runconfigs.MPSPsiElement;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SModelOperations;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SPropertyOperations;
import jetbrains.mps.internal.collections.runtime.Sequence;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SLinkOperations;
import com.mbeddr.core.modules.behavior.IMayActAsMainFunction__BehaviorDescriptor;
import com.mbeddr.core.buildconfig.behavior.Binary__BehaviorDescriptor;
import org.jetbrains.mps.openapi.language.SConcept;
import jetbrains.mps.smodel.adapter.structure.MetaAdapterFactory;
import org.jetbrains.mps.openapi.language.SInterfaceConcept;
import org.jetbrains.mps.openapi.language.SProperty;
import org.jetbrains.mps.openapi.language.SContainmentLink;

public final class MbeddrExecutableConfiguration_Producer {

  public static List<RuntimeConfigurationProducer> getProducers(ConfigurationType configurationType) {
    ConfigurationFactory configurationFactory = null;
    // assume the one with id matching configuration kind is the primary one.
    // In fact, though technically we support more that one factory per type (aka 'foreign' factories), all factories
    // bear same id (due to overlook of template author, I believe), and we effectively take the fist registerd one, which I don't
    // mind as 'foreign' factories do not work anyway.
    for (ConfigurationFactory f : configurationType.getConfigurationFactories()) {
      if (f.getId().equals(configurationType.getId())) {
        configurationFactory = f;
        break;
      }
    }
    if (configurationFactory == null) {
      configurationFactory = configurationType.getConfigurationFactories()[0];
    }
    List<RuntimeConfigurationProducer> creators = ListSequence.fromList(new ArrayList<RuntimeConfigurationProducer>());
    ListSequence.fromList(creators).addElement(new ProducerPart_NodeExecutable_n4nea2_a(configurationFactory));
    ListSequence.fromList(creators).addElement(new ProducerPart_NodeBuildConfiguration_n4nea2_b(configurationFactory));
    ListSequence.fromList(creators).addElement(new ProducerPart_NodeIMayActAsMainFunction_n4nea2_c(configurationFactory));
    ListSequence.fromList(creators).addElement(new ProducerPart_NodeImplementationModule_n4nea2_d(configurationFactory));
    return creators;
  }

  public static final class ProducerPart_NodeExecutable_n4nea2_a extends BaseMpsProducer<SNode> {
    public ProducerPart_NodeExecutable_n4nea2_a(ConfigurationFactory configurationFactory) {
      super(configurationFactory);
    }

    @Override
    protected boolean isApplicable(Object source) {
      return source instanceof SNode && SNodeOperations.isInstanceOf(((SNode) source), CONCEPTS.Executable$4V);
    }

    @Override
    protected MbeddrExecutableConfiguration_Configuration doCreateConfiguration(final SNode source) {
      setSourceElement(MPSPsiElement.createFor(source, getMpsProject()));
      if (!(RunconfigurationHelper.DISABLE_MBEDDR_RUNCOFIG)) {
        SNode exe = source;
        if (BuildConfigHelper.isApplicable(exe)) {
          MbeddrExecutableConfiguration_Configuration config = ((MbeddrExecutableConfiguration_Configuration) getConfigurationFactory().createConfiguration("" + "(default) " + SModelOperations.getModelName(SNodeOperations.getModel(exe)) + "." + SPropertyOperations.getString(exe, PROPS.name$MnvL), getContext().getRunManager().getConfigurationTemplate(getConfigurationFactory()).getConfiguration()));
          config.getSettings().launchTimeout = 1200;
          config.getSettings().commandTimeout = 500;
          config.getBinary().setNode(exe);
          return config;
        }
      }
      return null;
    }


    @Override
    public ProducerPart_NodeExecutable_n4nea2_a clone() {
      return (ProducerPart_NodeExecutable_n4nea2_a) super.clone();
    }
  }
  public static final class ProducerPart_NodeBuildConfiguration_n4nea2_b extends BaseMpsProducer<SNode> {
    public ProducerPart_NodeBuildConfiguration_n4nea2_b(ConfigurationFactory configurationFactory) {
      super(configurationFactory);
    }

    @Override
    protected boolean isApplicable(Object source) {
      return source instanceof SNode && SNodeOperations.isInstanceOf(((SNode) source), CONCEPTS.BuildConfiguration$kH);
    }

    @Override
    protected MbeddrExecutableConfiguration_Configuration doCreateConfiguration(final SNode source) {
      setSourceElement(MPSPsiElement.createFor(source, getMpsProject()));
      if (!(RunconfigurationHelper.DISABLE_MBEDDR_RUNCOFIG)) {
        SNode exe = Sequence.fromIterable(SNodeOperations.ofConcept(SLinkOperations.getChildren(source, LINKS.binaries$R6lf), CONCEPTS.Executable$4V)).first();
        if ((exe != null) && BuildConfigHelper.isApplicable(exe)) {
          MbeddrExecutableConfiguration_Configuration config = ((MbeddrExecutableConfiguration_Configuration) getConfigurationFactory().createConfiguration("" + "(default) " + SModelOperations.getModelName(SNodeOperations.getModel(exe)) + "." + SPropertyOperations.getString(exe, PROPS.name$MnvL), getContext().getRunManager().getConfigurationTemplate(getConfigurationFactory()).getConfiguration()));
          config.getSettings().launchTimeout = 1200;
          config.getSettings().commandTimeout = 500;
          config.getBinary().setNode(exe);
          return config;
        }
      }
      return null;
    }


    @Override
    public ProducerPart_NodeBuildConfiguration_n4nea2_b clone() {
      return (ProducerPart_NodeBuildConfiguration_n4nea2_b) super.clone();
    }
  }
  public static final class ProducerPart_NodeIMayActAsMainFunction_n4nea2_c extends BaseMpsProducer<SNode> {
    public ProducerPart_NodeIMayActAsMainFunction_n4nea2_c(ConfigurationFactory configurationFactory) {
      super(configurationFactory);
    }

    @Override
    protected boolean isApplicable(Object source) {
      return source instanceof SNode && SNodeOperations.isInstanceOf(((SNode) source), CONCEPTS.IMayActAsMainFunction$Ej);
    }

    @Override
    protected MbeddrExecutableConfiguration_Configuration doCreateConfiguration(final SNode source) {
      setSourceElement(MPSPsiElement.createFor(source, getMpsProject()));
      if (!(RunconfigurationHelper.DISABLE_MBEDDR_RUNCOFIG)) {
        SNode main = source;
        if (!((boolean) IMayActAsMainFunction__BehaviorDescriptor.actsAsMainFunction_id2MbfxrZIa1M.invoke(main))) {
          return null;
        }

        List<SNode> bc = SModelOperations.roots(SNodeOperations.getModel(main), CONCEPTS.BuildConfiguration$kH);
        if (ListSequence.fromList(bc).isEmpty()) {
          return null;
        }

        final SNode mainModule = SNodeOperations.getNodeAncestor(main, CONCEPTS.ImplementationModule$Gy, false, false);
        SNode exe = Sequence.fromIterable(SNodeOperations.ofConcept(SLinkOperations.collectMany(bc, LINKS.binaries$R6lf), CONCEPTS.Executable$4V)).findFirst((it) -> Sequence.fromIterable(Binary__BehaviorDescriptor.referencedImplModules_id7RiewQ_lHPf.invoke(it)).contains(mainModule));

        if ((exe == null) || !(BuildConfigHelper.isApplicable(exe))) {
          return null;
        }


        MbeddrExecutableConfiguration_Configuration config = ((MbeddrExecutableConfiguration_Configuration) getConfigurationFactory().createConfiguration("" + "(default) " + SModelOperations.getModelName(SNodeOperations.getModel(exe)) + "." + SPropertyOperations.getString(exe, PROPS.name$MnvL), getContext().getRunManager().getConfigurationTemplate(getConfigurationFactory()).getConfiguration()));
        config.getSettings().launchTimeout = 1200;
        config.getSettings().commandTimeout = 500;
        config.getBinary().setNode(exe);
        return config;
      }
      return null;
    }


    @Override
    public ProducerPart_NodeIMayActAsMainFunction_n4nea2_c clone() {
      return (ProducerPart_NodeIMayActAsMainFunction_n4nea2_c) super.clone();
    }
  }
  public static final class ProducerPart_NodeImplementationModule_n4nea2_d extends BaseMpsProducer<SNode> {
    public ProducerPart_NodeImplementationModule_n4nea2_d(ConfigurationFactory configurationFactory) {
      super(configurationFactory);
    }

    @Override
    protected boolean isApplicable(Object source) {
      return source instanceof SNode && SNodeOperations.isInstanceOf(((SNode) source), CONCEPTS.ImplementationModule$Gy);
    }

    @Override
    protected MbeddrExecutableConfiguration_Configuration doCreateConfiguration(final SNode source) {
      setSourceElement(MPSPsiElement.createFor(source, getMpsProject()));
      if (!(RunconfigurationHelper.DISABLE_MBEDDR_RUNCOFIG)) {
        final SNode mainModule = source;
        SNode main = Sequence.fromIterable(SNodeOperations.ofConcept(SLinkOperations.getChildren(mainModule, LINKS.contents$3Vmy), CONCEPTS.IMayActAsMainFunction$Ej)).findFirst((it) -> (boolean) IMayActAsMainFunction__BehaviorDescriptor.actsAsMainFunction_id2MbfxrZIa1M.invoke(it));
        if ((main == null)) {
          return null;
        }

        List<SNode> bc = SModelOperations.roots(SNodeOperations.getModel(mainModule), CONCEPTS.BuildConfiguration$kH);
        if (ListSequence.fromList(bc).isEmpty()) {
          return null;
        }

        SNode exe = Sequence.fromIterable(SNodeOperations.ofConcept(SLinkOperations.collectMany(bc, LINKS.binaries$R6lf), CONCEPTS.Executable$4V)).findFirst((it) -> Sequence.fromIterable(Binary__BehaviorDescriptor.referencedImplModules_id7RiewQ_lHPf.invoke(it)).contains(mainModule));

        if ((exe == null) || !(BuildConfigHelper.isApplicable(exe))) {
          return null;
        }

        MbeddrExecutableConfiguration_Configuration config = ((MbeddrExecutableConfiguration_Configuration) getConfigurationFactory().createConfiguration("" + "(default) " + SModelOperations.getModelName(SNodeOperations.getModel(exe)) + "." + SPropertyOperations.getString(exe, PROPS.name$MnvL), getContext().getRunManager().getConfigurationTemplate(getConfigurationFactory()).getConfiguration()));
        config.getSettings().launchTimeout = 1200;
        config.getSettings().commandTimeout = 500;
        config.getBinary().setNode(exe);
        return config;
      }
      return null;
    }


    @Override
    public ProducerPart_NodeImplementationModule_n4nea2_d clone() {
      return (ProducerPart_NodeImplementationModule_n4nea2_d) super.clone();
    }
  }

  private static final class CONCEPTS {
    /*package*/ static final SConcept Executable$4V = MetaAdapterFactory.getConcept(0x2d7fadf533f64e80L, 0xa78f0f739add2bdeL, 0x46097107c8d98c12L, "com.mbeddr.core.buildconfig.structure.Executable");
    /*package*/ static final SConcept BuildConfiguration$kH = MetaAdapterFactory.getConcept(0x2d7fadf533f64e80L, 0xa78f0f739add2bdeL, 0x6b1af9f9f43c2f48L, "com.mbeddr.core.buildconfig.structure.BuildConfiguration");
    /*package*/ static final SInterfaceConcept IMayActAsMainFunction$Ej = MetaAdapterFactory.getInterfaceConcept(0x6d11763d483d4b2bL, 0x8efc09336c1b0001L, 0x2c8b3e16ffb89fbaL, "com.mbeddr.core.modules.structure.IMayActAsMainFunction");
    /*package*/ static final SConcept ImplementationModule$Gy = MetaAdapterFactory.getConcept(0x6d11763d483d4b2bL, 0x8efc09336c1b0001L, 0x595522006a5b934eL, "com.mbeddr.core.modules.structure.ImplementationModule");
  }

  private static final class PROPS {
    /*package*/ static final SProperty name$MnvL = MetaAdapterFactory.getProperty(0xceab519525ea4f22L, 0x9b92103b95ca8c0cL, 0x110396eaaa4L, 0x110396ec041L, "name");
  }

  private static final class LINKS {
    /*package*/ static final SContainmentLink binaries$R6lf = MetaAdapterFactory.getContainmentLink(0x2d7fadf533f64e80L, 0xa78f0f739add2bdeL, 0x6b1af9f9f43c2f48L, 0x46097107c8de43cbL, "binaries");
    /*package*/ static final SContainmentLink contents$3Vmy = MetaAdapterFactory.getContainmentLink(0x6d11763d483d4b2bL, 0x8efc09336c1b0001L, 0x595522006a5b933dL, 0x595522006a5b9351L, "contents");
  }
}

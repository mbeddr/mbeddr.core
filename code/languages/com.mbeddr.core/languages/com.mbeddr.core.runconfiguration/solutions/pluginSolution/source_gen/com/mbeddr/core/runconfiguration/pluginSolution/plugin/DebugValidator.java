package com.mbeddr.core.runconfiguration.pluginSolution.plugin;

/*Generated by MPS */

import java.util.concurrent.Callable;
import org.jetbrains.mps.openapi.model.SNode;
import org.jetbrains.mps.openapi.util.ProgressMonitor;
import org.apache.commons.lang3.SystemUtils;

public class DebugValidator {

  public DebugValidator() {
  }

  public static Callable<Boolean> makeFileExists(final SNode binary, final ProgressMonitor progressMonitor) {
    return new Callable<Boolean>() {
      public Boolean call() throws Exception {
        boolean fileExists = PlatformUtil.generatedMakeFileExists(binary);
        if (!(fileExists)) {
          progressMonitor.cancel();
          ErrorReporter.showErrorDialog("Make File wasn't generated, please rebuild the solution/language");
        }
        progressMonitor.advance(1);
        return fileExists;
      }
    };
  }

  public static Callable<Boolean> makeFileExists(final SNode binary) {
    return new Callable<Boolean>() {
      public Boolean call() throws Exception {
        boolean fileExists = PlatformUtil.generatedMakeFileExists(binary);
        if (!(fileExists)) {
          throw new Exception("Make File wasn't generated, please rebuild the solution/language");
        }
        return fileExists;
      }
    };
  }


  public static boolean isCommandLineProgramInstalled(String name, String option) {
    int processExitValue = -1;
    try {
      String[] command;
      if (SystemUtils.IS_OS_WINDOWS) {
        command = new String[]{"cmd.exe", "/C", name, option};
      } else {
        command = new String[]{name, option};
      }
      Process process = Runtime.getRuntime().exec(command);
      new StreamClearer(process.getInputStream()).start();
      processExitValue = process.waitFor();
    } catch (Exception ex) {
    }
    return processExitValue == 0;
  }

  public static Callable<Boolean> toolIsExecutable(final String commandName, final String[] parameter) {
    return new Callable<Boolean>() {
      public Boolean call() throws Exception {
        boolean toolAvailable = false;
        toolAvailable = CMDExecutor.executeTool(commandName, parameter, null);
        if (!(toolAvailable)) {
          throw new Exception(commandName + " is not available. Please check the tool is installed and can be invoked from the command-line");
        }
        return toolAvailable;
      }
    };
  }

  public static Callable<Boolean> toolIsExecutable(final String commandName, final String[] parameter, final ProgressMonitor progressMonitor) {
    return new Callable<Boolean>() {
      public Boolean call() throws Exception {
        boolean toolAvailable = false;
        if (!(progressMonitor.isCanceled())) {
          progressMonitor.step("checking " + commandName + " is installed and available");
          toolAvailable = CMDExecutor.executeTool(commandName, parameter, null);
          if (!(toolAvailable)) {
            progressMonitor.cancel();
            ErrorReporter.showErrorDialog(commandName + " is not available. Please check the tool is installed and can be invoked from the command-line");
          }
          progressMonitor.advance(1);
        }
        return toolAvailable;
      }
    };
  }

}

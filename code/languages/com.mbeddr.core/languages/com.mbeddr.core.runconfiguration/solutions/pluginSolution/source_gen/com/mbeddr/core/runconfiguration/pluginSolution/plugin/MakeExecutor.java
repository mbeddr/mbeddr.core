package com.mbeddr.core.runconfiguration.pluginSolution.plugin;

/*Generated by MPS */

import java.util.concurrent.Callable;
import org.jetbrains.mps.openapi.model.SNode;
import org.jetbrains.mps.openapi.util.ProgressMonitor;
import java.io.File;

public class MakeExecutor {

  public static Callable<Boolean> makeDebugBinary(final SNode myBinary, final ProgressMonitor progressMonitor) {
    return new Callable<Boolean>() {
      public Boolean call() throws Exception {
        boolean result = false;
        if (!(progressMonitor.isCanceled())) {
          progressMonitor.step("compiling binary");
          File directory = PlatformUtil.getFolderFQ(myBinary);
          try {
            result = CMDExecutor.executeTool("make", new String[]{"clean", "all", "FLAVOR=debug"}, directory);
          } catch (Exception ex) {
            ex.printStackTrace();
          }
          if (!(result)) {
            progressMonitor.cancel();
            ErrorReporter.showErrorDialog("Make failed - try running make from the command line to get more detailed information");
          }
          progressMonitor.advance(1);
        }
        return result;
      }
    };
  }


  public static Callable<Boolean> makeBinary(final String pathToMake, final SNode myBinary, final boolean debug) {
    return new Callable<Boolean>() {
      public Boolean call() throws Exception {
        boolean result = false;
        File directory = PlatformUtil.getFolderFQ(myBinary);
        try {
          result = CMDExecutor.executeTool(pathToMake, new String[]{"clean", "all", "FLAVOR=" + ((debug ? "debug" : "release"))}, directory);
        } catch (Exception ex) {
          ex.printStackTrace();
        }
        if (!(result)) {
          throw new Exception("Make failed - try running make from the command line to get more detailed information");
        }
        return result;
      }
    };
  }





}

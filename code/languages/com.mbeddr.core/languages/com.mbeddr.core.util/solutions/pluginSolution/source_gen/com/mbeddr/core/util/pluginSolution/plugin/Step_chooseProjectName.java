package com.mbeddr.core.util.pluginSolution.plugin;

/*Generated by MPS */

import com.mbeddr.mpsutil.wizard.runtime.plugin.BaseProcessStep;
import jetbrains.mps.project.Project;
import javax.swing.JComponent;
import javax.swing.JPanel;
import com.intellij.uiDesigner.core.GridLayoutManager;
import com.intellij.util.ui.JBInsets;
import javax.swing.JLabel;
import com.intellij.uiDesigner.core.GridConstraints;
import javax.swing.JTextField;
import jetbrains.mps.workbench.dialogs.project.newproject.PathField;
import javax.swing.event.CaretListener;
import javax.swing.event.CaretEvent;
import java.awt.BorderLayout;
import jetbrains.mps.workbench.dialogs.project.newproject.ProjectOptions;
import org.jetbrains.mps.openapi.util.ProgressMonitor;
import com.intellij.ide.wizard.AbstractWizardStepEx;
import com.intellij.ide.wizard.CommitStepException;

public class Step_chooseProjectName extends BaseProcessStep<Project> {
  public static final String ID = "com.mbeddr.core.util.pluginSolution.plugin::createNewProjectWizard@chooseProjectName";



  protected void createComponent(final JComponent mainpanel) {

    JPanel myProjectPanel = new JPanel(new GridLayoutManager(2, 2, new JBInsets(0, 0, 5, 0), -1, -1));
    myProjectPanel.add(new JLabel("Project name:"), new GridConstraints(0, 0, 1, 1, GridConstraints.ANCHOR_NORTHWEST, GridConstraints.FILL_NONE, GridConstraints.SIZEPOLICY_FIXED, GridConstraints.SIZEPOLICY_FIXED, null, null, null));
    Step_chooseProjectName.this.priv_myProjectName = new JTextField("NewProject");
    myProjectPanel.add(Step_chooseProjectName.this.priv_myProjectName, new GridConstraints(0, 1, 1, 1, GridConstraints.ANCHOR_NORTHWEST, GridConstraints.FILL_HORIZONTAL, GridConstraints.SIZEPOLICY_CAN_SHRINK | GridConstraints.SIZEPOLICY_CAN_GROW, GridConstraints.SIZEPOLICY_FIXED, null, null, null));
    myProjectPanel.add(new JLabel("Project location:"), new GridConstraints(1, 0, 1, 1, GridConstraints.ANCHOR_NORTHWEST, GridConstraints.FILL_NONE, GridConstraints.SIZEPOLICY_FIXED, GridConstraints.SIZEPOLICY_FIXED, null, null, null));
    Step_chooseProjectName.this.priv_myProjectPath = new PathField();
    Step_chooseProjectName.this.priv_myProjectPath.addPathChangedListener(new PathField.PathChangedListener() {
      public void firePathChanged(String newValue) {
        // If path changed need to update specific module settings
        // TODO: trigger proper validation
      }
    });
    // Change project path if project name changed
    Step_chooseProjectName.this.priv_myProjectName.addCaretListener(new CaretListener() {
      private String myValue = Step_chooseProjectName.this.priv_myProjectName.getText();
      @Override
      public void caretUpdate(CaretEvent e) {
        if (myValue != Step_chooseProjectName.this.priv_myProjectName.getText()) {
          myValue = Step_chooseProjectName.this.priv_myProjectName.getText();
          NewProjectWizardHelper.updateProjectPath(Step_chooseProjectName.this.priv_myProjectName, Step_chooseProjectName.this.priv_myProjectPath);
        }
      }
    });
    NewProjectWizardHelper.updateProjectPath(Step_chooseProjectName.this.priv_myProjectName, Step_chooseProjectName.this.priv_myProjectPath);
    myProjectPanel.add(Step_chooseProjectName.this.priv_myProjectPath, new GridConstraints(1, 1, 1, 1, GridConstraints.ANCHOR_NORTHWEST, GridConstraints.FILL_HORIZONTAL, GridConstraints.SIZEPOLICY_CAN_SHRINK | GridConstraints.SIZEPOLICY_CAN_GROW, GridConstraints.SIZEPOLICY_FIXED, null, null, null));

    mainpanel.setLayout(new BorderLayout(5, 5));
    mainpanel.add(myProjectPanel, BorderLayout.CENTER);
  }
  public ProjectOptions out_projectOptions;
  private JTextField priv_myProjectName;
  private PathField priv_myProjectPath;
  @Override
  public boolean isComplete() {
    return isNotEmptyString(Step_chooseProjectName.this.priv_myProjectName.getText());
  }
  @Override
  public Project execute(final Project output, final ProgressMonitor progress) {
    super.execute(output, progress);

    final ProjectOptions myOptions = new ProjectOptions();
    myOptions.setProjectName(Step_chooseProjectName.this.priv_myProjectName.getText());
    myOptions.setProjectPath(Step_chooseProjectName.this.priv_myProjectPath.getPath());
    myOptions.setCreateNewLanguage(false);
    myOptions.setCreateNewSolution(false);
    myOptions.setStorageScheme(false);

    Step_chooseProjectName.this.out_projectOptions = myOptions;
    return null;
  }

  public Step_chooseProjectName() {
    super("Project Name", ID);
  }

  public void commit(AbstractWizardStepEx.CommitType type) throws CommitStepException {
  }
  private static boolean isNotEmptyString(String str) {
    return str != null && str.length() > 0;
  }
}

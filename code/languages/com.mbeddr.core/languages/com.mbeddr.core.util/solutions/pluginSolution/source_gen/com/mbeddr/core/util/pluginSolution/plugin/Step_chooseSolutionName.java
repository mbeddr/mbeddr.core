package com.mbeddr.core.util.pluginSolution.plugin;

/*Generated by MPS */

import com.mbeddr.mpsutil.wizard.runtime.plugin.BaseProcessStep;
import jetbrains.mps.project.Solution;
import javax.swing.JComponent;
import jetbrains.mps.ide.ui.dialogs.modules.NameLocationPanel;
import jetbrains.mps.ide.ui.dialogs.modules.NewModuleDialog;
import javax.swing.BoxLayout;
import javax.swing.Box;
import java.awt.Dimension;
import org.jetbrains.mps.openapi.model.SModel;
import org.jetbrains.mps.openapi.util.ProgressMonitor;
import com.intellij.openapi.util.AsyncResult;
import com.mbeddr.mpsutil.smodule.runtime.lib.ModelHelper;
import jetbrains.mps.persistence.PreinstalledModelFactoryTypes;
import jetbrains.mps.internal.collections.runtime.ListSequence;
import java.util.ArrayList;
import jetbrains.mps.project.DevKit;
import org.jetbrains.mps.openapi.language.SLanguage;
import com.intellij.ide.wizard.AbstractWizardStepEx;
import com.intellij.ide.wizard.CommitStepException;

public class Step_chooseSolutionName extends BaseProcessStep<Solution> {
  public static final String ID = "com.mbeddr.core.util.pluginSolution.plugin::createNewMbeddrSolution@chooseSolutionName";



  protected void createComponent(final JComponent mainpanel) {
    Step_chooseSolutionName.this.priv_newSolutionSettings = new NameLocationPanel(NewModuleDialog.projectHome(((createNewMbeddrSolution_Wizard) this.wizard).input_project), "Name:", "Location:");
    // XXX is there need for location? addSolution(), below, uses name of the module only
    Step_chooseSolutionName.this.priv_newSolutionSettings.withDefaults("NewSolution", "");
    Step_chooseSolutionName.this.priv_newSolutionSettings.onChange(() -> Step_chooseSolutionName.this.triggerValidation());

    mainpanel.setLayout(new BoxLayout(mainpanel, BoxLayout.PAGE_AXIS));
    mainpanel.add(Step_chooseSolutionName.this.priv_newSolutionSettings);
    mainpanel.add(Box.createRigidArea(new Dimension(0, 5)));
  }
  public SModel out_createdModel;
  private NameLocationPanel priv_newSolutionSettings;
  @Override
  public boolean isComplete() {
    return isNotEmptyString(Step_chooseSolutionName.this.priv_newSolutionSettings.getModuleName());
  }
  @Override
  public Solution execute(final Solution output, final ProgressMonitor progress) {
    super.execute(output, progress);
    final AsyncResult<Solution> res = new AsyncResult<Solution>();
    Solution result;
    result = ModelHelper.createSolution(((createNewMbeddrSolution_Wizard) this.wizard).input_project, Step_chooseSolutionName.this.priv_newSolutionSettings.getModuleName(), "");
    SModel model = ModelHelper.createModel(result, PreinstalledModelFactoryTypes.PLAIN_XML, Step_chooseSolutionName.this.priv_newSolutionSettings.getModuleName() + ".model", ListSequence.fromList(new ArrayList<DevKit>()), ListSequence.fromList(new ArrayList<SLanguage>()), ListSequence.fromList(new ArrayList<SModel>()));
    res.setDone(result);
    Step_chooseSolutionName.this.out_createdModel = model;
    return res.getResultSync();
  }

  public Step_chooseSolutionName() {
    super("Solution Name", ID);
  }

  public void commit(AbstractWizardStepEx.CommitType type) throws CommitStepException {
  }
  private static boolean isNotEmptyString(String str) {
    return str != null && str.length() > 0;
  }
}

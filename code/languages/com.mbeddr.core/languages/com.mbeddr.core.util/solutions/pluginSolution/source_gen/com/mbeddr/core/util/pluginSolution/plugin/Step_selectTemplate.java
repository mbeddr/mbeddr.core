package com.mbeddr.core.util.pluginSolution.plugin;

/*Generated by MPS */

import com.mbeddr.mpsutil.wizard.runtime.plugin.BaseProcessStep;
import jetbrains.mps.project.Solution;
import javax.swing.JComponent;
import javax.swing.JCheckBox;
import javax.swing.JList;
import javax.swing.ListSelectionModel;
import javax.swing.BorderFactory;
import java.awt.Color;
import javax.swing.DefaultListCellRenderer;
import java.awt.Component;
import javax.swing.JLabel;
import javax.swing.event.ListSelectionListener;
import javax.swing.event.ListSelectionEvent;
import java.awt.event.ActionListener;
import java.awt.event.ActionEvent;
import java.awt.BorderLayout;
import org.jetbrains.mps.openapi.util.ProgressMonitor;
import org.jetbrains.mps.openapi.model.SModel;
import javax.swing.SwingUtilities;
import com.intellij.ide.wizard.AbstractWizardStepEx;
import com.intellij.ide.wizard.CommitStepException;

public class Step_selectTemplate extends BaseProcessStep<Solution> {
  public static final String ID = "com.mbeddr.core.util.pluginSolution.plugin::createNewMbeddrSolution@selectTemplate";



  protected void createComponent(final JComponent mainpanel) {

    Step_selectTemplate.this.priv_useTemplate = new JCheckBox("Create model using template");
    Step_selectTemplate.this.priv_useTemplate.setSelected(true);

    IModelTemplate[] templates = new IModelTemplate[]{new HelloWorldTemplate(), new BasicEmbeddedDevModel()};
    IModelTemplate defaultSelected = templates[1];
    Step_selectTemplate.this.priv_templateList = new JList<IModelTemplate>(templates);
    Step_selectTemplate.this.priv_templateList.setSelectionMode(ListSelectionModel.SINGLE_SELECTION);
    Step_selectTemplate.this.priv_templateList.setLayoutOrientation(JList.VERTICAL);
    Step_selectTemplate.this.priv_templateList.setVisibleRowCount(-1);
    Step_selectTemplate.this.priv_templateList.setBorder(BorderFactory.createLineBorder(Color.GRAY));
    DefaultListCellRenderer renderer = new DefaultListCellRenderer() {
      @Override
      public Component getListCellRendererComponent(JList<?> list, Object object, int i, boolean b, boolean b1) {
        JLabel label = (JLabel) super.getListCellRendererComponent(list, object, i, b, b1);
        label.setText(as_ij7oo4_a0a0a1a0a0a0l0e(object, IModelTemplate.class).getName());
        return label;
      }
    };
    Step_selectTemplate.this.priv_templateList.setCellRenderer(renderer);
    Step_selectTemplate.this.priv_templateList.addListSelectionListener(new ListSelectionListener() {
      public void valueChanged(ListSelectionEvent event) {
        Step_selectTemplate.this.triggerValidation();
      }
    });
    Step_selectTemplate.this.priv_templateList.setSelectedValue(defaultSelected, true);

    Step_selectTemplate.this.priv_useTemplate.addActionListener(new ActionListener() {
      public void actionPerformed(ActionEvent event) {
        JCheckBox source = (JCheckBox) event.getSource();
        Step_selectTemplate.this.priv_templateList.setEnabled(source.isSelected());
        Step_selectTemplate.this.triggerValidation();
      }
    });
    mainpanel.setLayout(new BorderLayout(50, 5));
    mainpanel.add(Step_selectTemplate.this.priv_useTemplate, BorderLayout.NORTH);
    mainpanel.add(Step_selectTemplate.this.priv_templateList, BorderLayout.CENTER);
  }
  private JCheckBox priv_useTemplate;
  private JList<IModelTemplate> priv_templateList;
  @Override
  public boolean isComplete() {
    return !(Step_selectTemplate.this.priv_useTemplate.isSelected()) || Step_selectTemplate.this.priv_useTemplate.isSelected() && Step_selectTemplate.this.priv_templateList.getSelectedValue() != null;
  }
  @Override
  public Solution execute(final Solution output, final ProgressMonitor progress) {
    super.execute(output, progress);
    final SModel model = ((Step_chooseSolutionName) getStep(Step_chooseSolutionName.ID)).out_createdModel;
    if (Step_selectTemplate.this.priv_useTemplate.isSelected()) {
      final IModelTemplate template = Step_selectTemplate.this.priv_templateList.getSelectedValue();
      SwingUtilities.invokeLater(() -> ((createNewMbeddrSolution_Wizard) Step_selectTemplate.this.wizard).input_project.getRepository().getModelAccess().executeCommand(() -> template.populateModel(model)));
    }
    return output;
  }

  public Step_selectTemplate() {
    super("Model Template", ID);
  }

  public void commit(AbstractWizardStepEx.CommitType type) throws CommitStepException {
  }
  private static <T> T as_ij7oo4_a0a0a1a0a0a0l0e(Object o, Class<T> type) {
    return (type.isInstance(o) ? (T) o : null);
  }
}

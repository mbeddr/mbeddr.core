package com.mbeddr.core.util.intentions;

/*Generated by MPS */

import jetbrains.mps.intentions.AbstractIntentionDescriptor;
import jetbrains.mps.openapi.intentions.IntentionFactory;
import java.util.Collection;
import jetbrains.mps.openapi.intentions.IntentionExecutable;
import jetbrains.mps.openapi.intentions.Kind;
import jetbrains.mps.smodel.SNodePointer;
import org.jetbrains.mps.openapi.model.SNode;
import jetbrains.mps.openapi.editor.EditorContext;
import java.util.Collections;
import jetbrains.mps.intentions.AbstractIntentionExecutable;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SNodeOperations;
import jetbrains.mps.internal.collections.runtime.ListSequence;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SLinkOperations;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SPropertyOperations;
import com.mbeddr.core.base.behavior.NameExtractionHelper;
import com.mbeddr.core.expressions.typesystem.MeetTypeHelper;
import jetbrains.mps.typechecking.TypecheckingFacade;
import com.mbeddr.core.modules.behavior.IFunctionLike__BehaviorDescriptor;
import java.util.List;
import jetbrains.mps.internal.collections.runtime.Sequence;
import com.mbeddr.core.base.behavior.IVisibleElementProvider__BehaviorDescriptor;
import jetbrains.mps.openapi.intentions.IntentionDescriptor;
import jetbrains.mps.smodel.builder.SNodeBuilder;
import org.jetbrains.mps.openapi.language.SInterfaceConcept;
import jetbrains.mps.smodel.adapter.structure.MetaAdapterFactory;
import org.jetbrains.mps.openapi.language.SConcept;
import org.jetbrains.mps.openapi.language.SContainmentLink;
import org.jetbrains.mps.openapi.language.SReferenceLink;
import org.jetbrains.mps.openapi.language.SProperty;

public final class logThisExpressionAsNewItemWithNewLogger_Intention extends AbstractIntentionDescriptor implements IntentionFactory {
  private Collection<IntentionExecutable> myCachedExecutable;

  public logThisExpressionAsNewItemWithNewLogger_Intention() {
    super(Kind.NORMAL, false, new SNodePointer("r:a97b0256-d67b-46d6-8dd5-fd70d5b31e78(com.mbeddr.core.util.intentions)", "2284103232232569652"));
  }

  @Override
  public String getPresentation() {
    return "logThisExpressionAsNewItemWithNewLogger";
  }

  @Override
  public boolean isSurroundWith() {
    return false;
  }

  public Collection<IntentionExecutable> instances(final SNode node, final EditorContext context) {
    if (myCachedExecutable == null) {
      myCachedExecutable = Collections.<IntentionExecutable>singletonList(new IntentionImplementation());
    }
    return myCachedExecutable;
  }
  /*package*/ final class IntentionImplementation extends AbstractIntentionExecutable {
    public IntentionImplementation() {
    }

    @Override
    public String getDescription(final SNode node, final EditorContext editorContext) {
      return "LOGGER: " + ("Log with New Data Logger");
    }

    @Override
    public void execute(final SNode node, final EditorContext editorContext) {
      SNode ifl = SNodeOperations.getNodeAncestor(node, CONCEPTS.IFunctionLike$zN, false, false);

      SNode datalogger = createDataLoggerDeclaration_iqxt41_a0c0a();
      if (ifl != null) {
        ListSequence.fromList(SLinkOperations.getChildren(datalogger, LINKS.tracepoints$yDim)).addElement(createTracePoint_iqxt41_a0a0a3a0(SPropertyOperations.getString(ifl, PROPS.name$MnvL)));
      }
      ListSequence.fromList(SLinkOperations.getChildren(datalogger, LINKS.items$rLi7)).clear();
      ListSequence.fromList(SLinkOperations.getChildren(datalogger, LINKS.items$rLi7)).addElement(createDataItem_iqxt41_a0a5a0(NameExtractionHelper.extractExampleName(node), MeetTypeHelper.getConcreteNonConstVolatileType(SNodeOperations.cast(TypecheckingFacade.getFromContext().getTypeOf(node), CONCEPTS.IType$a9))));



      ListSequence.fromList(SLinkOperations.getChildren(SNodeOperations.getNodeAncestor(node, CONCEPTS.ImplementationModule$Gy, false, false), LINKS.contents$3Vmy)).insertElement(0, datalogger);

      SNode s = createExpressionStatement_iqxt41_a0l0a(datalogger, ListSequence.fromList(SLinkOperations.getChildren(datalogger, LINKS.items$rLi7)).first(), SNodeOperations.copyNode(node));


      SNodeOperations.insertNextSiblingChild(SNodeOperations.getNodeAncestor(node, CONCEPTS.Statement$zV, false, false), s);

      if (ifl != null) {
        ListSequence.fromList(SLinkOperations.getChildren(IFunctionLike__BehaviorDescriptor.getStatementList_id71UKpntnl7S.invoke(ifl), LINKS.statements$euTV)).insertElement(0, createExpressionStatement_iqxt41_a0a0a61a0(datalogger, ListSequence.fromList(SLinkOperations.getChildren(datalogger, LINKS.tracepoints$yDim)).first()));
        SNode leaver = createExpressionStatement_iqxt41_a0b0q0a(datalogger, ListSequence.fromList(SLinkOperations.getChildren(datalogger, LINKS.tracepoints$yDim)).first());

        List<SNode> statements = SLinkOperations.getChildren(IFunctionLike__BehaviorDescriptor.getStatementList_id71UKpntnl7S.invoke(ifl), LINKS.statements$euTV);
        if (SNodeOperations.isInstanceOf(ListSequence.fromList(statements).last(), CONCEPTS.ReturnStatement$Kx)) {
          SNodeOperations.insertPrevSiblingChild(ListSequence.fromList(statements).last(), leaver);
        } else {
          ListSequence.fromList(statements).addElement(leaver);
        }
      }

    }

    @Override
    public boolean isApplicable(final SNode node, final EditorContext editorContext) {
      if (!(isApplicableToNode(node, editorContext))) {
        return false;
      }
      return true;
    }

    private boolean isApplicableToNode(final SNode node, final EditorContext editorContext) {
      if (!(SNodeOperations.isInstanceOf(SNodeOperations.getContainingRoot(node), CONCEPTS.Module$fX))) {
        return false;
      }
      return Sequence.fromIterable(SNodeOperations.ofConcept(IVisibleElementProvider__BehaviorDescriptor.visibleContentsOfType_id6clJcrJXo2_.invoke(SNodeOperations.getNodeAncestor(node, CONCEPTS.IVisibleElementProvider$$O, false, false), CONCEPTS.DataLoggerDeclaration$5X.getDeclarationNode()), CONCEPTS.DataLoggerDeclaration$5X)).translate((it) -> SLinkOperations.getChildren(it, LINKS.items$rLi7)).isEmpty();
    }


    @Override
    public IntentionDescriptor getDescriptor() {
      return logThisExpressionAsNewItemWithNewLogger_Intention.this;
    }

  }
  private static SNode createDataLoggerDeclaration_iqxt41_a0c0a() {
    SNodeBuilder n0 = new SNodeBuilder().init(CONCEPTS.DataLoggerDeclaration$5X);
    n0.forChild(LINKS.timeType$o5LC).init(CONCEPTS.UnsignedInt32tType$7z);
    n0.setProperty(PROPS.name$MnvL, "DL");
    n0.setProperty(PROPS.tracepointStackSize$KQPd, "" + (100));
    return n0.getResult();
  }
  private static SNode createTracePoint_iqxt41_a0a0a3a0(String p0) {
    SNodeBuilder n0 = new SNodeBuilder().init(CONCEPTS.TracePoint$QV);
    n0.setProperty(PROPS.name$MnvL, p0);
    return n0.getResult();
  }
  private static SNode createDataItem_iqxt41_a0a5a0(String p0, SNode p1) {
    SNodeBuilder n0 = new SNodeBuilder().init(CONCEPTS.DataItem$xH);
    n0.setProperty(PROPS.active$F8DW, "" + (true));
    n0.setProperty(PROPS.size$vk_i, "" + (1));
    n0.setProperty(PROPS.name$MnvL, p0);
    n0.forChild(LINKS.type$sXU3).initNode(p1, CONCEPTS.Type$dP, true);
    {
      SNodeBuilder n1 = n0.forChild(LINKS.initValue$4EyG).init(CONCEPTS.NumberLiteral$jK);
      n1.setProperty(PROPS.value$qZmE, "0");
    }
    return n0.getResult();
  }
  private static SNode createExpressionStatement_iqxt41_a0l0a(SNode p0, SNode p1, SNode p2) {
    SNodeBuilder n0 = new SNodeBuilder().init(CONCEPTS.ExpressionStatement$SU);
    {
      SNodeBuilder n1 = n0.forChild(LINKS.expr$vamr).init(CONCEPTS.GenericDotExpression$uQ);
      {
        SNodeBuilder n2 = n1.forChild(LINKS.expression$PfNq).init(CONCEPTS.DataLoggerRef$JQ);
        n2.setReferenceTarget(LINKS.datalogger$bfY7, p0);
      }
      {
        SNodeBuilder n3 = n1.forChild(LINKS.target$CEPF).init(CONCEPTS.GenericDLLogOp$yM);
        n3.setReferenceTarget(LINKS.item$3DF8, p1);
        n3.forChild(LINKS.value$3Ds7).initNode(p2, CONCEPTS.Expression$bT, true);
      }
    }
    return n0.getResult();
  }
  private static SNode createExpressionStatement_iqxt41_a0a0a61a0(SNode p0, SNode p1) {
    SNodeBuilder n0 = new SNodeBuilder().init(CONCEPTS.ExpressionStatement$SU);
    {
      SNodeBuilder n1 = n0.forChild(LINKS.expr$vamr).init(CONCEPTS.GenericDotExpression$uQ);
      {
        SNodeBuilder n2 = n1.forChild(LINKS.expression$PfNq).init(CONCEPTS.DataLoggerRef$JQ);
        n2.setReferenceTarget(LINKS.datalogger$bfY7, p0);
      }
      {
        SNodeBuilder n3 = n1.forChild(LINKS.target$CEPF).init(CONCEPTS.GenericDLEnterTraceOp$3Q);
        n3.setReferenceTarget(LINKS.tracepoint$vPhN, p1);
      }
    }
    return n0.getResult();
  }
  private static SNode createExpressionStatement_iqxt41_a0b0q0a(SNode p0, SNode p1) {
    SNodeBuilder n0 = new SNodeBuilder().init(CONCEPTS.ExpressionStatement$SU);
    {
      SNodeBuilder n1 = n0.forChild(LINKS.expr$vamr).init(CONCEPTS.GenericDotExpression$uQ);
      {
        SNodeBuilder n2 = n1.forChild(LINKS.expression$PfNq).init(CONCEPTS.DataLoggerRef$JQ);
        n2.setReferenceTarget(LINKS.datalogger$bfY7, p0);
      }
      {
        SNodeBuilder n3 = n1.forChild(LINKS.target$CEPF).init(CONCEPTS.GenericDLLeaveTraceOp$4e);
        n3.setReferenceTarget(LINKS.tracepoint$CleM, p1);
      }
    }
    return n0.getResult();
  }

  private static final class CONCEPTS {
    /*package*/ static final SInterfaceConcept IFunctionLike$zN = MetaAdapterFactory.getInterfaceConcept(0x6d11763d483d4b2bL, 0x8efc09336c1b0001L, 0x707ac195dd5d51f2L, "com.mbeddr.core.modules.structure.IFunctionLike");
    /*package*/ static final SInterfaceConcept IType$a9 = MetaAdapterFactory.getInterfaceConcept(0xceab519525ea4f22L, 0x9b92103b95ca8c0cL, 0x11f8a0774f2L, "jetbrains.mps.lang.core.structure.IType");
    /*package*/ static final SConcept ImplementationModule$Gy = MetaAdapterFactory.getConcept(0x6d11763d483d4b2bL, 0x8efc09336c1b0001L, 0x595522006a5b934eL, "com.mbeddr.core.modules.structure.ImplementationModule");
    /*package*/ static final SConcept Statement$zV = MetaAdapterFactory.getConcept(0xa9d696470840491eL, 0xbf392eb0805d2011L, 0x3a16e3a9c7ad6d03L, "com.mbeddr.core.statements.structure.Statement");
    /*package*/ static final SConcept ReturnStatement$Kx = MetaAdapterFactory.getConcept(0x6d11763d483d4b2bL, 0x8efc09336c1b0001L, 0x7c747300dbd94ea5L, "com.mbeddr.core.modules.structure.ReturnStatement");
    /*package*/ static final SConcept Module$fX = MetaAdapterFactory.getConcept(0x6d11763d483d4b2bL, 0x8efc09336c1b0001L, 0x595522006a5b933dL, "com.mbeddr.core.modules.structure.Module");
    /*package*/ static final SInterfaceConcept IVisibleElementProvider$$O = MetaAdapterFactory.getInterfaceConcept(0xd4280a54f6df4383L, 0xaa41d1b2bffa7eb1L, 0x6315bcc6eff580a3L, "com.mbeddr.core.base.structure.IVisibleElementProvider");
    /*package*/ static final SConcept DataLoggerDeclaration$5X = MetaAdapterFactory.getConcept(0x2693fc719b0e4b05L, 0xab13f57227d675f2L, 0x1567b4046d19f344L, "com.mbeddr.core.util.structure.DataLoggerDeclaration");
    /*package*/ static final SConcept UnsignedInt32tType$7z = MetaAdapterFactory.getConcept(0x61c69711ed614850L, 0x81d97714ff227fb0L, 0x75739ed9f39e3892L, "com.mbeddr.core.expressions.structure.UnsignedInt32tType");
    /*package*/ static final SConcept TracePoint$QV = MetaAdapterFactory.getConcept(0x2693fc719b0e4b05L, 0xab13f57227d675f2L, 0x1567b4046d1a91a8L, "com.mbeddr.core.util.structure.TracePoint");
    /*package*/ static final SConcept DataItem$xH = MetaAdapterFactory.getConcept(0x2693fc719b0e4b05L, 0xab13f57227d675f2L, 0x449df48f7ad4e2fcL, "com.mbeddr.core.util.structure.DataItem");
    /*package*/ static final SConcept Type$dP = MetaAdapterFactory.getConcept(0x61c69711ed614850L, 0x81d97714ff227fb0L, 0x7af69e2e83a1ba36L, "com.mbeddr.core.expressions.structure.Type");
    /*package*/ static final SConcept NumberLiteral$jK = MetaAdapterFactory.getConcept(0x61c69711ed614850L, 0x81d97714ff227fb0L, 0x7af69e2e83a1ba67L, "com.mbeddr.core.expressions.structure.NumberLiteral");
    /*package*/ static final SConcept ExpressionStatement$SU = MetaAdapterFactory.getConcept(0xa9d696470840491eL, 0xbf392eb0805d2011L, 0x64ae61a4018a8592L, "com.mbeddr.core.statements.structure.ExpressionStatement");
    /*package*/ static final SConcept GenericDotExpression$uQ = MetaAdapterFactory.getConcept(0x61c69711ed614850L, 0x81d97714ff227fb0L, 0x401df715da462c0cL, "com.mbeddr.core.expressions.structure.GenericDotExpression");
    /*package*/ static final SConcept DataLoggerRef$JQ = MetaAdapterFactory.getConcept(0x2693fc719b0e4b05L, 0xab13f57227d675f2L, 0x449df48f7b1e6175L, "com.mbeddr.core.util.structure.DataLoggerRef");
    /*package*/ static final SConcept GenericDLLogOp$yM = MetaAdapterFactory.getConcept(0x2693fc719b0e4b05L, 0xab13f57227d675f2L, 0x59d32c6e7c9920f1L, "com.mbeddr.core.util.structure.GenericDLLogOp");
    /*package*/ static final SConcept Expression$bT = MetaAdapterFactory.getConcept(0x61c69711ed614850L, 0x81d97714ff227fb0L, 0x7af69e2e83a1ba32L, "com.mbeddr.core.expressions.structure.Expression");
    /*package*/ static final SConcept GenericDLEnterTraceOp$3Q = MetaAdapterFactory.getConcept(0x2693fc719b0e4b05L, 0xab13f57227d675f2L, 0x7a23fdecbce1d04aL, "com.mbeddr.core.util.structure.GenericDLEnterTraceOp");
    /*package*/ static final SConcept GenericDLLeaveTraceOp$4e = MetaAdapterFactory.getConcept(0x2693fc719b0e4b05L, 0xab13f57227d675f2L, 0x7a23fdecbcf14fabL, "com.mbeddr.core.util.structure.GenericDLLeaveTraceOp");
  }

  private static final class LINKS {
    /*package*/ static final SContainmentLink tracepoints$yDim = MetaAdapterFactory.getContainmentLink(0x2693fc719b0e4b05L, 0xab13f57227d675f2L, 0x1567b4046d19f344L, 0x1567b4046d1a91abL, "tracepoints");
    /*package*/ static final SContainmentLink items$rLi7 = MetaAdapterFactory.getContainmentLink(0x2693fc719b0e4b05L, 0xab13f57227d675f2L, 0x1567b4046d19f344L, 0x449df48f7ad54a01L, "items");
    /*package*/ static final SContainmentLink contents$3Vmy = MetaAdapterFactory.getContainmentLink(0x6d11763d483d4b2bL, 0x8efc09336c1b0001L, 0x595522006a5b933dL, 0x595522006a5b9351L, "contents");
    /*package*/ static final SContainmentLink statements$euTV = MetaAdapterFactory.getContainmentLink(0xa9d696470840491eL, 0xbf392eb0805d2011L, 0x3a16e3a9c7ad9955L, 0x3a16e3a9c7ad9956L, "statements");
    /*package*/ static final SContainmentLink timeType$o5LC = MetaAdapterFactory.getContainmentLink(0x2693fc719b0e4b05L, 0xab13f57227d675f2L, 0x1567b4046d19f344L, 0xdad51b530538d9bL, "timeType");
    /*package*/ static final SContainmentLink type$sXU3 = MetaAdapterFactory.getContainmentLink(0x61c69711ed614850L, 0x81d97714ff227fb0L, 0x46a2a92ac61b183L, 0x46a2a92ac61b184L, "type");
    /*package*/ static final SContainmentLink initValue$4EyG = MetaAdapterFactory.getContainmentLink(0x2693fc719b0e4b05L, 0xab13f57227d675f2L, 0x449df48f7ad4e2fcL, 0x2d59c2f8a407991dL, "initValue");
    /*package*/ static final SContainmentLink expr$vamr = MetaAdapterFactory.getContainmentLink(0xa9d696470840491eL, 0xbf392eb0805d2011L, 0x64ae61a4018a8592L, 0x64ae61a4018a8593L, "expr");
    /*package*/ static final SContainmentLink expression$PfNq = MetaAdapterFactory.getContainmentLink(0x61c69711ed614850L, 0x81d97714ff227fb0L, 0x29b5b7c4a3763232L, 0x64ae61a4018a9c50L, "expression");
    /*package*/ static final SReferenceLink datalogger$bfY7 = MetaAdapterFactory.getReferenceLink(0x2693fc719b0e4b05L, 0xab13f57227d675f2L, 0x449df48f7b1e6175L, 0x449df48f7b1e6176L, "datalogger");
    /*package*/ static final SContainmentLink target$CEPF = MetaAdapterFactory.getContainmentLink(0x61c69711ed614850L, 0x81d97714ff227fb0L, 0x401df715da462c0cL, 0x619e8ce80b7ff48bL, "target");
    /*package*/ static final SReferenceLink item$3DF8 = MetaAdapterFactory.getReferenceLink(0x2693fc719b0e4b05L, 0xab13f57227d675f2L, 0x59d32c6e7c9920f1L, 0x59d32c6e7c9920f3L, "item");
    /*package*/ static final SContainmentLink value$3Ds7 = MetaAdapterFactory.getContainmentLink(0x2693fc719b0e4b05L, 0xab13f57227d675f2L, 0x59d32c6e7c9920f1L, 0x59d32c6e7c9920f2L, "value");
    /*package*/ static final SReferenceLink tracepoint$vPhN = MetaAdapterFactory.getReferenceLink(0x2693fc719b0e4b05L, 0xab13f57227d675f2L, 0x7a23fdecbce1d04aL, 0x7a23fdecbce1d04cL, "tracepoint");
    /*package*/ static final SReferenceLink tracepoint$CleM = MetaAdapterFactory.getReferenceLink(0x2693fc719b0e4b05L, 0xab13f57227d675f2L, 0x7a23fdecbcf14fabL, 0x7a23fdecbcf14facL, "tracepoint");
  }

  private static final class PROPS {
    /*package*/ static final SProperty name$MnvL = MetaAdapterFactory.getProperty(0xceab519525ea4f22L, 0x9b92103b95ca8c0cL, 0x110396eaaa4L, 0x110396ec041L, "name");
    /*package*/ static final SProperty tracepointStackSize$KQPd = MetaAdapterFactory.getProperty(0x2693fc719b0e4b05L, 0xab13f57227d675f2L, 0x1567b4046d19f344L, 0x1fb2c3c9bc21cdc7L, "tracepointStackSize");
    /*package*/ static final SProperty active$F8DW = MetaAdapterFactory.getProperty(0x2693fc719b0e4b05L, 0xab13f57227d675f2L, 0x449df48f7ad4e2fcL, 0x1c84074b5cef4609L, "active");
    /*package*/ static final SProperty size$vk_i = MetaAdapterFactory.getProperty(0x2693fc719b0e4b05L, 0xab13f57227d675f2L, 0x449df48f7ad4e2fcL, 0x449df48f7ad54941L, "size");
    /*package*/ static final SProperty value$qZmE = MetaAdapterFactory.getProperty(0x61c69711ed614850L, 0x81d97714ff227fb0L, 0x1eb611a68febd3e5L, 0x1eb611a68fec38b0L, "value");
  }
}

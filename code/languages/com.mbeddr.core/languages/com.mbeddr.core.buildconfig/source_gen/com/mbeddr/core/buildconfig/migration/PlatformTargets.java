package com.mbeddr.core.buildconfig.migration;

/*Generated by MPS */

import jetbrains.mps.lang.migration.runtime.base.MigrationScriptBase;
import org.jetbrains.mps.openapi.model.SNode;
import org.jetbrains.mps.openapi.module.SModule;
import org.jetbrains.mps.openapi.model.SModel;
import jetbrains.mps.internal.collections.runtime.ListSequence;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SModelOperations;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SLinkOperations;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SPropertyOperations;
import com.mbeddr.core.buildconfig.behavior.DesktopPlatformHelper;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SNodeOperations;
import jetbrains.mps.lang.migration.runtime.base.MigrationScriptReference;
import jetbrains.mps.smodel.adapter.structure.MetaAdapterFactory;
import org.jetbrains.mps.openapi.language.SContainmentLink;
import org.jetbrains.mps.openapi.language.SReferenceLink;
import org.jetbrains.mps.openapi.language.SProperty;
import org.jetbrains.mps.openapi.language.SConcept;

public class PlatformTargets extends MigrationScriptBase {
  private final String description = "PlatformTargets";
  public String getCaption() {
    return description;
  }
  @Override
  public boolean isRerunnable() {
    return false;
  }
  public SNode execute(final SModule m) {
    doExecute(m);
    return null;
  }
  public void doExecute(final SModule m) {
    for (SModel mdl : m.getModels()) {
      for (SNode platform : ListSequence.fromList(SModelOperations.nodes(mdl, CONCEPTS.DesktopPlatform$p7))) {
        if (!(ListSequence.fromList(SLinkOperations.getChildren(platform, LINKS.targets$$_dF)).any((it) -> SPropertyOperations.getString(it, PROPS.name$MnvL).equals(SPropertyOperations.getString(DesktopPlatformHelper.TARGET_WIN32, PROPS.name$MnvL))))) {
          ListSequence.fromList(SLinkOperations.getChildren(platform, LINKS.targets$$_dF)).addElement(SNodeOperations.copyNode(DesktopPlatformHelper.TARGET_WIN32));
        }

        if (!(ListSequence.fromList(SLinkOperations.getChildren(platform, LINKS.targets$$_dF)).any((it) -> SPropertyOperations.getString(it, PROPS.name$MnvL).equals(SPropertyOperations.getString(DesktopPlatformHelper.TARGET_MACOSX, PROPS.name$MnvL))))) {
          ListSequence.fromList(SLinkOperations.getChildren(platform, LINKS.targets$$_dF)).addElement(SNodeOperations.copyNode(DesktopPlatformHelper.TARGET_MACOSX));
        }

        if (!(ListSequence.fromList(SLinkOperations.getChildren(platform, LINKS.targets$$_dF)).any((it) -> SPropertyOperations.getString(it, PROPS.name$MnvL).equals(SPropertyOperations.getString(DesktopPlatformHelper.TARGET_LINUX, PROPS.name$MnvL))))) {
          ListSequence.fromList(SLinkOperations.getChildren(platform, LINKS.targets$$_dF)).addElement(SNodeOperations.copyNode(DesktopPlatformHelper.TARGET_LINUX));
        }

        if (!(ListSequence.fromList(SLinkOperations.getChildren(platform, LINKS.targets$$_dF)).any((it) -> SPropertyOperations.getString(it, PROPS.name$MnvL).equals(SPropertyOperations.getString(DesktopPlatformHelper.TARGET_PORTABLE, PROPS.name$MnvL))))) {
          ListSequence.fromList(SLinkOperations.getChildren(platform, LINKS.targets$$_dF)).addElement(SNodeOperations.copyNode(DesktopPlatformHelper.TARGET_PORTABLE));
        }

        for (SNode binary : ListSequence.fromList(SLinkOperations.getChildren(SNodeOperations.getNodeAncestor(platform, CONCEPTS.BuildConfiguration$kH, false, false), LINKS.binaries$R6lf))) {
          if ((SLinkOperations.getTarget(binary, LINKS.target_old$NKRN) == null)) {
            SLinkOperations.setTarget(binary, LINKS.target_old$NKRN, ListSequence.fromList(SLinkOperations.getChildren(SLinkOperations.getTarget(SNodeOperations.getNodeAncestor(binary, CONCEPTS.BuildConfiguration$kH, false, false), LINKS.platform$sQSW), LINKS.targets$$_dF)).where((it) -> SPropertyOperations.getString(it, PROPS.name$MnvL).equals(SPropertyOperations.getString(DesktopPlatformHelper.TARGET_PORTABLE, PROPS.name$MnvL))).first());
          }
        }
      }

      for (SNode platformReference : ListSequence.fromList(SModelOperations.nodes(mdl, CONCEPTS.PlatformReference$gD))) {
        if (SNodeOperations.isInstanceOf(SLinkOperations.getTarget(SLinkOperations.getTarget(platformReference, LINKS.template$Zbys), LINKS.template$CzrK), CONCEPTS.DesktopPlatform$p7) && !(ListSequence.fromList(SLinkOperations.getChildren(SLinkOperations.getTarget(SLinkOperations.getTarget(platformReference, LINKS.template$Zbys), LINKS.template$CzrK), LINKS.targets$$_dF)).any((it) -> SPropertyOperations.getString(it, PROPS.name$MnvL).equals(SPropertyOperations.getString(DesktopPlatformHelper.TARGET_WIN32, PROPS.name$MnvL))))) {
          ListSequence.fromList(SLinkOperations.getChildren(SLinkOperations.getTarget(SLinkOperations.getTarget(platformReference, LINKS.template$Zbys), LINKS.template$CzrK), LINKS.targets$$_dF)).addElement(SNodeOperations.copyNode(DesktopPlatformHelper.TARGET_WIN32));
        }

        if (!(SNodeOperations.isInstanceOf(SLinkOperations.getTarget(SLinkOperations.getTarget(platformReference, LINKS.template$Zbys), LINKS.template$CzrK), CONCEPTS.DesktopPlatform$p7)) && ListSequence.fromList(SLinkOperations.getChildren(SLinkOperations.getTarget(SLinkOperations.getTarget(platformReference, LINKS.template$Zbys), LINKS.template$CzrK), LINKS.targets$$_dF)).any((it) -> SPropertyOperations.getString(it, PROPS.name$MnvL).equals(SPropertyOperations.getString(DesktopPlatformHelper.TARGET_MACOSX, PROPS.name$MnvL)))) {
          ListSequence.fromList(SLinkOperations.getChildren(SLinkOperations.getTarget(SLinkOperations.getTarget(platformReference, LINKS.template$Zbys), LINKS.template$CzrK), LINKS.targets$$_dF)).addElement(SNodeOperations.copyNode(DesktopPlatformHelper.TARGET_MACOSX));
        }

        if (!(SNodeOperations.isInstanceOf(SLinkOperations.getTarget(SLinkOperations.getTarget(platformReference, LINKS.template$Zbys), LINKS.template$CzrK), CONCEPTS.DesktopPlatform$p7)) && ListSequence.fromList(SLinkOperations.getChildren(SLinkOperations.getTarget(SLinkOperations.getTarget(platformReference, LINKS.template$Zbys), LINKS.template$CzrK), LINKS.targets$$_dF)).any((it) -> SPropertyOperations.getString(it, PROPS.name$MnvL).equals(SPropertyOperations.getString(DesktopPlatformHelper.TARGET_LINUX, PROPS.name$MnvL)))) {
          ListSequence.fromList(SLinkOperations.getChildren(SLinkOperations.getTarget(SLinkOperations.getTarget(platformReference, LINKS.template$Zbys), LINKS.template$CzrK), LINKS.targets$$_dF)).addElement(SNodeOperations.copyNode(DesktopPlatformHelper.TARGET_LINUX));
        }

        if (!(SNodeOperations.isInstanceOf(SLinkOperations.getTarget(SLinkOperations.getTarget(platformReference, LINKS.template$Zbys), LINKS.template$CzrK), CONCEPTS.DesktopPlatform$p7)) && ListSequence.fromList(SLinkOperations.getChildren(SLinkOperations.getTarget(SLinkOperations.getTarget(platformReference, LINKS.template$Zbys), LINKS.template$CzrK), LINKS.targets$$_dF)).any((it) -> SPropertyOperations.getString(it, PROPS.name$MnvL).equals(SPropertyOperations.getString(DesktopPlatformHelper.TARGET_PORTABLE, PROPS.name$MnvL)))) {
          ListSequence.fromList(SLinkOperations.getChildren(SLinkOperations.getTarget(SLinkOperations.getTarget(platformReference, LINKS.template$Zbys), LINKS.template$CzrK), LINKS.targets$$_dF)).addElement(SNodeOperations.copyNode(DesktopPlatformHelper.TARGET_PORTABLE));
        }

        for (SNode binary : ListSequence.fromList(SLinkOperations.getChildren(SNodeOperations.getNodeAncestor(platformReference, CONCEPTS.BuildConfiguration$kH, false, false), LINKS.binaries$R6lf))) {
          if ((SLinkOperations.getTarget(binary, LINKS.target_old$NKRN) == null) && SNodeOperations.isInstanceOf(SLinkOperations.getTarget(SLinkOperations.getTarget(SNodeOperations.cast(SLinkOperations.getTarget(SNodeOperations.getNodeAncestor(binary, CONCEPTS.BuildConfiguration$kH, false, false), LINKS.platform$sQSW), CONCEPTS.PlatformReference$gD), LINKS.template$Zbys), LINKS.template$CzrK), CONCEPTS.DesktopPlatform$p7)) {
            SLinkOperations.setTarget(binary, LINKS.target_old$NKRN, ListSequence.fromList(SLinkOperations.getChildren(SLinkOperations.getTarget(SLinkOperations.getTarget(SNodeOperations.cast(SLinkOperations.getTarget(SNodeOperations.getNodeAncestor(binary, CONCEPTS.BuildConfiguration$kH, false, false), LINKS.platform$sQSW), CONCEPTS.PlatformReference$gD), LINKS.template$Zbys), LINKS.template$CzrK), LINKS.targets$$_dF)).where((it) -> SPropertyOperations.getString(it, PROPS.name$MnvL).equals(SPropertyOperations.getString(DesktopPlatformHelper.TARGET_PORTABLE, PROPS.name$MnvL))).first());
          }
        }
      }

    }
  }
  public MigrationScriptReference getReference() {
    return new MigrationScriptReference(MetaAdapterFactory.getLanguage(0x2d7fadf533f64e80L, 0xa78f0f739add2bdeL, "com.mbeddr.core.buildconfig"), 1);
  }

  private static final class LINKS {
    /*package*/ static final SContainmentLink targets$$_dF = MetaAdapterFactory.getContainmentLink(0x2d7fadf533f64e80L, 0xa78f0f739add2bdeL, 0x49e1b9dfef12762bL, 0x149d2320dec0c354L, "targets");
    /*package*/ static final SReferenceLink target_old$NKRN = MetaAdapterFactory.getReferenceLink(0x2d7fadf533f64e80L, 0xa78f0f739add2bdeL, 0x46097107c8d98c14L, 0x22c2a484fa022de6L, "target_old");
    /*package*/ static final SContainmentLink platform$sQSW = MetaAdapterFactory.getContainmentLink(0x2d7fadf533f64e80L, 0xa78f0f739add2bdeL, 0x6b1af9f9f43c2f48L, 0x49e1b9dfef127632L, "platform");
    /*package*/ static final SContainmentLink binaries$R6lf = MetaAdapterFactory.getContainmentLink(0x2d7fadf533f64e80L, 0xa78f0f739add2bdeL, 0x6b1af9f9f43c2f48L, 0x46097107c8de43cbL, "binaries");
    /*package*/ static final SReferenceLink template$Zbys = MetaAdapterFactory.getReferenceLink(0x2d7fadf533f64e80L, 0xa78f0f739add2bdeL, 0x7900826ed83da11eL, 0x7900826ed83da196L, "template");
    /*package*/ static final SContainmentLink template$CzrK = MetaAdapterFactory.getContainmentLink(0x2d7fadf533f64e80L, 0xa78f0f739add2bdeL, 0x7900826ed82c35ffL, 0x7900826ed82c363fL, "template");
  }

  private static final class PROPS {
    /*package*/ static final SProperty name$MnvL = MetaAdapterFactory.getProperty(0xceab519525ea4f22L, 0x9b92103b95ca8c0cL, 0x110396eaaa4L, 0x110396ec041L, "name");
  }

  private static final class CONCEPTS {
    /*package*/ static final SConcept BuildConfiguration$kH = MetaAdapterFactory.getConcept(0x2d7fadf533f64e80L, 0xa78f0f739add2bdeL, 0x6b1af9f9f43c2f48L, "com.mbeddr.core.buildconfig.structure.BuildConfiguration");
    /*package*/ static final SConcept DesktopPlatform$p7 = MetaAdapterFactory.getConcept(0x2d7fadf533f64e80L, 0xa78f0f739add2bdeL, 0x49e1b9dfef12762eL, "com.mbeddr.core.buildconfig.structure.DesktopPlatform");
    /*package*/ static final SConcept PlatformReference$gD = MetaAdapterFactory.getConcept(0x2d7fadf533f64e80L, 0xa78f0f739add2bdeL, 0x7900826ed83da11eL, "com.mbeddr.core.buildconfig.structure.PlatformReference");
  }
}

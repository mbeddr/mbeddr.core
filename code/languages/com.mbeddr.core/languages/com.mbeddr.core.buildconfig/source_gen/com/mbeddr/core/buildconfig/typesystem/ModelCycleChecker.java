package com.mbeddr.core.buildconfig.typesystem;

/*Generated by MPS */

import org.jetbrains.mps.openapi.model.SModel;
import java.util.Set;
import jetbrains.mps.internal.collections.runtime.SetSequence;
import java.util.HashSet;
import jetbrains.mps.smodel.ModelImports;
import org.jetbrains.mps.openapi.model.SModelReference;
import jetbrains.mps.internal.collections.runtime.Sequence;
import jetbrains.mps.smodel.MPSModuleRepository;

public class ModelCycleChecker {

  public static boolean hasCycle(SModel m) {
    Set<SModel> visitedModels = SetSequence.fromSet(new HashSet<SModel>());
    return hasCycle(new ModelImports(m).getImportedModels(), m, visitedModels);
  }

  private static boolean hasCycle(Iterable<SModelReference> imports, SModel modelToSearch, Set<SModel> visited) {
    for (SModelReference impModel : Sequence.fromIterable(imports)) {
      SModel imp = impModel.resolve(MPSModuleRepository.getInstance());
      if (modelToSearch == imp) {
        return true;
      }
      if (imp == null || SetSequence.fromSet(visited).contains(imp)) {
        continue;
      } else {
        SetSequence.fromSet(visited).addElement(imp);
      }
      if (hasCycle(new ModelImports(imp).getImportedModels(), modelToSearch, visited)) {
        return true;
      }
    }

    return false;
  }



}

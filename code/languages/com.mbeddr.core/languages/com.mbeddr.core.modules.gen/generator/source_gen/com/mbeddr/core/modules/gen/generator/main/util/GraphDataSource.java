package com.mbeddr.core.modules.gen.generator.main.util;

/*Generated by MPS */

import org.jetbrains.mps.openapi.model.SNode;
import com.mbeddr.mpsutil.common.graph.Graph;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SNodeOperations;
import java.util.Map;
import java.util.HashMap;
import jetbrains.mps.internal.collections.runtime.SetSequence;
import jetbrains.mps.lang.core.behavior.BaseConcept__BehaviorDescriptor;
import java.util.Collection;
import jetbrains.mps.internal.collections.runtime.CollectionSequence;
import org.jetbrains.mps.openapi.language.SInterfaceConcept;
import jetbrains.mps.smodel.adapter.structure.MetaAdapterFactory;

public class GraphDataSource<T extends SNode> extends Graph<T> {

  public GraphDataSource() {
    super();
  }

  @Override
  public void addEdge(T from, T to) {
    if (from != null && to != null && SNodeOperations.getContainingRoot(from) == SNodeOperations.getContainingRoot(to)) {
      super.addNode(from);
      super.addNode(to);
      super.addEdge(from, to);
    }
  }
  @Override
  public String toString() {
    StringBuilder builder = new StringBuilder();
    Map<T, String> idMap = new HashMap<T, String>();
    int id = 1;
    builder.append("digraph dependencies {\n");

    for (T node : SetSequence.fromSet(this.getAllNodes())) {
      idMap.put(node, "n" + id++);
      builder.append(idMap.get(node) + " [label=\"presentation: " + BaseConcept__BehaviorDescriptor.getPresentation_idhEwIMiw.invoke(SNodeOperations.cast(node, CONCEPTS.IModuleContent$H1)) + " concept: " + SNodeOperations.getConcept(node) + "\"];\n");
    }

    for (T source : SetSequence.fromSet(this.getAllNodes())) {
      Collection<T> targets = this.getTargets(source);
      if (targets != null) {
        for (T target : CollectionSequence.fromCollection(targets)) {
          builder.append(idMap.get(source) + " -> " + idMap.get(target) + ";\n");
        }
      }
    }

    builder.append("}");
    return builder.toString();
  }

  private static final class CONCEPTS {
    /*package*/ static final SInterfaceConcept IModuleContent$H1 = MetaAdapterFactory.getInterfaceConcept(0x6d11763d483d4b2bL, 0x8efc09336c1b0001L, 0x595522006a5b934fL, "com.mbeddr.core.modules.structure.IModuleContent");
  }
}

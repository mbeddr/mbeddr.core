package com.mbeddr.core.modules.gen.behavior;

/*Generated by MPS */

import jetbrains.mps.core.aspects.behaviour.BaseBHDescriptor;
import jetbrains.mps.logging.Logger;
import org.jetbrains.mps.openapi.language.SAbstractConcept;
import jetbrains.mps.smodel.adapter.structure.MetaAdapterFactory;
import jetbrains.mps.core.aspects.behaviour.api.SMethod;
import jetbrains.mps.core.aspects.behaviour.SMethodBuilder;
import jetbrains.mps.core.aspects.behaviour.SJavaCompoundTypeImpl;
import jetbrains.mps.core.aspects.behaviour.AccessPrivileges;
import java.util.List;
import java.util.Arrays;
import org.jetbrains.annotations.NotNull;
import org.jetbrains.mps.openapi.model.SNode;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SPropertyOperations;
import com.mbeddr.core.modules.behavior.IModuleContentContainer__BehaviorDescriptor;
import java.nio.file.Files;
import java.nio.file.Paths;
import java.io.IOException;
import java.util.Calendar;
import java.util.regex.Matcher;
import java.util.regex.Pattern;
import java.util.Objects;
import jetbrains.mps.core.aspects.behaviour.api.SConstructor;
import org.jetbrains.annotations.Nullable;
import jetbrains.mps.core.aspects.behaviour.api.BHMethodNotFoundException;
import org.jetbrains.mps.openapi.language.SProperty;

public final class AbstractGenModule__BehaviorDescriptor extends BaseBHDescriptor {
  private static final Logger LOG = Logger.getLogger(AbstractGenModule__BehaviorDescriptor.class);
  private static final SAbstractConcept CONCEPT = MetaAdapterFactory.getConcept(0x62296a07bc3846d2L, 0x8034198c24063588L, 0x6492560dd5e536beL, "com.mbeddr.core.modules.gen.structure.AbstractGenModule");

  public static final SMethod<Boolean> canMangleNames_id4J$Pz4XGFls = new SMethodBuilder<Boolean>(new SJavaCompoundTypeImpl(Boolean.TYPE)).name("canMangleNames").modifiers(8, AccessPrivileges.PUBLIC).concept(CONCEPT).baseMethodId(5468731354511488348L).languageId(0x8efc09336c1b0001L, 0x6d11763d483d4b2bL).build2();
  public static final SMethod<String> genName_id7Aba6Bzz6b$ = new SMethodBuilder<String>(new SJavaCompoundTypeImpl(String.class)).name("genName").modifiers(8, AccessPrivileges.PUBLIC).concept(CONCEPT).baseMethodId(8758138335606366948L).languageId(0x8034198c24063588L, 0x62296a07bc3846d2L).build2();
  public static final SMethod<String> readCopyrightNotice_id6TPUpoFAGOQ = new SMethodBuilder<String>(new SJavaCompoundTypeImpl(String.class)).name("readCopyrightNotice").modifiers(0, AccessPrivileges.PUBLIC).concept(CONCEPT).baseMethodId(7959524747633151286L).languageId(0x8034198c24063588L, 0x62296a07bc3846d2L).build2();
  public static final SMethod<String> updateLastCopyrightYear_id6TPUpoGqTDH = new SMethodBuilder<String>(new SJavaCompoundTypeImpl(String.class)).name("updateLastCopyrightYear").modifiers(0, AccessPrivileges.PUBLIC).concept(CONCEPT).baseMethodId(7959524747646835309L).languageId(0x8034198c24063588L, 0x62296a07bc3846d2L).build2(SMethodBuilder.createJavaParameter(String.class, ""));

  private static final List<SMethod<?>> BH_METHODS = Arrays.<SMethod<?>>asList(canMangleNames_id4J$Pz4XGFls, genName_id7Aba6Bzz6b$, readCopyrightNotice_id6TPUpoFAGOQ, updateLastCopyrightYear_id6TPUpoGqTDH);

  private static void ___init___(@NotNull SNode __thisNode__) {
  }

  /*package*/ static boolean canMangleNames_id4J$Pz4XGFls(@NotNull SNode __thisNode__) {
    return SPropertyOperations.getBoolean(__thisNode__, PROPS.canMangleNames$zaJA);
  }
  /*package*/ static String genName_id7Aba6Bzz6b$(@NotNull SNode __thisNode__) {
    return ((String) IModuleContentContainer__BehaviorDescriptor.getMangledModuleName_id7Aba6ByEk1p.invoke(__thisNode__));
  }
  /*package*/ static String readCopyrightNotice_id6TPUpoFAGOQ(@NotNull SNode __thisNode__) {
    String errorMsg = "Failed to read copyright notice: ";
    try {
      if (isNotEmptyString(SPropertyOperations.getString(__thisNode__, PROPS.copyrightNoticePath$y0oA))) {
        String copyrightNotice = new String(Files.readAllBytes(Paths.get(SPropertyOperations.getString(__thisNode__, PROPS.copyrightNoticePath$y0oA))));
        return AbstractGenModule__BehaviorDescriptor.updateLastCopyrightYear_id6TPUpoGqTDH.invoke(__thisNode__, copyrightNotice);
      } else {
        errorMsg += "Copyright notice path missing";
      }
    } catch (IOException ex) {
      if (LOG.isErrorLevel()) {
        LOG.error(errorMsg, ex);
      }
      errorMsg += ex.getMessage();
    }
    return "/*\n * " + errorMsg + "\n */";
  }
  /*package*/ static String updateLastCopyrightYear_id6TPUpoGqTDH(@NotNull SNode __thisNode__, String copyrightNotice) {
    int currentYear = Calendar.getInstance().get(Calendar.YEAR);

    // Copyright (C) 2006-2015  ->   Copyright (C) 2006-2020
    Matcher longCopyrightMatcher = Pattern.compile("(Copyright\\s+\\(C\\)\\s+\\d{4}-)\\d{4}").matcher(copyrightNotice);
    if (longCopyrightMatcher.find()) {
      return longCopyrightMatcher.replaceFirst("$1" + currentYear);
    }

    // Copyright (C) 2006   ->   Copyright (C) 2006-2020
    Matcher shortCopyrightMatcher = Pattern.compile("(Copyright\\s+\\(C\\)\\s+)(\\d{4})").matcher(copyrightNotice);
    if (shortCopyrightMatcher.find()) {
      if (!(Objects.equals(shortCopyrightMatcher.group(2), Integer.toString(currentYear)))) {
        return shortCopyrightMatcher.replaceFirst("$1$2-" + currentYear);
      }
    }

    return copyrightNotice;
  }

  /*package*/ AbstractGenModule__BehaviorDescriptor() {
  }

  @Override
  protected void initNode(@NotNull SNode node, @NotNull SConstructor constructor, @Nullable Object[] parameters) {
    ___init___(node);
  }

  @Override
  protected <T> T invokeSpecial0(@NotNull SNode node, @NotNull SMethod<T> method, @Nullable Object[] parameters) {
    int methodIndex = BH_METHODS.indexOf(method);
    if (methodIndex < 0) {
      throw new BHMethodNotFoundException(this, method);
    }
    switch (methodIndex) {
      case 0:
        return (T) ((Boolean) canMangleNames_id4J$Pz4XGFls(node));
      case 1:
        return (T) ((String) genName_id7Aba6Bzz6b$(node));
      case 2:
        return (T) ((String) readCopyrightNotice_id6TPUpoFAGOQ(node));
      case 3:
        return (T) ((String) updateLastCopyrightYear_id6TPUpoGqTDH(node, (String) parameters[0]));
      default:
        throw new BHMethodNotFoundException(this, method);
    }
  }

  @Override
  protected <T> T invokeSpecial0(@NotNull SAbstractConcept concept, @NotNull SMethod<T> method, @Nullable Object[] parameters) {
    int methodIndex = BH_METHODS.indexOf(method);
    if (methodIndex < 0) {
      throw new BHMethodNotFoundException(this, method);
    }
    switch (methodIndex) {
      default:
        throw new BHMethodNotFoundException(this, method);
    }
  }

  @NotNull
  @Override
  public List<SMethod<?>> getDeclaredMethods() {
    return BH_METHODS;
  }

  @NotNull
  @Override
  public SAbstractConcept getConcept() {
    return CONCEPT;
  }
  private static boolean isNotEmptyString(String str) {
    return str != null && str.length() > 0;
  }

  private static final class PROPS {
    /*package*/ static final SProperty canMangleNames$zaJA = MetaAdapterFactory.getProperty(0x62296a07bc3846d2L, 0x8034198c24063588L, 0x6492560dd5e536beL, 0x268d85d4dace2fd8L, "canMangleNames");
    /*package*/ static final SProperty copyrightNoticePath$y0oA = MetaAdapterFactory.getProperty(0x62296a07bc3846d2L, 0x8034198c24063588L, 0x6492560dd5e536beL, 0x6e75e9962b82b6eeL, "copyrightNoticePath");
  }
}

package com.mbeddr.core.modules.gen.behavior;

/*Generated by MPS */

import java.util.WeakHashMap;
import org.jetbrains.mps.openapi.model.SNode;
import java.util.Map;
import java.util.List;
import jetbrains.mps.internal.collections.runtime.MapSequence;
import java.util.HashMap;
import java.util.ArrayList;
import jetbrains.mps.internal.collections.runtime.ListSequence;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SLinkOperations;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SNodeOperations;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SPropertyOperations;
import jetbrains.mps.internal.collections.runtime.Sequence;
import org.jetbrains.mps.openapi.language.SContainmentLink;
import jetbrains.mps.smodel.adapter.structure.MetaAdapterFactory;
import org.jetbrains.mps.openapi.language.SReferenceLink;
import org.jetbrains.mps.openapi.language.SProperty;
import org.jetbrains.mps.openapi.language.SConcept;

public class ExportedContentsOfTypeCacheHelper {
  private static WeakHashMap<SNode, Map<SNode, List<SNode>>> provider2concept2Content = new WeakHashMap<SNode, Map<SNode, List<SNode>>>();
  public ExportedContentsOfTypeCacheHelper() {
  }
  public static List<SNode> exportedContentsOfTypeForGenModuleH(SNode provider, final SNode concept, List<SNode> alreadyTraversedModules) {
    Map<SNode, List<SNode>> concept2Content = MapSequence.fromMap(provider2concept2Content).get(provider);
    if (concept2Content == null) {
      concept2Content = MapSequence.fromMap(new HashMap<SNode, List<SNode>>());
      MapSequence.fromMap(provider2concept2Content).put(provider, concept2Content);
    }
    List<SNode> result = MapSequence.fromMap(concept2Content).get(concept);

    // TODO chache disables due to https://github.com/mbeddr/mbeddr.core/issues/791
    result = null;

    if (result == null) {
      result = new ArrayList<SNode>();
      ListSequence.fromList(result).addSequence(ListSequence.fromList(SLinkOperations.getChildren(provider, LINKS.contents$F2O3)).where((it) -> SNodeOperations.isInstanceOf(it, SNodeOperations.asSConcept(SNodeOperations.asSConcept(concept)))));
      for (SNode i : ListSequence.fromList(SLinkOperations.getChildren(provider, LINKS.headerImports$M5SR)).where((it) -> SNodeOperations.isInstanceOf(it, CONCEPTS.GenExtModuleImport$qk)).select((it) -> SNodeOperations.cast(it, CONCEPTS.GenExtModuleImport$qk))) {
        ListSequence.fromList(result).addSequence(ListSequence.fromList(SLinkOperations.getChildren(SLinkOperations.getTarget(i, LINKS.moduleExt$uG3), LINKS.contents$5Qf$)).where((it) -> SNodeOperations.isInstanceOf(it, SNodeOperations.asSConcept(SNodeOperations.asSConcept(concept))) && SPropertyOperations.getBoolean(it, PROPS.exported$V4am)));
      }
      for (SNode i : ListSequence.fromList(SLinkOperations.getChildren(provider, LINKS.headerImports$M5SR)).where((it) -> SNodeOperations.isInstanceOf(it, CONCEPTS.GenImplModuleImport$Rp)).select((it) -> SNodeOperations.cast(it, CONCEPTS.GenImplModuleImport$Rp))) {
        SNode module = SLinkOperations.getTarget(i, LINKS.module$ddez);
        if (!(ListSequence.fromList(alreadyTraversedModules).contains(module))) {
          ListSequence.fromList(alreadyTraversedModules).addElement(module);
          ListSequence.fromList(result).addSequence(Sequence.fromIterable(GenModuleH__BehaviorDescriptor.exportedContentsOfType_id5aaBiRoycuf.invoke(module, concept, alreadyTraversedModules)));
        }
      }

      MapSequence.fromMap(concept2Content).put(concept, result);


    }


    return result;

  }

  private static final class LINKS {
    /*package*/ static final SContainmentLink contents$F2O3 = MetaAdapterFactory.getContainmentLink(0x62296a07bc3846d2L, 0x8034198c24063588L, 0x1865bdb749ca065eL, 0x1865bdb749ca065fL, "contents");
    /*package*/ static final SReferenceLink moduleExt$uG3 = MetaAdapterFactory.getReferenceLink(0x62296a07bc3846d2L, 0x8034198c24063588L, 0x7dd23a0da554ace5L, 0x7dd23a0da554ace6L, "moduleExt");
    /*package*/ static final SContainmentLink contents$5Qf$ = MetaAdapterFactory.getContainmentLink(0x62296a07bc3846d2L, 0x8034198c24063588L, 0x7dd23a0da5533172L, 0x7dd23a0da5533174L, "contents");
    /*package*/ static final SContainmentLink headerImports$M5SR = MetaAdapterFactory.getContainmentLink(0x62296a07bc3846d2L, 0x8034198c24063588L, 0x1865bdb749ca065eL, 0x4d4a3140e3d18b26L, "headerImports");
    /*package*/ static final SReferenceLink module$ddez = MetaAdapterFactory.getReferenceLink(0x62296a07bc3846d2L, 0x8034198c24063588L, 0x124a1a47a699cb26L, 0x124a1a47a699cb27L, "module");
  }

  private static final class PROPS {
    /*package*/ static final SProperty exported$V4am = MetaAdapterFactory.getProperty(0x6d11763d483d4b2bL, 0x8efc09336c1b0001L, 0x595522006a5b934fL, 0x124a1a47a69807f0L, "exported");
  }

  private static final class CONCEPTS {
    /*package*/ static final SConcept GenExtModuleImport$qk = MetaAdapterFactory.getConcept(0x62296a07bc3846d2L, 0x8034198c24063588L, 0x7dd23a0da554ace5L, "com.mbeddr.core.modules.gen.structure.GenExtModuleImport");
    /*package*/ static final SConcept GenImplModuleImport$Rp = MetaAdapterFactory.getConcept(0x62296a07bc3846d2L, 0x8034198c24063588L, 0x124a1a47a699cb26L, "com.mbeddr.core.modules.gen.structure.GenImplModuleImport");
  }
}

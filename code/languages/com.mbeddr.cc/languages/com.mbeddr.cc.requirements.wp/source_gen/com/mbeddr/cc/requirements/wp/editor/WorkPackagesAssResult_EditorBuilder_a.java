package com.mbeddr.cc.requirements.wp.editor;

/*Generated by MPS */

import jetbrains.mps.editor.runtime.descriptor.AbstractEditorBuilder;
import org.jetbrains.annotations.NotNull;
import org.jetbrains.mps.openapi.model.SNode;
import jetbrains.mps.openapi.editor.EditorContext;
import jetbrains.mps.openapi.editor.cells.EditorCell;
import jetbrains.mps.nodeEditor.cells.EditorCell_Collection;
import jetbrains.mps.nodeEditor.cellLayout.CellLayout_Vertical;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SPropertyOperations;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SNodeOperations;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SLinkOperations;
import com.mbeddr.mpsutil.editor.querylist.runtime.QueryListHandler;
import com.mbeddr.mpsutil.editor.querylist.runtime.EditorCell_QueryList;
import jetbrains.mps.nodeEditor.cellLayout.CellLayout_Horizontal;
import org.jetbrains.mps.openapi.language.SConceptFeature;
import jetbrains.mps.nodeEditor.cellProviders.AbstractCellListHandler;
import jetbrains.mps.openapi.editor.cells.CellActionType;
import jetbrains.mps.nodeEditor.cellActions.CellAction_DeleteNode;
import java.util.List;
import java.util.ArrayList;
import jetbrains.mps.internal.collections.runtime.ListSequence;
import jetbrains.mps.internal.collections.runtime.Sequence;
import jetbrains.mps.openapi.editor.cells.SubstituteInfo;
import com.mbeddr.mpsutil.editor.querylist.runtime.SubstituteInfoFactory;
import jetbrains.mps.openapi.editor.menus.transformation.SNodeLocation;
import jetbrains.mps.openapi.editor.style.Style;
import jetbrains.mps.editor.runtime.style.StyleImpl;
import jetbrains.mps.editor.runtime.style.StyleAttributes;
import jetbrains.mps.nodeEditor.cellLayout.CellLayout_Indent;
import jetbrains.mps.nodeEditor.cells.EditorCell_Constant;
import jetbrains.mps.nodeEditor.MPSColors;
import jetbrains.mps.nodeEditor.cells.EditorCell_Property;
import jetbrains.mps.nodeEditor.cells.ModelAccessor;
import jetbrains.mps.editor.runtime.cells.EmptyCellAction;
import jetbrains.mps.nodeEditor.EditorManager;
import org.jetbrains.mps.openapi.language.SConcept;
import jetbrains.mps.smodel.adapter.structure.MetaAdapterFactory;
import org.jetbrains.mps.openapi.language.SContainmentLink;
import org.jetbrains.mps.openapi.language.SReferenceLink;
import org.jetbrains.mps.openapi.language.SProperty;

/*package*/ class WorkPackagesAssResult_EditorBuilder_a extends AbstractEditorBuilder {
  @NotNull
  private SNode myNode;

  public WorkPackagesAssResult_EditorBuilder_a(@NotNull EditorContext context, @NotNull SNode node) {
    super(context);
    myNode = node;
  }

  @NotNull
  @Override
  public SNode getNode() {
    return myNode;
  }

  /*package*/ EditorCell createCell() {
    return createCollection_0();
  }

  private EditorCell createCollection_0() {
    EditorCell_Collection editorCell = new EditorCell_Collection(getEditorContext(), myNode, new CellLayout_Vertical());
    editorCell.setCellId("Collection_uwl5y_a");
    editorCell.setBig(true);
    setCellContext(editorCell);
    if (nodeCondition_uwl5y_a0a()) {
      editorCell.addEditorCell(createQueryList_1());
    }
    return editorCell;
  }
  private boolean nodeCondition_uwl5y_a0a() {
    return SPropertyOperations.getBoolean(SNodeOperations.cast(SLinkOperations.getTarget(SNodeOperations.getNodeAncestor(myNode, CONCEPTS.Assessment$UY, false, false), LINKS.query$gGFe), CONCEPTS.WorkPackagesAssQuery$lg), PROPS.editable$MpOZ);
  }
  private EditorCell createQueryList_0(final EditorContext editorContext, final SNode node) {

    QueryListHandler handler = new QueryListHandler_uwl5y_a0(editorContext, node, false);
    EditorCell_QueryList editorCell = handler.createCells(new CellLayout_Horizontal());
    editorCell.setTargeConcept(CONCEPTS.WorkPackage$eW);
    editorCell.setOwner(SNodeOperations.getConcept(node));
    editorCell.setCellId("QueryList_uwl5y_a0");
    return editorCell;

  }
  private EditorCell createQueryList_1() {
    return createQueryList_0(getEditorContext(), myNode);
  }
  private static class QueryListHandler_uwl5y_a0 extends QueryListHandler {
    /**
     * allows node access in the query with ConceptFunctionParameter_node
     */
    private SNode myNode;
    public QueryListHandler_uwl5y_a0(EditorContext context, SNode ownerNode, boolean readOnly) {
      super(context, ownerNode, readOnly);
      myNode = ownerNode;
    }
    @NotNull
    @Override
    public SNode getNode() {
      return myNode;
    }
    public String getElementRole() {
      return null;
    }
    public SConceptFeature getElementSRole() {
      return null;
    }
    public EditorCell createNodeCell(SNode elementNode) {
      EditorCell elementCell = super.createNodeCell(elementNode);
      this.installElementCellActions(getNode(), elementNode, elementCell, getEditorContext());
      return elementCell;
    }
    @Override
    public EditorCell createEmptyCell() {
      EditorCell emptyCell = null;
      emptyCell = super.createEmptyCell();
      this.installElementCellActions(getNode(), null, emptyCell, getEditorContext());
      return postProcessEmptyCell(emptyCell);
    }
    public void installElementCellActions(SNode listOwner, SNode elementNode, EditorCell elementCell, EditorContext editorContext) {
      if (elementCell.getUserObject(AbstractCellListHandler.ELEMENT_CELL_ACTIONS_SET) == null) {
        elementCell.putUserObject(AbstractCellListHandler.ELEMENT_CELL_ACTIONS_SET, AbstractCellListHandler.ELEMENT_CELL_ACTIONS_SET);
        if (elementNode != null) {

          elementCell.setAction(CellActionType.DELETE, new CellAction_DeleteNode(elementNode));
          elementCell.setAction(CellActionType.BACKSPACE, new CellAction_DeleteNode(elementNode));


        }
        if (elementCell.getSubstituteInfo() == null) {
          elementCell.setSubstituteInfo(getSubstituteInfo(elementNode));
        }
      }
    }
    private Object executeQuery(final SNode node, final EditorContext editorContext) {
      List<SNode> res = new ArrayList<SNode>();
      ListSequence.fromList(res).addElement(SLinkOperations.getTarget(myNode, LINKS.wp$eCO9));
      return res;
    }
    @Override
    public Iterable<SNode> getNodesForList(final SNode node) {
      Object queryResult = executeQuery(node, getEditorContext());
      if (queryResult instanceof Iterable) {
        return (Iterable<SNode>) queryResult;
      } else {
        return Sequence.<SNode>singleton((SNode) queryResult);
      }
    }
    @Override
    public SubstituteInfo getSubstituteInfo(final SNode node, final SNode childNode, final SubstituteInfoFactory factory, final EditorContext editorContext) {
      return factory.forChild(childNode);
    }
    @Override
    public void insertNewNode(final SNode node, final SNode anchorNode, final boolean insertBefore, final EditorContext editorContext) {
    }
    @Override
    public void deleteNode(final SNode node, final SNode nodeToDelete, final EditorContext editorContext) {
    }
    @Override
    protected EditorCell createNodeCellNotNull(final EditorContext context, @NotNull final SNode node) {
      EditorCell cell;
      getCellFactory().pushCellContext();
      try {
        getCellFactory().setNodeLocation(new SNodeLocation.FromNode(node));
        {
          Inline_Builder0 provider = new Inline_Builder0(context, myNode, node);
          cell = provider.createCell();
        }
      } finally {
        getCellFactory().popCellContext();
      }
      return cell;
    }

    private jetbrains.mps.openapi.editor.cells.EditorCell_Collection wrapWithCollection(EditorCell cell) {
      jetbrains.mps.openapi.editor.cells.EditorCell_Collection collection = EditorCell_Collection.createIndent2(getEditorContext(), getNode());
      collection.addEditorCell(cell);
      return collection;
    }

  }
  /*package*/ static class Inline_Builder0 extends AbstractEditorBuilder {
    @NotNull
    private SNode myNode;
    private SNode myReferencingNode;

    /*package*/ Inline_Builder0(@NotNull EditorContext context, SNode referencingNode, @NotNull SNode node) {
      super(context);
      myReferencingNode = referencingNode;
      myNode = node;
    }

    /*package*/ EditorCell createCell() {
      return createCollection_1();
    }

    @NotNull
    @Override
    public SNode getNode() {
      return myNode;
    }

    private EditorCell createCollection_1() {
      EditorCell_Collection editorCell = new EditorCell_Collection(getEditorContext(), myNode, new CellLayout_Vertical());
      editorCell.setCellId("Collection_uwl5y_a0a0");
      Style style = new StyleImpl();
      style.set(StyleAttributes.SELECTABLE, false);
      editorCell.getStyle().putAll(style);
      editorCell.addEditorCell(createCollection_2());
      editorCell.addEditorCell(createDefaultEditor_1());
      editorCell.addEditorCell(createConstant_1());
      return editorCell;
    }
    private EditorCell createCollection_2() {
      EditorCell_Collection editorCell = new EditorCell_Collection(getEditorContext(), myNode, new CellLayout_Indent());
      editorCell.setCellId("Collection_uwl5y_a0a0a");
      editorCell.addEditorCell(createConstant_0());
      editorCell.addEditorCell(createReadOnlyModelAccessor_0());
      return editorCell;
    }
    private EditorCell createConstant_0() {
      EditorCell_Constant editorCell = new EditorCell_Constant(getEditorContext(), myNode, "in requirement:");
      editorCell.setCellId("Constant_uwl5y_a0a0a0");
      Style style = new StyleImpl();
      style.set(StyleAttributes.TEXT_COLOR, getStyleRegistry().getSimpleColor(MPSColors.gray));
      editorCell.getStyle().putAll(style);
      editorCell.setDefaultText("");
      return editorCell;
    }
    private EditorCell createReadOnlyModelAccessor_0() {
      EditorCell_Property editorCell = EditorCell_Property.create(getEditorContext(), new ModelAccessor.ReadOnly() {
        public String getText() {
          return SPropertyOperations.getString(SNodeOperations.cast(SNodeOperations.getParent(myNode), CONCEPTS.Requirement$sS), PROPS.name$MnvL);
        }
      }, myNode);
      editorCell.setAction(CellActionType.DELETE, EmptyCellAction.getInstance());
      editorCell.setAction(CellActionType.BACKSPACE, EmptyCellAction.getInstance());
      editorCell.setCellId("ReadOnlyModelAccessor_uwl5y_b0a0a0");
      Style style = new StyleImpl();
      style.set(StyleAttributes.TEXT_COLOR, getStyleRegistry().getSimpleColor(MPSColors.gray));
      style.set(StyleAttributes.NAVIGATABLE_NODE, _StyleParameter_QueryFunction_uwl5y_a1b0a0a0());
      style.set(StyleAttributes.EDITABLE, false);
      editorCell.getStyle().putAll(style);
      return editorCell;
    }
    private SNode _StyleParameter_QueryFunction_uwl5y_a1b0a0a0() {
      return SNodeOperations.cast(SNodeOperations.getParent(getNode()), CONCEPTS.Requirement$sS);
    }
    private EditorCell createDefaultEditor_0(EditorContext editorContext, SNode node) {
      EditorManager manager = EditorManager.getInstanceFromContext(editorContext);
      jetbrains.mps.openapi.editor.cells.EditorCell_Collection editorCell = EditorCell_Collection.createIndent2(editorContext, node);
      EditorCell defaultCell = getCellFactory().createEditorCell(node, editorContext.isInspector());
      editorContext.getEditorComponent().getUpdater().getCurrentUpdateSession().registerAsBigCell(defaultCell);
      editorCell.addEditorCell(defaultCell);
      editorCell.setCellId("DefaultEditor_uwl5y_b0a0a");
      return editorCell;
    }
    private EditorCell createDefaultEditor_1() {
      return createDefaultEditor_0(getEditorContext(), myNode);
    }
    private EditorCell createConstant_1() {
      EditorCell_Constant editorCell = new EditorCell_Constant(getEditorContext(), myNode, "");
      editorCell.setCellId("Constant_uwl5y_c0a0a");
      editorCell.setDefaultText("");
      return editorCell;
    }
  }

  private static final class CONCEPTS {
    /*package*/ static final SConcept Assessment$UY = MetaAdapterFactory.getConcept(0xd4280a54f6df4383L, 0xaa41d1b2bffa7eb1L, 0xc022423d5828abcL, "com.mbeddr.core.base.structure.Assessment");
    /*package*/ static final SConcept WorkPackagesAssQuery$lg = MetaAdapterFactory.getConcept(0xe530d4cbefad4822L, 0x92f81d114f03f836L, 0x772d5405a23c3b73L, "com.mbeddr.cc.requirements.wp.structure.WorkPackagesAssQuery");
    /*package*/ static final SConcept WorkPackage$eW = MetaAdapterFactory.getConcept(0xe530d4cbefad4822L, 0x92f81d114f03f836L, 0x772d5405a23bd0a0L, "com.mbeddr.cc.requirements.wp.structure.WorkPackage");
    /*package*/ static final SConcept Requirement$sS = MetaAdapterFactory.getConcept(0xe865cad27cc8437aL, 0x951a665bcbcb8b1aL, 0x795de87bb67288a5L, "com.mbeddr.cc.requirements.structure.Requirement");
  }

  private static final class LINKS {
    /*package*/ static final SContainmentLink query$gGFe = MetaAdapterFactory.getContainmentLink(0xd4280a54f6df4383L, 0xaa41d1b2bffa7eb1L, 0xc022423d5828abcL, 0xc022423d582911dL, "query");
    /*package*/ static final SReferenceLink wp$eCO9 = MetaAdapterFactory.getReferenceLink(0xe530d4cbefad4822L, 0x92f81d114f03f836L, 0x772d5405a23c3b8bL, 0x772d5405a23c3b92L, "wp");
  }

  private static final class PROPS {
    /*package*/ static final SProperty editable$MpOZ = MetaAdapterFactory.getProperty(0xe530d4cbefad4822L, 0x92f81d114f03f836L, 0x772d5405a23c3b73L, 0x49e86e3d6e953ffbL, "editable");
    /*package*/ static final SProperty name$MnvL = MetaAdapterFactory.getProperty(0xceab519525ea4f22L, 0x9b92103b95ca8c0cL, 0x110396eaaa4L, 0x110396ec041L, "name");
  }
}

package com.mbeddr.cc.var.composition.c.behavior;

/*Generated by MPS */

import jetbrains.mps.core.aspects.behaviour.BaseBHDescriptor;
import org.jetbrains.mps.openapi.language.SAbstractConcept;
import jetbrains.mps.smodel.adapter.structure.MetaAdapterFactory;
import jetbrains.mps.core.aspects.behaviour.api.SMethod;
import com.mbeddr.cc.var.composition.behavior.CompositionResult;
import jetbrains.mps.core.aspects.behaviour.SMethodBuilder;
import jetbrains.mps.core.aspects.behaviour.SJavaCompoundTypeImpl;
import jetbrains.mps.core.aspects.behaviour.AccessPrivileges;
import org.jetbrains.mps.openapi.model.SNode;
import com.mbeddr.cc.var.composition.behavior.CompositionContext;
import java.util.List;
import java.util.Arrays;
import org.jetbrains.annotations.NotNull;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SNodeOperations;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SLinkOperations;
import jetbrains.mps.internal.collections.runtime.ListSequence;
import com.mbeddr.cc.var.composition.behavior.CompositionResultSuccess;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.IAttributeDescriptor;
import jetbrains.mps.internal.collections.runtime.Sequence;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SPropertyOperations;
import com.mbeddr.cc.var.composition.behavior.CompositionResultFail;
import jetbrains.mps.core.aspects.behaviour.api.SConstructor;
import org.jetbrains.annotations.Nullable;
import jetbrains.mps.core.aspects.behaviour.api.BHMethodNotFoundException;
import org.jetbrains.mps.openapi.language.SConcept;
import org.jetbrains.mps.openapi.language.SContainmentLink;
import org.jetbrains.mps.openapi.language.SProperty;

public final class FunctionStatementMerger__BehaviorDescriptor extends BaseBHDescriptor {
  private static final SAbstractConcept CONCEPT = MetaAdapterFactory.getConcept(0x3f78d943f334789L, 0xad355950b32fdad8L, 0x59e482034f2d904cL, "com.mbeddr.cc.var.composition.c.structure.FunctionStatementMerger");

  public static final SMethod<CompositionResult> compose_id3YyHFqO7EVE = new SMethodBuilder<CompositionResult>(new SJavaCompoundTypeImpl(CompositionResult.class)).name("compose").modifiers(8, AccessPrivileges.PUBLIC).concept(CONCEPT).baseMethodId(4585428266438799082L).languageId(0xaaec94e43bb86519L, 0x21ac77a41b6644c5L).build2(SMethodBuilder.createJavaParameter((Class<SNode>) ((Class) Object.class), ""), SMethodBuilder.createJavaParameter((Class<SNode>) ((Class) Object.class), ""), SMethodBuilder.createJavaParameter(CompositionContext.class, ""));

  private static final List<SMethod<?>> BH_METHODS = Arrays.<SMethod<?>>asList(compose_id3YyHFqO7EVE);

  private static void ___init___(@NotNull SNode __thisNode__) {
  }

  /*package*/ static CompositionResult compose_id3YyHFqO7EVE(@NotNull final SNode __thisNode__, SNode target, SNode matchNode, CompositionContext ctx) {
    SNode matchFun = SNodeOperations.copyNode(SNodeOperations.cast(matchNode, CONCEPTS.Function$K8));
    SNode targetFun = SNodeOperations.cast(target, CONCEPTS.Function$K8);
    final List<SNode> targetStatements = SLinkOperations.getChildren(SLinkOperations.getTarget(targetFun, LINKS.body$1GE0), LINKS.statements$euTV);
    List<SNode> matchedStatements = SLinkOperations.getChildren(SLinkOperations.getTarget(matchFun, LINKS.body$1GE0), LINKS.statements$euTV);
    if (SNodeOperations.isInstanceOf(SLinkOperations.getTarget(__thisNode__, LINKS.op$vUmo), CONCEPTS.ReplaceOp$RE)) {
      ListSequence.fromList(targetStatements).clear();
      ListSequence.fromList(targetStatements).addSequence(ListSequence.fromList(matchedStatements).select((it) -> SNodeOperations.copyNode(it)));
      return new CompositionResultSuccess();
    }
    if (SNodeOperations.isInstanceOf(SLinkOperations.getTarget(__thisNode__, LINKS.op$vUmo), CONCEPTS.AppendOp$fL)) {
      ListSequence.fromList(targetStatements).addSequence(ListSequence.fromList(matchedStatements).select((it) -> SNodeOperations.copyNode(it)));
      return new CompositionResultSuccess();
    }
    if (SNodeOperations.isInstanceOf(SLinkOperations.getTarget(__thisNode__, LINKS.op$vUmo), CONCEPTS.PrependOp$zd)) {
      ListSequence.fromList(matchedStatements).reversedList().visitAll((it) -> ListSequence.fromList(targetStatements).insertElement(0, it));
      return new CompositionResultSuccess();
    }
    if (SNodeOperations.isInstanceOf(SLinkOperations.getTarget(__thisNode__, LINKS.op$vUmo), CONCEPTS.ReplaceHookOp$VP)) {
      Iterable<SNode> smWithHook = ListSequence.fromList(targetStatements).where((it) -> (new IAttributeDescriptor.NodeAttribute(CONCEPTS.HookAnnotation$ln).get(it) != null));
      Iterable<SNode> matchedHooks = Sequence.fromIterable(smWithHook).where((it) -> SPropertyOperations.getString(new IAttributeDescriptor.NodeAttribute(CONCEPTS.HookAnnotation$ln).get(it), PROPS.name$MnvL).equals(SPropertyOperations.getString(SNodeOperations.cast(SLinkOperations.getTarget(__thisNode__, LINKS.op$vUmo), CONCEPTS.ReplaceHookOp$VP), PROPS.hookName$U_zy)));
      for (SNode hookedSM : Sequence.fromIterable(matchedHooks)) {
        for (SNode ms : ListSequence.fromList(matchedStatements).reversedList()) {
          SNodeOperations.insertPrevSiblingChild(hookedSM, SNodeOperations.copyNode(ms));
        }
        SNodeOperations.deleteNode(hookedSM);
      }
      return new CompositionResultSuccess();
    }
    return new CompositionResultFail(target, __thisNode__, "unknown operation: " + check_19u7gg_a2a0i0a(SNodeOperations.getConcept(SLinkOperations.getTarget(__thisNode__, LINKS.op$vUmo))));
  }

  /*package*/ FunctionStatementMerger__BehaviorDescriptor() {
  }

  @Override
  protected void initNode(@NotNull SNode node, @NotNull SConstructor constructor, @Nullable Object[] parameters) {
    ___init___(node);
  }

  @Override
  protected <T> T invokeSpecial0(@NotNull SNode node, @NotNull SMethod<T> method, @Nullable Object[] parameters) {
    int methodIndex = BH_METHODS.indexOf(method);
    if (methodIndex < 0) {
      throw new BHMethodNotFoundException(this, method);
    }
    switch (methodIndex) {
      case 0:
        return (T) ((CompositionResult) compose_id3YyHFqO7EVE(node, (SNode) parameters[0], (SNode) parameters[1], (CompositionContext) parameters[2]));
      default:
        throw new BHMethodNotFoundException(this, method);
    }
  }

  @Override
  protected <T> T invokeSpecial0(@NotNull SAbstractConcept concept, @NotNull SMethod<T> method, @Nullable Object[] parameters) {
    int methodIndex = BH_METHODS.indexOf(method);
    if (methodIndex < 0) {
      throw new BHMethodNotFoundException(this, method);
    }
    switch (methodIndex) {
      default:
        throw new BHMethodNotFoundException(this, method);
    }
  }

  @NotNull
  @Override
  public List<SMethod<?>> getDeclaredMethods() {
    return BH_METHODS;
  }

  @NotNull
  @Override
  public SAbstractConcept getConcept() {
    return CONCEPT;
  }
  private static String check_19u7gg_a2a0i0a(SConcept checkedDotOperand) {
    if (null != checkedDotOperand) {
      return checkedDotOperand.getName();
    }
    return null;
  }

  private static final class CONCEPTS {
    /*package*/ static final SConcept Function$K8 = MetaAdapterFactory.getConcept(0x6d11763d483d4b2bL, 0x8efc09336c1b0001L, 0x595522006a5b97e1L, "com.mbeddr.core.modules.structure.Function");
    /*package*/ static final SConcept ReplaceOp$RE = MetaAdapterFactory.getConcept(0x3f78d943f334789L, 0xad355950b32fdad8L, 0x59e482034f2d9088L, "com.mbeddr.cc.var.composition.c.structure.ReplaceOp");
    /*package*/ static final SConcept AppendOp$fL = MetaAdapterFactory.getConcept(0x3f78d943f334789L, 0xad355950b32fdad8L, 0x59e482034f2d906bL, "com.mbeddr.cc.var.composition.c.structure.AppendOp");
    /*package*/ static final SConcept PrependOp$zd = MetaAdapterFactory.getConcept(0x3f78d943f334789L, 0xad355950b32fdad8L, 0x59e482034f2d904eL, "com.mbeddr.cc.var.composition.c.structure.PrependOp");
    /*package*/ static final SConcept HookAnnotation$ln = MetaAdapterFactory.getConcept(0x21ac77a41b6644c5L, 0xaaec94e43bb86519L, 0x59e482034f48da05L, "com.mbeddr.cc.var.composition.structure.HookAnnotation");
    /*package*/ static final SConcept ReplaceHookOp$VP = MetaAdapterFactory.getConcept(0x3f78d943f334789L, 0xad355950b32fdad8L, 0x59e482034f4d9de3L, "com.mbeddr.cc.var.composition.c.structure.ReplaceHookOp");
  }

  private static final class LINKS {
    /*package*/ static final SContainmentLink body$1GE0 = MetaAdapterFactory.getContainmentLink(0x6d11763d483d4b2bL, 0x8efc09336c1b0001L, 0x595522006a5b97e1L, 0x3a16e3a9c7ad9954L, "body");
    /*package*/ static final SContainmentLink statements$euTV = MetaAdapterFactory.getContainmentLink(0xa9d696470840491eL, 0xbf392eb0805d2011L, 0x3a16e3a9c7ad9955L, 0x3a16e3a9c7ad9956L, "statements");
    /*package*/ static final SContainmentLink op$vUmo = MetaAdapterFactory.getContainmentLink(0x3f78d943f334789L, 0xad355950b32fdad8L, 0x59e482034f2d904cL, 0x59e482034f2dc494L, "op");
  }

  private static final class PROPS {
    /*package*/ static final SProperty name$MnvL = MetaAdapterFactory.getProperty(0xceab519525ea4f22L, 0x9b92103b95ca8c0cL, 0x110396eaaa4L, 0x110396ec041L, "name");
    /*package*/ static final SProperty hookName$U_zy = MetaAdapterFactory.getProperty(0x3f78d943f334789L, 0xad355950b32fdad8L, 0x59e482034f4d9de3L, 0x59e482034f50758cL, "hookName");
  }
}

package com.mbeddr.cc.requirements.scenarios.findUsages;

/*Generated by MPS */

import jetbrains.mps.ide.findusages.findalgorithm.finders.GeneratedFinder;
import org.jetbrains.mps.openapi.language.SAbstractConcept;
import org.jetbrains.annotations.NotNull;
import org.jetbrains.mps.openapi.model.SNode;
import org.jetbrains.mps.openapi.module.SearchScope;
import jetbrains.mps.ide.findusages.findalgorithm.finders.IFinder;
import org.jetbrains.mps.openapi.util.ProgressMonitor;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SNodeOperations;
import java.util.List;
import jetbrains.mps.ide.findusages.view.FindUtils;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SLinkOperations;
import jetbrains.mps.internal.collections.runtime.ListSequence;
import com.mbeddr.cc.requirements.scenarios.behavior.ICallContext__BehaviorDescriptor;
import org.jetbrains.annotations.Nullable;
import org.jetbrains.mps.openapi.model.SNodeReference;
import org.jetbrains.mps.openapi.language.SConcept;
import jetbrains.mps.smodel.adapter.structure.MetaAdapterFactory;
import org.jetbrains.mps.openapi.language.SInterfaceConcept;
import org.jetbrains.mps.openapi.language.SReferenceLink;

public class findCollaborations_Finder extends GeneratedFinder {
  public findCollaborations_Finder() {
  }
  @Override
  public String getDescription() {
    return "Capability Uses";
  }
  @Override
  public String getLongDescription() {
    return "Capability Uses";
  }
  @Override
  public SAbstractConcept getSConcept() {
    return CONCEPTS.Collaboration$8h;
  }

  @Override
  protected void doFind0(@NotNull SNode node, SearchScope scope, IFinder.FindCallback callback, ProgressMonitor monitor) {
    monitor.start(getDescription(), 1);
    try {
      SNode comp = SNodeOperations.getNodeAncestor(node, CONCEPTS.Component$GQ, false, false);
      List<SNode> all = FindUtils.executeFinder("jetbrains.mps.lang.structure.findUsages.NodeUsages_Finder", SLinkOperations.getTarget(node, LINKS.participant$tAkS), scope, monitor.subTask(1));
      for (SNode usage : ListSequence.fromList(all)) {
        boolean isPartRef = SNodeOperations.isInstanceOf(usage, CONCEPTS.ParticipantRef$i4);
        SNode parent = SNodeOperations.getParent(usage);
        boolean parentIsCall = SNodeOperations.isInstanceOf(parent, CONCEPTS.Call$eV);
        boolean correctContext = ICallContext__BehaviorDescriptor.getContextParticipant_id4YQM_89uRDd.invoke(SNodeOperations.getNodeAncestor(parent, CONCEPTS.ICallContext$Wj, false, false)) == comp;
        if (isPartRef && parentIsCall && correctContext) {
          callback.onUsageFound(createSingleResult(parent));
        }
      }
    } finally {
      monitor.done();
    }
  }

  @Override
  public String getNodeCategory(SNode node) {
    return "Manifestations (Calls)";
  }

  @Nullable
  @Override
  public SNodeReference getDeclarationNode() {
    return buildNodePointer(FindUsagesDescriptor.DECLARING_MODEL, "8119642625901820565");
  }

  private static final class CONCEPTS {
    /*package*/ static final SConcept Collaboration$8h = MetaAdapterFactory.getConcept(0xd6714220402d48cbL, 0xa4a288223c6257f6L, 0x4fb6ca520978eab7L, "com.mbeddr.cc.requirements.scenarios.structure.Collaboration");
    /*package*/ static final SConcept Component$GQ = MetaAdapterFactory.getConcept(0xd6714220402d48cbL, 0xa4a288223c6257f6L, 0x4fb6ca520978688bL, "com.mbeddr.cc.requirements.scenarios.structure.Component");
    /*package*/ static final SConcept ParticipantRef$i4 = MetaAdapterFactory.getConcept(0xd6714220402d48cbL, 0xa4a288223c6257f6L, 0x4fb6ca52097ae40aL, "com.mbeddr.cc.requirements.scenarios.structure.ParticipantRef");
    /*package*/ static final SConcept Call$eV = MetaAdapterFactory.getConcept(0xd6714220402d48cbL, 0xa4a288223c6257f6L, 0x4fb6ca52097b2b30L, "com.mbeddr.cc.requirements.scenarios.structure.Call");
    /*package*/ static final SInterfaceConcept ICallContext$Wj = MetaAdapterFactory.getInterfaceConcept(0xd6714220402d48cbL, 0xa4a288223c6257f6L, 0x4fb6ca52097b7a48L, "com.mbeddr.cc.requirements.scenarios.structure.ICallContext");
  }

  private static final class LINKS {
    /*package*/ static final SReferenceLink participant$tAkS = MetaAdapterFactory.getReferenceLink(0xd6714220402d48cbL, 0xa4a288223c6257f6L, 0x4fb6ca520978eab7L, 0x4fb6ca520978eab9L, "participant");
  }
}

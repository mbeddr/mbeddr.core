package com.mbeddr.cc.var.annotations.behavior;

/*Generated by MPS */

import org.jetbrains.mps.openapi.model.SNode;
import com.mbeddr.cc.var.fm.behavior.IMapping__BehaviorDescriptor;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SNodeOperations;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SLinkOperations;
import jetbrains.mps.internal.collections.runtime.ListSequence;
import com.mbeddr.core.expressions.behavior.Expression__BehaviorDescriptor;
import java.math.BigInteger;
import com.mbeddr.core.expressions.behavior.NumberEvaluationHelper;
import org.jetbrains.mps.openapi.language.SReferenceLink;
import jetbrains.mps.smodel.adapter.structure.MetaAdapterFactory;
import org.jetbrains.mps.openapi.language.SContainmentLink;
import org.jetbrains.mps.openapi.language.SConcept;

public class FeatureConditionEvalHelper {

  private SNode config;

  public FeatureConditionEvalHelper(SNode config) {
    this.config = config;
  }

  public Number attrValue(final SNode far) {
    SNode featureSelection = IMapping__BehaviorDescriptor.getFeatureSelection_id6hM2_xVMLfJ.invoke(config, SNodeOperations.cast(SNodeOperations.getParent(SLinkOperations.getTarget(far, LINKS.attr$VdDL)), CONCEPTS.Feature$U_));
    SNode val = ListSequence.fromList(SLinkOperations.getChildren(featureSelection, LINKS.values$NUfk)).findFirst((it) -> SLinkOperations.getTarget(it, LINKS.attribute$NMYk) == SLinkOperations.getTarget(far, LINKS.attr$VdDL));
    return as_rnryfr_a0c0f(Expression__BehaviorDescriptor.evaluateStatically_id6OxpEKG0KPv.invoke(SLinkOperations.getTarget(val, LINKS.value$NMJj)), Number.class);
  }

  public Number numericValueOf(SNode expr) {
    return dispatch0(expr);
  }

  public boolean isSelected(SNode expr) {
    return dispatch1(expr);
  }

  public Number dispatch0(SNode candidate) {
    if (SNodeOperations.isInstanceOf(candidate, CONCEPTS.EnumLiteralRef$ZN)) {
      return BigInteger.valueOf(SNodeOperations.getIndexInParent(SLinkOperations.getTarget(SNodeOperations.cast(candidate, CONCEPTS.EnumLiteralRef$ZN), LINKS.literal$dkOg)));
    }
    if (SNodeOperations.isInstanceOf(candidate, CONCEPTS.FeatureAttributeRef$It)) {
      return attrValue(SNodeOperations.cast(candidate, CONCEPTS.FeatureAttributeRef$It));
    }
    if (SNodeOperations.isInstanceOf(candidate, CONCEPTS.NumberLiteral$jK)) {
      return as_rnryfr_a0a0c0l(Expression__BehaviorDescriptor.evaluateStatically_id6OxpEKG0KPv.invoke(SNodeOperations.cast(candidate, CONCEPTS.NumberLiteral$jK)), Number.class);
    }
    throw new RuntimeException("cannot handle " + SNodeOperations.present(candidate));
  }
  public boolean dispatch1(SNode candidate) {
    if (SNodeOperations.isInstanceOf(candidate, CONCEPTS.FeatureRef$MU)) {
      return (boolean) IMapping__BehaviorDescriptor.isFeatureSelected_id5USXI9KzkZO.invoke(config, SLinkOperations.getTarget(SNodeOperations.cast(candidate, CONCEPTS.FeatureRef$MU), LINKS.feature$4n8N));
    }
    if (SNodeOperations.isInstanceOf(candidate, CONCEPTS.ParensExpression$Ng)) {
      return isSelected(SLinkOperations.getTarget(SNodeOperations.cast(candidate, CONCEPTS.ParensExpression$Ng), LINKS.expression$PfNq));
    }
    if (SNodeOperations.isInstanceOf(candidate, CONCEPTS.AndExpression$P)) {
      return isSelected(SLinkOperations.getTarget(SNodeOperations.cast(candidate, CONCEPTS.AndExpression$P), LINKS.left$SkXz)) && isSelected(SLinkOperations.getTarget(SNodeOperations.cast(candidate, CONCEPTS.AndExpression$P), LINKS.right$Slc$));
    }
    if (SNodeOperations.isInstanceOf(candidate, CONCEPTS.OrExpression$1N)) {
      return isSelected(SLinkOperations.getTarget(SNodeOperations.cast(candidate, CONCEPTS.OrExpression$1N), LINKS.left$SkXz)) || isSelected(SLinkOperations.getTarget(SNodeOperations.cast(candidate, CONCEPTS.OrExpression$1N), LINKS.right$Slc$));
    }
    if (SNodeOperations.isInstanceOf(candidate, CONCEPTS.NotExpression$pF)) {
      return !(isSelected(SLinkOperations.getTarget(SNodeOperations.cast(candidate, CONCEPTS.NotExpression$pF), LINKS.expression$PfNq)));
    }
    if (SNodeOperations.isInstanceOf(candidate, CONCEPTS.EqualsExpression$Mi)) {
      return NumberEvaluationHelper.equal(numericValueOf(SLinkOperations.getTarget(SNodeOperations.cast(candidate, CONCEPTS.EqualsExpression$Mi), LINKS.left$SkXz)), numericValueOf(SLinkOperations.getTarget(SNodeOperations.cast(candidate, CONCEPTS.EqualsExpression$Mi), LINKS.right$Slc$)));
    }
    if (SNodeOperations.isInstanceOf(candidate, CONCEPTS.GreaterExpression$Gc)) {
      return NumberEvaluationHelper.greater(numericValueOf(SLinkOperations.getTarget(SNodeOperations.cast(candidate, CONCEPTS.GreaterExpression$Gc), LINKS.left$SkXz)), numericValueOf(SLinkOperations.getTarget(SNodeOperations.cast(candidate, CONCEPTS.GreaterExpression$Gc), LINKS.right$Slc$)));
    }
    if (SNodeOperations.isInstanceOf(candidate, CONCEPTS.LessExpression$I8)) {
      return NumberEvaluationHelper.less(numericValueOf(SLinkOperations.getTarget(SNodeOperations.cast(candidate, CONCEPTS.LessExpression$I8), LINKS.left$SkXz)), numericValueOf(SLinkOperations.getTarget(SNodeOperations.cast(candidate, CONCEPTS.LessExpression$I8), LINKS.right$Slc$)));
    }
    if (SNodeOperations.isInstanceOf(candidate, CONCEPTS.GreaterEqualsExpression$Ha)) {
      return NumberEvaluationHelper.greaterEqual(numericValueOf(SLinkOperations.getTarget(SNodeOperations.cast(candidate, CONCEPTS.GreaterEqualsExpression$Ha), LINKS.left$SkXz)), numericValueOf(SLinkOperations.getTarget(SNodeOperations.cast(candidate, CONCEPTS.GreaterEqualsExpression$Ha), LINKS.right$Slc$)));
    }
    if (SNodeOperations.isInstanceOf(candidate, CONCEPTS.LessEqualsExpression$Th)) {
      return NumberEvaluationHelper.lessEqual(numericValueOf(SLinkOperations.getTarget(SNodeOperations.cast(candidate, CONCEPTS.LessEqualsExpression$Th), LINKS.left$SkXz)), numericValueOf(SLinkOperations.getTarget(SNodeOperations.cast(candidate, CONCEPTS.LessEqualsExpression$Th), LINKS.right$Slc$)));
    }
    throw new RuntimeException("cannot handle " + SNodeOperations.present(candidate));
  }
  private static <T> T as_rnryfr_a0c0f(Object o, Class<T> type) {
    return (type.isInstance(o) ? (T) o : null);
  }
  private static <T> T as_rnryfr_a0a0c0l(Object o, Class<T> type) {
    return (type.isInstance(o) ? (T) o : null);
  }

  private static final class LINKS {
    /*package*/ static final SReferenceLink attr$VdDL = MetaAdapterFactory.getReferenceLink(0x17fba0eaf154a23L, 0xb0a802b5c1141e75L, 0x6f686b5f00f0a7L, 0x6f686b5f00f0a8L, "attr");
    /*package*/ static final SContainmentLink values$NUfk = MetaAdapterFactory.getContainmentLink(0xe401b44780194ccdL, 0xa72cbfb0230f5782L, 0x5eb8f6e2708cb28eL, 0x5eb8f6e2708cb290L, "values");
    /*package*/ static final SReferenceLink attribute$NMYk = MetaAdapterFactory.getReferenceLink(0xe401b44780194ccdL, 0xa72cbfb0230f5782L, 0x5eb8f6e2708cb285L, 0x5eb8f6e2708cb287L, "attribute");
    /*package*/ static final SContainmentLink value$NMJj = MetaAdapterFactory.getContainmentLink(0xe401b44780194ccdL, 0xa72cbfb0230f5782L, 0x5eb8f6e2708cb285L, 0x5eb8f6e2708cb286L, "value");
    /*package*/ static final SReferenceLink literal$dkOg = MetaAdapterFactory.getReferenceLink(0xefda956e491e4f00L, 0xba1436af2f213ecfL, 0x7a4924c71c1b40b7L, 0x7a4924c71c1b40b8L, "literal");
    /*package*/ static final SReferenceLink feature$4n8N = MetaAdapterFactory.getReferenceLink(0xe401b44780194ccdL, 0xa72cbfb0230f5782L, 0x6a0e1211f0e3a631L, 0x6a0e1211f0e3a632L, "feature");
    /*package*/ static final SContainmentLink expression$PfNq = MetaAdapterFactory.getContainmentLink(0x61c69711ed614850L, 0x81d97714ff227fb0L, 0x29b5b7c4a3763232L, 0x64ae61a4018a9c50L, "expression");
    /*package*/ static final SContainmentLink right$Slc$ = MetaAdapterFactory.getContainmentLink(0x61c69711ed614850L, 0x81d97714ff227fb0L, 0x7af69e2e83a1ba34L, 0x7af69e2e83a1ba41L, "right");
    /*package*/ static final SContainmentLink left$SkXz = MetaAdapterFactory.getContainmentLink(0x61c69711ed614850L, 0x81d97714ff227fb0L, 0x7af69e2e83a1ba34L, 0x7af69e2e83a1ba40L, "left");
  }

  private static final class CONCEPTS {
    /*package*/ static final SConcept Feature$U_ = MetaAdapterFactory.getConcept(0xe401b44780194ccdL, 0xa72cbfb0230f5782L, 0x5eb8f6e2708cb292L, "com.mbeddr.cc.var.fm.structure.Feature");
    /*package*/ static final SConcept EnumLiteralRef$ZN = MetaAdapterFactory.getConcept(0xefda956e491e4f00L, 0xba1436af2f213ecfL, 0x7a4924c71c1b40b7L, "com.mbeddr.core.udt.structure.EnumLiteralRef");
    /*package*/ static final SConcept FeatureAttributeRef$It = MetaAdapterFactory.getConcept(0x17fba0eaf154a23L, 0xb0a802b5c1141e75L, 0x6f686b5f00f0a7L, "com.mbeddr.cc.var.annotations.structure.FeatureAttributeRef");
    /*package*/ static final SConcept NumberLiteral$jK = MetaAdapterFactory.getConcept(0x61c69711ed614850L, 0x81d97714ff227fb0L, 0x7af69e2e83a1ba67L, "com.mbeddr.core.expressions.structure.NumberLiteral");
    /*package*/ static final SConcept FeatureRef$MU = MetaAdapterFactory.getConcept(0xe401b44780194ccdL, 0xa72cbfb0230f5782L, 0x6a0e1211f0e3a631L, "com.mbeddr.cc.var.fm.structure.FeatureRef");
    /*package*/ static final SConcept ParensExpression$Ng = MetaAdapterFactory.getConcept(0x61c69711ed614850L, 0x81d97714ff227fb0L, 0x4ffba68fe82dd4c7L, "com.mbeddr.core.expressions.structure.ParensExpression");
    /*package*/ static final SConcept AndExpression$P = MetaAdapterFactory.getConcept(0x61c69711ed614850L, 0x81d97714ff227fb0L, 0x7490dc0ede26e048L, "com.mbeddr.core.expressions.structure.AndExpression");
    /*package*/ static final SConcept OrExpression$1N = MetaAdapterFactory.getConcept(0x61c69711ed614850L, 0x81d97714ff227fb0L, 0x7490dc0ede26e04aL, "com.mbeddr.core.expressions.structure.OrExpression");
    /*package*/ static final SConcept NotExpression$pF = MetaAdapterFactory.getConcept(0x61c69711ed614850L, 0x81d97714ff227fb0L, 0x352a4cc97cbac907L, "com.mbeddr.core.expressions.structure.NotExpression");
    /*package*/ static final SConcept EqualsExpression$Mi = MetaAdapterFactory.getConcept(0x61c69711ed614850L, 0x81d97714ff227fb0L, 0x7af69e2e83a1bf2aL, "com.mbeddr.core.expressions.structure.EqualsExpression");
    /*package*/ static final SConcept GreaterExpression$Gc = MetaAdapterFactory.getConcept(0x61c69711ed614850L, 0x81d97714ff227fb0L, 0x7af69e2e83a205f5L, "com.mbeddr.core.expressions.structure.GreaterExpression");
    /*package*/ static final SConcept LessExpression$I8 = MetaAdapterFactory.getConcept(0x61c69711ed614850L, 0x81d97714ff227fb0L, 0x7af69e2e83a205f9L, "com.mbeddr.core.expressions.structure.LessExpression");
    /*package*/ static final SConcept GreaterEqualsExpression$Ha = MetaAdapterFactory.getConcept(0x61c69711ed614850L, 0x81d97714ff227fb0L, 0x7af69e2e83a205f7L, "com.mbeddr.core.expressions.structure.GreaterEqualsExpression");
    /*package*/ static final SConcept LessEqualsExpression$Th = MetaAdapterFactory.getConcept(0x61c69711ed614850L, 0x81d97714ff227fb0L, 0x7af69e2e83a205fbL, "com.mbeddr.core.expressions.structure.LessEqualsExpression");
  }
}

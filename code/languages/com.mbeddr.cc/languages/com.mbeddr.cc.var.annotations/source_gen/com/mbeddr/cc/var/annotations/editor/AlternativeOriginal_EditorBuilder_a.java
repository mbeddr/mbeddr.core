package com.mbeddr.cc.var.annotations.editor;

/*Generated by MPS */

import jetbrains.mps.editor.runtime.descriptor.AbstractEditorBuilder;
import org.jetbrains.annotations.NotNull;
import org.jetbrains.mps.openapi.model.SNode;
import jetbrains.mps.openapi.editor.EditorContext;
import jetbrains.mps.openapi.editor.cells.EditorCell;
import jetbrains.mps.nodeEditor.cells.EditorCell_Collection;
import jetbrains.mps.nodeEditor.cellLayout.CellLayout_Horizontal;
import jetbrains.mps.openapi.editor.style.Style;
import jetbrains.mps.editor.runtime.style.StyleImpl;
import jetbrains.mps.editor.runtime.style.StyleAttributes;
import com.mbeddr.cc.var.annotations.behavior.VarEditorModeHelper;
import jetbrains.mps.project.AbstractModule;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SNodeOperations;
import java.util.Set;
import org.jetbrains.mps.openapi.model.SReference;
import jetbrains.mps.findUsages.FindUsagesManager;
import java.util.Collections;
import jetbrains.mps.progress.EmptyProgressMonitor;
import jetbrains.mps.internal.collections.runtime.SetSequence;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SLinkOperations;
import com.mbeddr.cc.var.annotations.behavior.FeatureCondition__BehaviorDescriptor;
import jetbrains.mps.nodeEditor.cells.EditorCell_Constant;
import com.mbeddr.cc.var.annotations.editor.fmstyles_StyleSheet.greyAndBigStyleClass;
import jetbrains.mps.nodeEditor.EditorManager;
import jetbrains.mps.openapi.editor.update.AttributeKind;
import org.jetbrains.mps.openapi.language.SConcept;
import jetbrains.mps.smodel.adapter.structure.MetaAdapterFactory;
import org.jetbrains.mps.openapi.language.SContainmentLink;

/*package*/ class AlternativeOriginal_EditorBuilder_a extends AbstractEditorBuilder {
  @NotNull
  private SNode myNode;

  public AlternativeOriginal_EditorBuilder_a(@NotNull EditorContext context, @NotNull SNode node) {
    super(context);
    myNode = node;
  }

  @NotNull
  @Override
  public SNode getNode() {
    return myNode;
  }

  /*package*/ EditorCell createCell() {
    return createCollection_0();
  }

  private EditorCell createCollection_0() {
    EditorCell_Collection editorCell = new EditorCell_Collection(getEditorContext(), myNode, new CellLayout_Horizontal());
    editorCell.setCellId("Collection_5pm1x3_a");
    editorCell.setBig(true);
    setCellContext(editorCell);
    Style style = new StyleImpl();
    style.set(StyleAttributes.SELECTABLE, false);
    editorCell.getStyle().putAll(style);
    if (nodeCondition_5pm1x3_a0a()) {
      editorCell.addEditorCell(createCollection_1());
    }
    return editorCell;
  }
  private boolean nodeCondition_5pm1x3_a0a() {
    if (VarEditorModeHelper.modeIsConcise() || VarEditorModeHelper.modeIsDetailed()) {
      return true;
    }

    AbstractModule module = ((AbstractModule) SNodeOperations.getModel(myNode).getModule());
    Set<SReference> refs = FindUsagesManager.getInstance().findUsages(module.getScope(), Collections.singleton(SNodeOperations.getParent(myNode)), new EmptyProgressMonitor());
    for (SReference ref : SetSequence.fromSet(refs)) {
      SNode src = ref.getSourceNode();
      if (SNodeOperations.isInstanceOf(src, CONCEPTS.ConditionalAlternative$_0)) {
        SNode alt = SNodeOperations.cast(src, CONCEPTS.ConditionalAlternative$_0);
        if (SLinkOperations.getTarget(alt, LINKS.condition$RIVN) == null) {
          continue;
        }
        if (FeatureCondition__BehaviorDescriptor.renderingConfiguration_id6tR2451fqEz.invoke(SLinkOperations.getTarget(alt, LINKS.condition$RIVN)) == null) {
          continue;
        }
        if ((boolean) FeatureCondition__BehaviorDescriptor.isSelectedInRenderingConfiguration_id2h6lNbWo02u.invoke(SLinkOperations.getTarget(alt, LINKS.condition$RIVN))) {
          return false;
        }
      }
    }
    return true;
  }
  private EditorCell createCollection_1() {
    EditorCell_Collection editorCell = new EditorCell_Collection(getEditorContext(), myNode, new CellLayout_Horizontal());
    editorCell.setCellId("Collection_5pm1x3_a0");
    Style style = new StyleImpl();
    style.set(StyleAttributes.SELECTABLE, true);
    editorCell.getStyle().putAll(style);
    editorCell.addEditorCell(createConstant_0());
    editorCell.addEditorCell(createAttributedNodeCell_0());
    return editorCell;
  }
  private EditorCell createConstant_0() {
    EditorCell_Constant editorCell = new EditorCell_Constant(getEditorContext(), myNode, "|^");
    editorCell.setCellId("Constant_5pm1x3_a0a");
    Style style = new StyleImpl();
    new greyAndBigStyleClass(this).apply(style, editorCell);
    editorCell.getStyle().putAll(style);
    deletePCOnPC.setCellActions(editorCell, myNode, getEditorContext());
    editorCell.setDefaultText("");
    return editorCell;
  }
  private EditorCell createAttributedNodeCell_0() {
    EditorManager manager = EditorManager.getInstanceFromContext(getEditorContext());
    EditorCell editorCell = getUpdateSession().getAttributedCell(AttributeKind.NODE, myNode);
    return editorCell;
  }

  private static final class CONCEPTS {
    /*package*/ static final SConcept ConditionalAlternative$_0 = MetaAdapterFactory.getConcept(0x17fba0eaf154a23L, 0xb0a802b5c1141e75L, 0x64a1f32ba3999d5fL, "com.mbeddr.cc.var.annotations.structure.ConditionalAlternative");
  }

  private static final class LINKS {
    /*package*/ static final SContainmentLink condition$RIVN = MetaAdapterFactory.getContainmentLink(0x17fba0eaf154a23L, 0xb0a802b5c1141e75L, 0x64a1f32ba3999d5fL, 0x64a1f32ba3999d99L, "condition");
  }
}

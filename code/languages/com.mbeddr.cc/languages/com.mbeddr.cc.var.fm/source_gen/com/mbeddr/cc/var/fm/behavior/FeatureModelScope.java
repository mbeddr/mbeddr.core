package com.mbeddr.cc.var.fm.behavior;

/*Generated by MPS */

import jetbrains.mps.scope.Scope;
import org.jetbrains.mps.openapi.model.SNode;
import jetbrains.mps.internal.collections.runtime.LinkedListSequence;
import java.util.LinkedList;
import java.util.List;
import jetbrains.mps.internal.collections.runtime.ListSequence;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SLinkOperations;
import org.jetbrains.annotations.Nullable;
import jetbrains.mps.internal.collections.runtime.Sequence;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SPropertyOperations;
import org.jetbrains.annotations.NotNull;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SNodeOperations;
import org.jetbrains.mps.openapi.language.SContainmentLink;
import jetbrains.mps.smodel.adapter.structure.MetaAdapterFactory;
import org.jetbrains.mps.openapi.language.SProperty;
import org.jetbrains.mps.openapi.language.SConcept;

public class FeatureModelScope extends Scope {
  private SNode featureModel;
  public FeatureModelScope(SNode featureModel) {
    this.featureModel = featureModel;
  }
  private Iterable<SNode> getAllElements() {
    return LinkedListSequence.fromLinkedList(new LinkedList<SNode>());
  }
  private List<SNode> add(final List<SNode> sequence, SNode feature) {
    if (feature != null) {
      ListSequence.fromList(sequence).addElement(feature);
      ListSequence.fromList(SLinkOperations.getChildren(feature, LINKS.children$NVdk)).visitAll((it) -> add(sequence, it));
    }
    return sequence;
  }
  public Iterable<SNode> getAvailableElements(@Nullable final String prefix) {
    return Sequence.fromIterable(getAllElements()).where((it) -> SPropertyOperations.getString(it, PROPS.name$MnvL) != null && SPropertyOperations.getString(it, PROPS.name$MnvL).startsWith(prefix));
  }
  @Nullable
  public SNode resolve(SNode contextNode, @NotNull final String refText) {
    return Sequence.fromIterable(getAllElements()).findFirst((it) -> SPropertyOperations.getString(it, PROPS.name$MnvL) != null && SPropertyOperations.getString(it, PROPS.name$MnvL).equals(refText));
  }
  @Nullable
  public String getReferenceText(SNode contextNode, @NotNull SNode node) {
    {
      final SNode f = node;
      if (SNodeOperations.isInstanceOf(f, CONCEPTS.Feature$U_)) {
        return SPropertyOperations.getString(f, PROPS.name$MnvL);
      }
    }
    return null;
  }

  private static final class LINKS {
    /*package*/ static final SContainmentLink children$NVdk = MetaAdapterFactory.getContainmentLink(0xe401b44780194ccdL, 0xa72cbfb0230f5782L, 0x5eb8f6e2708cb292L, 0x5eb8f6e2708cb294L, "children");
  }

  private static final class PROPS {
    /*package*/ static final SProperty name$MnvL = MetaAdapterFactory.getProperty(0xceab519525ea4f22L, 0x9b92103b95ca8c0cL, 0x110396eaaa4L, 0x110396ec041L, "name");
  }

  private static final class CONCEPTS {
    /*package*/ static final SConcept Feature$U_ = MetaAdapterFactory.getConcept(0xe401b44780194ccdL, 0xa72cbfb0230f5782L, 0x5eb8f6e2708cb292L, "com.mbeddr.cc.var.fm.structure.Feature");
  }
}

package com.mbeddr.ext.units.editor;

/*Generated by MPS */

import jetbrains.mps.nodeEditor.menus.transformation.TransformationMenuBase;
import jetbrains.mps.lang.editor.menus.EditorMenuDescriptorBase;
import jetbrains.mps.smodel.SNodePointer;
import java.util.List;
import jetbrains.mps.lang.editor.menus.transformation.MenuLocations;
import org.jetbrains.annotations.NotNull;
import jetbrains.mps.lang.editor.menus.MenuPart;
import jetbrains.mps.openapi.editor.menus.transformation.TransformationMenuItem;
import jetbrains.mps.openapi.editor.menus.transformation.TransformationMenuContext;
import java.util.ArrayList;
import jetbrains.mps.internal.collections.runtime.ListSequence;
import jetbrains.mps.lang.editor.menus.GroupMenuPart;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SNodeOperations;
import jetbrains.mps.typechecking.TypecheckingFacade;
import java.util.Arrays;
import jetbrains.mps.lang.editor.menus.transformation.ConstraintsFilteringTransformationMenuPartDecorator;
import jetbrains.mps.lang.editor.menus.ParameterizedMenuPart;
import org.jetbrains.mps.openapi.model.SNode;
import org.jetbrains.annotations.Nullable;
import jetbrains.mps.internal.collections.runtime.SetSequence;
import com.mbeddr.ext.units.runtime.plugin.ScopingHelper;
import jetbrains.mps.lang.editor.menus.SingleItemMenuPart;
import jetbrains.mps.lang.editor.menus.transformation.ActionItemBase;
import jetbrains.mps.nodeEditor.cellMenu.SideTransformCompletionActionItem;
import jetbrains.mps.openapi.editor.menus.transformation.ConstraintsVerifiableActionItem;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SPropertyOperations;
import jetbrains.mps.editor.runtime.selection.SelectionUtil;
import jetbrains.mps.openapi.editor.selection.SelectionManager;
import org.jetbrains.mps.openapi.language.SAbstractConcept;
import jetbrains.mps.openapi.editor.menus.style.EditorMenuItemStyle;
import jetbrains.mps.editor.runtime.menus.EditorMenuItemModifyingCustomizationContext;
import jetbrains.mps.editor.runtime.menus.EditorMenuItemCompositeCustomizationContext;
import jetbrains.mps.editor.runtime.completion.CompletionMenuItemCustomizationContext;
import jetbrains.mps.editor.runtime.completion.CompletionItemInformation;
import jetbrains.mps.openapi.editor.menus.style.EditorMenuItemCustomizer;
import jetbrains.mps.internal.collections.runtime.CollectionSequence;
import jetbrains.mps.smodel.builder.SNodeBuilder;
import org.jetbrains.mps.openapi.language.SConcept;
import jetbrains.mps.smodel.adapter.structure.MetaAdapterFactory;
import org.jetbrains.mps.openapi.language.SProperty;
import org.jetbrains.mps.openapi.language.SContainmentLink;
import org.jetbrains.mps.openapi.language.SReferenceLink;

public class Expression_PrimitiveType_SpecifyUnit_Contribution extends TransformationMenuBase {
  public Expression_PrimitiveType_SpecifyUnit_Contribution() {
    super(true, new EditorMenuDescriptorBase("contribution to the " + "default transformation menu for " + "Expression", new SNodePointer("r:5b3a7fb6-3625-421c-a433-fc84488109d4(com.mbeddr.ext.units.editor)", "3691316882320236799")), List.<String>of(MenuLocations.RIGHT_SIDE_TRANSFORM));
  }

  @Override
  @NotNull
  protected List<MenuPart<TransformationMenuItem, TransformationMenuContext>> getParts(TransformationMenuContext _context) {
    List<MenuPart<TransformationMenuItem, TransformationMenuContext>> result = new ArrayList<MenuPart<TransformationMenuItem, TransformationMenuContext>>();
    if (ListSequence.fromListAndArray(new ArrayList<String>(), MenuLocations.RIGHT_SIDE_TRANSFORM).contains(_context.getMenuLocation())) {
      result.add(new TMP_Group_kyrnr_a0());
    }
    return result;
  }

  public class TMP_Group_kyrnr_a0 extends GroupMenuPart<TransformationMenuItem, TransformationMenuContext> {
    public TMP_Group_kyrnr_a0() {
      super(new EditorMenuDescriptorBase("transformation menu group", new SNodePointer("r:5b3a7fb6-3625-421c-a433-fc84488109d4(com.mbeddr.ext.units.editor)", "3691316882320236805")));
    }
    @Override
    protected boolean isApplicable(TransformationMenuContext _context) {
      // check if there doesn't exist already an annotated expression around the original expression
      // and that the type of the source node is either of the three interesting primitive types

      boolean cond1 = (SNodeOperations.getNodeAncestor(_context.getNode(), CONCEPTS.AnnotatedExpression$Ec, true, false) == null);
      boolean cond2 = ((TypecheckingFacade.getFromContext().coerceType(TypecheckingFacade.getFromContext().getTypeOf(_context.getNode()), CONCEPTS.PrimitiveBasicIntegralType$$2) != null) || (TypecheckingFacade.getFromContext().coerceType(TypecheckingFacade.getFromContext().getTypeOf(_context.getNode()), CONCEPTS.PrimitiveC99IntegralType$E_) != null) || (TypecheckingFacade.getFromContext().coerceType(TypecheckingFacade.getFromContext().getTypeOf(_context.getNode()), CONCEPTS.PrimitiveIEEE754Type$WK) != null));

      return cond1 && cond2;
    }
    @Override
    protected List<MenuPart<TransformationMenuItem, TransformationMenuContext>> getParts() {
      return Arrays.<MenuPart<TransformationMenuItem, TransformationMenuContext>>asList(new ConstraintsFilteringTransformationMenuPartDecorator(new TMP_Param_kyrnr_a0a(), CONCEPTS.AnnotatedType$I9));
    }
    private class TMP_Param_kyrnr_a0a extends ParameterizedMenuPart<SNode, TransformationMenuItem, TransformationMenuContext> {
      /*package*/ TMP_Param_kyrnr_a0a() {
        super(new EditorMenuDescriptorBase("parameterized transformation menu part", new SNodePointer("r:5b3a7fb6-3625-421c-a433-fc84488109d4(com.mbeddr.ext.units.editor)", "3691316882320236860")));
      }
      @NotNull
      @Override
      protected List<TransformationMenuItem> createItems(SNode parameter, TransformationMenuContext context) {
        return new TMP_Action_kyrnr_a0a0(parameter).createItems(context);
      }

      @Nullable
      @Override
      protected Iterable<? extends SNode> getParameters(TransformationMenuContext _context) {
        return SetSequence.fromSet(ScopingHelper.getVisibleUnitsFrom(_context.getNode())).toList();
      }

      private class TMP_Action_kyrnr_a0a0 extends SingleItemMenuPart<TransformationMenuItem, TransformationMenuContext> {
        private final SNode myParameterObject;
        public TMP_Action_kyrnr_a0a0(SNode parameterObject) {
          myParameterObject = parameterObject;
        }
        @Nullable
        protected TransformationMenuItem createItem(TransformationMenuContext context) {
          return new Item(context).resetTraceInfo();
        }

        private class Item extends ActionItemBase implements SideTransformCompletionActionItem, ConstraintsVerifiableActionItem {
          /*package*/ Item(TransformationMenuContext context) {
            super(context);
          }
          /*package*/ Item resetTraceInfo() {
            updateTraceInfo("single item: " + getLabelText(""), new SNodePointer("r:5b3a7fb6-3625-421c-a433-fc84488109d4(com.mbeddr.ext.units.editor)", "3691316882320236870"));
            return this;
          }
          @Nullable
          @Override
          public String getLabelText(String pattern) {
            return SPropertyOperations.getString(myParameterObject, PROPS.name$MnvL);
          }

          @Override
          public void execute(@NotNull String pattern) {
            SelectionUtil.selectLabelCellAnSetCaret(_context.getEditorContext(), SNodeOperations.replaceWithAnother(_context.getNode(), createAnnotatedExpression_kyrnr_a0a0a0a0a0a(SNodeOperations.copyNode(_context.getNode()), myParameterObject)), SelectionManager.LAST_EDITABLE_CELL, -1);
          }


          @Nullable
          @Override
          public SAbstractConcept getOutputConcept() {
            return CONCEPTS.AnnotatedType$I9;
          }
          @Override
          public String getShortDescriptionText(@NotNull String pattern) {
            if (SNodeOperations.isInstanceOf(myParameterObject, CONCEPTS.MetaUnit$gm)) {
              return "";
            } else {
              return SPropertyOperations.getString(SNodeOperations.cast(myParameterObject, CONCEPTS.Unit$Yt), PROPS.description$eFCI);
            }
          }

          public void customize(String pattern, EditorMenuItemStyle style) {
            EditorMenuItemModifyingCustomizationContext modifyingContext = new EditorMenuItemModifyingCustomizationContext(_context.getNode(), null, null, null);
            SAbstractConcept outputConcept = CONCEPTS.AnnotatedType$I9;
            EditorMenuItemCompositeCustomizationContext compositeContext = new EditorMenuItemCompositeCustomizationContext(modifyingContext, new CompletionMenuItemCustomizationContext(new CompletionItemInformation(myParameterObject, outputConcept, getLabelText(pattern), getShortDescriptionText(pattern))));
            for (EditorMenuItemCustomizer customizer : CollectionSequence.fromCollection(_context.getCustomizers())) {
              customizer.customize(style, compositeContext);
            }
          }
        }
      }
    }
  }
  private static SNode createAnnotatedExpression_kyrnr_a0a0a0a0a0a(SNode p0, SNode p1) {
    SNodeBuilder n0 = new SNodeBuilder().init(CONCEPTS.AnnotatedExpression$Ec);
    n0.forChild(LINKS.innerExpression$bkfw).initNode(p0, CONCEPTS.Expression$bT, true);
    {
      SNodeBuilder n1 = n0.forChild(LINKS.specification$6D2X).init(CONCEPTS.UnitSpecification$om);
      {
        SNodeBuilder n2 = n1.forChild(LINKS.components$PbgL).init(CONCEPTS.UnitReference$hr);
        n2.setReferenceTarget(LINKS.unit$ZXwJ, p1);
      }
    }
    return n0.getResult();
  }

  private static final class CONCEPTS {
    /*package*/ static final SConcept AnnotatedExpression$Ec = MetaAdapterFactory.getConcept(0xd04a6cc773e4069L, 0xb9b011884b2ff1c8L, 0x73b48a125b0c5df0L, "com.mbeddr.ext.units.structure.AnnotatedExpression");
    /*package*/ static final SConcept PrimitiveBasicIntegralType$$2 = MetaAdapterFactory.getConcept(0x61c69711ed614850L, 0x81d97714ff227fb0L, 0x4d4a3140e3e01fdaL, "com.mbeddr.core.expressions.structure.PrimitiveBasicIntegralType");
    /*package*/ static final SConcept PrimitiveC99IntegralType$E_ = MetaAdapterFactory.getConcept(0x61c69711ed614850L, 0x81d97714ff227fb0L, 0x75739ed9f39c4635L, "com.mbeddr.core.expressions.structure.PrimitiveC99IntegralType");
    /*package*/ static final SConcept PrimitiveIEEE754Type$WK = MetaAdapterFactory.getConcept(0x61c69711ed614850L, 0x81d97714ff227fb0L, 0x7efa919be7fb2073L, "com.mbeddr.core.expressions.structure.PrimitiveIEEE754Type");
    /*package*/ static final SConcept AnnotatedType$I9 = MetaAdapterFactory.getConcept(0xd04a6cc773e4069L, 0xb9b011884b2ff1c8L, 0x73b48a125b0f3f14L, "com.mbeddr.ext.units.structure.AnnotatedType");
    /*package*/ static final SConcept MetaUnit$gm = MetaAdapterFactory.getConcept(0xd04a6cc773e4069L, 0xb9b011884b2ff1c8L, 0x73b48a125b28a2ddL, "com.mbeddr.ext.units.structure.MetaUnit");
    /*package*/ static final SConcept Unit$Yt = MetaAdapterFactory.getConcept(0xd04a6cc773e4069L, 0xb9b011884b2ff1c8L, 0x73b48a125b0d373fL, "com.mbeddr.ext.units.structure.Unit");
    /*package*/ static final SConcept Expression$bT = MetaAdapterFactory.getConcept(0x61c69711ed614850L, 0x81d97714ff227fb0L, 0x7af69e2e83a1ba32L, "com.mbeddr.core.expressions.structure.Expression");
    /*package*/ static final SConcept UnitSpecification$om = MetaAdapterFactory.getConcept(0xd04a6cc773e4069L, 0xb9b011884b2ff1c8L, 0x73b48a125b0d411dL, "com.mbeddr.ext.units.structure.UnitSpecification");
    /*package*/ static final SConcept UnitReference$hr = MetaAdapterFactory.getConcept(0xd04a6cc773e4069L, 0xb9b011884b2ff1c8L, 0x73b48a125b0d4dc5L, "com.mbeddr.ext.units.structure.UnitReference");
  }

  private static final class PROPS {
    /*package*/ static final SProperty name$MnvL = MetaAdapterFactory.getProperty(0xceab519525ea4f22L, 0x9b92103b95ca8c0cL, 0x110396eaaa4L, 0x110396ec041L, "name");
    /*package*/ static final SProperty description$eFCI = MetaAdapterFactory.getProperty(0xd04a6cc773e4069L, 0xb9b011884b2ff1c8L, 0x73b48a125b0d373fL, 0x73b48a125b0d3d88L, "description");
  }

  private static final class LINKS {
    /*package*/ static final SContainmentLink innerExpression$bkfw = MetaAdapterFactory.getContainmentLink(0xd04a6cc773e4069L, 0xb9b011884b2ff1c8L, 0x73b48a125b0c5df0L, 0x73b48a125b0d373aL, "innerExpression");
    /*package*/ static final SContainmentLink specification$6D2X = MetaAdapterFactory.getContainmentLink(0xd04a6cc773e4069L, 0xb9b011884b2ff1c8L, 0x73b48a125b0c5df0L, 0x73b48a125b0e856dL, "specification");
    /*package*/ static final SContainmentLink components$PbgL = MetaAdapterFactory.getContainmentLink(0xd04a6cc773e4069L, 0xb9b011884b2ff1c8L, 0x73b48a125b0d411dL, 0x73b48a125b0dab03L, "components");
    /*package*/ static final SReferenceLink unit$ZXwJ = MetaAdapterFactory.getReferenceLink(0xd04a6cc773e4069L, 0xb9b011884b2ff1c8L, 0x73b48a125b0d4dc5L, 0x73b48a125b0daafcL, "unit");
  }
}

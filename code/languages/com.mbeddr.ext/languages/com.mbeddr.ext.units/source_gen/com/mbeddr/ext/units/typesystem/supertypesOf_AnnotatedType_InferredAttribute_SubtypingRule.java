package com.mbeddr.ext.units.typesystem;

/*Generated by MPS */

import jetbrains.mps.lang.typesystem.runtime.SubtypingRule_Runtime;
import jetbrains.mps.lang.typesystem.runtime.ISubtypingRule_Runtime;
import java.util.List;
import org.jetbrains.mps.openapi.model.SNode;
import jetbrains.mps.typesystem.inference.TypeCheckingContext;
import jetbrains.mps.lang.typesystem.runtime.IsApplicableStatus;
import jetbrains.mps.internal.collections.runtime.ListSequence;
import java.util.ArrayList;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.IAttributeDescriptor;
import com.mbeddr.ext.units.runtime.plugin.UnitConversionUtil;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SLinkOperations;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SNodeOperations;
import jetbrains.mps.internal.collections.runtime.CollectionSequence;
import jetbrains.mps.typechecking.TypecheckingFacade;
import org.jetbrains.mps.openapi.language.SAbstractConcept;
import jetbrains.mps.smodel.builder.SNodeBuilder;
import org.jetbrains.mps.openapi.language.SContainmentLink;
import jetbrains.mps.smodel.adapter.structure.MetaAdapterFactory;
import org.jetbrains.mps.openapi.language.SReferenceLink;
import org.jetbrains.mps.openapi.language.SConcept;
import org.jetbrains.mps.openapi.language.SInterfaceConcept;

public class supertypesOf_AnnotatedType_InferredAttribute_SubtypingRule extends SubtypingRule_Runtime implements ISubtypingRule_Runtime {
  public supertypesOf_AnnotatedType_InferredAttribute_SubtypingRule() {
  }
  public List<SNode> getSubOrSuperTypes(SNode annotatedType, TypeCheckingContext typeCheckingContext, IsApplicableStatus status) {
    // Specifies the supertypes of an annotated type with substitutions. The
    // supertype will be the annotated type where the meta units are resolved.
    // If no substitutions are present, then it simply returns the immediate
    // supertypes of the inner type.

    List<SNode> supertypes = ListSequence.fromList(new ArrayList<SNode>());
    if ((new IAttributeDescriptor.NodeAttribute(CONCEPTS.InferredAttribute$yb).get(annotatedType) != null)) {
      List<SNode> subsitutedReferences = UnitConversionUtil.createUnitReferences(UnitConversionUtil.getUnitMap_UnitSpecification(SLinkOperations.getTarget(annotatedType, LINKS.specification$Q3Ej), new IAttributeDescriptor.NodeAttribute(CONCEPTS.InferredAttribute$yb).get(annotatedType)));
      if (SNodeOperations.isInstanceOf(SLinkOperations.getTarget(annotatedType, LINKS.valueType$2o7e), CONCEPTS.TypeDefType$3U)) {
        ListSequence.fromList(supertypes).addElement(createAnnotatedType_tuzfxn_a0a0a1a6a1(SNodeOperations.copyNode(SLinkOperations.getTarget(SLinkOperations.getTarget(SNodeOperations.cast(SLinkOperations.getTarget(annotatedType, LINKS.valueType$2o7e), CONCEPTS.TypeDefType$3U), LINKS.typeDef$LmRK), LINKS.original$$TxO)), subsitutedReferences));
      } else {
        ListSequence.fromList(supertypes).addElement(createAnnotatedType_tuzfxn_a0a0a0b0g0b(SNodeOperations.copyNode(SLinkOperations.getTarget(annotatedType, LINKS.valueType$2o7e)), subsitutedReferences));
      }
    } else {
      if (SNodeOperations.isInstanceOf(SLinkOperations.getTarget(annotatedType, LINKS.valueType$2o7e), CONCEPTS.TypeDefType$3U)) {
        SNode original = SLinkOperations.getTarget(SLinkOperations.getTarget(SNodeOperations.cast(SLinkOperations.getTarget(annotatedType, LINKS.valueType$2o7e), CONCEPTS.TypeDefType$3U), LINKS.typeDef$LmRK), LINKS.original$$TxO);
        for (SNode type : CollectionSequence.fromCollection(TypecheckingFacade.getFromContext().getImmediateSupertypes(original))) {
          ListSequence.fromList(supertypes).addElement(createAnnotatedType_tuzfxn_a0a0a1a0a0g0b(SNodeOperations.cast(type, CONCEPTS.IType$a9), SNodeOperations.copyNode(SLinkOperations.getTarget(annotatedType, LINKS.specification$Q3Ej))));
        }
      } else {
        for (SNode type : CollectionSequence.fromCollection(TypecheckingFacade.getFromContext().getImmediateSupertypes(SLinkOperations.getTarget(annotatedType, LINKS.valueType$2o7e)))) {
          ListSequence.fromList(supertypes).addElement(createAnnotatedType_tuzfxn_a0a0a0a0a0a6a1(SNodeOperations.cast(type, CONCEPTS.IType$a9), SNodeOperations.copyNode(SLinkOperations.getTarget(annotatedType, LINKS.specification$Q3Ej))));
        }
      }
    }
    return supertypes;
  }
  public SAbstractConcept getApplicableConcept() {
    return CONCEPTS.AnnotatedType$I9;
  }
  public IsApplicableStatus isApplicableAndPattern(SNode argument) {
    return new IsApplicableStatus(argument.getConcept().isSubConceptOf(getApplicableConcept()), null);
  }
  public boolean isWeak() {
    return false;
  }
  private static SNode createAnnotatedType_tuzfxn_a0a0a1a6a1(SNode p0, Iterable<? extends SNode> p1) {
    SNodeBuilder n0 = new SNodeBuilder().init(CONCEPTS.AnnotatedType$I9);
    n0.forChild(LINKS.valueType$2o7e).initNode(p0, CONCEPTS.IType$a9, true);
    {
      SNodeBuilder n1 = n0.forChild(LINKS.specification$Q3Ej).init(CONCEPTS.UnitSpecification$om);
      n1.forChild(LINKS.components$PbgL).initNodeList(p1, CONCEPTS.UnitReference$hr);
    }
    return n0.getResult();
  }
  private static SNode createAnnotatedType_tuzfxn_a0a0a0b0g0b(SNode p0, Iterable<? extends SNode> p1) {
    SNodeBuilder n0 = new SNodeBuilder().init(CONCEPTS.AnnotatedType$I9);
    n0.forChild(LINKS.valueType$2o7e).initNode(p0, CONCEPTS.IType$a9, true);
    {
      SNodeBuilder n1 = n0.forChild(LINKS.specification$Q3Ej).init(CONCEPTS.UnitSpecification$om);
      n1.forChild(LINKS.components$PbgL).initNodeList(p1, CONCEPTS.UnitReference$hr);
    }
    return n0.getResult();
  }
  private static SNode createAnnotatedType_tuzfxn_a0a0a1a0a0g0b(SNode p0, SNode p1) {
    SNodeBuilder n0 = new SNodeBuilder().init(CONCEPTS.AnnotatedType$I9);
    n0.forChild(LINKS.valueType$2o7e).initNode(p0, CONCEPTS.IType$a9, true);
    n0.forChild(LINKS.specification$Q3Ej).initNode(p1, CONCEPTS.UnitSpecification$om, true);
    return n0.getResult();
  }
  private static SNode createAnnotatedType_tuzfxn_a0a0a0a0a0a6a1(SNode p0, SNode p1) {
    SNodeBuilder n0 = new SNodeBuilder().init(CONCEPTS.AnnotatedType$I9);
    n0.forChild(LINKS.valueType$2o7e).initNode(p0, CONCEPTS.IType$a9, true);
    n0.forChild(LINKS.specification$Q3Ej).initNode(p1, CONCEPTS.UnitSpecification$om, true);
    return n0.getResult();
  }

  private static final class LINKS {
    /*package*/ static final SContainmentLink specification$Q3Ej = MetaAdapterFactory.getContainmentLink(0xd04a6cc773e4069L, 0xb9b011884b2ff1c8L, 0x73b48a125b0f3f14L, 0x73b48a125b0f3f48L, "specification");
    /*package*/ static final SContainmentLink valueType$2o7e = MetaAdapterFactory.getContainmentLink(0x61c69711ed614850L, 0x81d97714ff227fb0L, 0xa526fcd7806eb53L, 0x65d0a4755f54174cL, "valueType");
    /*package*/ static final SReferenceLink typeDef$LmRK = MetaAdapterFactory.getReferenceLink(0xefda956e491e4f00L, 0xba1436af2f213ecfL, 0x54e261614fd09a17L, 0x54e261614fd09a18L, "typeDef");
    /*package*/ static final SContainmentLink original$$TxO = MetaAdapterFactory.getContainmentLink(0x6d11763d483d4b2bL, 0x8efc09336c1b0001L, 0x6b0ac27ac5014717L, 0x54e261614fd09a16L, "original");
    /*package*/ static final SContainmentLink components$PbgL = MetaAdapterFactory.getContainmentLink(0xd04a6cc773e4069L, 0xb9b011884b2ff1c8L, 0x73b48a125b0d411dL, 0x73b48a125b0dab03L, "components");
  }

  private static final class CONCEPTS {
    /*package*/ static final SConcept InferredAttribute$yb = MetaAdapterFactory.getConcept(0xd04a6cc773e4069L, 0xb9b011884b2ff1c8L, 0x55aa7381f5dffdfL, "com.mbeddr.ext.units.structure.InferredAttribute");
    /*package*/ static final SConcept TypeDefType$3U = MetaAdapterFactory.getConcept(0xefda956e491e4f00L, 0xba1436af2f213ecfL, 0x54e261614fd09a17L, "com.mbeddr.core.udt.structure.TypeDefType");
    /*package*/ static final SInterfaceConcept IType$a9 = MetaAdapterFactory.getInterfaceConcept(0xceab519525ea4f22L, 0x9b92103b95ca8c0cL, 0x11f8a0774f2L, "jetbrains.mps.lang.core.structure.IType");
    /*package*/ static final SConcept AnnotatedType$I9 = MetaAdapterFactory.getConcept(0xd04a6cc773e4069L, 0xb9b011884b2ff1c8L, 0x73b48a125b0f3f14L, "com.mbeddr.ext.units.structure.AnnotatedType");
    /*package*/ static final SConcept UnitSpecification$om = MetaAdapterFactory.getConcept(0xd04a6cc773e4069L, 0xb9b011884b2ff1c8L, 0x73b48a125b0d411dL, "com.mbeddr.ext.units.structure.UnitSpecification");
    /*package*/ static final SConcept UnitReference$hr = MetaAdapterFactory.getConcept(0xd04a6cc773e4069L, 0xb9b011884b2ff1c8L, 0x73b48a125b0d4dc5L, "com.mbeddr.ext.units.structure.UnitReference");
  }
}

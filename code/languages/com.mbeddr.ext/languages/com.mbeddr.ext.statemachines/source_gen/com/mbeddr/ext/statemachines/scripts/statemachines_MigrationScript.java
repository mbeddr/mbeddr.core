package com.mbeddr.ext.statemachines.scripts;

/*Generated by MPS */

import jetbrains.mps.lang.script.runtime.BaseMigrationScript;
import jetbrains.mps.lang.script.runtime.AbstractMigrationRefactoring;
import org.jetbrains.mps.openapi.language.SAbstractConcept;
import org.jetbrains.mps.openapi.model.SNode;
import java.util.List;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SModelOperations;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SNodeOperations;
import jetbrains.mps.internal.collections.runtime.ListSequence;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SLinkOperations;
import jetbrains.mps.internal.collections.runtime.Sequence;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SConceptOperations;
import jetbrains.mps.smodel.adapter.structure.MetaAdapterFactory;
import org.jetbrains.annotations.Nullable;
import org.jetbrains.mps.openapi.model.SNodeReference;
import org.jetbrains.mps.openapi.persistence.PersistenceFacade;
import org.jetbrains.mps.openapi.language.SConcept;
import org.jetbrains.mps.openapi.language.SContainmentLink;

public final class statemachines_MigrationScript extends BaseMigrationScript {
  public statemachines_MigrationScript() {
    super("State Machines");
    this.addRefactoring(new AbstractMigrationRefactoring() {
      @Override
      public String getName() {
        return "Sattemachines";
      }
      @Override
      public String getAdditionalInfo() {
        return "Sattemachines";
      }
      @Override
      public SAbstractConcept getApplicableConcept() {
        return CONCEPTS.Statemachine$h1;
      }
      @Override
      public boolean isApplicableInstanceNode(SNode node) {
        List<SNode> bcs = SModelOperations.roots(SNodeOperations.getModel(node), CONCEPTS.BuildConfiguration$kH);
        if (ListSequence.fromList(bcs).isNotEmpty()) {
          SNode bc = ListSequence.fromList(bcs).first();
          Iterable<SNode> items = SLinkOperations.getChildren(bc, LINKS.configurationItems$HPvE);
          SNode ci = Sequence.fromIterable(items).findFirst((it) -> SNodeOperations.isInstanceOf(it, CONCEPTS.StatemachineConfigItem$mA));
          return ci == null;
        }
        return false;
      }
      @Override
      public void doUpdateInstanceNode(SNode node) {
        SNode bc = ListSequence.fromList(SModelOperations.roots(SNodeOperations.getModel(node), CONCEPTS.BuildConfiguration$kH)).first();
        Iterable<SNode> items = SLinkOperations.getChildren(bc, LINKS.configurationItems$HPvE);
        SNode ci = Sequence.fromIterable(items).findFirst((it) -> SNodeOperations.isInstanceOf(it, CONCEPTS.StatemachineConfigItem$mA));
        if (ci == null) {
          ci = SConceptOperations.createNewNode(MetaAdapterFactory.getConcept(0x564e97d68fb741f5L, 0xbfc1c7ed376efd62L, 0x415c3a0da3f0467fL, "com.mbeddr.ext.statemachines.structure.StatemachineConfigItem"));
          ListSequence.fromList(SLinkOperations.getChildren(bc, LINKS.configurationItems$HPvE)).addElement(ci);
        }
      }
      @Override
      public boolean isShowAsIntention() {
        return false;
      }
    });
  }

  @Nullable
  @Override
  public SNodeReference getScriptNode() {
    return PersistenceFacade.getInstance().createNodeReference("r:e13864bd-d994-43cd-a24f-22a4b4b04dad(com.mbeddr.ext.statemachines.scripts)/6183633367245055768");
  }

  private static final class CONCEPTS {
    /*package*/ static final SConcept Statemachine$h1 = MetaAdapterFactory.getConcept(0x564e97d68fb741f5L, 0xbfc1c7ed376efd62L, 0x50315072219db271L, "com.mbeddr.ext.statemachines.structure.Statemachine");
    /*package*/ static final SConcept BuildConfiguration$kH = MetaAdapterFactory.getConcept(0x2d7fadf533f64e80L, 0xa78f0f739add2bdeL, 0x6b1af9f9f43c2f48L, "com.mbeddr.core.buildconfig.structure.BuildConfiguration");
    /*package*/ static final SConcept StatemachineConfigItem$mA = MetaAdapterFactory.getConcept(0x564e97d68fb741f5L, 0xbfc1c7ed376efd62L, 0x415c3a0da3f0467fL, "com.mbeddr.ext.statemachines.structure.StatemachineConfigItem");
  }

  private static final class LINKS {
    /*package*/ static final SContainmentLink configurationItems$HPvE = MetaAdapterFactory.getContainmentLink(0xd4280a54f6df4383L, 0xaa41d1b2bffa7eb1L, 0x3de41a718bc20029L, 0x3de41a718bc2002aL, "configurationItems");
  }
}

package com.mbeddr.ext.statemachines.dataFlow;

/*Generated by MPS */

import jetbrains.mps.lang.dataFlow.DataFlowBuilder;
import jetbrains.mps.lang.dataFlow.DataFlowBuilderContext;
import org.jetbrains.mps.openapi.model.SNode;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SLinkOperations;
import com.mbeddr.core.expressions.behavior.Expression__BehaviorDescriptor;
import java.util.List;
import com.mbeddr.ext.statemachines.behavior.Trigger__BehaviorDescriptor;
import jetbrains.mps.internal.collections.runtime.ListSequence;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SNodeOperations;
import org.jetbrains.mps.openapi.language.SAbstractConcept;
import jetbrains.mps.internal.collections.runtime.Sequence;
import com.mbeddr.ext.statemachines.behavior.Statemachine__BehaviorDescriptor;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SPropertyOperations;
import org.jetbrains.mps.openapi.language.SContainmentLink;
import jetbrains.mps.smodel.adapter.structure.MetaAdapterFactory;
import org.jetbrains.mps.openapi.language.SReferenceLink;
import org.jetbrains.mps.openapi.language.SConcept;
import org.jetbrains.mps.openapi.language.SProperty;

public class Transition_DataFlow extends DataFlowBuilder {
  public void build(final DataFlowBuilderContext _context) {
    SNode guard = SLinkOperations.getTarget(_context.getNode(), LINKS.guard$OBO2);
    if ((boolean) Expression__BehaviorDescriptor.isStaticallyEvaluatable_id3ilck8Kr3zN.invoke(guard) && Expression__BehaviorDescriptor.evaluateStatically_id6OxpEKG0KPv.invoke(guard) instanceof Boolean) {
      Boolean guardEvaluationResult = ((Boolean) Expression__BehaviorDescriptor.evaluateStatically_id6OxpEKG0KPv.invoke(guard));
      if (!(guardEvaluationResult)) {
        _context.getBuilder().emitJump(_context.getBuilder().after(_context.getNode()), "r:7cb6370f-4b48-4728-843f-eb7fc8df09b6(com.mbeddr.ext.statemachines.dataFlow)/7307224057852911965");
      }
    } else {
      _context.getBuilder().emitIfJump(_context.getBuilder().after(_context.getNode()), "r:7cb6370f-4b48-4728-843f-eb7fc8df09b6(com.mbeddr.ext.statemachines.dataFlow)/7307224057852802738");
    }

    List<SNode> eventArguments = SLinkOperations.getChildren(Trigger__BehaviorDescriptor.getEvent_id1_07M0PJvWu.invoke(SLinkOperations.getTarget(_context.getNode(), LINKS.trigger$GAf9)), LINKS.args$bnCY);
    for (SNode argument : ListSequence.fromList(eventArguments)) {
      _context.getBuilder().emitWrite(argument, "r:7cb6370f-4b48-4728-843f-eb7fc8df09b6(com.mbeddr.ext.statemachines.dataFlow)/6827806583615530814");
    }
    SNode state = SNodeOperations.getNodeAncestor(_context.getNode(), CONCEPTS.AbstractState$pd, false, false);
    SNode exitAction = null;
    if (state != null) {
      for (SNode content : ListSequence.fromList(SLinkOperations.getChildren(state, LINKS.contents$78mW))) {
        if (SNodeOperations.isInstanceOf(content, CONCEPTS.ExitAction$mF)) {
          exitAction = SNodeOperations.copyNode(content);
        }
      }
    }
    _context.getBuilder().build((SNode) SLinkOperations.getTarget(_context.getNode(), LINKS.guard$OBO2));
    _context.getBuilder().build((SNode) SLinkOperations.getTarget(_context.getNode(), LINKS.actions$Iazr));

    if (!(ListSequence.fromList(SNodeOperations.getNodeDescendants(SLinkOperations.getTarget(_context.getNode(), LINKS.actions$Iazr), CONCEPTS.SendOutEventStatement$Bw, false, new SAbstractConcept[]{})).isEmpty())) {
      SNode stateMachine = SNodeOperations.getNodeAncestor(_context.getNode(), CONCEPTS.Statemachine$h1, false, false);
      Iterable<SNode> writableVars = Sequence.fromIterable(Statemachine__BehaviorDescriptor.localVariables_id6MWlM4926s9.invoke(stateMachine)).where((it) -> SPropertyOperations.getBoolean(it, PROPS.writable$3B$w));
      for (SNode var : Sequence.fromIterable(writableVars)) {
        _context.getBuilder().emitWrite(var, "r:7cb6370f-4b48-4728-843f-eb7fc8df09b6(com.mbeddr.ext.statemachines.dataFlow)/7307224057852983068");
      }
    }


    if (exitAction != null && SLinkOperations.getTarget(_context.getNode(), LINKS.targetState$DvvA) != state) {
      _context.getBuilder().build((SNode) exitAction);

    }
    _context.getBuilder().emitJump(_context.getBuilder().before(SLinkOperations.getTarget(_context.getNode(), LINKS.targetState$DvvA)), "r:7cb6370f-4b48-4728-843f-eb7fc8df09b6(com.mbeddr.ext.statemachines.dataFlow)/6827806583616245521");

  }

  private static final class LINKS {
    /*package*/ static final SContainmentLink guard$OBO2 = MetaAdapterFactory.getContainmentLink(0x564e97d68fb741f5L, 0xbfc1c7ed376efd62L, 0x11a25169722e07bbL, 0x11a25169722e24e7L, "guard");
    /*package*/ static final SContainmentLink trigger$GAf9 = MetaAdapterFactory.getContainmentLink(0x564e97d68fb741f5L, 0xbfc1c7ed376efd62L, 0x50315072219db2bbL, 0x32f1807ca8773e4eL, "trigger");
    /*package*/ static final SContainmentLink args$bnCY = MetaAdapterFactory.getContainmentLink(0x564e97d68fb741f5L, 0xbfc1c7ed376efd62L, 0x18c9c9c9dcecabd3L, 0x18c9c9c9dced1d80L, "args");
    /*package*/ static final SContainmentLink contents$78mW = MetaAdapterFactory.getContainmentLink(0x564e97d68fb741f5L, 0xbfc1c7ed376efd62L, 0x3af8b5004a9a92a2L, 0x3af8b5004a9acb3dL, "contents");
    /*package*/ static final SContainmentLink actions$Iazr = MetaAdapterFactory.getContainmentLink(0x564e97d68fb741f5L, 0xbfc1c7ed376efd62L, 0x11a25169722e07bbL, 0x11a25169722e2f0fL, "actions");
    /*package*/ static final SReferenceLink targetState$DvvA = MetaAdapterFactory.getReferenceLink(0x564e97d68fb741f5L, 0xbfc1c7ed376efd62L, 0x11a25169722e07bbL, 0x11a25169722f85feL, "targetState");
  }

  private static final class CONCEPTS {
    /*package*/ static final SConcept AbstractState$pd = MetaAdapterFactory.getConcept(0x564e97d68fb741f5L, 0xbfc1c7ed376efd62L, 0x3af8b5004a9a92a2L, "com.mbeddr.ext.statemachines.structure.AbstractState");
    /*package*/ static final SConcept ExitAction$mF = MetaAdapterFactory.getConcept(0x564e97d68fb741f5L, 0xbfc1c7ed376efd62L, 0x41f86c71755ac23cL, "com.mbeddr.ext.statemachines.structure.ExitAction");
    /*package*/ static final SConcept Statemachine$h1 = MetaAdapterFactory.getConcept(0x564e97d68fb741f5L, 0xbfc1c7ed376efd62L, 0x50315072219db271L, "com.mbeddr.ext.statemachines.structure.Statemachine");
    /*package*/ static final SConcept SendOutEventStatement$Bw = MetaAdapterFactory.getConcept(0x564e97d68fb741f5L, 0xbfc1c7ed376efd62L, 0x79eee1655cb959bfL, "com.mbeddr.ext.statemachines.structure.SendOutEventStatement");
  }

  private static final class PROPS {
    /*package*/ static final SProperty writable$3B$w = MetaAdapterFactory.getProperty(0x564e97d68fb741f5L, 0xbfc1c7ed376efd62L, 0x4e2fec0f393b785dL, 0x3e6a1afa163003a1L, "writable");
  }
}

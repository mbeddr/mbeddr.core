package com.mbeddr.ext.components.scripts;

/*Generated by MPS */

import jetbrains.mps.lang.script.runtime.BaseMigrationScript;
import jetbrains.mps.lang.script.runtime.AbstractMigrationRefactoring;
import org.jetbrains.mps.openapi.language.SAbstractConcept;
import org.jetbrains.mps.openapi.model.SNode;
import org.jetbrains.mps.openapi.model.SReference;
import jetbrains.mps.smodel.SNodeLegacy;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SLinkOperations;
import org.jetbrains.annotations.Nullable;
import org.jetbrains.mps.openapi.model.SNodeReference;
import org.jetbrains.mps.openapi.persistence.PersistenceFacade;
import jetbrains.mps.smodel.builder.SNodeBuilder;
import org.jetbrains.mps.openapi.language.SConcept;
import jetbrains.mps.smodel.adapter.structure.MetaAdapterFactory;
import org.jetbrains.mps.openapi.language.SContainmentLink;
import org.jetbrains.mps.openapi.language.SReferenceLink;

public final class refactorWhenConnected_MigrationScript extends BaseMigrationScript {
  public refactorWhenConnected_MigrationScript() {
    super("MBEDDR:2014-03-21 refactor when connected");
    this.addRefactoring(new AbstractMigrationRefactoring() {
      @Override
      public String getName() {
        return "updateWhenConnectedStatements";
      }
      @Override
      public String getAdditionalInfo() {
        return "updateWhenConnectedStatements";
      }
      @Override
      public SAbstractConcept getApplicableConcept() {
        return CONCEPTS.WhenPortConnectedStatement$fw;
      }
      @Override
      public boolean isApplicableInstanceNode(SNode node) {
        SReference reference = new SNodeLegacy(node).getReference("port");
        if (reference == null) {
          return false;
        }

        SNode port = ((SNode) reference.getTargetNode());
        return port != null;
      }
      @Override
      public void doUpdateInstanceNode(SNode node) {
        jetbrains.mps.smodel.SReference reference = new SNodeLegacy(node).getReference("port");
        SNode port = ((SNode) reference.getTargetNode());

        SLinkOperations.setTarget(node, LINKS.portExpr$qDHC, createPortRefExpr_l48qcm_a0d0a0(port));
        node.setReferenceTarget(reference.getLink(), null);
      }
      @Override
      public boolean isShowAsIntention() {
        return false;
      }
    });
  }

  @Nullable
  @Override
  public SNodeReference getScriptNode() {
    return PersistenceFacade.getInstance().createNodeReference("r:39571dfe-a327-4599-8602-d7f9646f3039(com.mbeddr.ext.components.scripts)/1136269059640376281");
  }
  private static SNode createPortRefExpr_l48qcm_a0d0a0(SNode p0) {
    SNodeBuilder n0 = new SNodeBuilder().init(CONCEPTS.PortRefExpr$IW);
    n0.setReferenceTarget(LINKS.port$IUw8, p0);
    return n0.getResult();
  }

  private static final class CONCEPTS {
    /*package*/ static final SConcept WhenPortConnectedStatement$fw = MetaAdapterFactory.getConcept(0x97d2424451db4e2eL, 0x97fc7bd73b1f5f40L, 0x49ac545363852eabL, "com.mbeddr.ext.components.structure.WhenPortConnectedStatement");
    /*package*/ static final SConcept PortRefExpr$IW = MetaAdapterFactory.getConcept(0x97d2424451db4e2eL, 0x97fc7bd73b1f5f40L, 0x707ac195dd6397aaL, "com.mbeddr.ext.components.structure.PortRefExpr");
  }

  private static final class LINKS {
    /*package*/ static final SContainmentLink portExpr$qDHC = MetaAdapterFactory.getContainmentLink(0x97d2424451db4e2eL, 0x97fc7bd73b1f5f40L, 0x49ac545363852eabL, 0xfc4d6b08523b438L, "portExpr");
    /*package*/ static final SReferenceLink port$IUw8 = MetaAdapterFactory.getReferenceLink(0x97d2424451db4e2eL, 0x97fc7bd73b1f5f40L, 0x707ac195dd6397aaL, 0x707ac195dd6397abL, "port");
  }
}

package com.mbeddr.ext.serialization.typesystem;

/*Generated by MPS */

import org.jetbrains.mps.openapi.model.SNode;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SNodeOperations;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SLinkOperations;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.IAttributeDescriptor;
import jetbrains.mps.internal.collections.runtime.ListSequence;
import com.mbeddr.core.udt.behavior.SUDeclaration__BehaviorDescriptor;
import org.jetbrains.mps.openapi.language.SInterfaceConcept;
import jetbrains.mps.smodel.adapter.structure.MetaAdapterFactory;
import org.jetbrains.mps.openapi.language.SConcept;
import org.jetbrains.mps.openapi.language.SContainmentLink;
import org.jetbrains.mps.openapi.language.SReferenceLink;

public class TypeHelper {

  public static boolean isTypeAllowed(SNode t) {
    {
      final SNode td = t;
      if (SNodeOperations.isInstanceOf(td, CONCEPTS.ITypeDecorator$9x)) {
        return isTypeAllowed(SLinkOperations.getTarget(td, LINKS.valueType$2o7e));
      }
    }

    if (isPrimitiveTypeAllowed(t)) {
      return true;
    }

    {
      final SNode st = t;
      if (SNodeOperations.isInstanceOf(st, CONCEPTS.StructType$B3)) {
        SNode decl = SNodeOperations.cast(SLinkOperations.getTarget(st, LINKS.struct$WCsg), CONCEPTS.StructDeclaration$ox);
        if ((new IAttributeDescriptor.NodeAttribute(CONCEPTS.SerialAnnotation$Wb).get(decl) != null)) {
          return ListSequence.fromList(SUDeclaration__BehaviorDescriptor.membersIncludingTransparent_id7TdHRrCpjWZ.invoke(decl)).select((it) -> SLinkOperations.getTarget(it, LINKS.type$sXU3)).all((it) -> isTypeAllowed(it));
        }
      }
    }

    return false;
  }

  private static boolean isPrimitiveTypeAllowed(SNode t) {
    if (SNodeOperations.isInstanceOf(t, CONCEPTS.PrimitiveC99IntegralType$E_)) {
      return true;
    }
    if (SNodeOperations.isInstanceOf(t, CONCEPTS.StringArrayType$DF)) {
      return (SLinkOperations.getTarget(SNodeOperations.cast(t, CONCEPTS.StringArrayType$DF), LINKS.sizeExpr$hVlA) != null);
    }
    if (SNodeOperations.isInstanceOf(t, CONCEPTS.BooleanType$fL)) {
      return true;
    }
    if (SNodeOperations.isInstanceOf(t, CONCEPTS.DoubleType$Lm)) {
      return true;
    }
    if (SNodeOperations.isInstanceOf(t, CONCEPTS.FloatType$6s)) {
      return true;
    }

    return false;
  }

  private static final class CONCEPTS {
    /*package*/ static final SInterfaceConcept ITypeDecorator$9x = MetaAdapterFactory.getInterfaceConcept(0x61c69711ed614850L, 0x81d97714ff227fb0L, 0xa526fcd7806eb53L, "com.mbeddr.core.expressions.structure.ITypeDecorator");
    /*package*/ static final SConcept StructType$B3 = MetaAdapterFactory.getConcept(0xefda956e491e4f00L, 0xba1436af2f213ecfL, 0x58bef62304fc0a38L, "com.mbeddr.core.udt.structure.StructType");
    /*package*/ static final SConcept StructDeclaration$ox = MetaAdapterFactory.getConcept(0xefda956e491e4f00L, 0xba1436af2f213ecfL, 0x58bef62304fc0a2fL, "com.mbeddr.core.udt.structure.StructDeclaration");
    /*package*/ static final SConcept SerialAnnotation$Wb = MetaAdapterFactory.getConcept(0xbb0ad88b63cd45fdL, 0xae278662d274cf3cL, 0x3f5fa3b030827c0dL, "com.mbeddr.ext.serialization.structure.SerialAnnotation");
    /*package*/ static final SConcept PrimitiveC99IntegralType$E_ = MetaAdapterFactory.getConcept(0x61c69711ed614850L, 0x81d97714ff227fb0L, 0x75739ed9f39c4635L, "com.mbeddr.core.expressions.structure.PrimitiveC99IntegralType");
    /*package*/ static final SConcept StringArrayType$DF = MetaAdapterFactory.getConcept(0x3bf5377ae9044dedL, 0x97545a516023bfaaL, 0x4ee1acbf0c8d52c9L, "com.mbeddr.core.pointers.structure.StringArrayType");
    /*package*/ static final SConcept BooleanType$fL = MetaAdapterFactory.getConcept(0x61c69711ed614850L, 0x81d97714ff227fb0L, 0x7af69e2e83a1ba3aL, "com.mbeddr.core.expressions.structure.BooleanType");
    /*package*/ static final SConcept DoubleType$Lm = MetaAdapterFactory.getConcept(0x61c69711ed614850L, 0x81d97714ff227fb0L, 0x7b064baaf4444619L, "com.mbeddr.core.expressions.structure.DoubleType");
    /*package*/ static final SConcept FloatType$6s = MetaAdapterFactory.getConcept(0x61c69711ed614850L, 0x81d97714ff227fb0L, 0x41c7cca6a7ab279fL, "com.mbeddr.core.expressions.structure.FloatType");
  }

  private static final class LINKS {
    /*package*/ static final SContainmentLink valueType$2o7e = MetaAdapterFactory.getContainmentLink(0x61c69711ed614850L, 0x81d97714ff227fb0L, 0xa526fcd7806eb53L, 0x65d0a4755f54174cL, "valueType");
    /*package*/ static final SReferenceLink struct$WCsg = MetaAdapterFactory.getReferenceLink(0xefda956e491e4f00L, 0xba1436af2f213ecfL, 0x58bef62304fc0a38L, 0x58bef62304fc0a39L, "struct");
    /*package*/ static final SContainmentLink type$sXU3 = MetaAdapterFactory.getContainmentLink(0x61c69711ed614850L, 0x81d97714ff227fb0L, 0x46a2a92ac61b183L, 0x46a2a92ac61b184L, "type");
    /*package*/ static final SContainmentLink sizeExpr$hVlA = MetaAdapterFactory.getContainmentLink(0x3bf5377ae9044dedL, 0x97545a516023bfaaL, 0x4ee1acbf0c8d52c9L, 0x4ee1acbf0c8d52ceL, "sizeExpr");
  }
}

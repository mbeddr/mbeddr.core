package com.mbeddr.ext.concurrency.pthreads.behavior;

/*Generated by MPS */

import jetbrains.mps.generator.template.TemplateQueryContext;
import org.jetbrains.mps.openapi.model.SNode;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SPropertyOperations;
import jetbrains.mps.internal.collections.runtime.ListSequence;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SNodeOperations;
import org.jetbrains.mps.openapi.language.SAbstractConcept;
import com.mbeddr.core.buildconfig.behavior.BCHelper;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SLinkOperations;
import org.jetbrains.mps.openapi.language.SProperty;
import jetbrains.mps.smodel.adapter.structure.MetaAdapterFactory;
import org.jetbrains.mps.openapi.language.SConcept;
import org.jetbrains.mps.openapi.language.SContainmentLink;

public class GenConfigHelper {

  public static boolean checkWCET(TemplateQueryContext ctx) {
    SNode strategy = getStrategy(ctx);
    if (strategy == null) {
      return false;
    }
    return SPropertyOperations.getBoolean(strategy, PROPS.checkWCET$JHFk);
  }

  public static boolean checkWCET(TemplateQueryContext ctx, SNode task) {
    return checkWCET(ctx);
  }

  public static boolean checkPeriod(TemplateQueryContext ctx, SNode task) {
    SNode strategy = getStrategy(ctx);
    if (strategy == null) {
      return false;
    }
    return SPropertyOperations.getBoolean(strategy, PROPS.checkPeriod$nKyE);
  }

  public static boolean requiresIterationStartTime(TemplateQueryContext ctx, SNode task) {
    return checkWCET(ctx, task) || ListSequence.fromList(SNodeOperations.getNodeDescendants(task, CONCEPTS.IterationStartTimeTarget$j8, false, new SAbstractConcept[]{})).isNotEmpty();
  }

  public static SNode getStrategy(TemplateQueryContext ctx) {
    SNode rc = BCHelper.expectBCConfigItem(ctx.getInputModel(), ctx, "com.mbeddr.ext.concurrency.pthreads/main.main", CONCEPTS.ConcurrencyConfigItem$uy.getDeclarationNode());
    if (rc == null) {
      return null;
    }
    return SNodeOperations.cast(SLinkOperations.getTarget(SNodeOperations.cast(rc, CONCEPTS.ConcurrencyConfigItem$uy), LINKS.genStrategy$1aJl), CONCEPTS.PThreadsStrategy$O5);
  }

  private static final class PROPS {
    /*package*/ static final SProperty checkWCET$JHFk = MetaAdapterFactory.getProperty(0x8c1a7e14952042a4L, 0xa3a7b15e523af156L, 0x2361f579568d2997L, 0x4472bacfa15039c6L, "checkWCET");
    /*package*/ static final SProperty checkPeriod$nKyE = MetaAdapterFactory.getProperty(0x8c1a7e14952042a4L, 0xa3a7b15e523af156L, 0x2361f579568d2997L, 0x63f008cf24cdec70L, "checkPeriod");
  }

  private static final class CONCEPTS {
    /*package*/ static final SConcept IterationStartTimeTarget$j8 = MetaAdapterFactory.getConcept(0xb879012d402b40e0L, 0x8df7e6fa93b9b711L, 0x20b675ce19184c66L, "com.mbeddr.ext.concurrency.structure.IterationStartTimeTarget");
    /*package*/ static final SConcept ConcurrencyConfigItem$uy = MetaAdapterFactory.getConcept(0xb879012d402b40e0L, 0x8df7e6fa93b9b711L, 0x10a5c0ee63f67c81L, "com.mbeddr.ext.concurrency.structure.ConcurrencyConfigItem");
    /*package*/ static final SConcept PThreadsStrategy$O5 = MetaAdapterFactory.getConcept(0x8c1a7e14952042a4L, 0xa3a7b15e523af156L, 0x2361f579568d2997L, "com.mbeddr.ext.concurrency.pthreads.structure.PThreadsStrategy");
  }

  private static final class LINKS {
    /*package*/ static final SContainmentLink genStrategy$1aJl = MetaAdapterFactory.getContainmentLink(0xb879012d402b40e0L, 0x8df7e6fa93b9b711L, 0x10a5c0ee63f67c81L, 0x10a5c0ee63f6fec4L, "genStrategy");
  }
}

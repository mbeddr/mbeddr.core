package com.mbeddr.ext.units.runtime.plugin;

/*Generated by MPS */

import org.jetbrains.mps.openapi.model.SNode;
import java.util.Queue;
import jetbrains.mps.internal.collections.runtime.QueueSequence;
import java.util.LinkedList;
import java.util.Set;
import jetbrains.mps.internal.collections.runtime.SetSequence;
import java.util.HashSet;
import jetbrains.mps.internal.collections.runtime.ListSequence;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SNodeOperations;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SLinkOperations;
import org.jetbrains.mps.openapi.language.SAbstractConcept;
import org.jetbrains.mps.openapi.language.SReferenceLink;
import jetbrains.mps.smodel.adapter.structure.MetaAdapterFactory;
import org.jetbrains.mps.openapi.language.SContainmentLink;
import org.jetbrains.mps.openapi.language.SConcept;

public class ExpressionChecker {

  public static boolean isSelfReferencingSpecifier(SNode specifier) {
    Queue<SNode> queue = QueueSequence.fromQueue(new LinkedList<SNode>());
    Set<SNode> seenSpecifiers = SetSequence.fromSet(new HashSet<SNode>());

    for (SNode convertExpression : ListSequence.fromList(SNodeOperations.getNodeDescendants(SLinkOperations.getTarget(specifier, LINKS.expression$g3is), CONCEPTS.ConvertExpression$ff, true, new SAbstractConcept[]{}))) {
      if (SLinkOperations.getTarget(convertExpression, LINKS.conversionSpecifier$TvLX) != null) {
        QueueSequence.fromQueue(queue).addLastElement(SLinkOperations.getTarget(convertExpression, LINKS.conversionSpecifier$TvLX));
      }
    }

    while (QueueSequence.fromQueue(queue).isNotEmpty()) {
      SNode head = QueueSequence.fromQueue(queue).removeFirstElement();
      if (head == specifier) {
        return true;
      }
      SetSequence.fromSet(seenSpecifiers).addElement(head);

      for (SNode convertExpression : ListSequence.fromList(SNodeOperations.getNodeDescendants(SLinkOperations.getTarget(head, LINKS.expression$g3is), CONCEPTS.ConvertExpression$ff, true, new SAbstractConcept[]{}))) {
        if (SLinkOperations.getTarget(convertExpression, LINKS.conversionSpecifier$TvLX) != null && !(SetSequence.fromSet(seenSpecifiers).contains(SLinkOperations.getTarget(convertExpression, LINKS.conversionSpecifier$TvLX)))) {
          QueueSequence.fromQueue(queue).addLastElement(SLinkOperations.getTarget(convertExpression, LINKS.conversionSpecifier$TvLX));
        }
      }
    }

    return SetSequence.fromSet(seenSpecifiers).contains(specifier);
  }

  public static boolean hasDivExpressionBeforeMulExpression(SNode expression) {
    Queue<SNode> expressions = QueueSequence.fromQueue(new LinkedList<SNode>());
    QueueSequence.fromQueue(expressions).addLastElement(expression);

    while (QueueSequence.fromQueue(expressions).isNotEmpty()) {
      SNode head = QueueSequence.fromQueue(expressions).removeFirstElement();
      if (SNodeOperations.isInstanceOf(head, CONCEPTS.ParensExpression$Ng)) {
        QueueSequence.fromQueue(expressions).addLastElement(SLinkOperations.getTarget(SNodeOperations.cast(head, CONCEPTS.ParensExpression$Ng), LINKS.expression$PfNq));
      } else if (SNodeOperations.isInstanceOf(head, CONCEPTS.BinaryExpression$cR)) {
        if (SNodeOperations.isInstanceOf(head, CONCEPTS.DivExpression$WL) && hasExpression(SLinkOperations.getTarget(SNodeOperations.cast(head, CONCEPTS.DivExpression$WL), LINKS.right$Slc$), CONCEPTS.MultiExpression$VN)) {
          return true;
        } else if (SNodeOperations.isInstanceOf(head, CONCEPTS.MultiExpression$VN) && hasExpression(SLinkOperations.getTarget(SNodeOperations.cast(head, CONCEPTS.MultiExpression$VN), LINKS.left$SkXz), CONCEPTS.DivExpression$WL)) {
          return true;
        } else {
          QueueSequence.fromQueue(expressions).addLastElement(SLinkOperations.getTarget(SNodeOperations.cast(head, CONCEPTS.BinaryExpression$cR), LINKS.left$SkXz));
          QueueSequence.fromQueue(expressions).addLastElement(SLinkOperations.getTarget(SNodeOperations.cast(head, CONCEPTS.BinaryExpression$cR), LINKS.right$Slc$));
        }
      } else if (SNodeOperations.isInstanceOf(head, CONCEPTS.ConvertExpression$ff)) {
        QueueSequence.fromQueue(expressions).addLastElement(SLinkOperations.getTarget(SNodeOperations.cast(head, CONCEPTS.ConvertExpression$ff), LINKS.expression$LDUH));
      }
    }

    return false;
  }

  public static boolean hasExpression(SNode expression, SAbstractConcept expressionConcept) {
    if (SNodeOperations.isInstanceOf(expression, CONCEPTS.BinaryExpression$cR)) {
      if (SNodeOperations.isInstanceOf(expression, SNodeOperations.asSConcept(expressionConcept))) {
        return true;
      } else {
        return hasExpression(SLinkOperations.getTarget(SNodeOperations.cast(expression, CONCEPTS.BinaryExpression$cR), LINKS.left$SkXz), expressionConcept) || hasExpression(SLinkOperations.getTarget(SNodeOperations.cast(expression, CONCEPTS.BinaryExpression$cR), LINKS.right$Slc$), expressionConcept);
      }
    } else if (SNodeOperations.isInstanceOf(expression, CONCEPTS.ParensExpression$Ng)) {
      return hasExpression(SLinkOperations.getTarget(SNodeOperations.cast(expression, CONCEPTS.ParensExpression$Ng), LINKS.expression$PfNq), expressionConcept);
    } else if (SNodeOperations.isInstanceOf(expression, CONCEPTS.ConvertExpression$ff)) {
      return hasExpression(SLinkOperations.getTarget(SNodeOperations.cast(expression, CONCEPTS.ConvertExpression$ff), LINKS.expression$LDUH), expressionConcept);
    } else {
      return false;
    }
  }

  private static final class LINKS {
    /*package*/ static final SReferenceLink conversionSpecifier$TvLX = MetaAdapterFactory.getReferenceLink(0xd04a6cc773e4069L, 0xb9b011884b2ff1c8L, 0x3930d8ab4c0e6285L, 0x8ac4b7baaeabc73L, "conversionSpecifier");
    /*package*/ static final SContainmentLink expression$g3is = MetaAdapterFactory.getContainmentLink(0xd04a6cc773e4069L, 0xb9b011884b2ff1c8L, 0x182c7aae9fea4574L, 0x182c7aae9fee3f05L, "expression");
    /*package*/ static final SContainmentLink expression$PfNq = MetaAdapterFactory.getContainmentLink(0x61c69711ed614850L, 0x81d97714ff227fb0L, 0x29b5b7c4a3763232L, 0x64ae61a4018a9c50L, "expression");
    /*package*/ static final SContainmentLink right$Slc$ = MetaAdapterFactory.getContainmentLink(0x61c69711ed614850L, 0x81d97714ff227fb0L, 0x7af69e2e83a1ba34L, 0x7af69e2e83a1ba41L, "right");
    /*package*/ static final SContainmentLink left$SkXz = MetaAdapterFactory.getContainmentLink(0x61c69711ed614850L, 0x81d97714ff227fb0L, 0x7af69e2e83a1ba34L, 0x7af69e2e83a1ba40L, "left");
    /*package*/ static final SContainmentLink expression$LDUH = MetaAdapterFactory.getContainmentLink(0xd04a6cc773e4069L, 0xb9b011884b2ff1c8L, 0x3930d8ab4c0e6285L, 0x3930d8ab4c0edbeaL, "expression");
  }

  private static final class CONCEPTS {
    /*package*/ static final SConcept ConvertExpression$ff = MetaAdapterFactory.getConcept(0xd04a6cc773e4069L, 0xb9b011884b2ff1c8L, 0x3930d8ab4c0e6285L, "com.mbeddr.ext.units.structure.ConvertExpression");
    /*package*/ static final SConcept ParensExpression$Ng = MetaAdapterFactory.getConcept(0x61c69711ed614850L, 0x81d97714ff227fb0L, 0x4ffba68fe82dd4c7L, "com.mbeddr.core.expressions.structure.ParensExpression");
    /*package*/ static final SConcept BinaryExpression$cR = MetaAdapterFactory.getConcept(0x61c69711ed614850L, 0x81d97714ff227fb0L, 0x7af69e2e83a1ba34L, "com.mbeddr.core.expressions.structure.BinaryExpression");
    /*package*/ static final SConcept DivExpression$WL = MetaAdapterFactory.getConcept(0x61c69711ed614850L, 0x81d97714ff227fb0L, 0x4ffba68fe82b621eL, "com.mbeddr.core.expressions.structure.DivExpression");
    /*package*/ static final SConcept MultiExpression$VN = MetaAdapterFactory.getConcept(0x61c69711ed614850L, 0x81d97714ff227fb0L, 0x4ffba68fe82b621cL, "com.mbeddr.core.expressions.structure.MultiExpression");
  }
}
